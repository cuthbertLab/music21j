<html lang="en">
<head>
<title>MIDI In Chords for Music21j</title>
	<meta charset="utf-8">
    <link rel="stylesheet" href="../css/m21.css">
</head>
<body>
	<div>
		MIDI Input:
		<div id="putMidiSelectHere"></div>
	</div>
	<h2>Chord and Duration rendering and Metronome Demo.</h2>
	<div id='keyboardDiv'></div>
	<div>
		<i>Requires MIDI keyboard and WebMIDI(Chrome) or Jazz Plugin to work.</i>
	</div>
	<div id="svgDiv">
	</div>
	<div id="metronomeDiv"></div>
	<script type="module" src="./m21-dev.ts"></script>
	<script>
    let s; // will become Stream object soon...
    let metro; // will become Metronome object soon...

    function appendElement(appendObject) {
        if (s.length > 7) {
            s.elements = s.elements.slice(1)
        }
        // if (s.length > 0) {
        //     const lastNote = s.elements[s.length - 1];
        // }
        s.append(appendObject);
        const svgDiv = document.querySelector("#svgDiv");
        svgDiv.replaceChildren();
        s.appendNewDOM(svgDiv);
	}
    function main() {
        s = new music21.stream.Measure();
        s.clef = new music21.clef.TrebleClef();
        s.renderOptions.staffLines = 5;

        metro = new music21.tempo.Metronome();
        metro.addDiv(document.querySelector("#metronomeDiv"));

        music21.miditools.config.metronome = metro;

        const k = new music21.keyboard.Keyboard();
        const kd = document.getElementById('keyboardDiv');
        k.startPitch = 18; // 6
        k.endPitch = 39; // 57

        k.appendKeyboard(kd); // 37key keyboard

        music21.webmidi.createSelector(document.querySelector("#putMidiSelectHere"));
        music21.miditools.callbacks.general = [
            music21.miditools.makeChords,
            music21.keyboard.jazzHighlight.bind(k),
            music21.miditools.sendToMIDIjs,
        ];
        music21.miditools.callbacks.sendOutChord = appendElement;
    }
    document.addEventListener('DOMContentLoaded', () => {
        main();
    });

    </script>

</body>
</html>
