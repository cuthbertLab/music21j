<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Music21j Source: music21/common.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spruce.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Music21j</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="music21.html">music21</a>
						</li>
						
						<li>
							<a href="music21.base.html">music21.base</a>
						</li>
						
						<li>
							<a href="music21.duration.html">music21.duration</a>
						</li>
						
						<li>
							<a href="music21.meter.html">music21.meter</a>
						</li>
						
						<li>
							<a href="music21.miditools.html">music21.miditools</a>
						</li>
						
						<li>
							<a href="music21.note.html">music21.note</a>
						</li>
						
						<li>
							<a href="music21.pitch.html">music21.pitch</a>
						</li>
						
						<li>
							<a href="music21.prebase.html">music21.prebase</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="base.html">music21/base</a>
						</li>
						
						<li>
							<a href="beam.html">music21/beam</a>
						</li>
						
						<li>
							<a href="chord.html">music21/chord</a>
						</li>
						
						<li>
							<a href="duration.html">music21/duration</a>
						</li>
						
						<li>
							<a href="meter.html">music21/meter</a>
						</li>
						
						<li>
							<a href="miditools.html">music21/miditools</a>
						</li>
						
						<li>
							<a href="note.html">music21/note</a>
						</li>
						
						<li>
							<a href="pitch.html">music21/pitch</a>
						</li>
						
						<li>
							<a href="prebase.html">music21/prebase</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="interval.ChromaticInterval.html">interval.ChromaticInterval</a>
						</li>
						
						<li>
							<a href="interval.DiatonicInterval.html">interval.DiatonicInterval</a>
						</li>
						
						<li>
							<a href="interval.GenericInterval.html">interval.GenericInterval</a>
						</li>
						
						<li>
							<a href="key.KeySignature.html">key.KeySignature</a>
						</li>
						
						<li>
							<a href="chord-chord.Chord.html">music21/chord~chord.Chord</a>
						</li>
						
						<li>
							<a href="music21.base.Music21Object.html">music21.base.Music21Object</a>
						</li>
						
						<li>
							<a href="music21.duration.Duration.html">music21.duration.Duration</a>
						</li>
						
						<li>
							<a href="music21.duration.Tuplet.html">music21.duration.Tuplet</a>
						</li>
						
						<li>
							<a href="music21.meter.TimeSignature.html">music21.meter.TimeSignature</a>
						</li>
						
						<li>
							<a href="music21.miditools.Event.html">music21.miditools.Event</a>
						</li>
						
						<li>
							<a href="music21.note.GeneralNote.html">music21.note.GeneralNote</a>
						</li>
						
						<li>
							<a href="music21.note.Lyric.html">music21.note.Lyric</a>
						</li>
						
						<li>
							<a href="music21.note.Note.html">music21.note.Note</a>
						</li>
						
						<li>
							<a href="music21.note.NotRest.html">music21.note.NotRest</a>
						</li>
						
						<li>
							<a href="music21.note.Rest.html">music21.note.Rest</a>
						</li>
						
						<li>
							<a href="music21.pitch.Accidental.html">music21.pitch.Accidental</a>
						</li>
						
						<li>
							<a href="music21.pitch.Pitch.html">music21.pitch.Pitch</a>
						</li>
						
						<li>
							<a href="music21.prebase.ProtoM21Object.html">music21.prebase.ProtoM21Object</a>
						</li>
						
						<li>
							<a href="stream.Measure.html">stream.Measure</a>
						</li>
						
						<li>
							<a href="stream.Part.html">stream.Part</a>
						</li>
						
						<li>
							<a href="stream.Score.html">stream.Score</a>
						</li>
						
						<li>
							<a href="stream.Voice.html">stream.Voice</a>
						</li>
						
						<li>
							<a href="streamInteraction.PixelMapper.html">streamInteraction.PixelMapper</a>
						</li>
						
						<li>
							<a href="vfShow.Renderer.html">vfShow.Renderer</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: music21/common.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">define([], function() {
    var common = {};    
    
    common.merge = function MergeRecursive(destination, source) {
        //concept borrowed from Vex.Flow.Merge, though source can be undefined;
        // http://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically
        // recursive parts used in .clone()
        if (source === undefined || source === null) {
            return destination;
        }
        for (var p in source) {
          try {
            // Property in destination object set; update its value.
            if ( source[p].constructor == Object ) {
                destination[p] = MergeRecursive(destination[p], source[p]);
            } else {
                destination[p] = source[p];
            }
          } catch(e) {
            // Property in destination object not set; create it and set its value.
              destination[p] = source[p];
          }
        }
        return destination;
    };
    
    common.makeSVGright = function (tag, attrs) {
        // see http://stackoverflow.com/questions/3642035/jquerys-append-not-working-with-svg-element
        // normal JQuery does not work.
        var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs) {
            el.setAttribute(k, attrs[k]);            
        }
        return el;
    };    
    
    common.ordinalAbbreviation = function (value, plural) {
        var post = "";
        var valueHundreths = value % 100;
        if (valueHundreths == 11 || valueHundreths == 12 || valueHundreths == 13) {
            post = 'th';
        } else {
            var valueMod = value % 10;
            if (valueMod == 1) {
                post = 'st';
            } else if (valueMod == 2) {
                post = 'nd';
            } else if (valueMod == 3) {
                post = 'rd';
            } else {
                post = 'th';
            }
        }
        if (post != 'st' && plural) {
            post += 's';            
        }
        return post;
    };
    
    common.rationalize = function (ql, epsilon, maxDenominator) {
        epsilon = epsilon || 0.001;
        maxDenominator = maxDenominator || 50;
        
        for (var i = 2; i &lt; maxDenominator; i++) {
            if (Math.abs(ql * i - Math.round(ql * i)) &lt; epsilon) {
                var numerator = Math.round(ql * i);
                var denominator = i;
                return {'numerator': numerator, 'denominator': denominator};
            }
        }
        return undefined;
    };
    
    /* from "400px" to 400 */
    common.stripPx = function (str) {
        if (typeof str == 'string') {
            var pxIndex = str.indexOf('px');
            str = str.slice(0, pxIndex);
            return parseInt(str);
        } else {
            return str;
        }
    };
    
    common.urlParam = function (name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    };
    
    
    /**
     * Logic for copying events from one jQuery object to another.
     *
     * @private 
     * @name music21.common.jQueryEventCopy
     * @param jQuery|String|DOM Element jQuery object to copy events from. Only uses the first matched element.
     * @param jQuery|String|DOM Element jQuery object to copy events to. Copies to all matched elements.
     * @type undefined
     * @author Brandon Aaron (brandon.aaron@gmail.com || http://brandonaaron.net)
     * @author Yannick Albert (mail@yckart.com || http://yckart.com)
     */
    common.jQueryEventCopy = function  (eventObj, from, to) {
        from = from.jquery ? from : jQuery(from);
        to = to.jquery ? to : jQuery(to);
    
        var events = from[0].events || jQuery.data(from[0], "events") || jQuery._data(from[0], "events");
        if (!from.length || !to.length || !events) return;
    
        return to.each(function () {
            for (var type in events)
                for (var handler in events[type])
                    jQuery.event.add(eventObj, type, events[type][handler], events[type][handler].data);
        });
    };
//    common.walk = function (obj, callback, callList, seen, numSeen) {
//        if (depth == undefined) {
//            depth = 0;
//        }
//        if (depth > 20) {
//            throw "max depth reached";
//        }
//        if (callList === undefined) {
//            callList = [];
//        }
//        if (seen === undefined) {
//            seen = new Set();
//        }
//        var next, item;
//        for (item in obj) {
//            if (obj.hasOwnProperty(item)) {
//                next = obj[item];
//                var nextCallList = []
//                nextCallList.push.apply(callList);
//                nextCallList.push(item);
//                if (callback !== undefined) {
//                    callback.call(this, item, next, nextCallList);
//                }
//                if (typeof next =='object' && next != null) {
//                    if (seen.has(next) == false) {
//                        seen.add(next);
//                        common.walk(next, callback, nextCallList, seen, depth+1);
//                    }
//                }
//            }
//        }
//    };
    
    /**
     * runs a callback with either "visible" or "hidden" as the argument anytime the
     * window or document state changes.
     * 
     * Depending on the browser, may be called multiple times with the same argument
     * for a single event.  For instance, Safari calls once on losing focus completely
     * but twice for a tab change.
     */
    common.setWindowFocusWatcher = function (callback) {
        var hidden = "hidden";

        // Standards:
        if (hidden in document) {
            document.addEventListener("visibilitychange", windowFocusChanged);                
        } else if ((hidden = "mozHidden") in document) {
            document.addEventListener("mozvisibilitychange", windowFocusChanged);                
        } else if ((hidden = "webkitHidden") in document) {
            document.addEventListener("webkitvisibilitychange", windowFocusChanged);                
        } else if ((hidden = "msHidden") in document) {
            document.addEventListener("msvisibilitychange", windowFocusChanged);                
        } else if ('onfocusin' in document) {
            // IE 9 and lower:
            document.onfocusin = document.onfocusout = windowFocusChanged;
        } 
        
        // Also catch window... -- get two calls for a tab shift, but one for window losing focus
        window.onpageshow = window.onpagehide = window.onfocus = window.onblur = windowFocusChanged;                
        
        
        function windowFocusChanged (evt) {
            var v = 'visible', h = 'hidden',
                evtMap = { 
                    focus:v, focusin:v, pageshow:v, blur:h, focusout:h, pagehide:h, 
                };

            evt = evt || window.event;
            var callbackState = "";
            if (evt.type in evtMap) {
                callbackState = evtMap[evt.type];                
            } else {
                callbackState = this[hidden] ? "hidden" : "visible";                
            }
            callback(callbackState);
        }
        // set the initial state
        var initialState = ((document.visibilityState == "visible") ? "focus" : "blur");
        var initialStateEvent = { 'type': initialState };
        windowFocusChanged(initialStateEvent); 
    };
    // end of define
    if (typeof(music21) != "undefined") {
        music21.common = common;
    }       
    return common;
});

</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		Music21j, Copyright © 2013-2014 Michael Scott Cuthbert and cuthbertLab.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Thu Oct 23rd 2014 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
