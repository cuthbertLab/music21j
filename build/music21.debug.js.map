{"version":3,"file":null,"sources":["../src/music21/exceptions21.js","../src/music21/debug.js","../src/music21/common.js","../src/music21/prebase.js","../src/music21/duration.js","../src/music21/base.js","../src/music21/articulations.js","../src/music21/audioSearch.js","../src/music21/beam.js","../src/music21/pitch.js","../src/music21/note.js","../src/music21/chord.js","../src/music21/clef.js","../src/music21/dynamics.js","../src/music21/expressions.js","../src/music21/fromPython.js","../src/music21/instrument.js","../src/music21/interval.js","../src/music21/scale.js","../src/music21/key.js","../src/music21/miditools.js","../src/music21/keyboard.js","../src/music21/meter.js","../src/music21/renderOptions.js","../src/music21/streamInteraction.js","../src/music21/vfShow.js","../src/music21/stream.js","../src/music21/layout.js","../src/music21/roman.js","../src/music21/tempo.js","../src/music21/tie.js","../src/music21/tinyNotation.js","../src/music21/webmidi.js","../src/music21/widgets.js","../src/loadModules.js"],"sourcesContent":["// not working properly...\n\nclass ExtendableError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = this.constructor.name;\n        this.message = message; \n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, this.constructor);\n        } else { \n            this.stack = (new Error(message)).stack; \n        }\n    }\n}    \n\nexport class Music21Exception extends ExtendableError {\n    constructor(message) {\n        super(message);\n    }\n}\n\nexport class StreamException extends Music21Exception {\n    constructor(message) {\n        super(message);\n    }\n}\n\n","export const debug = true;\n","/**\n * common functions\n *\n * @exports music21/common\n */\n/**\n * functions that are useful everywhere...\n *\n * @namespace music21.common\n * @memberof music21\n */\nimport * as $ from 'jquery';\n\nexport const common = {};\n\n/**\n * concept borrowed from Vex.Flow.Merge, though here the source can be undefined;\n * http://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically\n * recursive parts used in .clone()\n *\n * @function music21.common.merge\n * @param {object} destination - object to have attributes placed into\n * @param {object} source - object to take attributes from.\n * @memberof music21.common\n * @returns {object} destination\n */\ncommon.merge = function mergeRecursive(destination, source) {\n    if (source === undefined || source === null) {\n        return destination;\n    }\n    for (const p in source) {\n        if (!({}.hasOwnProperty.call(source, p))) {\n            continue;\n        }\n        try {\n            // Property in destination object set; update its value.\n            if (source[p].constructor === Object) {\n                destination[p] = mergeRecursive(destination[p], source[p]);\n            } else {\n                destination[p] = source[p];\n            }\n        } catch (e) {\n            // Property in destination object not set; create it and set its value.\n            destination[p] = source[p];\n        }\n    }\n    return destination;\n};\n\ncommon.mixin = function common_mixin(OtherParent, thisClassOrObject) {\n    let proto = Object.getPrototypeOf(OtherParent);\n    const classProto = Object.getPrototypeOf(thisClassOrObject);\n\n    while (proto) {\n        for (const key of Object.keys(proto)) {\n            if (!(key in classProto)) {\n                classProto[key] = proto[key];\n            }\n        }\n        proto = Object.getPrototypeOf(proto);\n    }\n};\n/**\n *\n * Returns the statistical mode (most commonly appearing element)\n * in a.\n *\n * In case of tie, returns the first element to reach the maximum\n * number of occurrences.\n *\n * @function music21.common.statisticalMode\n * @param {Array} a - an array to analyze\n * @returns {object} element with the highest frequency in a\n */\ncommon.statisticalMode = function statisticalMode(a) {\n    if (a.length === 0) {\n        return null;\n    }\n    const modeMap = {};\n    let maxEl = a[0];\n    let maxCount = 1;\n    for (let i = 0; i < a.length; i++) {\n        const el = a[i];\n        if (modeMap[el] == null) {\n            modeMap[el] = 0;\n        }\n        modeMap[el]++;\n        if (modeMap[el] > maxCount) {\n            maxEl = el;\n            maxCount = modeMap[el];\n        }\n    }\n    return maxEl;\n};\n\n/**\n * Creates a DOMObject of an SVG figure using the correct `document.createElementNS` call.\n *\n * @function music21.common.makeSVGright\n * @param {string} [tag='svg'] - a tag, such as 'rect', 'circle', 'text', or 'svg'\n * @param {object} [attrs] - attributes to pass to the tag.\n * @memberof music21.common\n * @returns {DOMObject}\n */\ncommon.makeSVGright = function makeSVGright(tag, attrs) {\n    // see http://stackoverflow.com/questions/3642035/jquerys-append-not-working-with-svg-element\n    // normal JQuery does not work.\n    if (tag === undefined) {\n        tag = 'svg';\n    }\n    if (attrs === undefined) {\n        attrs = {};\n    }\n\n    const el = document.createElementNS('http://www.w3.org/2000/svg', tag);\n    for (const k in attrs) {\n        if (!({}.hasOwnProperty.call(attrs, k))) {\n            continue;\n        }\n        el.setAttribute(k, attrs[k]);\n    }\n    return el;\n};\n\n/**\n * Take a number such as 32 and return a string such as \"nd\"\n * (for \"32nd\") etc.\n *\n * @function music21.common.ordinalAbbreviation\n * @param {Int} value\n * @param {Boolean} [plural=false] - make plural (note that \"21st\" plural is \"21st\")\n * @return {string}\n */\ncommon.ordinalAbbreviation = function ordinalAbbreviation(value, plural) {\n    let post = '';\n    const valueHundreths = value % 100;\n    if (valueHundreths === 11 || valueHundreths === 12 || valueHundreths === 13) {\n        post = 'th';\n    } else {\n        const valueMod = value % 10;\n        if (valueMod === 1) {\n            post = 'st';\n        } else if (valueMod === 2) {\n            post = 'nd';\n        } else if (valueMod === 3) {\n            post = 'rd';\n        } else {\n            post = 'th';\n        }\n    }\n    if (post !== 'st' && plural) {\n        post += 's';\n    }\n    return post;\n};\n\n/**\n * Find a rational number approximation of this floating point.\n *\n * @function music21.common.rationalize\n * @param {number} ql - number to rationalize\n * @param {number} [epsilon=0.001] - how close to get\n * @param {Int} [maxDenominator=50] - maximum denominator\n * @returns {object|undefined} {'numerator: numerator, 'denominator': denominator}\n */\ncommon.rationalize = function rationalize(ql, epsilon, maxDenominator) {\n    epsilon = epsilon || 0.001;\n    maxDenominator = maxDenominator || 50;\n\n    for (let i = 2; i < maxDenominator; i++) {\n        if (Math.abs(ql * i - Math.round(ql * i)) < epsilon) {\n            const numerator = Math.round(ql * i);\n            const denominator = i;\n            return { 'numerator': numerator, 'denominator': denominator };\n        }\n    }\n    return undefined;\n};\n\n/**\n * Change something that could be a string or number and might\n * end with \"px\" to a number.\n *\n * \"400px\" -> 400\n *\n * @function music21.common.stripPx\n * @param {Int|string} str -- string that might have 'px' at the end or not\n * @returns {Int} a number to use\n */\ncommon.stripPx = function stripPx(str) {\n    if (typeof str === 'string') {\n        const pxIndex = str.indexOf('px');\n        str = str.slice(0, pxIndex);\n        return parseInt(str);\n    } else {\n        return str;\n    }\n};\n\n/**\n * Find name in the query string (?name=value) and return value.\n *\n * @function music21.common.urlParam\n * @param {string} name - url parameter to find\n * @returns {string} may be \"\" if empty.\n */\ncommon.urlParam = function urlParam(name) {\n    name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n    const results = regex.exec(location.search);\n    return results == null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\n\n/**\n * Copies an event from one jQuery object to another.\n *\n * @function music21.common.jQueryEventCopy\n * @param {Event} eventObj - Event to copy from \"from\" to \"to\"\n * @param {jQuery|string|DOMObject} from - jQuery object to copy events from. Only uses the first matched element.\n * @param {jQuery|string|DOMObject} to - jQuery object to copy events to. Copies to all matched elements.\n * @author Brandon Aaron (brandon.aaron@gmail.com || http://brandonaaron.net)\n * @author Yannick Albert (mail@yckart.com || http://yckart.com)\n */\ncommon.jQueryEventCopy = function jQueryEventCopy(eventObj, from, to) {\n    from = from.jquery ? from : $(from);\n    to = to.jquery ? to : $(to);\n\n    const events = from[0].events || $.data(from[0], 'events') || $._data(from[0], 'events');\n    if (!from.length || !to.length || !events) {\n        return undefined;\n    }\n    return to.each(() => {\n        for (const type in events) {\n            if (!({}.hasOwnProperty.call(events, type))) {\n                continue;\n            }\n            for (const handler in events[type]) {\n                if (!({}.hasOwnProperty.call(events[type], handler))) {\n                    continue;\n                }\n                $.event.add(eventObj, type, events[type][handler], events[type][handler].data);\n            }\n        }\n    });\n};\n// common.walk = function (obj, callback, callList, seen, numSeen) {\n// if (depth == undefined) {\n// depth = 0;\n// }\n// if (depth > 20) {\n// throw \"max depth reached\";\n// }\n// if (callList === undefined) {\n// callList = [];\n// }\n// if (seen === undefined) {\n// seen = new Set();\n// }\n// var next, item;\n// for (item in obj) {\n// if (obj.hasOwnProperty(item)) {\n// next = obj[item];\n// var nextCallList = []\n// nextCallList.push.apply(callList);\n// nextCallList.push(item);\n// if (callback !== undefined) {\n// callback.call(this, item, next, nextCallList);\n// }\n// if (typeof next =='object' && next != null) {\n// if (seen.has(next) == false) {\n// seen.add(next);\n// common.walk(next, callback, nextCallList, seen, depth+1);\n// }\n// }\n// }\n// }\n// };\n\n/**\n * runs a callback with either \"visible\" or \"hidden\" as the argument anytime the\n * window or document state changes.\n *\n * Depending on the browser, may be called multiple times with the same argument\n * for a single event.  For instance, Safari calls once on losing focus completely\n * but twice for a tab change.\n *\n * @function music21.common.setWindowVisibilityWatcher\n * @param {function} callback\n */\ncommon.setWindowVisibilityWatcher = function(callback) {\n    let hidden = 'hidden';\n\n    // Standards:\n    if (hidden in document) {\n        document.addEventListener('visibilitychange', windowFocusChanged);\n    } else if ('mozHidden' in document) {\n        hidden = 'mozHidden';\n        document.addEventListener('mozvisibilitychange', windowFocusChanged);\n    } else if ('webkitHidden' in document) {\n        hidden = 'webkitHidden';\n        document.addEventListener('webkitvisibilitychange', windowFocusChanged);\n    } else if ('msHidden' in document) {\n        hidden = 'msHidden';\n        document.addEventListener('msvisibilitychange', windowFocusChanged);\n    } else if ('onfocusin' in document) {\n        // IE 9 and lower:\n        document.onfocusin = document.onfocusout = windowFocusChanged;\n    }\n\n    // Also catch window... -- get two calls for a tab shift, but one for window losing focus\n    window.onpageshow = window.onpagehide = window.onfocus = window.onblur = windowFocusChanged;\n\n\n    function windowFocusChanged(evt) {\n        const v = 'visible';\n        const h = 'hidden';\n        const evtMap = {\n            focus: v, focusin: v, pageshow: v, blur: h, focusout: h, pagehide: h,\n        };\n\n        evt = evt || window.event;\n        let callbackState = '';\n        if (evt.type in evtMap) {\n            callbackState = evtMap[evt.type];\n        } else {\n            callbackState = this[hidden] ? 'hidden' : 'visible';\n        }\n        callback(callbackState, evt);\n    }\n    // set the initial state\n    const initialState = ((document.visibilityState === 'visible') ? 'focus' : 'blur');\n    const initialStateEvent = { 'type': initialState };\n    windowFocusChanged(initialStateEvent);\n};\n","/**\n * module for things that all music21-created objects, not just objects that can live in\n * Stream.elements should inherit. See the {@link music21.prebase} namespace.\n *\n * @exports music21/prebase\n */\n/**\n * module for things that all music21-created objects, not just objects that can live in\n * Stream.elements should inherit\n *\n * @namespace music21.prebase\n * @memberof music21\n */\nexport const prebase = {};\n/**\n * Class for pseudo-m21 objects to inherit from. The most important attributes that nearly\n * everything in music21 should inherit from are given below.\n *\n * @class ProtoM21Object\n * @memberof music21.prebase\n * @property {Array<string>} classes - An Array of strings of classes that the object belongs to (default ['ProtoM21Object'])\n * @property {Boolean} isProtoM21Object - Does this object descend from {@link music21.prebase.ProtoM21Object}: obviously true.\n * @property {Boolean} isMusic21Object - Does this object descend from {@link music21.base.Music21Object}; default false.\n */\nexport class ProtoM21Object {\n    constructor() {\n        this.classes = ['ProtoM21Object'];\n        this.isProtoM21Object = true;\n        this.isMusic21Object = false;\n        this._cloneCallbacks = {};        \n    }\n    /**\n     * Makes (as much as possible) a complete duplicate copy of the object called with .clone()\n     *\n     * Works similarly to Python's copy.deepcopy().\n     *\n     * Every ProtoM21Object has a `._cloneCallbacks` object which maps `{attribute: callbackFunction}`\n     * to handle custom clone cases.  See, for instance, {@link music21.base.Music21Object} which\n     * uses a custom callback to NOT clone the `.activeSite` attribute.\n     *\n     * @returns {object}\n     * @memberof music21.prebase.ProtoM21Object\n     * @example\n     * var n1 = new music21.note.Note(\"C#\");\n     * n1.duration.quarterLength = 4;\n     * var n2 = n1.clone();\n     * n2.duration.quarterLength == 4; // true\n     * n2 === n1; // false\n     */\n    clone() {\n        const ret = new this.constructor();\n\n        // todo: do Arrays work?\n        for (const key in this) { // not that we ONLY copy the keys in Ret -- it's easier that way.\n            if ({}.hasOwnProperty.call(this, key) === false) {\n                continue;\n            }\n            if (key in this._cloneCallbacks) {\n                if (this._cloneCallbacks[key] === true) {\n                    ret[key] = this[key];\n                } else if (this._cloneCallbacks[key] === false) {\n                    ret[key] = undefined;\n                } else { // call the cloneCallbacks function\n                    this._cloneCallbacks[key](key, ret, this);\n                }\n            } else if (\n                    Object.getOwnPropertyDescriptor(this, key).get !== undefined\n                    || Object.getOwnPropertyDescriptor(this, key).set !== undefined\n            ) {\n                // do nothing\n            } else if (typeof (this[key]) === 'function') {\n                // do nothing -- events might not be copied.\n            } else if (typeof (this[key]) === 'object' && this[key] !== null &&\n                    this[key].isProtoM21Object) {\n                // console.log('cloning ', key);\n                ret[key] = this[key].clone();\n            } else {\n                try {\n                    ret[key] = this[key];\n                    // music21.common.merge(ret[key], this[key]); // not really necessary?\n                } catch (e) {\n                    if (e instanceof TypeError) {\n                        console.log('typeError:', e, key);\n                        // do nothing\n                    } else {\n                        throw (e);\n                    }\n                }\n            }\n        }\n        return ret;\n    }\n    /**\n     * Check to see if an object is of this class or subclass.\n     *\n     * @memberof music21.prebase.ProtoM21Object\n     * @param {(string|string[])} testClass - a class or Array of classes to test\n     * @returns {Boolean}\n     * @example\n     * var n = new music21.note.Note();\n     * n.isClassOrSubclass('Note'); // true\n     * n.isClassOrSubclass('Music21Object'); // true\n     * n.isClassOrSubclass(['Duration', 'NotRest']); // true // NotRest\n     */\n    isClassOrSubclass(testClass) {\n        if (testClass instanceof Array === false) {\n            testClass = [testClass];\n        }\n        for (let i = 0; i < testClass.length; i++) {\n            if (this.classes.indexOf(testClass[i]) !== -1) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nprebase.ProtoM21Object = ProtoM21Object;\n\n\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/duration -- duration routines\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006-16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21';\n\nimport { common } from './common';\nimport { debug } from './debug';\nimport { prebase } from './prebase';\n/**\n * Duration module. See {@link music21.duration}\n *\n * @requires music21/common\n * @requires music21/prebase\n * @exports music21/duration\n */\n/**\n * Module that holds **music21** classes and\n * tools for dealing with durations, especially\n * the {@link music21.duration.Duration} class.\n *\n * @namespace music21.duration\n * @memberof music21\n */\nexport const duration = {};\n\n/**\n * Object mapping int to name, as in `{1: 'whole'}` etc.\n *\n * @memberof music21.duration\n * @type {object}\n */\nduration.typeFromNumDict = {\n    1: 'whole',\n    2: 'half',\n    4: 'quarter',\n    8: 'eighth',\n    16: '16th',\n    32: '32nd',\n    64: '64th',\n    128: '128th',\n    256: '256th',\n    512: '512th',\n    1024: '1024th',\n    0: 'zero',\n    '0.5': 'breve',\n    '0.25': 'longa',\n    '0.125': 'maxima',\n    '0.0625': 'duplex-maxima',\n};\nduration.quarterTypeIndex = 6; // where is quarter in the following array.\nduration.ordinalTypeFromNum = ['duplex-maxima', 'maxima', 'longa', 'breve',\n                               'whole', 'half', 'quarter', 'eighth', '16th',\n                               '32nd', '64th', '128th', '256th', '512th', '1024th'];\nduration.vexflowDurationArray = [undefined, undefined, undefined, undefined,\n                                 'w', 'h', 'q', '8', '16',\n                                 '32', undefined, undefined, undefined, undefined, undefined];\n\n/**\n * Duration object; found as the `.duration` attribute on {@link music21.base.Music21Object} instances\n * such as {@link music21.note.Note}\n *\n * @class Duration\n * @memberof music21.duration\n * @extends music21.prebase.ProtoM21Object\n * @param {(number|undefined)} ql - quarterLength (default 1.0)\n */\nexport class Duration extends prebase.ProtoM21Object {\n    constructor(ql) {\n        super();\n        this.classes.push('Duration');\n        this._quarterLength = 1.0;\n        this._dots = 0;\n        this._durationNumber = undefined;\n        this._type = 'quarter';\n        this._tuplets = [];\n        if (typeof (ql) === 'string') {\n            this.type = ql;\n        } else {\n            this.quarterLength = ql;\n        }\n        this._cloneCallbacks._tuplets = this.cloneCallbacksTupletFunction;\n    }\n    /**\n     * Read or sets the number of dots on the duration.\n     *\n     * Updates the quarterLength\n     *\n     * @type Number\n     * @instance\n     * @default 0\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.dots === 0; // true\n     * d.dots = 1;\n     * d.quarterLength == 3; // true;\n     */\n    get dots() {\n        return this._dots;\n    }\n    set dots(numDots) {\n        this._dots = numDots;\n        this.updateQlFromFeatures();\n    }\n    /**\n     * Read or sets the quarterLength of the Duration\n     *\n     * Updates the type, dots, tuplets(?)\n     *\n     * @type Number\n     * @instance\n     * @default 1.0\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.quarterLength == 2.0; // true;\n     * d.quarterLength = 1.75;\n     * d.dots == 2; // true\n     * d.type == 'quarter'; // true\n     */\n    get quarterLength() {\n        return this._quarterLength;\n    }\n    set quarterLength(ql) {\n        if (ql === undefined) {\n            ql = 1.0;\n        }\n        this._quarterLength = ql;\n        this.updateFeaturesFromQl();\n    }\n    /**\n     * Read or sets the type of the duration.\n     *\n     * Updates the quarterLength\n     *\n     * @type String\n     * @instance\n     * @default 'quarter'\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.type == 'half; // true\n     * d.type = 'breve';\n     * d.quarterLength == 8.0; // true\n     * d.dots = 1;\n     * d.type = 'quarter'; // will not change dots\n     * d.quarterLength == 1.5; // true\n     */\n    get type() {\n        return this._type;\n    }\n    set type(typeIn) {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(typeIn);\n        if (typeNumber === -1) {\n            console.log('invalid type ' + typeIn);\n            throw new Music21Exception('invalid type ' + typeIn);\n        }\n        this._type = typeIn;\n        this.updateQlFromFeatures();\n    }\n    /**\n     * Reads the tuplet Array for the duration.\n     *\n     * The tuplet array should be considered Read Only.\n     * Use {@link music21.duration.Duration#appendTuplet} to\n     * add a tuplet (no way to remove yet)\n     *\n     * @type Array<music21.duration.Tuplet>\n     * @instance\n     * @default []\n     * @memberof music21.duration.Duration\n     */\n    get tuplets() {\n        return this._tuplets;\n    }\n    /**\n     * Read-only: the duration expressed for VexFlow\n     *\n     * @type String\n     * @instance\n     * @default 'd'\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.vexflowDuration == 'h'; // true;\n     * d.dots = 2;\n     * d.vexflowDuration == 'hdd'; // true;\n     */\n    get vexflowDuration() {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this.type);\n        let vd = duration.vexflowDurationArray[typeNumber];\n        if (this.dots > 0) {\n            for (let i = 0; i < this.dots; i++) {\n                vd += 'd'; // vexflow does not handle double dots .. or does it???\n            }\n        }\n        return vd;\n    }\n    cloneCallbacksTupletFunction(tupletKey, ret, obj) {\n        // make sure that tuplets clone properly\n        const newTuplets = [];\n        for (let i = 0; i < obj[tupletKey].length; i++) {\n            const newTuplet = obj[tupletKey][i].clone();\n            // console.log('cloning tuplets', obj[tupletKey][i], newTuplet);\n            newTuplets.push(newTuplet);\n        }\n        ret[tupletKey] = newTuplets;\n    }\n    _findDots(ql) {\n        if (ql === 0) { return 0; } // zero length stream probably;\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this._type);\n        const powerOfTwo = Math.pow(2, duration.quarterTypeIndex - typeNumber);\n        // alert(undottedQL * 1.5 + \" \" + ql)\n        // console.log('find dots called on ql: ', ql, typeNumber, powerOfTwo);\n        for (let dotsNum = 0; dotsNum <= 4; dotsNum++) {\n            const dotMultiplier = (Math.pow(2, dotsNum) - 1.0) / (Math.pow(2, dotsNum));\n            const durationMultiplier = 1 + dotMultiplier;\n            if (Math.abs((powerOfTwo * durationMultiplier) - ql) < 0.0001) {\n                return dotsNum;\n            }\n        }\n        if (debug) {\n            console.log('no dots available for ql; probably a tuplet', ql);\n        }\n        return 0;\n    }\n    updateQlFromFeatures() {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this._type); // must be set property\n        const undottedQuarterLength = Math.pow(2, duration.quarterTypeIndex - typeNumber);\n        const dottedMultiplier = 1 + ((Math.pow(2, this._dots) - 1) / Math.pow(2, this._dots));\n        const unTupletedQl = undottedQuarterLength * dottedMultiplier;\n        let tupletCorrectedQl = unTupletedQl;\n        this._tuplets.forEach((tuplet) => {\n            tupletCorrectedQl *= tuplet.tupletMultiplier();\n        });\n        this._quarterLength = tupletCorrectedQl;\n    }\n    updateFeaturesFromQl() {\n        const ql = this._quarterLength;\n        const powerOfTwo = Math.floor(Math.log(ql + 0.00001) / Math.log(2));\n        let typeNumber = duration.quarterTypeIndex - powerOfTwo;\n        this._type = duration.ordinalTypeFromNum[typeNumber];\n        // console.log(this._findDots);\n        this._dots = this._findDots(ql);\n\n        const undottedQuarterLength = Math.pow(2, duration.quarterTypeIndex - typeNumber);\n        const dottedMultiplier = 1 + ((Math.pow(2, this._dots) - 1) / Math.pow(2, this._dots));\n        let unTupletedQl = undottedQuarterLength * dottedMultiplier;\n        if (unTupletedQl !== ql && ql !== 0) {\n            typeNumber -= 1;\n            this._type = duration.ordinalTypeFromNum[typeNumber]; // increase type: eighth to quarter etc.\n            unTupletedQl *= 2;\n            const tupletRatio = ql / unTupletedQl;\n            const ratioRat = common.rationalize(tupletRatio);\n            if (ratioRat === undefined) {\n                // probably a Stream with a length that is inexpressable;\n            } else {\n                const t = new duration.Tuplet(ratioRat.denominator, ratioRat.numerator, new duration.Duration(unTupletedQl));\n                this.appendTuplet(t, true); // skipUpdateQl\n            }\n            // console.log(ratioRat, ql, unTupletedQl);\n        }\n    }\n    /**\n     * Add a tuplet to music21j\n     *\n     * @memberof music21.duration.Duration\n     * @param {music21.duration.Tuplet} newTuplet - tuplet to add to `.tuplets`\n     * @param {boolean} [skipUpdateQl=false] - update the quarterLength afterwards?\n     */\n    appendTuplet(newTuplet, skipUpdateQl) {\n        newTuplet.frozen = true;\n        this._tuplets.push(newTuplet);\n        if (skipUpdateQl !== true) {\n            this.updateQlFromFeatures();\n        }\n    }\n}\n\nduration.Duration = Duration;\n\n\n/**\n * Represents a Tuplet; found in {@link music21.duration.Duration#tuplets}\n *\n * @class Tuplet\n * @memberof music21.duration\n * @extends music21.prebase.ProtoM21Object\n * @param {number} numberNotesActual - numerator of the tuplet, default 3\n * @param {number} numberNotesNormal - denominator of the tuplet, default 2\n * @param {(music21.duration.Duration|number)} durationActual - duration or quarterLength of duration type, default music21.duration.Duration(0.5)\n * @param {(music21.duration.Duration|number)} durationNormal - unused; see music21p for description\n */\nexport class Tuplet extends prebase.ProtoM21Object {\n    constructor(numberNotesActual, numberNotesNormal,\n            durationActual, durationNormal) {\n        super();\n        this.classes.push('Tuplet');\n        this.numberNotesActual = numberNotesActual || 3;\n        this.numberNotesNormal = numberNotesNormal || 2;\n        this.durationActual = durationActual || new duration.Duration(0.5);\n        if (typeof (this.durationActual) === 'number') {\n            this.durationActual = new duration.Duration(this.durationActual);\n        }\n        this.durationNormal = durationNormal || this.durationActual;\n\n        this.frozen = false;\n        this.type = undefined;\n        /**\n         * Show a bracket above the tuplet\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {Boolean} bracket\n         * @default true\n         */\n        this.bracket = true;\n        /**\n         * Bracket placement. Options are `above` or `below`.\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {String} placement\n         * @default 'above'\n         */\n        this.placement = 'above';\n\n        /**\n         * What to show above the Tuplet. Options are `number`, `type`, or (string) `none`.\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {String} tupletActualShow\n         * @default 'number'\n         */\n        this.tupletActualShow = 'number';\n        this.tupletNormalShow = undefined; // undefined, 'ratio' for ratios, 'type' for ratioed notes (does not work)\n    }\n    /**\n     * A nice name for the tuplet.\n     *\n     * @type String\n     * @instance\n     * @readonly\n     * @memberof music21.duration.Tuplet\n     */\n    get fullName() {\n        // actual is what is presented to viewer\n        const numActual = this.numberNotesActual;\n        const numNormal = this.numberNotesNormal;\n\n        if (numActual === 3 && numNormal === 2) {\n            return 'Triplet';\n        } else if (numActual === 5 && (numNormal === 4 || numNormal === 2)) {\n            return 'Quintuplet';\n        } else if (numActual === 6 && numNormal === 4) {\n            return 'Sextuplet';\n        }\n        const ordStr = common.ordinalAbbreviation(numNormal, true); // plural\n        return 'Tuplet of ' + numActual.toString() + '/' + numNormal.toString() + ordStr;\n    }\n    /**\n     * Set both durationActual and durationNormal for the tuplet.\n     *\n     * @memberof music21.duration.Tuplet\n     * @param {string} type - a duration type, such as `half`, `quarter`\n     * @returns {music21.duration.Duration} A converted {@link music21.duration.Duration} matching `type`\n     */\n    setDurationType(type) {\n        if (self.frozen === true) {\n            throw new Music21Exception('A frozen tuplet (or one attached to a duration) is immutable');\n        }\n        this.durationActual = new duration.Duration(type);\n        this.durationNormal = this.durationActual;\n        return this.durationActual;\n    }\n    /**\n     * Sets the tuplet ratio.\n     *\n     * @memberof music21.duration.Tuplet\n     * @param {Number} actual - number of notes in actual (e.g., 3)\n     * @param {Number} normal - number of notes in normal (e.g., 2)\n     * @returns {undefined}\n     */\n    setRatio(actual, normal) {\n        if (self.frozen === true) {\n            throw new Music21Exception('A frozen tuplet (or one attached to a duration) is immutable');\n        }\n        this.numberNotesActual = actual || 3;\n        this.numberNotesNormal = normal || 2;\n    }\n    /**\n     * Get the quarterLength corresponding to the total length that\n     * the completed tuplet (i.e., 3 notes in a triplet) would occupy.\n     *\n     * @memberof music21.duration.Tuplet\n     * @returns {Number} A quarter length.\n     */\n    totalTupletLength() {\n        return this.numberNotesNormal * this.durationNormal.quarterLength;\n    }\n    /**\n     * The amount by which each quarter length is multiplied to get\n     * the tuplet. For instance, in a normal triplet, this is 0.666\n     *\n     * @memberof music21.duration.Tuplet\n     * @returns {Number} A float of the multiplier\n     */\n    tupletMultiplier() {\n        const lengthActual = this.durationActual.quarterLength;\n        return (this.totalTupletLength() / (\n                this.numberNotesActual * lengthActual));\n    }\n}\nduration.Tuplet = Tuplet;\n\nduration.tests = () => {\n    test('music21.duration.Duration', () => {\n        const d = new music21.duration.Duration(1.0);\n        equal(d.type, 'quarter', 'got quarter note from 1.0');\n        equal(d.dots, 0, 'got no dots');\n        equal(d.quarterLength, 1.0, 'got 1.0 from 1.0');\n        equal(d.vexflowDuration, 'q', 'vexflow q');\n        d.type = 'half';\n        equal(d.type, 'half', 'got half note from half');\n        equal(d.dots, 0, 'got no dots');\n        equal(d.quarterLength, 2.0, 'got 2.0 from half');\n        equal(d.vexflowDuration, 'h', 'vexflow h');\n        d.quarterLength = 6.0;\n        equal(d.type, 'whole');\n        equal(d.dots, 1, 'got one dot from 6.0');\n        equal(d.quarterLength, 6.0, 'got 6.0');\n        equal(d.vexflowDuration, 'wd', 'vexflow duration wd');\n        d.quarterLength = 7.75;\n        equal(d.type, 'whole');\n        equal(d.dots, 4, 'got four dots from 7.75');\n    });\n\n    test('music21.duration.Tuplet', () => {\n        const d = new music21.duration.Duration(0.5);\n        const t = new music21.duration.Tuplet(5, 4);\n        equal(t.tupletMultiplier(), 0.8, 'tuplet multiplier');\n        d.appendTuplet(t);\n        equal(t.frozen, true, 'tuplet is frozen');\n        equal(d._tuplets[0], t, 'tuplet appended');\n        equal(d.quarterLength, 0.4, 'quarterLength Updated');\n\n        const d2 = new music21.duration.Duration(1 / 3);\n        equal(d2.type, 'eighth', 'got eighth note from 1/3');\n        equal(d2.dots, 0, 'got no dots');\n        equal(d2.quarterLength, 1 / 3, 'got 1/3 from 1/3');\n        const t2 = d2.tuplets[0];\n        equal(t2.numberNotesActual, 3, '3/2 tuplet');\n        equal(t2.numberNotesNormal, 2, '3/2 tuplet');\n        equal(t2.durationActual.quarterLength, 0.5);\n        equal(t2.tupletMultiplier(), 2 / 3, '2/3 tuplet multiplier');\n        equal(t2.totalTupletLength(), 1.0, 'total tuplet == 1.0');\n\n        const s = new music21.stream.Stream();\n        s.timeSignature = new music21.meter.TimeSignature('2/2');\n        for (let i = 0; i < 6; i++) {\n            const n1 = new music21.note.Note('C4');\n            n1.duration.quarterLength = 2 / 3;\n            if (i % 3 === 0) {\n                n1.articulations.push(new music21.articulations.Accent());\n            }\n            s.append(n1);\n        }\n        s.appendNewCanvas();\n        ok(true, 'quarter note triplets displayed');\n\n        const m6 = new music21.stream.Measure();\n        m6.renderOptions.staffLines = 1;\n        m6.timeSignature = new music21.meter.TimeSignature('2/4');\n        const n6 = new music21.note.Note('B4');\n        n6.duration.quarterLength = 2 / 3;\n        n6.duration.tuplets[0].durationNormal.type = 'eighth';\n        n6.duration.tuplets[0].tupletNormalShow = 'ratio';\n\n        const n7 = new music21.note.Note('B4');\n        n7.duration.quarterLength = 1 / 3;\n        n7.duration.tuplets[0].tupletNormalShow = 'ratio';\n\n        m6.append(n6);\n        m6.append(n7);\n        m6.append(n7.clone());\n        const n6clone = n6.clone();\n        m6.append(n6clone);\n        m6.appendNewCanvas();\n        ok(true, 'tuplets beginning with different type than original');\n        equal(n6.duration.tuplets[0] !== n6clone.duration.tuplets[0], true, 'tuplet should not be the same object after clone');\n    });\n    test('music21.duration.Tuplet multiple parts', () => {\n        const s2 = new music21.stream.Measure();\n        s2.timeSignature = new music21.meter.TimeSignature('3/2');\n        const na1 = new music21.note.Note('F4');\n        const na2 = new music21.note.Note('E4');\n        s2.append(na1);\n        s2.append(na2);\n        for (let i = 0; i < 10; i++) {\n            const n1 = new music21.note.Note('F4');\n            n1.pitch.diatonicNoteNum += i;\n            n1.duration.quarterLength = 2 / 5;\n            n1.duration.tuplets[0].tupletNormalShow = 'ratio';\n            if (i % 5 === 0) {\n                n1.articulations.push(new music21.articulations.Accent());\n            }\n            s2.append(n1);\n        }\n        const s3 = new music21.stream.Measure();\n        s3.timeSignature = new music21.meter.TimeSignature('3/2');\n        s3.append(new music21.note.Note('B5', 6.0));\n        const p = new music21.stream.Part();\n        p.append(s2);\n        p.append(s3);\n\n        const m4 = new music21.stream.Measure();\n        m4.timeSignature = new music21.meter.TimeSignature('3/2');\n        m4.append(new music21.note.Note('B3', 6.0));\n        const m5 = new music21.stream.Measure();\n        m5.timeSignature = new music21.meter.TimeSignature('3/2');\n        m5.append(new music21.note.Note('B3', 6.0));\n        const p2 = new music21.stream.Part();\n        p2.append(m4);\n        p2.append(m5);\n\n        const sc = new music21.stream.Score();\n        sc.insert(0, p);\n        sc.insert(0, p2);\n        sc.appendNewCanvas();\n        ok(true, '5:4 tuplets in 3/2 with multiple parts');\n    });\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/base -- objects in base in music21p routines\n *\n * does not load the other modules, music21/moduleLoader.js does that.\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { duration } from './duration';\nimport { prebase } from './prebase';\n\n/**\n * module for Music21Objects, see {@link music21.base}\n *\n * @requires music21/duration\n * @requires music21/prebase\n * @exports music21/base\n */\n/**\n * Module for Music21Objects.  Does not load other modules, see {@link music21.moduleLoader}\n * for this functionality.\n *\n * @namespace music21.base\n * @memberof music21\n */\nexport const base = {};\n\n/**\n * Base class for any object that can be placed in a {@link music21.stream.Stream}.\n *\n * @class Music21Object\n * @memberof music21.base\n * @extends music21.prebase.ProtoM21Object\n * @property {object} activeSite - hardlink to a {@link music21.stream.Stream} containing the element.\n * @property {number} classSortOrder - Default sort order for this class (default 20; override in other classes). Lower numbered objects will sort before other objects in the staff if priority and offset are the same.\n * @property {music21.duration.Duration} duration - the duration (object) for the element. (can be set with a quarterLength also)\n * @property {Array} groups - An Array of strings representing group (equivalent to css classes) to assign to the object. (default [])\n * @property {boolean} isMusic21Object - true\n * @property {boolean} isStream - false\n * @property {number|null} offset - offset from the beginning of the stream (in quarterLength)\n * @property {number} priority - The priority (lower = earlier or more left) for elements at the same offset. (default 0)\n */\nexport class Music21Object extends prebase.ProtoM21Object {\n    constructor() {\n        super();\n        this.classes.push('Music21Object');\n        this.classSortOrder = 20; // default;\n        this._priority = 0; // default;\n        this.offset = null; // default -- simple version of m21.\n        this.activeSite = undefined;\n        this.isMusic21Object = true;\n        this.isStream = false;\n\n        this._duration = new duration.Duration();\n        this.groups = []; // custom object in m21p\n        // this.sites, this.activeSites, this.offset -- not yet...\n        // beat, measureNumber, etc.\n        // lots to do...\n        this._cloneCallbacks.activeSite = function Music21Object_cloneCallbacks_activeSite(p, ret, obj) {\n            ret[p] = undefined;\n        };\n    }\n    get priority() {\n        return this._priority;\n    }\n    set priority(p) {\n        this._priority = p;\n    }\n    get duration() {\n        return this._duration;\n    }\n    set duration(newDuration) {\n        if (typeof (newDuration) === 'object') {\n            this._duration = newDuration;\n            // common errors below...\n        } else if (typeof (newDuration) === 'number') {\n            this._duration.quarterLength = newDuration;\n        } else if (typeof (newDuration) === 'string') {\n            this._duration.type = newDuration;\n        }\n    }\n    get quarterLength() {\n        return this.duration.quarterLength;\n    }\n    set quarterLength(ql) {\n        this.duration.quarterLength = ql;\n    }\n    /**\n     * Return the offset of this element in a given site -- use .offset if you are sure that\n     * site === activeSite.\n     *\n     * Does not change activeSite or .offset\n     *\n     * @memberof music21.base.Music21Object\n     * @param {music21.stream.Stream} site\n     * @returns Number|undefined\n     */\n    getOffsetBySite(site) {\n        if (site === undefined) {\n            return this.offset;\n        }\n        for (let i = 0; i < site.length; i++) {\n            if (site._elements[i] === this) {\n                return site._elementOffsets[i];\n            }\n        }\n        return undefined;\n    }\n}\n\nbase.Music21Object = Music21Object;\n","import * as Vex from 'vexflow';\nimport { common } from './common';\nimport { prebase } from './prebase';\n\n/**\n * articulations module. See {@link music21.articulations} namespace\n *\n */\n\n/**\n * @namespace music21.articulations\n * @memberof music21\n * @requires music21/prebase, Vexflow\n */\nexport const articulations = {};\n\n/**\n * Represents a single articulation, usually in the `.articulations` Array\n * on a {@link music21.note.Note} or something like that.\n *\n * @class Articulation\n * @memberof music21.articulations\n * @extends music21.prebase.ProtoM21Object\n * @property {string} name\n * @property {string} [placement='above']\n * @property {string} vexflowModifier - the string code to get this accidental in Vexflow\n * @property {number} [dynamicScale=1.0] - multiplier for the dynamic of a note that this is attached to\n * @property {number} [lengthScale=1.0] - multiplier for the length of a note that this is attached to.\n */\nexport class Articulation extends prebase.ProtoM21Object {\n    constructor() {\n        super();\n        this.classes.push('Articulation');\n        this.name = undefined;\n        this.placement = 'above';\n        this.vexflowModifier = undefined;\n        this.setPosition = undefined;\n        this.dynamicScale = 1.0;\n        this.lengthScale = 1.0;\n    }\n\n    /**\n     * Generates a Vex.Flow.Articulation for this articulation.\n     *\n     * @memberof music21.articulations.Articulation\n     * @returns {Vex.Flow.Articulation}\n     */\n    vexflow() {\n        const vfa = new Vex.Flow.Articulation(this.vexflowModifier);\n        if (this.setPosition) {\n            vfa.setPosition(this.setPosition);\n        }\n        return vfa;\n    }\n}\narticulations.Articulation = Articulation;\n/**\n * base class for articulations that change the length of a note...\n *\n * @class LengthArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class LengthArticulation extends Articulation {\n    constructor() {\n        super();\n        this.classes.push('LengthArticulation');\n    }\n}\narticulations.LengthArticulation = LengthArticulation;\n\n/**\n * base class for articulations that change the dynamic of a note...\n *\n * @class DynamicArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class DynamicArticulation extends Articulation {\n    constructor() {\n        super();\n        this.classes.push('DynamicArticulation');\n    }\n}\narticulations.DynamicArticulation = DynamicArticulation;\n\n/**\n * base class for articulations that change the pitch of a note...\n *\n * @class PitchArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class PitchArticulation extends Articulation {\n    constructor() {\n        super();\n        this.classes.push('PitchArticulation');\n    }\n}\narticulations.PitchArticulation = PitchArticulation;\n\n/**\n * base class for articulations that change the timbre of a note...\n *\n * @class TimbreArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class TimbreArticulation extends Articulation {\n    constructor() {\n        super();\n        this.classes.push('TimbreArticulation');\n    }\n}\narticulations.TimbreArticulation = TimbreArticulation;\n\n\n/**\n * 50% louder than usual\n *\n * @class Accent\n * @memberof music21.articulations\n * @extends music21.articulations.DynamicArticulation\n */\nexport class Accent extends DynamicArticulation {\n    constructor() {\n        super();\n        this.classes.push('Accent');\n        this.name = 'accent';\n        this.vexflowModifier = 'a>';\n        this.dynamicScale = 1.5;\n    }\n}\narticulations.Accent = Accent;\n\n/**\n * 100% louder than usual\n *\n * @class StrongAccent\n * @memberof music21.articulations\n * @extends music21.articulations.Accent\n */\nexport class StrongAccent extends Accent {\n    constructor() {\n        super();\n        this.classes.push('StrongAccent');\n        this.name = 'strong accent';\n        this.vexflowModifier = 'a^';\n        this.dynamicScale = 2.0;\n    }\n}\narticulations.StrongAccent = StrongAccent;\n\n/**\n * no playback for now.\n *\n * @class Staccato\n * @memberof music21.articulations\n * @extends music21.articulations.LengthArticulation\n */\nexport class Staccato extends LengthArticulation {\n    constructor() {\n        super();\n        this.classes.push('Staccato');\n        this.name = 'staccato';\n        this.vexflowModifier = 'a.';\n    }\n}\narticulations.Staccato = Staccato;\n\n/**\n * no playback for now.\n *\n * @class Staccatissimo\n * @memberof music21.articulations\n * @extends music21.articulations.Staccato\n */\nexport class Staccatissimo extends Staccato {\n    constructor() {\n        super();\n        this.classes.push('Staccatissimo');\n        this.name = 'staccatissimo';\n        this.vexflowModifier = 'av';\n    }\n}\narticulations.Staccatissimo = Staccatissimo;\n\n/**\n * no playback or display for now.\n *\n * @class Spiccato\n * @memberof music21.articulations\n * @extends music21.articulations.Staccato\n */\nexport class Spiccato extends Staccato {\n    constructor() {\n        super();\n        this.classes.push('Spiccato');\n        this.name = 'spiccato';\n        this.vexflowModifier = undefined;\n    }\n}\narticulations.Spiccato = Spiccato;\n\n/**\n * @class Marcato\n * @memberof music21.articulations\n * @extends music21.articulations.DynamicArticulation\n * @extends music21.articulations.LengthArticulation\n */\nexport class Marcato extends DynamicArticulation {\n    constructor() {\n        super();\n        common.mixin(LengthArticulation, this);\n        this.classes.push('Marcato');\n        this.name = 'marcato';\n        this.vexflowModifier = 'a^';\n        this.dynamicScale = 1.7;\n    }\n}\narticulations.Marcato = Marcato;\n\n/**\n * @class Tenuto\n * @memberof music21.articulations\n * @extends music21.articulations.LengthArticulation\n */\nexport class Tenuto extends LengthArticulation {\n    constructor() {\n        super();\n        this.classes.push('Tenuto');\n        this.name = 'tenuto';\n        this.vexflowModifier = 'a-';\n    }\n}\narticulations.Tenuto = Tenuto;\n\n\narticulations.tests = () => {\n    test('music21.articulations.Articulation', () => {\n        const acc = new music21.articulations.Accent();\n        equal(acc.name, 'accent', 'matching names for accent');\n        const ten = new music21.articulations.Tenuto();\n        equal(ten.name, 'tenuto', 'matching names for tenuto');\n        const n = new music21.note.Note('C');\n        n.articulations.push(acc);\n        n.articulations.push(ten);\n        equal(n.articulations[0].name, 'accent', 'accent in array');\n        equal(n.articulations[1].name, 'tenuto', 'tenuto in array');\n    });\n\n    test('music21.articulations.Articulation display', () => {\n        // Marcato is a pseudo multiple inheritance\n        const marc = new music21.articulations.Marcato();\n        equal(marc.name, 'marcato', 'matching names for marcato');\n        const n = new music21.note.Note('D#5');\n        n.articulations.push(marc);\n        const nBoring = new music21.note.Note('D#5');\n\n        const measure = new music21.stream.Measure();\n        measure.append(n);\n        measure.append(nBoring);\n        measure.append(nBoring.clone());\n        measure.append(n.clone());\n        measure.appendNewCanvas();\n        ok(true, 'something worked');\n    });\n};\n","import { common } from './common';\n/**\n * audioSearch module. See {@link music21.audioSearch} namespace\n *\n * @exports music21/audioSearch\n */\n/**\n * @namespace music21.audioSearch\n * @memberof music21\n * @requires music21/pitch\n * @requires music21/common\n */\n\nexport const audioSearch = {};\n// functions based on the prototype created by Chris Wilson's MIT License version\n// and on Jordi Bartolome Guillen's audioSearch module for music21\n\naudioSearch.fftSize = 2048;\n\naudioSearch.AudioContextCaller = window.AudioContext || window.webkitAudioContext;\naudioSearch._audioContext = null;\naudioSearch.animationFrameCallbackId = null;\n\nObject.defineProperties(audioSearch,\n        { 'audioContext': {\n            'get': () => {\n                if (audioSearch._audioContext !== null) {\n                    return audioSearch._audioContext;\n                } else {\n                    audioSearch._audioContext = new audioSearch.AudioContextCaller();\n                    return audioSearch._audioContext;\n                }\n            },\n            'set': (ac) => {\n                audioSearch._audioContext = ac;\n            },\n        },\n        });\n\n\n/**\n *\n * @function music21.audioSearch.getUserMedia\n * @memberof music21.audioSearch\n * @param {object} dictionary - dictionary to fill\n * @param {function} callback - callback on success\n * @param {function} error - callback on error\n */\naudioSearch.getUserMedia = function getUserMedia(dictionary, callback, error) {\n    if (error === undefined) {\n        /* eslint no-alert: \"off\"*/\n        error = () => { alert('navigator.getUserMedia either not defined (Safari, IE) or denied.'); };\n    }\n    if (callback === undefined) {\n        callback = (mediaStream) => { audioSearch.userMediaStarted(mediaStream); };\n    }\n    const n = navigator;\n    // need to polyfill navigator, or binding problems are hard...\n    n.getUserMedia = n.getUserMedia || n.webkitGetUserMedia || n.mozGetUserMedia || n.msGetUserMedia;\n\n    if (n.getUserMedia === undefined) {\n        error();\n    }\n    if (dictionary === undefined) {\n        dictionary = {\n            'audio': {\n                'mandatory': {\n                },\n                'optional': [],\n            },\n        };\n    }\n    n.getUserMedia(dictionary, callback, error);\n};\n\naudioSearch.sampleBuffer = null;\naudioSearch.currentAnalyser = null;\n\naudioSearch.userMediaStarted = function userMediaStarted(audioStream) {\n    audioSearch.sampleBuffer = new Float32Array(audioSearch.fftSize / 2);\n    const mediaStreamSource = audioSearch.audioContext.createMediaStreamSource(audioStream);\n    const analyser = audioSearch.audioContext.createAnalyser();\n    analyser.fftSize = audioSearch.fftSize;\n    mediaStreamSource.connect(analyser);\n    audioSearch.currentAnalyser = analyser;\n    audioSearch.animateLoop();\n};\n\naudioSearch.minFrequency = 55;\naudioSearch.maxFrequency = 1050;\naudioSearch.animateLoop = function animateLoop(time) {\n    audioSearch.currentAnalyser.getFloatTimeDomainData(audioSearch.sampleBuffer);\n    // returns best frequency or -1\n    const frequencyDetected = audioSearch.autoCorrelate(\n            audioSearch.sampleBuffer,\n            audioSearch.audioContext.sampleRate,\n            audioSearch.minFrequency,\n            audioSearch.maxFrequency);\n    const retValue = audioSearch.sampleCallback(frequencyDetected);\n    if (retValue !== -1) {\n        audioSearch.animationFrameCallbackId = window.requestAnimationFrame(audioSearch.animateLoop);\n    }\n};\n\naudioSearch.pitchSmoothingSize = 40;\naudioSearch.lastPitchClassesDetected = [];\naudioSearch.lastPitchesDetected = [];\naudioSearch.lastCentsDeviationsDetected = [];\n\naudioSearch.smoothPitchExtraction = function smoothPitchExtraction(frequency) {\n    if (frequency === -1) {\n        audioSearch.lastPitchClassesDetected.shift();\n        audioSearch.lastPitchesDetected.shift();\n        audioSearch.lastCentsDeviationsDetected.shift();\n    } else {\n        const [midiNum, centsOff] = audioSearch.midiNumDiffFromFrequency(frequency);\n        if (audioSearch.lastPitchClassesDetected.length > audioSearch.pitchSmoothingSize) {\n            audioSearch.lastPitchClassesDetected.shift();\n            audioSearch.lastPitchesDetected.shift();\n            audioSearch.lastCentsDeviationsDetected.shift();\n        }\n        audioSearch.lastPitchClassesDetected.push(midiNum % 12);\n        audioSearch.lastPitchesDetected.push(midiNum);\n        audioSearch.lastCentsDeviationsDetected.push(centsOff);\n    }\n    const mostCommonPitchClass = common.statisticalMode(audioSearch.lastPitchClassesDetected);\n    if (mostCommonPitchClass === null) {\n        return [-1, 0];\n    }\n    const pitchesMatchingClass = [];\n    const centsMatchingClass = [];\n    for (let i = 0; i < audioSearch.lastPitchClassesDetected.length; i++) {\n        if (audioSearch.lastPitchClassesDetected[i] === mostCommonPitchClass) {\n            pitchesMatchingClass.push(audioSearch.lastPitchesDetected[i]);\n            centsMatchingClass.push(audioSearch.lastCentsDeviationsDetected[i]);\n        }\n    }\n    const mostCommonPitch = common.statisticalMode(pitchesMatchingClass);\n\n    // find cents difference; weighing more recent samples more...\n    let totalSamplePoints = 0;\n    let totalSample = 0;\n    for (let j = 0; j < centsMatchingClass.length; j++) {\n        const weight = (Math.pow(j, 2) + 1);\n        totalSample += weight * centsMatchingClass[j];\n        totalSamplePoints += weight;\n    }\n    const centsOff = Math.floor(totalSample / totalSamplePoints);\n    return [mostCommonPitch, centsOff];\n};\n\naudioSearch.sampleCallback = function sampleCallback(frequency) {\n    const [unused_midiNum, unused_centsOff] = audioSearch.smoothPitchExtraction(frequency);\n};\n\n// from Chris Wilson. Replace with Jordi's\naudioSearch.autoCorrelate = function autoCorrelate(buf, sampleRate, minFrequency, maxFrequency) {\n    const SIZE = buf.length;\n    const MAX_SAMPLES = Math.floor(SIZE / 2);\n    if (minFrequency === undefined) {\n        minFrequency = 0;\n    }\n    if (maxFrequency === undefined) {\n        maxFrequency = sampleRate;\n    }\n\n    let best_offset = -1;\n    let best_correlation = 0;\n    let rms = 0;\n    let foundGoodCorrelation = false;\n    const correlations = new Array(MAX_SAMPLES);\n\n    for (let i = 0; i < SIZE; i++) {\n        const val = buf[i];\n        rms += val * val;\n    }\n    rms = Math.sqrt(rms / SIZE);\n    if (rms < 0.01) {\n        return -1;\n    } // not enough signal\n\n    let lastCorrelation = 1;\n    for (let offset = 0; offset < MAX_SAMPLES; offset++) {\n        let correlation = 0;\n        const offsetFrequency = sampleRate / offset;\n        if (offsetFrequency < minFrequency) {\n            break;\n        }\n        if (offsetFrequency > maxFrequency) {\n            continue;\n        }\n\n        for (let i = 0; i < MAX_SAMPLES; i++) {\n            correlation += Math.abs((buf[i]) - (buf[i + offset]));\n        }\n        correlation = 1 - (correlation / MAX_SAMPLES);\n        correlations[offset] = correlation; // store it, for the tweaking we need to do below.\n        if ((correlation > 0.9) && (correlation > lastCorrelation)) {\n            foundGoodCorrelation = true;\n            if (correlation > best_correlation) {\n                best_correlation = correlation;\n                best_offset = offset;\n            }\n        } else if (foundGoodCorrelation) {\n            // short-circuit - we found a good correlation, then a bad one, so we'd just be seeing copies from here.\n            // Now we need to tweak the offset - by interpolating between the values to the left and right of the\n            // best offset, and shifting it a bit.  This is complex, and HACKY in this code (happy to take PRs!) -\n            // we need to do a curve fit on correlations[] around best_offset in order to better determine precise\n            // (anti-aliased) offset.\n\n            // we know best_offset >=1,\n            // since foundGoodCorrelation cannot go to true until the second pass (offset=1), and\n            // we can't drop into this clause until the following pass (else if).\n            const shift = (correlations[best_offset + 1] - correlations[best_offset - 1]) / correlations[best_offset];\n            return sampleRate / (best_offset + (8 * shift));\n        }\n        lastCorrelation = correlation;\n    }\n    if (best_correlation > 0.01) {\n        // console.log(\"f = \" + sampleRate/best_offset + \"Hz (rms: \" + rms + \" confidence: \" + best_correlation + \")\")\n        return sampleRate / best_offset;\n    }\n    return -1;\n    //  var best_frequency = sampleRate/best_offset;\n};\n\n/**\n *\n * @function midiNumDiffFromFrequency\n * @param {Number} frequency\n * @returns {Array<Int>} [miniNumber, centsOff]\n */\naudioSearch.midiNumDiffFromFrequency = function midiNumDiffFromFrequency(frequency) {\n    const midiNumFloat = (12 * (Math.log(frequency / 440) / Math.log(2))) + 69;\n    const midiNum = Math.round(midiNumFloat);\n    const centsOff = Math.round(100 * (midiNumFloat - midiNum));\n    return [midiNum, centsOff];\n};\n\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik MÃ¶ller\n// fixes from Paul Irish and Tino Zijdel\n\nfunction requestAnimationFramePolyFill() {\n    let lastTime = 0;\n    const vendors = ['ms', 'moz', 'webkit', 'o'];\n    for (let x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\n        || window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n\n    if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = (callback, element) => {\n            const currTime = new Date().getTime();\n            const timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            const timeoutId = window.setTimeout(() => callback(currTime + timeToCall), timeToCall);\n            lastTime = currTime + timeToCall;\n            return timeoutId;\n        };\n    }\n\n    if (!window.cancelAnimationFrame) {\n        window.cancelAnimationFrame = (id) => {\n            clearTimeout(id);\n        };\n    }\n}\nrequestAnimationFramePolyFill();\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/beam -- Beams and Beam class\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21';\n\nimport { prebase } from './prebase';\nimport { duration } from './duration';\n\n/**\n * Module holding beam materials. See {@link music21.beam} namespace.\n *\n * @exports music21/beam\n */\n/**\n * {@link music21.beam.Beam} and {music21.beam.Beams} objects\n *\n * @namespace music21.beam\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/duration\n */\nexport const beam = {};\n\nbeam.validBeamTypes = {\n    'start': true,\n    'stop': true,\n    'continue': true,\n    'partial': true,\n};\n\n/**\n * Object representing a single beam (e.g., a 16th note that is beamed needs two)\n *\n * @class Beam\n * @memberof music21.beam\n * @extends music21.prebase.ProtoM21Object\n * @param {string} type - \"start\", \"stop\", \"continue\", \"partial\"\n * @param {string} direction - only needed for partial beams: \"left\" or \"right\"\n * @property {Int|undefined} number - which beam line does this refer to; 8th = 1, 16th = 2, etc.\n * @property {number|undefined} independentAngle - the angle of this beam if it is different than others (feathered beams)\n */\nexport class Beam extends prebase.ProtoM21Object {\n    constructor(type, direction) {\n        super();\n        this.classes.push('Beam');\n        this.type = type;\n        this.direction = direction;\n        this.independentAngle = undefined;\n        this.number = undefined;\n    }\n}\nbeam.Beam = Beam;\n/**\n * Object representing a collection of Beams\n *\n * @class Beams\n * @memberof music21.beam\n * @extends music21.prebase.ProtoM21Object\n * @property {Array<music21.beam.Beam>} beamsList - a list of Beam objects\n * @property {Boolean} [feathered=false] - is this a feathered beam.\n * @property {Int} length - length of beamsList\n */\nexport class Beams extends prebase.ProtoM21Object {\n    constructor() {\n        super();\n        this.classes.push('Beams');\n        this.beamsList = [];\n        this.feathered = false;\n    }\n    get length() {\n        return this.beamsList.length;\n    }\n    /**\n     * Append a new {@link music21.beam.Beam} object to this Beams, automatically creating the Beam\n     *   object and incrementing the number count.\n     *\n     * @memberof music21.beam.Beams\n     * @param {string} type - the type (passed to {@link music21.beam.Beam})\n     * @param {string} [direction=undefined] - the direction if type is \"partial\"\n     * @returns {music21.beam.Beam} newly appended object\n     */\n    append(type, direction) {\n        const obj = new beam.Beam(type, direction);\n        obj.number = this.beamsList.length + 1;\n        this.beamsList.push(obj);\n        return obj;\n    }\n    /**\n     * A quick way of setting the beams list for a particular duration, for\n            instance, fill(\"16th\") will clear the current list of beams in the\n            Beams object and add two beams.  fill(2) will do the same (though note\n            that that is an int, not a string).\n\n     * It does not do anything to the direction that the beams are going in,\n            or by default.  Either set type here or call setAll() on the Beams\n            object afterwards.\n\n     * Both \"eighth\" and \"8th\" work.  Adding more than six beams (i.e. things\n            like 512th notes) raises an error.\n\n     * @memberof music21.beam.Beams\n     * @param {string|Int} level - either a string like \"eighth\" or a number like 1 (=\"eighth\")\n     * @param {string} type - type to fill all beams to.\n     * @returns {this}\n     */\n    fill(level, type) {\n        this.beamsList = [];\n        let count = 1;\n        if (level === 1 || level === '8th' || level === duration.typeFromNumDict[8]) {\n            count = 1;\n        } else if (level === 2 || level === duration.typeFromNumDict[16]) {\n            count = 2;\n        } else if (level === 3 || level === duration.typeFromNumDict[32]) {\n            count = 3;\n        } else if (level === 4 || level === duration.typeFromNumDict[64]) {\n            count = 4;\n        } else if (level === 5 || level === duration.typeFromNumDict[128]) {\n            count = 5;\n        } else if (level === 6 || level === duration.typeFromNumDict[256]) {\n            count = 6;\n        } else {\n            throw new Music21Exception('cannot fill beams for level ' + level);\n        }\n        for (let i = 1; i <= count; i++) {\n            const obj = new beam.Beam();\n            obj.number = i;\n            this.beamsList.push(obj);\n        }\n        if (type !== undefined) {\n            this.setAll(type);\n        }\n        return this;\n    }\n    /**\n     * Get the beam with the given number or throw an exception.\n     *\n     * @memberof music21.beam.Beams\n     * @param {Int} number - the beam number to retrieve (usually one less than the position in `.beamsList`)\n     * @returns {music21.beam.Beam|undefined}\n     */\n    getByNumber(number) {\n        if (!(number in this.getNumbers())) {\n            throw new Music21Exception('beam number error: ' + number);\n        }\n        for (let i = 0; i < this.length; i++) {\n            if (this.beamsList[i].number === number) {\n                return this.beamsList[i];\n            }\n        }\n        return undefined;\n    }\n    /**\n     * Get an Array of all the numbers for the beams\n     *\n     * @memberof music21.beam.Beams\n     * @returns {Array<Int>} all the numbers\n     */\n    getNumbers() {\n        const numbers = [];\n        for (let i = 0; i < this.length; i++) {\n            numbers.push(this.beamsList[i].number);\n        }\n        return numbers;\n    }\n    /**\n     * Returns the type + \"-\" + direction (if direction is defined)\n     * for the beam with the given number.\n     *\n     * @param {Int} number\n     * @returns {music21.beam.Beam|undefined}\n     */\n    getTypeByNumber(number) {\n        const beamObj = this.getByNumber(number);\n        if (beamObj.direction === undefined) {\n            return beamObj.type;\n        } else {\n            const x = beamObj.type + '-' + beamObj.direction;\n            return x;\n        }\n    }\n    /**\n     * Get an Array of all the types for the beams\n     *\n     * @memberof music21.beam.Beams\n     * @returns {Array<string>} all the types\n     */\n    getTypes() {\n        const types = [];\n        for (let i = 0; i < this.length; i++) {\n            types.push(this.beamsList[i].type);\n        }\n        return types;\n    }\n    /**\n     * Set all the {@link music21.beam.Beam} objects to a given type/direction\n     *\n     * @memberof music21.beam.Beams\n     * @param {string} type - beam type\n     * @param {string} [direction] - beam direction\n     * @returns {this}\n     */\n    setAll(type, direction) {\n        if (beam.validBeamTypes[type] === undefined) {\n            throw new Music21Exception('invalid beam type: ' + type);\n        }\n        for (let i = 0; i < this.length; i++) {\n            const b = this.beamsList[i];\n            b.type = type;\n            b.direction = direction;\n        }\n        return this;\n    }\n    /**\n     * Set the {@link music21.beam.Beam} object specified by `number` to a given type/direction\n     *\n     * @memberof music21.beam.Beams\n     * @param {Int} number\n     * @param {string} type\n     * @param {string} [direction]\n     * @returns {this}\n     */\n    setByNumber(number, type, direction) {\n        if (direction === undefined) {\n            const splitit = type.split('-');\n            type = splitit[0];\n            direction = splitit[1]; // can be undefined...\n        }\n        if (beam.validBeamTypes[type] === undefined) {\n            throw new Music21Exception('invalid beam type: ' + type);\n        }\n        for (let i = 0; i < this.length; i++) {\n            if (this.beamsList[i].number === number) {\n                this.beamsList[i].type = type;\n                this.beamsList[i].direction = direction;\n            }\n        }\n        return this;\n    }\n}\nbeam.Beams = Beams;\n\nbeam.tests = () => {\n    test('music21.beam.Beams', () => {\n        const a = new music21.beam.Beams();\n        a.fill('16th');\n        a.setAll('start');\n        equal(a.getTypes()[0], 'start');\n        equal(a.getTypes()[1], 'start');\n\n        const b = new music21.beam.Beams();\n        b.fill('16th');\n        b.setAll('start');\n        b.setByNumber(1, 'continue');\n        equal(b.beamsList[0].type, 'continue');\n        b.setByNumber(2, 'stop');\n        equal(b.beamsList[1].type, 'stop');\n        b.setByNumber(2, 'partial-right');\n        equal(b.beamsList[1].type, 'partial');\n        equal(b.beamsList[1].direction, 'right');\n    });\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/pitch -- pitch routines\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21';\n\nimport { prebase } from './prebase';\n/**\n * pitch module.  See {@link music21.pitch} namespace\n *\n * @exports music21/pitch\n */\n/**\n * Pitch related objects and methods\n *\n * @namespace music21.pitch\n * @memberof music21\n * @requires music21/prebase\n */\nexport const pitch = {};\n/**\n * @class Accidental\n * @memberof music21.pitch\n * @param {string|number} accName - an accidental name\n * @extends music21.prebase.ProtoM21Object\n */\nexport class Accidental extends prebase.ProtoM21Object {\n    constructor(accName) {\n        super();\n        this.classes.push('Accidental');\n        this._name = '';\n        this._alter = 0.0;\n        this._modifier = '';\n        this._unicodeModifier = '';\n        this.displayType = 'normal'; // \"normal\", \"always\" supported currently\n        this.displayStatus = undefined; // true, false, undefined\n        this.init(accName);\n    }\n    /**\n     * Sets a parameter of the accidental and updates name, alter, and modifier to suit.\n     *\n     * @memberof music21.pitch.Accidental\n     * @param {number|string} accName - the name, number, or modifier to set\n     * @returns {undefined}\n     */\n    init(accName) {\n        if ((accName !== undefined) && (accName.toLowerCase !== undefined)) {\n            accName = accName.toLowerCase();\n        }\n\n        if (accName === 'natural' || accName === 'n' || accName === 0 || accName === undefined) {\n            this._name = 'natural';\n            this._alter = 0.0;\n            this._modifier = '';\n            this._unicodeModifier = 'â™®';\n        } else if (accName === 'sharp' || accName === '#' || accName === 1) {\n            this._name = 'sharp';\n            this._alter = 1.0;\n            this._modifier = '#';\n            this._unicodeModifier = 'â™¯';\n        } else if (accName === 'flat' || accName === '-' || accName === -1) {\n            this._name = 'flat';\n            this._alter = -1.0;\n            this._modifier = '-';\n            this._unicodeModifier = 'â™­';\n        } else if (accName === 'double-flat' || accName === '--' || accName === -2) {\n            this._name = 'double-flat';\n            this._alter = -2.0;\n            this._modifier = '--';\n            this._unicodeModifier = '&#x1d12b;';\n        } else if (accName === 'double-sharp' || accName === '##' || accName === 2) {\n            this._name = 'double-sharp';\n            this._alter = 2.0;\n            this._modifier = '##';\n            this._unicodeModifier = '&#x1d12a;';\n        } else if (accName === 'triple-flat' || accName === '---' || accName === -3) {\n            this._name = 'triple-flat';\n            this._alter = -3.0;\n            this._modifier = '---';\n            this._unicodeModifier = 'â™­&#x1d12b;';\n        } else if (accName === 'triple-sharp' || accName === '###' || accName === 3) {\n            this._name = 'triple-sharp';\n            this._alter = 3.0;\n            this._modifier = '###';\n            this._unicodeModifier = '&#x1d12a;';\n        }\n    }\n    /**\n     * Return or set the name of the accidental ('flat', 'sharp', 'natural', etc.);\n     *\n     * When set, updates alter and modifier.\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} name\n     */\n    get name() {\n        return this._name;\n    }\n    set name(n) {\n        this.init(n);\n    }\n    /**\n     * Return or set the alteration amount (-1.0 = flat; 1.0 = sharp; etc.)\n     *\n     * When set, updates name and modifier.\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {number} alter\n     */\n    get alter() {\n        return this._alter;\n    }\n    set alter(alter) {\n        this.init(alter);\n    }\n    /**\n     * Return or set the modifier ('-', '#', '')\n     *\n     * When set, updates alter and name.\n\n     * @memberof music21.pitch.Accidental#\n     * @var {string} modifier\n     */\n    get modifier() {\n        return this._modifier;\n    }\n    set modifier(modifier) {\n        this.init(modifier);\n    }\n    /**\n     * Returns the modifier for vexflow ('b', '#', 'n')\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} vexflowModifier\n     * @readonly\n     */\n    get vexflowModifier() {\n        // todo -- rewrite with mapping.\n        const m = this.modifier;\n        if (m === '') {\n            return 'n';\n        } else if (m === '#') {\n            return '#';\n        } else if (m === '-') {\n            return 'b';\n        } else if (m === '##') {\n            return '##';\n        } else if (m === '--') {\n            return 'bb';\n        } else if (m === '###') {\n            return '###';\n        } else if (m === '---') {\n            return 'bbb';\n        } else {\n            throw new Music21Exception('Vexflow does not support: ' + m);\n        }\n    }\n    /**\n     * Returns the modifier in unicode or\n     * for double and triple accidentals, as a hex escape\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} unicodeModifier\n     * @readonly\n     */\n    get unicodeModifier() {\n        return this._unicodeModifier;\n    }\n}\npitch.Accidental = Accidental;\n\n\npitch.nameToMidi = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 };\npitch.nameToSteps = { 'C': 0, 'D': 1, 'E': 2, 'F': 3, 'G': 4, 'A': 5, 'B': 6 };\npitch.stepsToName = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\npitch.midiToName = ['C', 'C#', 'D', 'E-', 'E', 'F', 'F#', 'G', 'A-', 'A', 'B-', 'B'];\n\n/**\n * Pitch objects are found in {@link music21.note.Note} objects, and many other places.\n *\n * They do not have a {@link music21.duration.Duration} associated with them, so they\n * cannot be placed inside {@link music21.stream.Stream} objects.\n *\n * Valid pitch name formats are\n * - \"C\", \"D', etc. (\"B\" = American B; \"H\" is not allowed)\n * - \"C#\", \"C-\" (C-flat; do not use \"b\" for flat), \"C##\", \"C###\", \"C--\" etc.\n * - Octave may be specified after the name + accidental: \"C#4\" etc.\n * - Octave can be arbitrarily high (\"C10\") but only as low as \"C0\" because \"C-1\" would be interpreted as C-flat octave 1; shift octave later for very low notes.\n * - If octave is not specified, the system will usually use octave 4, but might adjust according to context. If you do not like this behavior, give an octave always.\n * - Microtones are not supported in music21j (they are in music21p)\n *\n * @class Pitch\n * @memberof music21.pitch\n * @param {string} pn - name of the pitch, with or without octave, see above.\n * @extends music21.prebase.ProtoM21Object\n * @property {music21.pitch.Accidental|undefined} accidental - link to an accidental\n * @property {number} diatonicNoteNum - diatonic number of the pitch, where 29 = C4, C#4, C-4, etc.; 30 = D-4, D4, D#4, etc. updates other properties.\n * @property {number} midi - midi number of the pitch (C4 = 60); readonly. See {@link music21.pitch.Pitch#ps} for setable version.\n * @property {string} name - letter name of pitch + accidental modifier; e.g., B-flat = 'B-'; changes automatically w/ step and accidental\n * @property {string} nameWithOctave - letter name of pitch + accidental modifier + octave; changes automatically w/ step, accidental, and octave\n * @property {number} octave - number for the octave, where middle C = C4, and octaves change between B and C; default 4\n * @property {number} ps - pitch space number, like midi number but floating point and w/ no restriction on range. C4 = 60.0\n * @property {string} step - letter name for the pitch (C-G, A, B), without accidental; default 'C'\n */\nexport class Pitch extends prebase.ProtoM21Object {\n    constructor(pn) {\n        super();\n        this.classes.push('Pitch');\n        if (pn === undefined) {\n            pn = 'C';\n        }\n        this._step = 'C';\n        this._octave = 4;\n        this._accidental = undefined;\n\n        /* pn can be a nameWithOctave */\n        if (typeof pn === 'number') {\n            if (pn < 12) {\n                pn += 60; // pitchClass\n            }\n            this.ps = pn;\n        } else if (pn.match(/\\d+/)) {\n            this.nameWithOctave = pn;\n        } else {\n            this.name = pn;\n        }        \n    }\n\n\n    get step() { return this._step; }\n    set step(s) { this._step = s; }\n    get octave() { return this._octave; }\n    set octave(o) { this._octave = o; }\n    get accidental() { return this._accidental; }\n    set accidental(a) {\n        if (typeof (a) !== 'object' && a !== undefined) {\n            a = new pitch.Accidental(a);\n        }\n        this._accidental = a;\n    }\n    get name() {\n        if (this.accidental === undefined) {\n            return this.step;\n        } else {\n            return this.step + this.accidental.modifier;\n        }\n    }\n    set name(nn) {\n        this.step = nn.slice(0, 1).toUpperCase();\n        const tempAccidental = nn.slice(1);\n        if (tempAccidental !== undefined) {\n            this.accidental = tempAccidental; // converts automatically\n        } else {\n            this.accidental = undefined;\n        }\n    }\n    get nameWithOctave() {\n        return this.name + this.octave.toString();\n    }\n    set nameWithOctave(pn) {\n        const storedOctave = pn.match(/\\d+/);\n        if (storedOctave !== undefined) {\n            pn = pn.replace(/\\d+/, '');\n            this.octave = parseInt(storedOctave);\n            this.name = pn;\n        } else {\n            this.name = pn;\n        }\n    }\n    get diatonicNoteNum() {\n        return (this.octave * 7) + pitch.nameToSteps[this.step] + 1;\n    }\n    set diatonicNoteNum(newDNN) {\n        newDNN -= 1; // makes math easier\n        this.octave = Math.floor(newDNN / 7);\n        this.step = pitch.stepsToName[newDNN % 7];\n    }\n    get frequency() {\n        return 440 * Math.pow(2, (this.ps - 69) / 12);\n    }\n    get midi() {\n        return Math.floor(this.ps);\n    }\n    get ps() {\n        let accidentalAlter = 0;\n        if (this.accidental !== undefined) {\n            accidentalAlter = parseInt(this.accidental.alter);\n        }\n        return (this.octave + 1) * 12 + pitch.nameToMidi[this.step] + accidentalAlter;\n    }\n    set ps(ps) {\n        this.name = pitch.midiToName[ps % 12];\n        this.octave = Math.floor(ps / 12) - 1;\n    }\n\n    /**\n     * Returns the vexflow name for the pitch in the given clef.\n     *\n     * @memberof music21.pitch.Pitch#\n     * @param {clef.Clef} clefObj - the active {@link music21.clef.Clef} object\n     * @returns {String} - representation in vexflow\n     */\n    vexflowName(clefObj) {\n        // returns a vexflow Key name for this pitch.\n        let tempPitch = this;\n        if (clefObj !== undefined) {\n            try {\n                tempPitch = clefObj.convertPitchToTreble(this);\n            } catch (e) {\n                console.log(e, clefObj);\n            }\n        }\n        let accidentalType = 'n';\n        if (this.accidental !== undefined) {\n            accidentalType = this.accidental.vexflowModifier;\n        }\n        const outName = tempPitch.step + accidentalType + '/' + tempPitch.octave;\n        return outName;\n    }\n}\npitch.Pitch = Pitch;\n\n\npitch.tests = () => {\n    test('music21.pitch.Accidental', () => {\n        const a = new music21.pitch.Accidental('-');\n        equal(a.alter, -1.0, 'flat alter passed');\n        equal(a.name, 'flat', 'flat name passed');\n    });\n\n    test('music21.pitch.Pitch', () => {\n        const p = new music21.pitch.Pitch('D#5');\n        equal(p.name, 'D#', 'Pitch Name set to D#');\n        equal(p.step, 'D',  'Pitch Step set to D');\n        equal(p.octave, 5, 'Pitch octave set to 5');\n        const c = new music21.clef.AltoClef();\n        const vfn = p.vexflowName(c);\n        equal(vfn, 'C#/6', 'Vexflow name set');\n    });\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/note -- Note, Rest, NotRest, GeneralNote\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as MIDI from 'MIDI';\nimport * as Vex from 'vexflow';\n\nimport { prebase } from './prebase';\nimport { base } from './base';\nimport { debug } from './debug';\nimport { pitch } from './pitch';\nimport { beam } from './beam';\nimport { common } from './common';\n\n/**\n * Module for note classes. See the namespace {@link music21.note}\n *\n * @requires music21/common\n * @requires music21/prebase\n * @requires music21/base\n * @requires music21/pitch\n * @requires music21/beam\n * @exports music21/note\n */\n/**\n * Namespace for notes (single pitch) or rests, and some things like Lyrics that go on notes.\n *\n * @namespace music21.note\n * @memberof music21\n * @property {Array} noteheadTypeNames - an Array of allowable notehead names.\n * @property {Array} stemDirectionNames - an Array of allowable stemDirection names.\n */\nexport const note = {};\n\nnote.noteheadTypeNames = [\n    'arrow down',\n    'arrow up',\n    'back slashed',\n    'circle dot',\n    'circle-x',\n    'cluster',\n    'cross',\n    'diamond',\n    'do',\n    'fa',\n    'inverted triangle',\n    'la',\n    'left triangle',\n    'mi',\n    'none',\n    'normal',\n    're',\n    'rectangle',\n    'slash',\n    'slashed',\n    'so',\n    'square',\n    'ti',\n    'triangle',\n    'x',\n];\n\nnote.stemDirectionNames = [\n    'double',\n    'down',\n    'noStem',\n    'none',\n    'unspecified',\n    'up',\n];\n\n/**\n * Class for a single Lyric attached to a {@link music21.note.GeneralNote}\n *\n * @class Lyric\n * @memberOf music21.note\n * @extends music21.prebase.ProtoM21Object\n * @param {string} text - the text of the lyric\n * @param {number} number=1 - the lyric number\n * @param {string} syllabic=undefined - placement of the syllable ('begin', 'middle', 'end', 'single'); undefined = interpret from text\n * @param {boolean} applyRaw=false - true = display the text exactly as it is or, false = use \"-\" etc. to determine syllabic\n * @param {string} identifier=undefined - identifier for the lyric.\n * @property {string} lyricConnector='-' - what to place between two lyrics that are syllabic.\n * @property {string} text - the text of the lyric syllable.\n * @property {string} syllabic - see above\n * @property {boolean} applyRaw - see above\n * @property {string} identifier - see above; gets .number if undefined\n * @property {number} number - see above\n * @property {string} rawText - text + any connectors\n */\nexport class Lyric extends prebase.ProtoM21Object {\n    constructor(text, number, syllabic, applyRaw, identifier) {\n        super();\n        this.classes.push('Lyric');\n        this.lyricConnector = '-'; // override to place something else between two notes...\n        this.text = text;\n        this._number = number || 1;\n        this.syllabic = syllabic;\n        this.applyRaw = applyRaw || false;\n        this.setTextAndSyllabic(this.text, this.applyRaw);\n        this._identifier = identifier;\n    }\n    get identifier() {\n        return this._identifier || this._number;\n    }\n    set identifier(i) {\n        this._identifier = i;\n    }\n    // a property just to match m21p\n    get number() {\n        return this._number;\n    }\n    set number(n) {\n        this._number = n;\n    }\n    get rawText() {\n        if (this.syllabic === 'begin') {\n            return this.text + this.lyricConnector;\n        } else if (this.syllabic === 'middle') {\n            return this.lyricConnector + this.text + this.lyricConnector;\n        } else if (this.syllabic === 'end') {\n            return this.lyricConnector + this.text;\n        } else {\n            return this.text;\n        }\n    }\n    set rawText(t) {\n        this.setTextAndSyllabic(t, false);\n    }\n    setTextAndSyllabic(rawText, applyRaw) {\n        if (rawText === undefined) {\n            this.text = undefined;\n            return this;\n        }\n\n        if (!applyRaw\n                && (rawText.indexOf(this.lyricConnector) === 0)\n                && (rawText.slice(-1) === this.lyricConnector)) {\n            this.text = rawText.slice(1, -1);\n            this.syllabic = 'middle';\n        } else if (!applyRaw\n                    && (rawText.indexOf(this.lyricConnector) === 0)) {\n            this.text = rawText.slice(1);\n            this.syllabic = 'end';\n        } else if (!applyRaw\n                    && (rawText.slice(-1) === this.lyricConnector)) {\n            this.text = rawText.slice(0, -1);\n            this.syllabic = 'begin';\n        } else {\n            this.text = rawText;\n            if (this.syllabic === undefined) {\n                this.syllabic = 'single';\n            }\n        }\n        return this;\n    }\n}\nnote.Lyric = Lyric;\n\n/* Notes and rests etc... */\n\n/**\n * Superclass for all Note values\n *\n * @class GeneralNote\n * @memberof music21.note\n * @extends music21.base.Music21Object\n * @param {(number|undefined)} [ql=1.0] - quarterLength of the note\n * @property {boolean} [isChord=false] - is this a chord\n * @property {number} quarterLength - shortcut to `.duration.quarterLength`\n * @property {object} activeVexflowNote - most recent Vex.Flow.StaveNote object to be made from this note (could change); default, undefined\n * @property {Array<music21.expressions.Expression>} expressions - array of attached expressions\n * @property {Array<music21.articulations.Articulation>} articulations - array of attached articulations\n * @property {string} lyric - the text of the first {@link music21.note.Lyric} object; can also set one.\n * @property {Array<music21.note.Lyric>} lyrics - array of attached lyrics\n * @property {number} [volume=60] - how loud is this note, 0-127, before articulations\n * @property {number} midiVolume - how loud is this note, taking into account articulations\n * @property {music21.note.Tie|undefined} [tie=undefined] - a tie object\n */\nexport class GeneralNote extends base.Music21Object {\n    constructor(ql) {\n        super();\n        this.classes.push('GeneralNote');\n        this.isChord = false;\n        if (ql !== undefined) {\n            this.duration.quarterLength = ql;\n        }\n        this.volume = 60;\n        this.activeVexflowNote = undefined;\n        this.expressions = [];\n        this.articulations = [];\n        this.lyrics = [];\n        this.tie = undefined;\n        /* TODO: editorial objects, color, addLyric, insertLyric, hasLyrics */\n        /* Later: augmentOrDiminish, getGrace, */\n    }\n    get lyric() {\n        if (this.lyrics.length > 0) {\n            return this.lyrics[0].text;\n        } else {\n            return undefined;\n        }\n    }\n    set lyric(value) {\n        this.lyrics = [];\n        if (value !== undefined && value !== false) {\n            this.lyrics.push(new note.Lyric(value));\n        }\n    }\n    get midiVolume() {\n        let volume = this.volume;\n        if (volume === undefined) {\n            volume = 60;\n        }\n        if (this.articulations !== undefined) {\n            this.articulations.forEach((a) => {\n                volume *= a.dynamicScale;\n                if (volume > 127) {\n                    volume = 127;\n                } else if (isNaN(volume)) {\n                    volume = 60;\n                }\n            });\n        }\n        volume = Math.floor(volume);\n        return volume;\n    }\n    /**\n     * Add a {@link music21.note.Lyric} object to the Note\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {string} text - text to be added\n     * @param {number} [lyricNumber] - integer specifying lyric (defaults to the current `.lyrics.length` + 1)\n     * @param {boolean} [applyRaw=false] - if `true`, do not parse the text for cluses about syllable placement.\n     * @param {string} [lyricIdentifier] - an optional identifier\n     */\n    addLyric(text, lyricNumber, applyRaw, lyricIdentifier) {\n        applyRaw = applyRaw || false;\n        if (lyricNumber === undefined) {\n            const maxLyrics = this.lyrics.length + 1;\n            const newLyric = new note.Lyric(text, maxLyrics, undefined, applyRaw, lyricIdentifier);\n            this.lyrics.push(newLyric);\n        } else {\n            let foundLyric = false;\n            for (let i = 0; i < self.lyrics.length; i++) {\n                const thisLyric = self.lyrics[i];\n                if (thisLyric.number === lyricNumber) {\n                    thisLyric.text = text;\n                    foundLyric = true;\n                    break;\n                }\n            }\n            if (foundLyric === false) {\n                const newLyric = new note.Lyric(text, lyricNumber, undefined, applyRaw, lyricIdentifier);\n                this.lyrics.push(newLyric);\n            }\n        }\n    }\n    /**\n     * Change stem direction according to clef. Does nothing for GeneralNote; overridden in subclasses.\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {music21.clef.Clef} [clef] - clef to set the stem direction of.\n     * @returns {undefined}\n     */\n    setStemDirectionFromClef(clef) {\n        return undefined;\n    }\n    /**\n     * Sets the vexflow accidentals (if any), the dots, and the stem direction\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {Vex.Flow.StaveNote} vfn - a Vex.Flow note\n     */\n    vexflowAccidentalsAndDisplay(vfn, options) {\n        if (this.duration.dots > 0) {\n            for (let i = 0; i < this.duration.dots; i++) {\n                vfn.addDotToAll();\n            }\n        }\n        if (this.activeSite !== undefined\n                && this.activeSite.renderOptions.stemDirection !== undefined) {\n            this.stemDirection = this.activeSite.renderOptions.stemDirection;\n        } else if (this.stemDirection === undefined\n                        && options.clef !== undefined) {\n            this.setStemDirectionFromClef(options.clef);\n        }\n        if (debug) {\n            console.log(this.stemDirection);\n        }\n        vfn.setStemDirection(this.stemDirection === 'down' ?\n                Vex.Flow.StaveNote.STEM_DOWN :\n                    Vex.Flow.StaveNote.STEM_UP);\n        if (this.stemDirection === 'noStem') {\n            vfn.hasStem = () => false; // need to override...\n            // vfn.render_options.stem_height = 0;\n        } else {\n            // correct VexFlow stem length for notes far from the center line;\n            let staveDNNSpacing = 5;\n            if (options.stave) {\n                staveDNNSpacing = Math.floor(options.stave.options.spacing_between_lines_px / 2);\n            }\n            if (options.clef !== undefined && this.pitch !== undefined) {\n                const midLine = options.clef.lowestLine + 4;\n                // console.log(midLine);\n                const absDNNfromCenter = Math.abs(this.pitch.diatonicNoteNum - midLine);\n                const absOverOctave = absDNNfromCenter - 7;\n                // console.log(absOverOctave);\n                if (absOverOctave > 0 && vfn.getStemLength !== undefined) {\n                    const stemHeight = (absOverOctave * staveDNNSpacing) + vfn.getStemLength();\n                    vfn.setStemLength(stemHeight);\n                }\n            }\n        }\n    }\n    /**\n     * Play the current element as a MIDI note.\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {number} [tempo=120] - tempo in bpm\n     * @param {(base.Music21Object)} [nextElement] - for determining the length to play in case of tied notes, etc.\n     * @param {object} [options] - other options (currently just `{instrument: {@link music21.instrument.Instrument} }`)\n     * @returns {Number} - delay time in milliseconds until the next element (may be ignored)\n     */\n    playMidi(tempo, nextElement, options) {\n        // returns the number of milliseconds to the next element in\n        // case that can't be determined otherwise.\n        if (tempo === undefined) {\n            tempo = 120;\n        }\n        if (options === undefined) {\n            let inst;\n            if (this.activeSite !== undefined) {\n                inst = this.activeSite.instrument;\n            }\n            options = { instrument: inst };\n        }\n\n        const volume = this.midiVolume;\n        let channel = 0;\n        if (options !== undefined && options.instrument !== undefined) {\n            channel = options.instrument.midiChannel;\n        }\n        let milliseconds = 60 * 1000 / tempo;\n        const ql = this.duration.quarterLength;\n        milliseconds = 60 * ql * 1000 / tempo;\n        let midNum;\n        if (this.isClassOrSubclass('Note')) { // Note, not rest\n            midNum = this.pitch.midi;\n            let stopTime = milliseconds / 1000;\n            if (nextElement !== undefined && nextElement.isClassOrSubclass('Note')) {\n                if (nextElement.pitch.midi !== this.pitch.midi) {\n                    stopTime += 60 * 0.25 / tempo; // legato -- play 16th note longer\n                } else if (this.tie !== undefined\n                            && (this.tie.type === 'start'\n                                || this.tie.type === 'continue')) {\n                    stopTime += 60 * nextElement.duration.quarterLength / tempo;\n                    // this does not take into account 3 or more notes tied.\n                    // TODO: look ahead at next nexts, etc.\n                }\n            } else if (nextElement === undefined) {\n                // let last note ring an extra beat...\n                stopTime += 60 * 1 / tempo;\n            }\n            // console.log(stopTime);\n            // console.log(this.tie);\n            if (this.tie === undefined || this.tie.type === 'start') {\n                // console.log(volume);\n                MIDI.noteOn(channel, midNum, volume, 0);\n                MIDI.noteOff(channel, midNum, stopTime);\n            }// else { console.log ('not going to play ', this.nameWithOctave); }\n        } else if (this.isClassOrSubclass('Chord')) {\n            // TODO: Tied Chords.\n            for (let j = 0; j < this._notes.length; j++) {\n                midNum = this._notes[j].pitch.midi;\n                MIDI.noteOn(channel, midNum, volume, 0);\n                MIDI.noteOff(channel, midNum, milliseconds / 1000);\n            }\n        } // it's a note.Rest -- do nothing -- milliseconds takes care of it...\n        return milliseconds;\n    }\n}\nnote.GeneralNote = GeneralNote;\n\n/**\n * Specifies that a GeneralNote is not a rest (Unpitched, Note, Chord).\n *\n * @class NotRest\n * @memberof music21.note\n * @extends music21.note.GeneralNote\n * @param {number} [ql=1.0] - length in quarter notes\n * @property {music21.beam.Beams} beams - a link to a beam object\n * @property {string} [notehead='normal'] - notehead type\n * @property {string} [noteheadFill='default'] - notehead fill\n * @property {string|undefined} [noteheadColor=undefined] - notehead color\n * @property {boolean} [noteheadParenthesis=false] - put a parenthesis around the notehead?\n * @property {string|undefined} [stemDirection=undefined] - One of ['up','down','noStem', undefined] -- 'double' not supported\n */\nexport class NotRest extends GeneralNote {\n    constructor(ql) {\n        super(ql);\n        this.classes.push('NotRest');\n        this.notehead = 'normal';\n        this.noteheadFill = 'default';\n        this.noteheadColor = undefined;\n        this.noteheadParenthesis = false;\n        this.volume = undefined; // not a real object yet.\n        this.beams = new beam.Beams();\n        /* TODO: this.duration.linkage -- need durationUnits */\n        this.stemDirection = undefined;\n        /* TODO: check stemDirection, notehead, noteheadFill, noteheadParentheses */\n    }\n}\nnote.NotRest = NotRest;\n\n/* ------- Note ----------- */\n/**\n * A very, very important class! music21.note.Note objects combine a {@link music21.pitch.Pitch}\n * object to describe pitch (highness/lowness) with a {@link music21.duration.Duration} object\n * that defines length, with additional features for drawing the Note, playing it back, etc.\n *\n * Together with {@link music21.stream.Stream} one of the two most important\n * classes in `music21`.\n *\n * See {@link music21.note.NotRest}, {@link music21.note.GeneralNote}, {@link music21.base.Music21Object}\n * and {@link music21.prebase.ProtoM21Object} (or in general, the **extends** list below) for other\n * things you can do with a `Note` object.\n *\n * Missing from music21p: `microtone, pitchClass, pitchClassString, transpose(), fullName`.\n *\n * @class Note\n * @memberof music21.note\n * @extends music21.note.NotRest\n * @param {(string|music21.pitch.Pitch|undefined)} [nn='C4'] - pitch name (\"C\", \"D#\", \"E-\") w/ or w/o octave (\"C#4\"), or a pitch.Pitch object\n * @param {(number|undefined)} [ql=1.0] - length in quarter notes\n * @property {Boolean} [isNote=true] - is it a Note? Yes!\n * @property {Boolean} [isRest=false] - is it a Rest? No!\n * @property {music21.pitch.Pitch} pitch - the {@link music21.pitch.Pitch} associated with the Note.\n * @property {string} name - shortcut to `.pitch.name`\n * @property {string} nameWithOctave - shortcut to `.pitch.nameWithOctave`\n * @property {string} step - shortcut to `.pitch.step`\n * @property {number} octave - shortcut to `.pitch.octave`\n */\nexport class Note extends NotRest {\n    constructor(nn, ql) {\n        super(ql);\n        this.classes.push('Note');\n        this.isNote = true; // for speed\n        this.isRest = false; // for speed\n        if (nn !== undefined\n                && nn.isClassOrSubclass !== undefined\n                && nn.isClassOrSubclass('Pitch') === true) {\n            this.pitch = nn;\n        } else {\n            this.pitch = new pitch.Pitch(nn);\n        }\n    }\n    get name() {\n        return this.pitch.name;\n    }\n    set name(nn) {\n        this.pitch.name = nn;\n    }\n    get nameWithOctave() {\n        return this.pitch.nameWithOctave;\n    }\n    set nameWithOctave(nn) {\n        this.pitch.nameWithOctave = nn;\n    }\n    get step() {\n        return this.pitch.step;\n    }\n    set step(nn) {\n        this.pitch.step = nn;\n    }\n    // no Frequency\n    get octave() {\n        return this.pitch.octave;\n    }\n    set octave(nn) {\n        this.pitch.octave = nn;\n    }\n    /* TODO: transpose, fullName, microtone, pitchclass, pitchClassString */\n    /**\n     * Change stem direction according to clef.\n     *\n     * @memberof music21.note.Note\n     * @param {music21.clef.Clef} [clef] - clef to set the stem direction of.\n     * @returns {music21.note.Note} Original object, for chaining methods\n     */\n    setStemDirectionFromClef(clef) {\n        if (clef === undefined) {\n            return this;\n        } else {\n            const midLine = clef.lowestLine + 4;\n            const DNNfromCenter = this.pitch.diatonicNoteNum - midLine;\n            // console.log(DNNfromCenter, this.pitch.nameWithOctave);\n            if (DNNfromCenter >= 0) {\n                this.stemDirection = 'down';\n            } else {\n                this.stemDirection = 'up';\n            }\n            return this;\n        }\n    }\n    /**\n     * Returns a `Vex.Flow.StaveNote` that approximates this note.\n     *\n     * @memberof music21.note.Note\n     * @param {object} [options={}] - `{clef: {@link music21.clef.Clef} }` clef to set the stem direction of.\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        const params = {};\n        common.merge(params, options);\n        const clef = params.clef;\n\n        if (this.duration === undefined) {\n            // console.log(this);\n            return undefined;\n        }\n        const vfd = this.duration.vexflowDuration;\n        if (vfd === undefined) {\n            return undefined;\n        }\n        const vexflowKey = this.pitch.vexflowName(clef);\n        const vfn = new Vex.Flow.StaveNote({\n            keys: [vexflowKey],\n            duration: vfd,\n        });\n        this.vexflowAccidentalsAndDisplay(vfn, params); // clean up stuff...\n        if (this.pitch.accidental !== undefined) {\n            if (this.pitch.accidental.vexflowModifier !== 'n'\n                    && this.pitch.accidental.displayStatus !== false) {\n                vfn.addAccidental(0, new Vex.Flow.Accidental(this.pitch.accidental.vexflowModifier));\n            } else if (this.pitch.accidental.displayType === 'always'\n                            || this.pitch.accidental.displayStatus === true) {\n                vfn.addAccidental(0, new Vex.Flow.Accidental(this.pitch.accidental.vexflowModifier));\n            }\n        }\n\n        if (this.articulations[0] !== undefined) {\n            for (let i = 0; i < this.articulations.length; i++) {\n                const art = this.articulations[i];\n                vfn.addArticulation(0, art.vexflow()); // 0 refers to the first pitch (for chords etc.)...\n            }\n        }\n        if (this.expressions[0] !== undefined) {\n            for (let j = 0; j < this.expressions.length; j++) {\n                const exp = this.expressions[j];\n                vfn.addArticulation(0, exp.vexflow()); // 0 refers to the first pitch (for chords etc.)...\n            }\n        }\n        if (this.noteheadColor) {\n            vfn.setKeyStyle(0, { fillStyle: this.noteheadColor });\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n}\nnote.Note = Note;\n\n/* ------ TODO: Unpitched ------ */\n\n\n/* ------ Rest ------ */\n\n/**\n * Represents a musical rest.\n *\n * @class Rest\n * @memberof music21.note\n * @extends music21.note.GeneralNote\n * @param {number} [ql=1.0] - length in number of quarterNotes\n * @property {Boolean} [isNote=false]\n * @property {Boolean} [isRest=true]\n * @property {string} [name='rest']\n * @property {number} [lineShift=undefined] - number of lines to shift up or down from default\n */\nexport class Rest extends GeneralNote {\n    constructor(ql) {\n        super(ql);\n        this.classes.push('Rest');\n        this.isNote = false; // for speed\n        this.isRest = true; // for speed\n        this.name = 'rest'; // for note compatibility\n        this.lineShift = undefined;\n    }\n    /**\n     * Returns a `Vex.Flow.StaveNote` that approximates this rest.\n     * Corrects for bug in VexFlow that renders a whole rest too low.\n     *\n     * @memberof music21.note.Rest\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        let keyLine = 'b/4';\n        if (this.duration.type === 'whole') {\n            if (this.activeSite !== undefined\n                    && this.activeSite.renderOptions.staffLines !== 1) {\n                keyLine = 'd/5';\n            }\n        }\n        if (this.lineShift !== undefined) {\n            const p = new pitch.Pitch('B4');\n            let ls = this.lineShift;\n            if (this.duration.type === 'whole') {\n                ls += 2;\n            }\n            p.diatonicNoteNum += ls;\n            keyLine = p.vexflowName(undefined);\n        }\n\n        const vfn = new Vex.Flow.StaveNote({ keys: [keyLine],\n            duration: this.duration.vexflowDuration + 'r' });\n        if (this.duration.dots > 0) {\n            for (let i = 0; i < this.duration.dots; i++) {\n                vfn.addDotToAll();\n            }\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n}\nnote.Rest = Rest;\n\n/* ------ SpacerRest ------ */\n\n\nnote.tests = () => {\n    test('music21.note.Note', () => {\n        const n = new note.Note('D#5');\n        equal(n.pitch.name, 'D#', 'Pitch Name set to D#');\n        equal(n.pitch.step, 'D',  'Pitch Step set to D');\n        equal(n.pitch.octave, 5, 'Pitch octave set to 5');\n    });\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/chord -- Chord\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as Vex from 'vexflow';\nimport { Music21Exception } from './exceptions21';\nimport { note } from './note';\n\n/**\n * chord Module. See {@link music21.chord} namespace for more details\n *\n * @exports music21/chord\n */\n/**\n * Chord related objects (esp. {@link music21.chord.Chord}) and methods.\n *\n * @namespace music21.chord\n * @memberof music21\n * @requires music21/note\n */\nexport    const chord = {};\n\n/**\n * Chord related objects (esp. {@link music21.chord.Chord}) and methods.\n *\n * @class Chord\n * @memberof music21.chord\n * @param {Array<string|music21.note.Note|music21.pitch.Pitch>} [notes] - an Array of strings\n * (see {@link music21.pitch.Pitch} for valid formats), note.Note, or pitch.Pitch objects.\n * @extends music21.note.NotRest\n * @property {number} length - the number of pitches in the Chord (readonly)\n * @property {Array<music21.pitch.Pitch>} pitches - an Array of Pitch objects in the chord. (Consider the Array read only and pass in a new Array to change)\n * @property {Boolean} [isChord=true]\n * @property {Boolean} [isNote=false]\n * @property {Boolean} [isRest=false]\n */\nexport class Chord extends note.NotRest {\n    constructor(notes) {\n        super();\n        if (typeof (notes) === 'undefined') {\n            notes = [];\n        }\n        this.classes.push('Chord');\n        this.isChord = true; // for speed\n        this.isNote = false; // for speed\n        this.isRest = false; // for speed\n\n        this._notes = [];\n        notes.forEach(this.add, this);\n    }\n    get length() {\n        return this._notes.length;\n    }\n    get pitches() {\n        const tempPitches = [];\n        for (let i = 0; i < this._notes.length; i++) {\n            tempPitches.push(this._notes[i].pitch);\n        }\n        return tempPitches;\n    }\n    set pitches(tempPitches) {\n        this._notes = [];\n        for (let i = 0; i < tempPitches.length; i++) {\n            let addNote;\n            if (typeof (tempPitches[i]) === 'string') {\n                addNote = new note.Note(tempPitches[i]);\n            } else if (tempPitches[i].isClassOrSubclass('Pitch')) {\n                addNote = new note.Note();\n                addNote.pitch = tempPitches[i];\n            } else if (tempPitches[i].isClassOrSubclass('Note')) {\n                addNote = tempPitches[i];\n            } else {\n                console.warn('bad pitch', tempPitches[i]);\n                throw new Music21Exception('Cannot add pitch from ' + tempPitches[i]);\n            }\n            this._notes.push(addNote);\n        }\n    }\n    setStemDirectionFromClef(clef) {\n        if (clef === undefined) {\n            return this;\n        } else {\n            const midLine = clef.lowestLine + 4;\n            // console.log(midLine, 'midLine');\n            let maxDNNfromCenter = 0;\n            const pA = this.pitches;\n            for (let i = 0; i < this.pitches.length; i++) {\n                const p = pA[i];\n                const DNNfromCenter = p.diatonicNoteNum - midLine;\n                // >= not > so that the highest pitch wins the tie and thus stem down.\n                if (Math.abs(DNNfromCenter) >= Math.abs(maxDNNfromCenter)) {\n                    maxDNNfromCenter = DNNfromCenter;\n                }\n            }\n            if (maxDNNfromCenter >= 0) {\n                this.stemDirection = 'down';\n            } else {\n                this.stemDirection = 'up';\n            }\n            return this;\n        }\n    }\n    /**\n     * Adds a note to the chord, sorting the note array\n     *\n     * @memberof music21.chord.Chord\n     * @param {string|music21.note.Note|music21.pitch.Pitch} noteObj - the Note or Pitch to be added or a string defining a pitch.\n     * @returns {music21.chord.Chord} the original chord.\n     */\n    add(noteObj) {\n        // takes in either a note or a pitch\n        if (typeof (noteObj) === 'string') {\n            noteObj = new note.Note(noteObj);\n        } else if (noteObj.isClassOrSubclass('Pitch')) {\n            const pitchObj = noteObj;\n            const noteObj2 = new note.Note();\n            noteObj2.pitch = pitchObj;\n            noteObj = noteObj2;\n        }\n        this._notes.push(noteObj);\n        // inefficient because sorts after each add, but safe and #(p) is small\n        this._notes.sort((a, b) => a.pitch.ps - b.pitch.ps);\n        return this;\n    }\n    /**\n     * Removes any pitches that appear more than once (in any octave), removing the higher ones, and returns a new Chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.chord.Chord} A new Chord object with duplicate pitches removed.\n     */\n    removeDuplicatePitches() {\n        const stepsFound = [];\n        const nonDuplicatingPitches = [];\n        const pitches = this.pitches;\n        for (let i = 0; i < pitches.length; i++) {\n            const p = pitches[i];\n            if (stepsFound.indexOf(p.step) === -1) {\n                stepsFound.push(p.step);\n                nonDuplicatingPitches.push(p);\n            }\n        }\n        const closedChord = new chord.Chord(nonDuplicatingPitches);\n        return closedChord;\n    }\n    /**\n     * Finds the Root of the chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.pitch.Pitch} the root of the chord.\n     */\n    root() {\n        const closedChord = this.removeDuplicatePitches();\n        /* var chordBass = closedChord.bass(); */\n        const closedPitches = closedChord.pitches;\n        if (closedPitches.length === 0) {\n            throw new Music21Exception('No notes in Chord!');\n        } else if (closedPitches.length === 1) {\n            return this.pitches[0];\n        }\n        const indexOfPitchesWithPerfectlyStackedThirds = [];\n        const testSteps = [3, 5, 7, 2, 4, 6];\n        for (let i = 0; i < closedPitches.length; i++) {\n            const p = closedPitches[i];\n            const currentListOfThirds = [];\n            for (let tsIndex = 0; tsIndex < testSteps.length; tsIndex++) {\n                const chordStepPitch = closedChord.getChordStep(testSteps[tsIndex], p);\n                if (chordStepPitch !== undefined) {\n                    // console.log(p.name + \" \" + testSteps[tsIndex].toString() + \" \" + chordStepPitch.name);\n                    currentListOfThirds.push(true);\n                } else {\n                    currentListOfThirds.push(false);\n                }\n            }\n            // console.log(currentListOfThirds);\n            let hasFalse = false;\n            for (let j = 0; j < closedPitches.length - 1; j++) {\n                if (currentListOfThirds[j] === false) {\n                    hasFalse = true;\n                }\n            }\n            if (hasFalse === false) {\n                indexOfPitchesWithPerfectlyStackedThirds.push(i);\n                return closedChord.pitches[i]; // should do more, but fine...\n                // should test rootedness function, etc. 13ths. etc.\n            }\n        }\n        return closedChord.pitches[0]; // fallback, just return the bass...\n    }\n    /**\n     * Returns the number of semitones above the root that a given chordstep is.\n     *\n     * For instance, in a G dominant 7th chord (G, B, D, F), would\n     * return 4 for chordStep=3, since the third of the chord (B) is four semitones above G.\n     *\n     * @memberof music21.chord.Chord\n     * @param {number} chordStep - the step to find, e.g., 1, 2, 3, etc.\n     * @param {music21.pitch.Pitch} [testRoot] - the pitch to temporarily consider the root.\n     * @returns {number|undefined} Number of semitones above the root for this chord step or undefined if no pitch matches that chord step.\n     */\n    semitonesFromChordStep(chordStep, testRoot) {\n        if (testRoot === undefined) {\n            testRoot = this.root();\n        }\n        const tempChordStep = this.getChordStep(chordStep, testRoot);\n        if (tempChordStep === undefined) {\n            return undefined;\n        } else {\n            let semitones = (tempChordStep.ps - testRoot.ps) % 12;\n            if (semitones < 0) {\n                semitones += 12;\n            }\n            return semitones;\n        }\n    }\n    /**\n     * Gets the lowest note (based on .ps not name) in the chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.pitch.Pitch} bass pitch\n     */\n    bass() {\n        let lowest;\n        const pitches = this.pitches;\n        for (let i = 0; i < pitches.length; i++) {\n            const p = pitches[i];\n            if (lowest === undefined) {\n                lowest = p;\n            } else if (p.ps < lowest.ps) {\n                lowest = p;\n            }\n        }\n        return lowest;\n    }\n    /**\n     * Counts the number of non-duplicate pitch MIDI Numbers in the chord.\n     *\n     * Call after \"closedPosition()\" to get Forte style cardinality disregarding octave.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {number}\n     */\n    cardinality() {\n        const uniqueChord = this.removeDuplicatePitches();\n        return uniqueChord.pitches.length;\n    }\n    /**\n    *\n    * @memberof music21.chord.Chord\n    * @returns {Boolean}\n    */\n    isMajorTriad() {\n        if (this.cardinality() !== 3) {\n            return false;\n        }\n        const thirdST = this.semitonesFromChordStep(3);\n        const fifthST = this.semitonesFromChordStep(5);\n        if (thirdST === 4 && fifthST === 7) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    /**\n    *\n    * @memberof music21.chord.Chord\n    * @returns {Boolean}\n    */\n    isMinorTriad() {\n        if (this.cardinality() !== 3) {\n            return false;\n        }\n        const thirdST = this.semitonesFromChordStep(3);\n        const fifthST = this.semitonesFromChordStep(5);\n        if (thirdST === 3 && fifthST === 7) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    /**\n     * Returns the inversion of the chord as a number (root-position = 0)\n     *\n     * Unlike music21 version, cannot set the inversion, yet.\n     *\n     * TODO: add.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {number}\n     */\n    inversion() {\n        const bass = this.bass();\n        const root = this.root();\n        const chordStepsToInversions = [1, 6, 4, 2, 7, 5, 3];\n        for (let i = 0; i < chordStepsToInversions.length; i++) {\n            const testNote = this.getChordStep(chordStepsToInversions[i], bass);\n            if (testNote !== undefined && testNote.name === root.name) {\n                return i;\n            }\n        }\n        return undefined;\n    }\n    /**\n     * @memberof music21.chord.Chord\n     * @param {object} options - a dictionary of options `{clef: {@music21.clef.Clef} }` is especially important\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        const clef = options.clef;\n\n        const pitchKeys = [];\n        for (let i = 0; i < this._notes.length; i++) {\n            pitchKeys.push(this._notes[i].pitch.vexflowName(clef));\n        }\n        const vfn = new Vex.Flow.StaveNote({ keys: pitchKeys,\n                                            duration: this.duration.vexflowDuration });\n        this.vexflowAccidentalsAndDisplay(vfn, options); // clean up stuff...\n        for (let i = 0; i < this._notes.length; i++) {\n            const tn = this._notes[i];\n            if (tn.pitch.accidental !== undefined) {\n                if (tn.pitch.accidental.vexflowModifier !== 'n'\n                        && tn.pitch.accidental.displayStatus !== false) {\n                    vfn.addAccidental(i, new Vex.Flow.Accidental(tn.pitch.accidental.vexflowModifier));\n                } else if (tn.pitch.accidental.displayType === 'always'\n                        || tn.pitch.accidental.displayStatus === true) {\n                    vfn.addAccidental(i, new Vex.Flow.Accidental(tn.pitch.accidental.vexflowModifier));\n                }\n            }\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n    /**\n     * Returns the Pitch object that is a Generic interval (2, 3, 4, etc., but not 9, 10, etc.) above\n     * the `.root()`\n     *\n     * In case there is more that one note with that designation (e.g., `[A-C-C#-E].getChordStep(3)`)\n     * the first one in `.pitches` is returned.\n     *\n     * @memberof music21.chord.Chord\n     * @param {Int} chordStep a positive integer representing the chord step\n     * @param {music21.pitch.Pitch} [testRoot] - the Pitch to use as a temporary root\n     * @returns {music21.pitch.Pitch|undefined}\n     */\n    getChordStep(chordStep, testRoot) {\n        if (testRoot === undefined) {\n            testRoot = this.root();\n        }\n        if (chordStep >= 8) {\n            chordStep %= 7;\n        }\n        const thisPitches = this.pitches;\n        const testRootDNN = testRoot.diatonicNoteNum;\n        for (let i = 0; i < thisPitches.length; i++) {\n            const thisPitch = thisPitches[i];\n            let thisInterval = (thisPitch.diatonicNoteNum - testRootDNN + 1) % 7; // fast cludge\n            if (thisInterval <= 0) {\n                thisInterval += 7;\n            }\n            if (thisInterval === chordStep) {\n                return thisPitch;\n            }\n        }\n        return undefined;\n    }\n}\nchord.Chord = Chord;\n\nchord.chordDefinitions = {\n    'major': ['M3', 'm3'],\n    'minor': ['m3', 'M3'],\n    'diminished': ['m3', 'm3'],\n    'augmented': ['M3', 'M3'],\n    'major-seventh': ['M3', 'm3', 'M3'],\n    'dominant-seventh': ['M3', 'm3', 'm3'],\n    'minor-seventh': ['m3', 'M3', 'm3'],\n    'diminished-seventh': ['m3', 'm3', 'm3'],\n    'half-diminished-seventh': ['m3', 'm3', 'M3'],\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/clef -- Clef objects\n *\n * note: only defines a single Clef object for now\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base';\nimport { pitch } from './pitch';\n\n/**\n * Clef module, see {@link music21.clef} for namespace\n *\n * @exports music21/clef\n */\n/**\n * Clef related objects and properties\n *\n * @namespace music21.clef\n * @memberof music21\n * @requires music21/base\n * @requires music21/pitch\n */\nexport const clef = {};\n/*  music21.Clef\n\tmust be defined before Stream since Stream subclasses call new music21.Clef...\n */\n// TODO: Fix to newest Vexflow format...\nclef.lowestLines = {\n    'treble': 31,\n    'soprano': 29,\n    'mezzo-soprano': 27,\n    'alto': 25,\n    'tenor': 23,\n    'bass': 19,\n    'percussion': 31,\n};\n/**\n * Clefname can be one of\n * \"treble\", \"bass\", \"soprano\", \"mezzo-soprano\", \"alto\", \"tenor\", \"percussion\"\n *\n * @class Clef\n * @memberof music21.clef\n * @extends music21.base.Music21Object\n * @param {string} name - clef name\n * @param {Int} [octaveChange=0] - ottava\n * @property {string|undefined} name\n * @property {Int} lowestLine - diatonicNoteNum (C4 = 29) for the lowest line (in a five-line staff)\n * @property {Int} lowestLineTrebleOffset - difference between the first line of this staff and the first line in treble clef\n * @property {Int} octaveChange\n */\nexport class Clef extends base.Music21Object {\n    constructor(name, octaveChange) {\n        super();\n        this.classes.push('Clef');\n        if (name !== undefined) {\n            name = name.toLowerCase();\n            this.name = name;\n            this.lowestLine = clef.lowestLines[name];\n            this.lowestLineTrebleOffset = clef.lowestLines.treble - this.lowestLine;\n        } else {\n            this.name = undefined;\n            this.lowestLine = clef.lowestLines.treble;\n            this.lowestLineTrebleOffset = 0;\n        }\n        if (octaveChange === undefined) {\n            this.octaveChange = 0;\n        } else {\n            this.octaveChange = octaveChange;\n            this.lowestLine += (7 * octaveChange);\n            this.lowestLineTrebleOffset -= 7 * octaveChange;\n        }\n    }\n    /**\n     * returns a new pitch object if the clef name is not Treble\n     * designed so it would look the same as it would in treble clef.\n     * for instance, bass-clef 2nd-space C# becomes treble clef 2nd-space A#\n     * used for Vex.Flow which requires all pitches to be input as if they\n     * are in treble clef.\n     *\n     * @memberof music21.clef.Clef\n     * @param {music21.pitch.Pitch} p\n     * @returns {music21.pitch.Pitch} new pitch\n     */\n    convertPitchToTreble(p) {\n        if (this.lowestLine === undefined) {\n            console.log('no first line defined for clef', this.name, this);\n            return p; // error\n        }\n        const lowestLineDifference = this.lowestLineTrebleOffset;\n        const tempPitch = new pitch.Pitch(p.step);\n        tempPitch.octave = p.octave;\n        tempPitch.diatonicNoteNum += lowestLineDifference;\n        tempPitch.accidental = p.accidental;\n        return tempPitch;\n    }\n}\n\nclef.Clef = Clef;\n\n/**\n * A TrebleClef (same as new music21.clef.Clef('treble')\n *\n * @class TrebleClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class TrebleClef extends Clef {\n    constructor() {\n        super('treble');\n        this.classes.push('TrebleClef');\n    }\n}\nclef.TrebleClef = TrebleClef;\n/**\n * A TrebleClef down an octave (same as new music21.clef.Clef('treble', -1)\n *\n * Unlike music21p, currently not a subclass of TrebleClef.\n *\n * @class Treble8vbClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class Treble8vbClef extends Clef {\n    constructor() {\n        super('treble', -1);\n        this.classes.push('Treble8vbClef');\n    }\n}\nclef.Treble8vbClef = Treble8vbClef;\n\n/**\n * A TrebleClef up an octave (same as new music21.clef.Clef('treble', 1)\n *\n * @class Treble8vaClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class Treble8vaClef extends Clef {\n    constructor() {\n        super('treble', 1);\n        this.classes.push('Treble8vaClef');\n    }\n}\nclef.Treble8vaClef = Treble8vaClef;\n\n/**\n * A BassClef (same as new music21.clef.Clef('bass')\n *\n * @class BassClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class BassClef extends Clef {\n    constructor() {\n        super('bass');\n        this.classes.push('BassClef');\n    }\n}\nclef.BassClef = BassClef;\n\n/**\n * An AltoClef (same as new music21.clef.Clef('alto')\n *\n * @class AltoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class AltoClef extends Clef {\n    constructor() {\n        super('alto');\n        this.classes.push('AltoClef');\n    }\n}\nclef.AltoClef = AltoClef;\n\n/**\n * A Tenor Clef (same as new music21.clef.Clef('tenor')\n *\n * @class TenorClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class TenorClef extends Clef {\n    constructor() {\n        super('tenor');\n        this.classes.push('TenorClef');\n    }\n}\nclef.TenorClef = TenorClef;\n/**\n * A Soprano Clef (same as new music21.clef.Clef('soprano')\n *\n * @class SopranoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class SopranoClef extends Clef {\n    constructor() {\n        super('soprano');\n        this.classes.push('SopranoClef');\n    }\n}\nclef.SopranoClef = SopranoClef;\n\n\n/**\n * A Mezzo-Soprano Clef (same as new music21.clef.Clef('mezzo-soprano')\n *\n * @class MezzoSopranoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class MezzoSopranoClef extends Clef {\n    constructor() {\n        super('mezzo-soprano');\n        this.classes.push('MezzoSopranoClef');\n    }\n}\nclef.MezzoSopranoClef = MezzoSopranoClef;\n\n/**\n * A Percussion Clef (same as new music21.clef.Clef('percussion')\n *\n * First line is treated as if it's treble clef. Not available as \"bestClef\"\n *\n * @class PercussionClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class PercussionClef extends Clef {\n    constructor() {\n        super('percussion');\n        this.classes.push('PercussionClef');\n    }\n}\nclef.PercussionClef = PercussionClef;\n\n/**\n * Looks at the pitches in a Stream and returns the best clef\n * of Treble and Bass\n *\n * @function music21.clef.bestClef\n * @memberof music21.clef\n * @param {music21.stream.Stream} st\n * @returns {music21.clef.Clef}\n */\nclef.bestClef = function bestClef(st) {\n    // console.log('calling flat on stream: ', st.elements.length, st.classes[st.classes.length - 1]);\n    const stFlat = st.flat;\n    let totalNotes = 0;\n    let totalPitch = 0.0;\n    for (let i = 0; i < stFlat.length; i++) {\n        const el = stFlat.get(i);\n        if (el.pitch !== undefined) {\n            totalNotes += 1;\n            totalPitch += el.pitch.diatonicNoteNum;\n        } else if (el.pitches !== undefined) {\n            for (let j = 0; j < el.pitches.length; j++) {\n                totalNotes += 1;\n                totalPitch += el.pitches[j].diatonicNoteNum;\n            }\n        }\n    }\n    let averageHeight;\n    if (totalNotes === 0) {\n        averageHeight = 29;\n    } else {\n        averageHeight = totalPitch / totalNotes;\n    }\n    // console.log('bestClef: average height', averageHeight);\n    if (averageHeight > 28) {    // 29 = c4\n        return new clef.TrebleClef();\n    } else {\n        return new clef.BassClef();\n    }\n};\n\n// tests\nclef.tests = () => {\n    test('music21.clef.Clef', () => {\n        const c1 = new music21.clef.Clef();\n        equal(c1.isClassOrSubclass('Clef'), true, 'clef is a Clef');\n\n        const ac = new music21.clef.AltoClef();\n        equal(ac.lowestLine, 25, 'first line set');\n        const n = new music21.note.Note('C#4');\n        n.setStemDirectionFromClef(ac);\n        equal(n.stemDirection, 'down', 'stem direction set');\n        n.pitch.diatonicNoteNum -= 1;\n        n.setStemDirectionFromClef(ac);\n        equal(n.stemDirection, 'up', 'stem direction set');\n        n.pitch.diatonicNoteNum += 1;\n        const p2 = ac.convertPitchToTreble(n.pitch);\n        equal(p2.nameWithOctave, 'B#4', 'converted to treble');\n    });\n    test('music21.clef.Clef 8va', () => {\n        const ac = new music21.clef.Treble8vaClef();\n        equal(ac.lowestLine, 38, 'first line set');\n        const n = new music21.note.Note('C#5');\n        n.setStemDirectionFromClef(ac);\n        equal(n.stemDirection, 'up', 'stem direction set');\n        const p2 = ac.convertPitchToTreble(n.pitch);\n        equal(p2.nameWithOctave, 'C#4', 'converted to treble');\n        const s = new music21.stream.Stream();\n        s.clef = ac;\n        s.append(n);\n        s.appendNewCanvas($('body'));\n    });\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/dynamics -- Dynamics\n *\n * note that Vex.Flow does not support Dynamics yet and we do not support MIDI dynamics,\n *  so currently of limited value...\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base';\n\n/**\n * dynamics Module. See {@link music21.dynamics} for namespace\n *\n * @exports music21/dynamics\n */\n/**\n * Dynamics related objects.\n *\n * N.B. Firefox completely ignores dyanmics on playback!\n *\n * Currently do not export to Vexflow.  :-(\n *\n * @namespace music21.dynamics\n * @memberof music21\n * @requires music21/base\n */\nexport const dynamics = {};\ndynamics.shortNames = ['pppppp', 'ppppp', 'pppp', 'ppp', 'pp', 'p', 'mp',\n                       'mf', 'f', 'fp', 'sf', 'ff', 'fff', 'ffff', 'fffff', 'ffffff'];\ndynamics.longNames = { 'ppp': ['pianississimo'],\n        'pp': ['pianissimo'],\n        'p': ['piano'],\n        'mp': ['mezzopiano'],\n        'mf': ['mezzoforte'],\n        'f': ['forte'],\n        'fp': ['fortepiano'],\n        'sf': ['sforzando'],\n        'ff': ['fortissimo'],\n        'fff': ['fortississimo'],\n};\ndynamics.englishNames = { 'ppp': ['extremely soft'],\n        'pp': ['very soft'],\n        'p': ['soft'],\n        'mp': ['moderately soft'],\n        'mf': ['moderately loud'],\n        'f': ['loud'],\n        'ff': ['very loud'],\n        'fff': ['extremely loud'],\n};\ndynamics.dynamicStrToScalar = {\n    'None': [0.5], // default value\n    'n': [0.0],\n    'pppp': [0.1],\n    'ppp': [0.15],\n    'pp': [0.25],\n    'p': [0.35],\n    'mp': [0.45],\n    'mf': [0.55],\n    'f': [0.7],\n    'fp': [0.75],\n    'sf': [0.85],\n    'ff': [0.85],\n    'fff': [0.9],\n    'ffff': [0.95],\n};\n\n/**\n * A representation of a dynamic.\n *\n * @class Dynamic\n * @memberof music21.dynamics\n * @extends music21.base.Music21Object\n * @param {number|string} value - either a number between 0 and 1 or a dynamic mark such as \"ff\" or \"mp\"\n * @property {string|undefined} value - a name such as \"pp\" etc.\n * @property {string|undefined} longName - a longer name such as \"pianissimo\"\n * @property {string|undefined} englishName - a name such as \"very soft\"\n * @property {number} volumeScalar - a number between 0 and 1.\n */\nexport class Dynamic extends base.Music21Object {\n    constructor(value) {\n        super();\n        this.classes.push('Dynamic');\n        this._value = undefined;\n        this._volumeScalar = undefined;\n        this.longName = undefined;\n        this.englishName = undefined;\n        this.value = value;\n    }\n    get value() {\n        return this._value;\n    }\n    set value(value) {\n        if (typeof (value) !== 'string') {\n            // assume number\n            this._volumeScalar = value;\n            if (value <= 0) {\n                this._value = 'n';\n            } else if (value < 0.11) {\n                this._value = 'pppp';\n            } else if (value < 0.16) {\n                this._value = 'ppp';\n            } else if (value < 0.26) {\n                this._value = 'pp';\n            } else if (value < 0.36) {\n                this._value = 'p';\n            } else if (value < 0.5) {\n                this._value = 'mp';\n            } else if (value < 0.65) {\n                this._value = 'mf';\n            } else if (value < 0.8) {\n                this._value = 'f';\n            } else if (value < 0.9) {\n                this._value = 'ff';\n            } else {\n                this._value = 'fff';\n            }\n        } else {\n            this._value = value;\n            this._volumeScalar = undefined;\n        }\n        if (this._value in dynamics.longNames) {\n            this.longName = dynamics.longNames[this._value][0];\n        } else {\n            this.longName = undefined;\n        }\n        if (this._value in dynamics.englishNames) {\n            this.englishName = dynamics.englishNames[this._value][0];\n        } else {\n            this.englishName = undefined;\n        }\n    }\n    get volumeScalar() {\n        if (this._volumeScalar !== undefined) {\n            return this._volumeScalar;\n        } else if (this._value in dynamics.dynamicStrToScalar) {\n            return dynamics.dynamicStrToScalar[this._value][0];\n        } else {\n            return undefined;\n        }\n    }\n    set volumeScalar(value) {\n        if ((typeof (value) === 'number')\n                && (value <= 1)\n                && (value >= 0)) {\n            this._volumeScalar = value;\n        }\n    }\n}\ndynamics.Dynamic = Dynamic;\n\ndynamics.tests = () => {\n    test('music21.dynamics.Dynamic', () => {\n        let dynamic = new dynamics.Dynamic('pp');\n        equal(dynamic.value, 'pp', 'matching dynamic');\n        dynamic = new dynamics.Dynamic(0.98);\n        equal(dynamic.value, 'fff', 'number conversion successful');\n        equal(dynamic.volumeScalar, 0.98, 'correct volume');\n        equal(dynamic.longName, 'fortississimo', 'matching long name');\n        equal(dynamic.englishName, 'extremely loud', 'matching english names');\n        dynamic = new dynamics.Dynamic('other');\n        equal(dynamic.value, 'other', 'record non standard dynamic');\n        equal(dynamic.longName, undefined, 'no long name for non standard dynamic');\n        equal(dynamic.englishName, undefined, 'no english name for non standard dynamic');\n        dynamic.value = 0.18;\n        equal(dynamic.value, 'pp', 'change in dynamic');\n        equal(dynamic.volumeScalar, 0.18, 'change in volume');\n        dynamic.value = 'other';\n        equal(dynamic.value, 'other', 'change to non standard');\n        equal(dynamic.longName, undefined, 'change to non standard dynamic');\n        equal(dynamic.englishName, undefined, 'change to non standard dynamic');\n    });\n};\n\n","import * as Vex from 'vexflow';\n\nimport { base } from './base';\n/**\n * Expressions module.  See {@link music21.expressions}\n *\n * @exports music21/expressions\n */\n/**\n * Expressions can be note attached (`music21.note.Note.expressions[]`) or floating...\n *\n * @namespace music21.expressions\n * @memberof music21\n * @requires music21/expressions\n */\nexport const expressions = {};\n\n/**\n * Expressions can be note attached (`music21.note.Note.expressions[]`) or floating...\n *\n * @class Expression\n * @memberof music21.expressions\n * @extends music21.base.Music21Object\n * @property {string} name\n * @property {string} vexflowModifier\n * @property {Int} setPosition\n */\nexport class Expression extends base.Music21Object {\n    constructor() {\n        super();\n        this.classes.push('Expression');\n        this.name = 'expression';\n        this.vexflowModifier = '';\n        this.setPosition = undefined;\n    }\n    /**\n     * Renders this Expression as a Vex.Flow.Articulation\n     *\n     * (this is not right for all cases)\n     *\n     * @memberof music21.expressions.Expression\n     * @returns {Vex.Flow.Articulation}\n     */\n    vexflow() {\n        const vfe =  new Vex.Flow.Articulation(this.vexflowModifier);\n        if (this.setPosition) {\n            vfe.setPosition(this.setPosition);\n        }\n        return vfe;\n    }\n}\nexpressions.Expression = Expression;\n\n/**\n * A fermata...\n *\n * @class Fermata\n * @memberof music21.expressions\n * @extends music21.expressions.Expression\n */\nexport class Fermata extends Expression {\n    constructor() {\n        super();\n        this.classes.push('Fermata');\n        this.name = 'fermata';\n        this.vexflowModifier = 'a@a';\n        this.setPosition = 3;\n    }\n}\nexpressions.Fermata = Fermata;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/fromPython -- Conversion from music21p jsonpickle streams\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n * usage:\n *\n * in python:\n *\n * s = corpus.parse('bwv66.6')\n * stringRepresentingM21JsonPickle = s.freezeStream('jsonpickle')\n *\n * in js:\n *\n * pyConv = new music21.fromPython.Converter();\n * s = pyConv.run(stringRepresentingM21JsonPickle);\n *\n *\n */\nimport * as jsonpickle from 'jsonpickle';\n\nconst jp = jsonpickle;\n/**\n * fromPython module -- see {@link music21.fromPython}\n */\nconst unpickler = jp.unpickler;\n\n/**\n * Converter for taking a Python-encoded jsonpickle music21p stream\n * and loading it into music21j\n *\n * Very very alpha.  See music21(p).vexflow modules to see how it works.\n *\n * Requires Cuthbert's jsonpickle.js port (included in music21j)\n *\n * @namespace music21.fromPython\n * @extends music21\n * @requires jsonpickle\n */\nexport const fromPython = {};\n\n/**\n *\n * @class Converter\n * @memberof music21.fromPython\n * @property {boolean} debug\n * @property {Array<string>} knownUnparsables - list of classes that cannot be parsed\n * @property {object} handlers - object mapping string names of classes to a set of function calls to perform when restoring or post-restoring. (too complicated to explain; read the code)\n */\nexport class Converter {\n    constructor() {\n        this.debug = true;\n        this.knownUnparsables = ['music21.spanner.Line',\n                                 'music21.instrument.Instrument',\n                                 'music21.layout.StaffGroup',\n                                 'music21.layout.StaffLayout',\n                                 'music21.layout.SystemLayout',\n                                 'music21.layout.PageLayout',\n                                 'music21.expressions.TextExpression',\n                                 'music21.bar.Barline', // Soon...\n                                 'music21.tempo.MetronomeMark', // should be possible\n                                 'music21.metadata.Metadata', // Soon...\n                                 ];\n        this.handlers = {\n            'music21.duration.Duration': {\n                post_restore: (d) => {\n                    d.quarterLength = d._qtrLength;\n                    return d;\n                },\n            },\n            'music21.meter.TimeSignature': {\n                post_restore: (ts) => {\n                    ts._numerator = ts.displaySequence._numerator;\n                    ts._denominator = ts.displaySequence._denominator;\n                    return ts;\n                },\n            },\n            'music21.stream.Part': {\n                post_restore: (p) => {\n                    this.currentPart = p;\n                    this.lastClef = undefined;\n                    this.lastKeySignature = undefined;\n                    this.lastTimeSignature = undefined;\n                    this.streamPostRestore(p);\n                    return p;\n                },\n            },\n                // TODO: all inherit somehow, through _classes or better, prototype...\n            'music21.stream.Score': {\n                post_restore: this.streamPostRestore,\n            },\n            'music21.stream.Stream': {\n                post_restore: this.streamPostRestore,\n            },\n            'music21.stream.Measure': {\n                post_restore: this.streamPostRestore,\n            },\n            'music21.stream.Voice': {\n                post_restore: this.streamPostRestore,\n            },\n        };\n        this.currentPart = undefined;\n        this.lastClef = undefined;\n        this.lastKeySignature = undefined;\n        this.lastTimeSignature = undefined;\n    }\n\n    /**\n     * Fixes up some references that cannot be unpacked from jsonpickle.\n     *\n     * @method music21.fromPython.Converter#streamPostRestore\n     * @memberof music21.fromPython.Converter\n     * @param {music21.stream.Stream} s - stream after unpacking from jsonpickle\n     * @returns {music21.stream.Stream}\n     */\n    streamPostRestore(s) {\n        const st = s._storedElementOffsetTuples;\n\n        s._clef = this.lastClef;\n        s._keySignature = this.lastKeySignature;\n        s._timeSignature = this.lastTimeSignature;\n        for (let i = 0; i < st.length; i++) {\n            const el = st[i][0];\n            el.offset = st[i][1];\n            let classList = el.classes;\n            if (classList === undefined) {\n                console.warn('M21object without classes: ', el);\n                console.warn('Javascript classes are: ', el._py_class);\n                classList = [];\n            }\n            let streamPart = this.currentPart;\n            if (streamPart === undefined) {\n                streamPart = s; // possibly a Stream constructed from .measures()\n            }\n\n            let appendEl = true;\n            let insertAtStart = false;\n\n            for (let j = 0; j < classList.length; j++) {\n                const thisClass = classList[j];\n                for (let kn = 0; kn < this.knownUnparsables.length; kn++) {\n                    const unparsable = this.knownUnparsables[kn];\n                    if (unparsable.indexOf(thisClass) !== -1) {\n                        appendEl = false;\n                    }\n                }\n                if (thisClass === 'TimeSignature') {\n                    // console.log(\"Got timeSignature\", streamPart, newM21pObj, storedElement);\n                    s._timeSignature = el;\n                    this.lastTimeSignature = el;\n                    if (streamPart !== undefined && streamPart.timeSignature === undefined) {\n                        streamPart.timeSignature = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'Clef') {\n                    s._clef = el;\n                    this.lastClef = el;\n                    if (streamPart !== undefined && streamPart.clef === undefined) {\n                        streamPart.clef = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'KeySignature') {\n                    s._keySignature = el;\n                    this.lastKeySignature = el;\n                    if (streamPart !== undefined && streamPart.keySignature === undefined) {\n                        streamPart.keySignature = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'Part') {\n                    appendEl = false;\n                    insertAtStart = true;\n                }\n            }\n\n            if (appendEl) {\n                s.append(el); // all but clef, ts, ks\n            } else if (insertAtStart) {\n                s.insert(0, el); // Part\n            }\n        }\n        return s;\n    }\n\n    /**\n     * Run the main decoder\n     *\n     * @method music21.fromPython.Converter#run\n     * @memberof music21.fromPython.Converter\n     * @param {string} jss - stream encoded as JSON\n     * @returns {music21.stream.Stream}\n     */\n    run(jss) {\n        const outStruct = unpickler.decode(jss, this.handlers);\n        return outStruct.stream;\n    }\n}\nfromPython.Converter = Converter;\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/instrument -- instrument objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base';\n\n/**\n * Instrument module, see {@link music21.instrument}\n *\n * @exports music21/instrument\n */\n\n/**\n * Looking for the {@link music21.instrument.Instrument} object? :-)\n *\n * @namespace music21.instrument\n * @memberof music21\n * @requires music21/base\n */\nexport const instrument = {};\n\n/**\n * Represents an instrument.  instrumentNames are found in the ext/soundfonts directory\n *\n * See {@link music21.miditools} and esp. `loadSoundfont` for a way of loading soundfonts into\n * instruments.\n *\n * @class Instrument\n * @memberof music21.instrument\n * @param {string} instrumentName\n * @property {string|undefined} partId\n * @property {string|undefined} partName\n * @property {string|undefined} partAbbreviation\n * @property {string|undefined} instrumentId\n * @property {string|undefined} instrumentName\n * @property {string|undefined} instrumentAbbreviation\n * @property {Int|undefined} midiProgram\n * @property {Int|undefined} midiChannel\n * @property {Int|undefined} lowestNote\n * @property {Int|undefined} highestNote\n * @property {music21.interval.Interval|undefined} transposition\n * @property {Boolean} inGMPercMap=false\n * @property {string|undefined} soundfontFn\n * @property {string|undefined} oggSoundfont - url of oggSoundfont for this instrument\n * @property {string|undefined} mp3Soundfont - url of mp3Soundfont for this instrument\n */\nclass Instrument extends base.Music21Object {\n    constructor(instrumentName) {\n        super();\n        this.classSortOrder = -25;\n\n        this.partId = undefined;\n        this.partName = undefined;\n        this.partAbbreviation = undefined;\n\n        this.instrumentId = undefined;\n        this.instrumentName = undefined;\n        this.instrumentAbbreviation = undefined;\n        this.midiProgram = undefined;\n        this._midiChannel = undefined;\n\n        this.lowestNote = undefined;\n        this.highestNote = undefined;\n\n        this.transpostion = undefined;\n\n        this.inGMPercMap = false;\n        this.soundfontFn = undefined;\n\n        if (instrumentName !== undefined) {\n            instrument.find(instrumentName);\n        }\n    }\n    /**\n     * Assign an instrument to an unused midi channel.\n     *\n     * Will use the global list of used channels (`music21.instrument.Instrument.usedChannels`)\n     * if not given.  Assigns up to `music21.instrument.maxMidi` channels (16)\n     * Skips 10 unless this.inGMPercMap is true\n     *\n     * @memberof music21.instrument.Instrument\n     * @param {Array<Int>} [usedChannels]\n     * @returns {Number}\n     */\n    autoAssignMidiChannel(usedChannels) {\n        if (usedChannels === undefined) {\n            usedChannels = instrument.usedChannels;\n        }\n        let startChannel = 0;\n        if (this.inGMPercMap) {\n            startChannel = 10;\n        }\n        for (let ch = startChannel; ch < instrument.maxMidi; ch++) {\n            if (ch % 16 === 10 && this.inGMPercMap !== true) {\n                continue; // skip 10 / percussion.\n            }\n            if (usedChannels[ch] === undefined || usedChannels[ch] === this.midiProgram) {\n                usedChannels[ch] = this.midiProgram;\n                this.midiChannel = ch;\n                return ch;\n            }\n        }\n        // TODO: no channels! throw exception!\n        return undefined;\n    }    \n    get oggSounfont() {\n        return this.soundfontFn + '-ogg.js';\n    }\n    get mp3Soundfont() {\n        return this.soundfontFn + '-mp3.js';\n    }\n    get midiChannel() {\n        if (this._midiChannel === undefined) {\n            this.autoAssignMidiChannel();\n        }\n        return this._midiChannel;        \n    }\n    set midiChannel(ch) {\n        this._midiChannel = ch;        \n    }\n}\ninstrument.Instrument = Instrument;\n\ninstrument.usedChannels = []; // differs from m21p -- stored midiProgram numbers\ninstrument.maxMidi = 16;\n\ninstrument.info = [\n                   { 'fn': 'acoustic_grand_piano', 'name': 'Acoustic Grand Piano', 'midiNumber': 0 },\n                   { 'fn': 'bright_acoustic_piano', 'name': 'Bright Acoustic Piano', 'midiNumber': 1 },\n                   { 'fn': 'electric_grand_piano', 'name': 'Electric Grand Piano', 'midiNumber': 2 },\n                   { 'fn': 'honkytonk_piano', 'name': 'Honky-tonk Piano', 'midiNumber': 3 },\n                   { 'fn': 'electric_piano_1', 'name': 'Electric Piano 1', 'midiNumber': 4 },\n                   { 'fn': 'electric_piano_2', 'name': 'Electric Piano 2', 'midiNumber': 5 },\n                   { 'fn': 'harpsichord', 'name': 'Harpsichord', 'midiNumber': 6 },\n                   { 'fn': 'clavinet', 'name': 'Clavinet', 'midiNumber': 7 },\n                   { 'fn': 'celesta', 'name': 'Celesta', 'midiNumber': 8 },\n                   { 'fn': 'glockenspiel', 'name': 'Glockenspiel', 'midiNumber': 9 },\n                   { 'fn': 'music_box', 'name': 'Music Box', 'midiNumber': 10 },\n                   { 'fn': 'vibraphone', 'name': 'Vibraphone', 'midiNumber': 11 },\n                   { 'fn': 'marimba', 'name': 'Marimba', 'midiNumber': 12 },\n                   { 'fn': 'xylophone', 'name': 'Xylophone', 'midiNumber': 13 },\n                   { 'fn': 'tubular_bells', 'name': 'Tubular Bells', 'midiNumber': 14 },\n                   { 'fn': 'dulcimer', 'name': 'Dulcimer', 'midiNumber': 15 },\n                   { 'fn': 'drawbar_organ', 'name': 'Drawbar Organ', 'midiNumber': 16 },\n                   { 'fn': 'percussive_organ', 'name': 'Percussive Organ', 'midiNumber': 17 },\n                   { 'fn': 'rock_organ', 'name': 'Rock Organ', 'midiNumber': 18 },\n                   { 'fn': 'church_organ', 'name': 'Church Organ', 'midiNumber': 19 },\n                   { 'fn': 'reed_organ', 'name': 'Reed Organ', 'midiNumber': 20 },\n                   { 'fn': 'accordion', 'name': 'Accordion', 'midiNumber': 21 },\n                   { 'fn': 'harmonica', 'name': 'Harmonica', 'midiNumber': 22 },\n                   { 'fn': 'tango_accordion', 'name': 'Tango Accordion', 'midiNumber': 23 },\n                   { 'fn': 'acoustic_guitar_nylon', 'name': 'Acoustic Guitar (nylon)', 'midiNumber': 24 },\n                   { 'fn': 'acoustic_guitar_steel', 'name': 'Acoustic Guitar (steel)', 'midiNumber': 25 },\n                   { 'fn': 'electric_guitar_jazz', 'name': 'Electric Guitar (jazz)', 'midiNumber': 26 },\n                   { 'fn': 'electric_guitar_clean', 'name': 'Electric Guitar (clean)', 'midiNumber': 27 },\n                   { 'fn': 'electric_guitar_muted', 'name': 'Electric Guitar (muted)', 'midiNumber': 28 },\n                   { 'fn': 'overdriven_guitar', 'name': 'Overdriven Guitar', 'midiNumber': 29 },\n                   { 'fn': 'distortion_guitar', 'name': 'Distortion Guitar', 'midiNumber': 30 },\n                   { 'fn': 'guitar_harmonics', 'name': 'Guitar Harmonics', 'midiNumber': 31 },\n                   { 'fn': 'acoustic_bass', 'name': 'Acoustic Bass', 'midiNumber': 32 },\n                   { 'fn': 'electric_bass_finger', 'name': 'Electric Bass (finger)', 'midiNumber': 33 },\n                   { 'fn': 'electric_bass_pick', 'name': 'Electric Bass (pick)', 'midiNumber': 34 },\n                   { 'fn': 'fretless_bass', 'name': 'Fretless Bass', 'midiNumber': 35 },\n                   { 'fn': 'slap_bass_1', 'name': 'Slap Bass 1', 'midiNumber': 36 },\n                   { 'fn': 'slap_bass_2', 'name': 'Slap Bass 2', 'midiNumber': 37 },\n                   { 'fn': 'synth_bass_1', 'name': 'Synth Bass 1', 'midiNumber': 38 },\n                   { 'fn': 'synth_bass_2', 'name': 'Synth Bass 2', 'midiNumber': 39 },\n                   { 'fn': 'violin', 'name': 'Violin', 'midiNumber': 40 },\n                   { 'fn': 'viola', 'name': 'Viola', 'midiNumber': 41 },\n                   { 'fn': 'cello', 'name': 'Cello', 'midiNumber': 42 },\n                   { 'fn': 'contrabass', 'name': 'Contrabass', 'midiNumber': 43 },\n                   { 'fn': 'tremolo_strings', 'name': 'Tremolo Strings', 'midiNumber': 44 },\n                   { 'fn': 'pizzicato_strings', 'name': 'Pizzicato Strings', 'midiNumber': 45 },\n                   { 'fn': 'orchestral_harp', 'name': 'Orchestral Harp', 'midiNumber': 46 },\n                   { 'fn': 'timpani', 'name': 'Timpani', 'midiNumber': 47 },\n                   { 'fn': 'string_ensemble_1', 'name': 'String Ensemble 1', 'midiNumber': 48 },\n                   { 'fn': 'string_ensemble_2', 'name': 'String Ensemble 2', 'midiNumber': 49 },\n                   { 'fn': 'synth_strings_1', 'name': 'Synth Strings 1', 'midiNumber': 50 },\n                   { 'fn': 'synth_strings_2', 'name': 'Synth Strings 2', 'midiNumber': 51 },\n                   { 'fn': 'choir_aahs', 'name': 'Choir Aahs', 'midiNumber': 52 },\n                   { 'fn': 'voice_oohs', 'name': 'Voice Oohs', 'midiNumber': 53 },\n                   { 'fn': 'synth_choir', 'name': 'Synth Choir', 'midiNumber': 54 },\n                   { 'fn': 'orchestra_hit', 'name': 'Orchestra Hit', 'midiNumber': 55 },\n                   { 'fn': 'trumpet', 'name': 'Trumpet', 'midiNumber': 56 },\n                   { 'fn': 'trombone', 'name': 'Trombone', 'midiNumber': 57 },\n                   { 'fn': 'tuba', 'name': 'Tuba', 'midiNumber': 58 },\n                   { 'fn': 'muted_trumpet', 'name': 'Muted Trumpet', 'midiNumber': 59 },\n                   { 'fn': 'french_horn', 'name': 'French Horn', 'midiNumber': 60 },\n                   { 'fn': 'brass_section', 'name': 'Brass Section', 'midiNumber': 61 },\n                   { 'fn': 'synth_brass_1', 'name': 'Synth Brass 1', 'midiNumber': 62 },\n                   { 'fn': 'synth_brass_2', 'name': 'Synth Brass 2', 'midiNumber': 63 },\n                   { 'fn': 'soprano_sax', 'name': 'Soprano Sax', 'midiNumber': 64 },\n                   { 'fn': 'alto_sax', 'name': 'Alto Sax', 'midiNumber': 65 },\n                   { 'fn': 'tenor_sax', 'name': 'Tenor Sax', 'midiNumber': 66 },\n                   { 'fn': 'baritone_sax', 'name': 'Baritone Sax', 'midiNumber': 67 },\n                   { 'fn': 'oboe', 'name': 'Oboe', 'midiNumber': 68 },\n                   { 'fn': 'english_horn', 'name': 'English Horn', 'midiNumber': 69 },\n                   { 'fn': 'bassoon', 'name': 'Bassoon', 'midiNumber': 70 },\n                   { 'fn': 'clarinet', 'name': 'Clarinet', 'midiNumber': 71 },\n                   { 'fn': 'piccolo', 'name': 'Piccolo', 'midiNumber': 72 },\n                   { 'fn': 'flute', 'name': 'Flute', 'midiNumber': 73 },\n                   { 'fn': 'recorder', 'name': 'Recorder', 'midiNumber': 74 },\n                   { 'fn': 'pan_flute', 'name': 'Pan Flute', 'midiNumber': 75 },\n                   { 'fn': 'blown_bottle', 'name': 'Blown bottle', 'midiNumber': 76 },\n                   { 'fn': 'shakuhachi', 'name': 'Shakuhachi', 'midiNumber': 77 },\n                   { 'fn': 'whistle', 'name': 'Whistle', 'midiNumber': 78 },\n                   { 'fn': 'ocarina', 'name': 'Ocarina', 'midiNumber': 79 },\n                   { 'fn': 'lead_1_square', 'name': 'Lead 1 (square)', 'midiNumber': 80 },\n                   { 'fn': 'lead_2_sawtooth', 'name': 'Lead 2 (sawtooth)', 'midiNumber': 81 },\n                   { 'fn': 'lead_3_calliope', 'name': 'Lead 3 (calliope)', 'midiNumber': 82 },\n                   { 'fn': 'lead_4_chiff', 'name': 'Lead 4 chiff', 'midiNumber': 83 },\n                   { 'fn': 'lead_5_charang', 'name': 'Lead 5 (charang)', 'midiNumber': 84 },\n                   { 'fn': 'lead_6_voice', 'name': 'Lead 6 (voice)', 'midiNumber': 85 },\n                   { 'fn': 'lead_7_fifths', 'name': 'Lead 7 (fifths)', 'midiNumber': 86 },\n                   { 'fn': 'lead_8_bass__lead', 'name': 'Lead 8 (bass + lead)', 'midiNumber': 87 },\n                   { 'fn': 'pad_1_new_age', 'name': 'Pad 1 (new age)', 'midiNumber': 88 },\n                   { 'fn': 'pad_2_warm', 'name': 'Pad 2 (warm)', 'midiNumber': 89 },\n                   { 'fn': 'pad_3_polysynth', 'name': 'Pad 3 (polysynth)', 'midiNumber': 90 },\n                   { 'fn': 'pad_4_choir', 'name': 'Pad 4 (choir)', 'midiNumber': 91 },\n                   { 'fn': 'pad_5_bowed', 'name': 'Pad 5 (bowed)', 'midiNumber': 92 },\n                   { 'fn': 'pad_6_metallic', 'name': 'Pad 6 (metallic)', 'midiNumber': 93 },\n                   { 'fn': 'pad_7_halo', 'name': 'Pad 7 (halo)', 'midiNumber': 94 },\n                   { 'fn': 'pad_8_sweep', 'name': 'Pad 8 (sweep)', 'midiNumber': 95 },\n                   { 'fn': 'fx_1_rain', 'name': 'FX 1 (rain)', 'midiNumber': 96 },\n                   { 'fn': 'fx_2_soundtrack', 'name': 'FX 2 (soundtrack)', 'midiNumber': 97 },\n                   { 'fn': 'fx_3_crystal', 'name': 'FX 3 (crystal)', 'midiNumber': 98 },\n                   { 'fn': 'fx_4_atmosphere', 'name': 'FX 4 (atmosphere)', 'midiNumber': 99 },\n                   { 'fn': 'fx_5_brightness', 'name': 'FX 5 (brightness)', 'midiNumber': 100 },\n                   { 'fn': 'fx_6_goblins', 'name': 'FX 6 (goblins)', 'midiNumber': 101 },\n                   { 'fn': 'fx_7_echoes', 'name': 'FX 7 (echoes)', 'midiNumber': 102 },\n                   { 'fn': 'fx_8_scifi', 'name': 'FX 8 (sci-fi)', 'midiNumber': 103 },\n                   { 'fn': 'sitar', 'name': 'Sitar', 'midiNumber': 104 },\n                   { 'fn': 'banjo', 'name': 'Banjo', 'midiNumber': 105 },\n                   { 'fn': 'shamisen', 'name': 'Shamisen', 'midiNumber': 106 },\n                   { 'fn': 'koto', 'name': 'Koto', 'midiNumber': 107 },\n                   { 'fn': 'kalimba', 'name': 'Kalimba', 'midiNumber': 108 },\n                   { 'fn': 'bagpipe', 'name': 'Bagpipe', 'midiNumber': 109 },\n                   { 'fn': 'fiddle', 'name': 'Fiddle', 'midiNumber': 110 },\n                   { 'fn': 'shanai', 'name': 'Shanai', 'midiNumber': 111 },\n                   { 'fn': 'tinkle_bell', 'name': 'Tinkle Bell', 'midiNumber': 112 },\n                   { 'fn': 'agogo', 'name': 'Agogo', 'midiNumber': 113 },\n                   { 'fn': 'steel_drums', 'name': 'Steel Drums', 'midiNumber': 114 },\n                   { 'fn': 'woodblock', 'name': 'Woodblock', 'midiNumber': 115 },\n                   { 'fn': 'taiko_drum', 'name': 'Taiko Drum', 'midiNumber': 116 },\n                   { 'fn': 'melodic_tom', 'name': 'Melodic Tom', 'midiNumber': 117 },\n                   { 'fn': 'synth_drum', 'name': 'Synth Drum', 'midiNumber': 118 },\n                   { 'fn': 'reverse_cymbal', 'name': 'Reverse Cymbal', 'midiNumber': 119 },\n                   { 'fn': 'guitar_fret_noise', 'name': 'Guitar Fret Noise', 'midiNumber': 120 },\n                   { 'fn': 'breath_noise', 'name': 'Breath Noise', 'midiNumber': 121 },\n                   { 'fn': 'seashore', 'name': 'Seashore', 'midiNumber': 122 },\n                   { 'fn': 'bird_tweet', 'name': 'Bird Tweet', 'midiNumber': 123 },\n                   { 'fn': 'telephone_ring', 'name': 'Telephone Ring', 'midiNumber': 124 },\n                   { 'fn': 'helicopter', 'name': 'Helicopter', 'midiNumber': 125 },\n                   { 'fn': 'applause', 'name': 'Applause', 'midiNumber': 126 },\n                   { 'fn': 'gunshot', 'name': 'Gunshot', 'midiNumber': 127 }];\n\n/**\n * Find information for a given instrument (by filename or name)\n * and load it into an instrument object.\n *\n * @function music21.instrument.find\n * @memberof music21.instrument\n * @param {string} fn - name or filename of instrument\n * @param {music21.instrument.Instrument} [inst] - instrument object to load into\n * @returns {music21.instrument.Instrument|undefined}\n */\ninstrument.find = function instrument_find(fn, inst) {\n    if (inst === undefined) {\n        inst = new instrument.Instrument();\n    }\n    for (let i = 0; i < instrument.info.length; i++) {\n        const info = instrument.info[i];\n        if (info.fn === fn || info.name === fn) {\n            inst.soundfontFn = info.fn;\n            inst.instrumentName = info.name;\n            inst.midiProgram = info.midiNumber;\n            return inst;\n        }\n    }\n    return undefined;\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/interval -- Interval routines\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006-16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { debug } from './debug';\nimport { prebase } from './prebase';\nimport { pitch } from './pitch';\n\n/**\n * interval module. See {@link music21.interval} for namespace\n *\n * @exports music21/interval\n */\n/**\n * Interval related objects\n *\n * @namespace music21.interval\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/pitch\n */\nexport\tconst interval = {};\n\n/**\n * Interval Directions as an Object/map\n *\n * @memberof music21.interval\n * @example\n * if (music21.interval.IntervalDirections.OBLIQUE >\n *     music21.interval.IntervalDirections.ASCENDING ) {\n *    console.log(music21.interval.IntervalDirections.DESCENDING);\n * }\n *\n */\ninterval.IntervalDirections = {\n        DESCENDING: -1,\n        OBLIQUE: 0,\n        ASCENDING: 1,\n};\n\n/**\n * N.B. a dict in music21p -- the indexes here let IntervalDirections call them + 1\n *\n * @memberof music21.interval\n * @example\n * console.log(music21.interval.IntervalDirectionTerms[music21l.interval.IntervalDirections.OBLIQUE + 1])\n * // \"Oblique\"\n */\ninterval.IntervalDirectionTerms = ['Descending', 'Oblique', 'Ascending'];\n\n/**\n * ordinals for music terms...\n *\n * @memberof music21.interval\n * @example\n * for (var i = 1; // N.B. 0 = undefined\n *      i < music21.interval.MusicOrdinals.length;\n *      i++) {\n *     console.log(i, music21.interval.MusicOrdinals[i]);\n * }\n * // 1, Unison\n * // 2, Second\n * // 3, Third\n * // ...\n * // 8, Octave\n * // ...\n * // 15, Double Octave\n */\ninterval.MusicOrdinals = [\n                          undefined, 'Unison', 'Second', 'Third', 'Fourth',\n                          'Fifth', 'Sixth', 'Seventh', 'Octave',\n                          'Ninth', 'Tenth', 'Eleventh', 'Twelfth',\n                          'Thirteenth', 'Fourteenth', 'Double Octave'\n                          ];\n\n/**\n * Represents an interval such as unison, second, etc.\n *\n * Properties are demonstrated below.\n *\n * @class GenericInterval\n * @memberof music21.interval\n * @param {Int} [gi=1] - generic interval (1 or higher, or -2 or lower)\n * @example\n * var gi = new music21.interval.GenericInterval(-14)\n * gi.value\n * // -14\n * gi.directed\n * // -14\n * gi.undirected\n * // 14\n * gi.direction == music21.interval.IntervalDirections.DESCENDING\n * // true\n * gi.isSkip\n * // true\n * gi.isStep\n * // false\n * gi.isDiatonicStep\n * // false  // augmented unisons are not diatonicSteps but can't tell yet..\n * gi.isUnison\n * // false\n * gi.simpleUndirected\n * // 7\n * gi.undirectedOctaves\n * // 1\n * gi.semiSimpleUndirected\n * // 7  -- semiSimple distinguishes between 8 and 1; that's all\n * gi.perfectable\n * // false\n * gi.niceName\n * // \"Fourteenth\"\n * gi.directedNiceName\n * // \"Descending Fourteenth\"\n * gi.simpleNiceName\n * // \"Seventh\"\n * gi.staffDistance\n * // -13\n * gi.mod7inversion\n * // 2  // sevenths invert to seconds\n *\n */\nexport class GenericInterval extends prebase.ProtoM21Object {\n    constructor(gi) {\n        super();\n        this.classes.push('GenericInterval');\n        if (gi === undefined) {\n            gi = 1;\n        }\n        this.value = gi; // todo: convertGeneric() from python\n        this.directed = this.value;\n        this.undirected = Math.abs(this.value);\n\n        if (this.directed === 1) {\n            this.direction = interval.IntervalDirections.OBLIQUE;\n        } else if (this.directed < 0) {\n            this.direction = interval.IntervalDirections.DESCENDING;\n        } else if (this.directed > 1) {\n            this.direction = interval.IntervalDirections.ASCENDING;\n        }\n        // else (raise exception)\n\n        if (this.undirected > 2) {\n            this.isSkip = true;\n        } else {\n            this.isSkip = false;\n        }\n\n        if (this.undirected === 2) {\n            this.isDiatonicStep = true;\n        } else {\n            this.isDiatonicStep = false;\n        }\n\n        this.isStep = this.isDiatonicStep;\n\n        if (this.undirected === 1) {\n            this.isUnison = true;\n        } else {\n            this.isUnison = false;\n        }\n\n        let tempSteps = this.undirected % 7;\n        let tempOctaves = parseInt(this.undirected / 7);\n        if (tempSteps === 0) {\n            tempOctaves -= 1;\n            tempSteps = 7;\n        }\n        this.simpleUndirected = tempSteps;\n        this.undirectedOctaves = tempOctaves;\n        if ((tempSteps === 1) && (tempOctaves >= 1)) {\n            this.semiSimpleUndirected = 8;\n        } else {\n            this.semiSimpleUndirected = this.simpleUndirected;\n        }\n\n        if (this.direction === interval.IntervalDirections.DESCENDING) {\n            this.octaves = -1 * tempOctaves;\n            if (tempSteps !== 1) {\n                this.simpleDirected = -1 * tempSteps;\n            } else {\n                this.simpleDirected = 1;  // no descending unisons...\n            }\n            this.semiSimpleDirected = -1 * this.semiSimpleUndirected;\n        } else {\n            this.octaves = tempOctaves;\n            this.simpleDirected = tempSteps;\n            this.semiSimpleDirected = this.semiSimpleUndirected;\n        }\n        if ((this.simpleUndirected === 1)\n                || (this.simpleUndirected === 4)\n                || (this.simpleUndirected === 5)) {\n            this.perfectable = true;\n        } else {\n            this.perfectable = false;\n        }\n\n        if (this.undirected < interval.MusicOrdinals.length) {\n            this.niceName = interval.MusicOrdinals[this.undirected];\n        } else {\n            this.niceName = this.undirected.toString();\n        }\n\n        this.simpleNiceName = interval.MusicOrdinals[this.simpleUndirected];\n        this.semiSimpleNiceName = interval.MusicOrdinals[this.semiSimpleUndirected];\n\n        if (Math.abs(this.directed) === 1) {\n            this.staffDistance = 0;\n        } else if (this.directed > 1) {\n            this.staffDistance = this.directed - 1;\n        } else if (this.directed < -1) {\n            this.staffDistance = this.directed + 1;\n        }\n        // else: raise IntervalException(\"Non-integer, -1, or 0 not permitted as a diatonic interval\")\n\n        // 2 -> 7; 3 -> 6; 8 -> 1 etc.\n        this.mod7inversion = 9 - this.semiSimpleUndirected;\n\n        if (this.direction === interval.IntervalDirections.DESCENDING) {\n            this.mod7 = this.mod7inversion;  // see chord.semitonesFromChordStep for usage...\n        } else {\n            this.mod7 = this.simpleDirected;\n        }\n\n    }\n\n    /**\n     * Returns a new GenericInterval which is the mod7inversion; 3rds (and 10ths etc.) to 6ths, etc.\n     *\n     * @memberof music21.interval.GenericInterval\n     * @returns {music21.interval.GenericInterval}\n     */\n    complement() {\n        return new interval.GenericInterval(this.mod7inversion);\n    };\n\n    /**\n     * Returns a new GenericInterval which has the opposite direction (descending becomes ascending, etc.)\n     *\n     * @memberof music21.interval.GenericInterval\n     * @returns {music21.interval.GenericInterval}\n     */\n    reverse() {\n        if (this.undirected === 1) {\n            return new interval.GenericInterval(1);\n        } else {\n            return new interval.GenericInterval(this.undirected * (-1 * this.direction));\n        }\n    };\n    /**\n     * Given a specifier, return a new DiatonicInterval with this generic.\n     *\n     * @memberof music21.interval.GenericInterval\n     * @param {string|Int} specifier - a specifier such as \"P\",\"m\",\"M\",\"A\",\"dd\" etc.\n     * @returns {music21.interval.DiatonicInterval}\n     */\n    getDiatonic(specifier) {\n        return new interval.DiatonicInterval(specifier, this);\n    }\n\n    /**\n     * Transpose a pitch by this generic interval, maintaining accidentals\n     *\n     * @memberof music21.interval.GenericInterval\n     * @param {music21.pitch.Pitch} p\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        const pitch2 = new pitch.Pitch();\n        pitch2.step = p.step;\n        pitch2.octave = p.octave;\n\n        const oldDiatonicNum = p.diatonicNoteNum;\n\n        const distanceToMove = this.staffDistance;\n\n        // if not reverse...\n        const newDiatonicNumber = oldDiatonicNum + distanceToMove;\n        const newInfo = interval.IntervalConvertDiatonicNumberToStep(newDiatonicNumber);\n        pitch2.step = newInfo[0];\n        pitch2.octave = newInfo[1];\n        if (p.accidental !== undefined) {\n            pitch2.accidental = new pitch.Accidental(p.accidental.name);\n        }\n        return pitch2;\n    }\n}\ninterval.GenericInterval = GenericInterval;\n\ninterval.IntervalSpecifiersEnum = {\n        PERFECT: 1,\n        MAJOR: 2,\n        MINOR: 3,\n        AUGMENTED: 4,\n        DIMINISHED: 5,\n        DBLAUG: 6,\n        DBLDIM: 7,\n        TRPAUG: 8,\n        TRPDIM: 9,\n        QUADAUG: 10,\n        QUADDIM: 11,\n};\n\ninterval.IntervalNiceSpecNames = [\n                                  'ERROR', 'Perfect', 'Major', 'Minor',\n                                  'Augmented', 'Diminished', 'Doubly-Augmented', 'Doubly-Diminished',\n                                  'Triply-Augmented', 'Triply-Diminished', 'Quadruply-Augmented', 'Quadruply-Diminished',\n                                  ];\ninterval.IntervalPrefixSpecs = [\n                                undefined, 'P', 'M', 'm', 'A', 'd', 'AA', 'dd', 'AAA', 'ddd', 'AAAA', 'dddd',\n                                ];\n\n\ninterval.IntervalOrderedPerfSpecs = [\n                                     'dddd', 'ddd', 'dd', 'd', 'P', 'A', 'AA', 'AAA', 'AAAA',\n                                     ];\n\ninterval.IntervalPerfSpecifiers = [\n                                   interval.IntervalSpecifiersEnum.QUADDMIN,\n                                   interval.IntervalSpecifiersEnum.TRPDIM,\n                                   interval.IntervalSpecifiersEnum.DBLDIM,\n                                   interval.IntervalSpecifiersEnum.DIMINISHED,\n                                   interval.IntervalSpecifiersEnum.PERFECT,\n                                   interval.IntervalSpecifiersEnum.AUGMENTED,\n                                   interval.IntervalSpecifiersEnum.DBLAUG,\n                                   interval.IntervalSpecifiersEnum.TRPAUG,\n                                   interval.IntervalSpecifiersEnum.QUADAUG,\n                                   ];\ninterval.IntervalPerfOffset = 4;\n\ninterval.IntervalOrderedImperfSpecs = [\n                                       'dddd', 'ddd', 'dd', 'd', 'm', 'M', 'A', 'AA', 'AAA', 'AAAA',\n                                       ];\n\ninterval.IntervalSpecifiers = [\n                               interval.IntervalSpecifiersEnum.QUADDMIN,\n                               interval.IntervalSpecifiersEnum.TRPDIM,\n                               interval.IntervalSpecifiersEnum.DBLDIM,\n                               interval.IntervalSpecifiersEnum.DIMINISHED,\n                               interval.IntervalSpecifiersEnum.MINOR,\n                               interval.IntervalSpecifiersEnum.MAJOR,\n                               interval.IntervalSpecifiersEnum.AUGMENTED,\n                               interval.IntervalSpecifiersEnum.DBLAUG,\n                               interval.IntervalSpecifiersEnum.TRPAUG,\n                               interval.IntervalSpecifiersEnum.QUADAUG,\n                               ];\ninterval.IntervalMajOffset = 5;\n\ninterval.IntervalSemitonesGeneric = {\n        1: 0, 2: 2, 3: 4, 4: 5, 5: 7, 6: 9, 7: 11,\n};\ninterval.IntervalAdjustPerfect = {\n        'P': 0, 'A': 1, 'AA': 2, 'AAA': 3, 'AAAA': 4,\n        'd': -1, 'dd': -2, 'ddd': -3, 'dddd': -4,\n}; // offset from Perfect\n\ninterval.IntervalAdjustImperf = {\n        'M': 0, 'm': -1, 'A': 1, 'AA': 2, 'AAA': 3, 'AAAA': 4,\n        'd': -2, 'dd': -3, 'ddd': -4, 'dddd': -5,\n}; // offset from major\n\n\n/**\n * Represents a Diatonic interval.  See example for usage.\n *\n * @class DiatonicInterval\n * @memberof music21.interval\n * @param {string|Int|undefined} [specifier='P'] - a specifier such as \"P\", \"d\", \"m\", \"M\" etc.\n * @param {music21.interval.GenericInterval|Int} [generic=1] - a `GenericInterval` object or a number to be converted to one\n * @example\n * var di = new music21.interval.DiatonicInterval(\"M\", 10);\n * di.generic.isClassOrSubclass('GenericInterval');\n * // true\n * di.specifier;\n * // 'M'\n * di.name;\n * // 'M10'\n * di.direction == music21.interval.IntervalDirections.ASCENDING;\n * // true\n * di.niceName\n * // \"Major Tenth\"\n *\n * // See music21p for more possibilities.\n */\nexport class DiatonicInterval extends prebase.ProtoM21Object {\n    constructor(specifier, generic) {\n        super();\n        this.classes.push('DiatonicInterval');\n\n        if (specifier === undefined) {\n            specifier = 'P';\n        }\n        if (generic === undefined) {\n            generic = new interval.GenericInterval(1);\n        } else if (typeof generic === 'number') {\n            generic = new interval.GenericInterval(generic);\n        }\n\n        this.name = '';\n        if (typeof specifier === 'number') {\n            this.specifier = specifier;\n        } else {\n            this.specifier = interval.IntervalPrefixSpecs.indexOf(specifier); // todo: convertSpecifier();\n        }\n        this.generic = generic;\n\n        if ((generic.undirected !== 1) || (specifier === interval.IntervalSpecifiersEnum.PERFECT)) {\n            this.direction = generic.direction;\n        } else if (interval.IntervalPerfSpecifiers.indexOf(specifier) <= interval.IntervalPerfSpecifiers.indexOf(interval.IntervalSpecifiersEnum.DIMINISHED)) {\n            // diminished unisons -- very controversial\n            this.direction = interval.IntervalDirections.DESCENDING;\n        } else {\n            this.direction = interval.IntervalDirections.ASCENDING;\n        }\n        const diatonicDirectionNiceName = interval.IntervalDirectionTerms[this.direction + 1];\n        this.name = interval.IntervalPrefixSpecs[this.specifier] + generic.undirected.toString();\n        this.niceName = interval.IntervalNiceSpecNames[this.specifier] + ' ' + generic.niceName;\n        this.simpleName = interval.IntervalPrefixSpecs[this.specifier] + generic.simpleUndirected.toString();\n        this.simpleNiceName = interval.IntervalNiceSpecNames[this.specifier] + ' ' + generic.simpleNiceName;\n        this.semiSimpleName = interval.IntervalPrefixSpecs[this.specifier] + generic.semiSimpleUndirected.toString();\n        this.semiSimpleNiceName = interval.IntervalNiceSpecNames[this.specifier] + ' ' + generic.semiSimpleNiceName;\n        this.directedName = interval.IntervalPrefixSpecs[this.specifier] + generic.directed.toString();\n        this.directedNiceName = diatonicDirectionNiceName + ' ' + this.niceName;\n        this.directedSimpleName = interval.IntervalPrefixSpecs[this.specifier] + generic.simpleDirected.toString();\n        this.directedSimpleNiceName = diatonicDirectionNiceName + ' ' + this.simpleNiceName;\n        this.directedSemiSimpleName = interval.IntervalPrefixSpecs[this.specifier] + generic.semiSimpleDirected.toString();\n        this.directedSemiSimpleNiceName = diatonicDirectionNiceName + ' ' + this.semiSimpleNameName;\n        this.specificName = interval.IntervalNiceSpecNames[this.specifier];\n        this.perfectable = generic.perfectable;\n        this.isDiatonicStep = generic.isDiatonicStep;\n        this.isStep = generic.isStep;\n\n        // generate inversions\n        if (this.perfectable) {\n            this.orderedSpecifierIndex = interval.IntervalOrderedPerfSpecs.indexOf(interval.IntervalPrefixSpecs[this.specifier]);\n            this.invertedOrderedSpecIndex = (interval.IntervalOrderedPerfSpecs.length - 1 - this.orderedSpecifierIndex);\n            this.invertedOrderedSpecifier = interval.IntervalOrderedPerfSpecs[this.invertedOrderedSpecIndex];\n        } else {\n            this.orderedSpecifierIndex = interval.IntervalOrderedImperfSpecs.indexOf(interval.IntervalPrefixSpecs[this.specifier]);\n            this.invertedOrderedSpecIndex = (interval.IntervalOrderedImperfSpecs.length - 1 - this.orderedSpecifierIndex);\n            this.invertedOrderedSpecifier = interval.IntervalOrderedImperfSpecs[this.invertedOrderedSpecIndex];\n        }\n\n        this.mod7inversion = this.invertedOrderedSpecifier + generic.mod7inversion.toString();\n        /* ( if (this.direction == interval.IntervalDirections.DESCENDING) {\n\t\t\tthis.mod7 = this.mod7inversion;\n\t\t} else {\n\t\t\tthis.mod7 = this.simpleName;\n\t\t} */\n\n        // TODO: reverse()\n        // TODO: property cents\n    }\n\n    /**\n     * Returns a ChromaticInterval object of the same size.\n     *\n     * @memberof music21.interval.DiatonicInterval\n     * @returns {music21.interval.ChromaticInterval}\n     */\n    getChromatic() {\n        const octaveOffset = Math.floor(Math.abs(this.generic.staffDistance) / 7);\n        const semitonesStart = interval.IntervalSemitonesGeneric[this.generic.simpleUndirected];\n        const specName = interval.IntervalPrefixSpecs[this.specifier];\n\n        let semitonesAdjust = 0;\n        if (this.generic.perfectable) {\n            semitonesAdjust = interval.IntervalAdjustPerfect[specName];\n        } else {\n            semitonesAdjust = interval.IntervalAdjustImperf[specName];\n        }\n\n        let semitones = (octaveOffset * 12) + semitonesStart + semitonesAdjust;\n\n\n        // direction should be same as original\n\n        if (this.generic.direction === interval.IntervalDirections.DESCENDING) {\n            semitones *= -1;\n        }\n        if (debug) {\n            console.log('DiatonicInterval.getChromatic -- octaveOffset: ' + octaveOffset);\n            console.log('DiatonicInterval.getChromatic -- semitonesStart: ' + semitonesStart);\n            console.log('DiatonicInterval.getChromatic -- specName: ' + specName);\n            console.log('DiatonicInterval.getChromatic -- semitonesAdjust: ' + semitonesAdjust);\n            console.log('DiatonicInterval.getChromatic -- semitones: ' + semitones);\n        }\n        return new interval.ChromaticInterval(semitones);\n    }\n}\ninterval.DiatonicInterval = DiatonicInterval;\n\n/**\n * @class ChromaticInterval\n * @memberof music21.interval\n * @param {number} value - number of semitones (positive or negative)\n * @property {number} cents\n * @property {number} value\n * @property {number} undirected - absolute value of value\n * @property {number} mod12 - reduction to one octave\n * @property {number} intervalClass - reduction to within a tritone (11 = 1, etc.)\n *\n */\nexport class ChromaticInterval extends prebase.ProtoM21Object {\n    constructor(value) {\n        super();\n        this.classes.push('ChromaticInterval');\n\n        this.semitones = value;\n        this.cents = Math.round(value * 100.0, 5);\n        this.directed = value;\n        this.undirected = Math.abs(value);\n\n        if (this.directed === 0) {\n            this.direction = interval.IntervalDirections.OBLIQUE;\n        } else if (this.directed === this.undirected) {\n            this.direction = interval.IntervalDirections.ASCENDING;\n        } else {\n            this.direction = interval.IntervalDirections.DESCENDING;\n        }\n\n        this.mod12 = this.semitones % 12;\n        this.simpleUndirected = this.undirected % 12;\n        if (this.direction === interval.IntervalDirections.DESCENDING) {\n            this.simpleDirected = -1 * this.simpleUndirected;\n        } else {\n            this.simpleDirected = this.simpleUndirected;\n        }\n\n        this.intervalClass = this.mod12;\n        if (this.mod12 > 6) {\n            this.intervalClass = 12 - this.mod12;\n        }\n\n        if (this.undirected === 1) {\n            this.isChromaticStep = true;\n        } else {\n            this.isChromaticStep = false;\n        }\n    }\n    reverse() {\n        return new interval.ChromaticInterval(this.undirected * (-1 * this.direction));\n    };\n\n//  TODO: this.getDiatonic()\n\n    /**\n     * Transposes pitches but does not maintain accidentals, etc.\n     *\n     * @memberof music21.interval.ChromaticInterval\n     * @property {music21.pitch.Pitch} p - pitch to transpose\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        let useImplicitOctave = false;\n        if (p.octave === undefined) {\n            // not yet implemented in m21j\n            useImplicitOctave = true;\n        }\n        const pps = p.ps;\n        const newPitch = new pitch.Pitch();\n        newPitch.ps = pps + this.semitones;\n        if (useImplicitOctave) {\n            newPitch.octave = undefined;\n        }\n        return newPitch;\n    }\n}\ninterval.ChromaticInterval = ChromaticInterval;\n\n\ninterval.IntervalStepNames = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\n\n/**\n * @function music21.interval.IntervalConvertDiatonicNumberToStep\n * @memberof music21.interval\n * @param {Int} dn - diatonic number, where 29 = C4, C#4 etc.\n * @returns {Array} two element array of {string} stepName and {Int} octave\n */\ninterval.IntervalConvertDiatonicNumberToStep = function IntervalConvertDiatonicNumberToStep(dn) {\n    let stepNumber;\n    let octave;\n    if (dn === 0) {\n        return ['B', -1];\n    } else if (dn > 0) {\n        octave = Math.floor((dn - 1) / 7);\n        stepNumber = (dn - 1) - (octave * 7);\n    } else { // low notes... test, because js(floor) != py(int);\n        octave = Math.floor(dn / 7);\n        stepNumber = (dn - 1) - ((octave + 1) * 7);\n    }\n    const stepName = interval.IntervalStepNames[stepNumber];\n    return [stepName, octave];\n};\n\n\n/**\n * This is the main, powerful Interval class.\n *\n * Instantiate with either a string (\"M3\") or two {@link music21.pitch.Pitch} or two {@link music21.note.Note}\n *\n * See music21p instructions for usage.\n *\n * @class Interval\n * @memberof music21.interval\n * @example\n * var n1 = new music21.note.Note(\"C4\");\n * var n2 = new music21.note.Note(\"F#5\");\n * var iv = new music21.interval.Interval(n1, n2);\n * iv.isConsonant();\n * // false\n * iv.semitones;\n * // 18\n * iv.niceName\n * // \"Augmented Eleventh\"\n */\nexport class Interval extends prebase.ProtoM21Object {\n\n    constructor(...restArgs) {\n        super()\n        this.classes.push('Interval');\n\n        // todo: allow full range of ways of specifying as in m21p\n        if (restArgs.length === 1) {\n            const arg0 = restArgs[0];\n            if (typeof (arg0) === 'string') {\n                // simple...\n                const specifier = arg0.slice(0, 1);\n                const generic = parseInt(arg0.slice(1));\n                const gI = new interval.GenericInterval(generic);\n                const dI = new interval.DiatonicInterval(specifier, gI);\n                this.diatonic = dI;\n                this.chromatic = this.diatonic.getChromatic();\n            } else if (arg0.specifier !== undefined) {\n                // assume diatonic...\n                this.diatonic = arg0;\n                this.chromatic = this.diatonic.getChromatic();\n            } else {\n                console.error('cant parse string arguments to Interval yet');\n            }\n        } else if (restArgs.length === 2) {\n            if (restArgs[0].pitch === undefined && restArgs[0].diatonicNoteNum === undefined) {\n                this.diatonic = restArgs[0];\n                this.chromatic = restArgs[1];\n            } else {\n                const n1 = restArgs[0];\n                const n2 = restArgs[1];\n                const gInt = interval.notesToGeneric(n1, n2);\n                const cInt = interval.notesToChromatic(n1, n2);\n\n                this.diatonic = interval.intervalsToDiatonic(gInt, cInt);\n                this.chromatic = cInt;\n            }\n        }\n        this.reinit();\n    }\n    get complement() {\n        return new interval.Interval(this.diatonic.mod7inversion);\n    }\n    reinit() {\n        this.direction = this.chromatic.direction;\n        this.specifier = this.diatonic.specifier;\n        this.diatonicType = this.diatonic.specifier;\n        // this.specificName = this.diatonic.specificName;\n        this.generic = this.diatonic.generic;\n\n        this.name = this.diatonic.name;\n        this.niceName = this.diatonic.niceName;\n        this.simpleName = this.diatonic.simpleName;\n        this.simpleNiceName = this.diatonic.simpleNiceName;\n        this.semiSimpleName = this.diatonic.semiSimpleName;\n        this.semiSimpleNiceName = this.diatonic.semiSimpleNiceName;\n\n        this.directedName = this.diatonic.directedName;\n        this.directedNiceName = this.diatonic.directedNiceName;\n        this.directedSimpleName = this.diatonic.directedSimpleName;\n        this.directedSimpleNiceName = this.diatonic.directedSimpleNiceName;\n\n        // other names...\n        this.isDiatonicStep = this.diatonic.isDiatonicStep;\n\n        this.isChromaticStep = this.chromatic.isChromaticStep;\n        this.semitones = this.chromatic.semitones;\n        this.intervalClass = this.chromatic.intervalClass;\n        this.cents = this.chromatic.cents;\n        this.isStep = (this.isChromaticStep || this.isDiatonicStep);\n    }\n\n    /**\n     * @memberof music21.interval.Interval\n     * @returns {Boolean}\n     */\n    isConsonant() {\n        const sn = this.simpleName;\n        const consonantNames = ['P5', 'm3', 'M3', 'm6', 'M6', 'P1'];\n        if (consonantNames.indexOf(sn) !== -1) {\n            return true;\n        } else {\n            return false;\n        }\n    };\n\n//  todo general: microtones\n    /**\n     * @memberof music21.interval.Interval\n     * @param {music21.pitch.Pitch} p - pitch to transpose\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        // todo: reverse, clearAccidentalDisplay, maxAccidental;\n\n        /*\n        var useImplicitOctave = false;\n        if (p.octave === undefined) {\n            useImplicitOctave = true;\n        }\n         */\n        const pitch2 = this.diatonic.generic.transposePitch(p);\n        pitch2.accidental = undefined;\n        // step and octave are right now, but not necessarily accidental\n        const halfStepsToFix = this.chromatic.semitones - parseInt(pitch2.ps - p.ps);\n        if (halfStepsToFix !== 0) {\n            pitch2.accidental = new pitch.Accidental(halfStepsToFix);\n        }\n        if (debug) {\n            console.log('Interval.transposePitch -- new step ' + pitch2.step);\n            console.log('Interval.transposePitch -- new octave ' + pitch2.octave);\n            console.log('Interval.transposePitch -- fixing halfsteps for ' + halfStepsToFix);\n        }\n        return pitch2;\n    }\n}\ninterval.Interval = Interval;\n/**\n * Convert two notes or pitches to a GenericInterval;\n */\ninterval.notesToGeneric = function notesToGeneric(n1, n2) {\n    let p1 = n1;\n    if (n1.pitch !== undefined) {\n        p1 = n1.pitch;\n    }\n    let p2 = n2;\n    if (n2.pitch !== undefined) {\n        p2 = n2.pitch;\n    }\n    const staffDist = p2.diatonicNoteNum - p1.diatonicNoteNum;\n    const genDist = interval.convertStaffDistanceToInterval(staffDist);\n    return new interval.GenericInterval(genDist);\n};\n\ninterval.convertStaffDistanceToInterval = function convertStaffDistanceToInterval(staffDist) {\n    if (staffDist === 0) {\n        return 1;\n    } else if (staffDist > 0) {\n        return staffDist + 1;\n    } else {\n        return staffDist - 1;\n    }\n};\n\ninterval.notesToChromatic = function notesToChromatic(n1, n2) {\n    let p1 = n1;\n    if (n1.pitch !== undefined) {\n        p1 = n1.pitch;\n    }\n    let p2 = n2;\n    if (n2.pitch !== undefined) {\n        p2 = n2.pitch;\n    }\n    return new interval.ChromaticInterval(p2.ps - p1.ps);\n};\n\ninterval.intervalsToDiatonic = function intervalsToDiatonic(gInt, cInt) {\n    const specifier = interval._getSpecifierFromGenericChromatic(gInt, cInt);\n    // todo -- convert specifier...\n    return new interval.DiatonicInterval(specifier, gInt);\n};\n\ninterval._getSpecifierFromGenericChromatic = function _getSpecifierFromGenericChromatic(gInt, cInt) {\n    const noteVals = [undefined, 0, 2, 4, 5, 7, 9, 11];\n    const normalSemis = noteVals[gInt.simpleUndirected] + 12 * gInt.undirectedOctaves;\n    let theseSemis = 0;\n    if (gInt.direction !== cInt.direction\n            && gInt.direction !== interval.IntervalDirections.OBLIQUE\n            && cInt.direction !== interval.IntervalDirections.OBLIQUE) {\n        // intervals like d2 and dd2 etc. (the last test doesn't matter, since -1*0 === 0, but in theory it should be there)\n        theseSemis = -1 * cInt.undirected;\n    } else if (gInt.undirected === 1) {\n        theseSemis = cInt.directed; // matters for unison\n    } else {\n        // all normal intervals\n        theseSemis  = cInt.undirected;\n    }\n    const semisRounded = Math.round(theseSemis);\n    let specifier = '';\n    if (gInt.perfectable) {\n        specifier = interval.IntervalPerfSpecifiers[interval.IntervalPerfOffset + semisRounded - normalSemis];\n    } else {\n        specifier = interval.IntervalSpecifiers[interval.IntervalMajOffset + semisRounded - normalSemis];\n    }\n    return specifier;\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/scale -- Scales\n *\n * Does not implement the full range of scales from music21p\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { debug } from './debug';\nimport { pitch } from './pitch';\nimport { interval } from './interval';\n\nimport { Music21Exception } from './exceptions21';\n\n/**\n * Scale module. See {@link music21.scale} namespace\n *\n * @exports music21/scale\n */\n/**\n * Scale namespace.  Right now only supports very simple scales.\n *\n * @namespace music21.scale\n * @memberof music21\n * @requires music21/pitch\n * @requires music21/interval\n */\nexport const scale = {};\n\n/**\n * Function, not class\n *\n * @function music21.scale.SimpleDiatonicScale\n * @param {music21.pitch.Pitch} tonic\n * @param {Array<string>} scaleSteps - an array of diatonic prefixes, generally 'M' (major) or 'm' (minor) describing the seconds.\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nscale.SimpleDiatonicScale = function SimpleDiatonicScale(tonic, scaleSteps) {\n    if (tonic === undefined) {\n        tonic = new pitch.Pitch('C4');\n    } else if (!(tonic instanceof pitch.Pitch)) {\n        throw new Music21Exception('Cannot make a scale not from ' + \n                'a music21.pitch.Pitch object: ' + tonic);\n    }\n    if (scaleSteps === undefined) {\n        scaleSteps = ['M', 'M', 'm', 'M', 'M', 'M', 'm'];\n    }\n    const gi = new interval.GenericInterval(2);\n    const pitches = [tonic];\n    let lastPitch = tonic;\n    for (let i = 0; i < scaleSteps.length; i++) {\n        const di = new interval.DiatonicInterval(scaleSteps[i], gi);\n        const ii = new interval.Interval(di);\n        const newPitch = ii.transposePitch(lastPitch);\n        if (debug) {\n            console.log('ScaleSimpleMajor -- adding pitch: ' + newPitch.name);\n        }\n        pitches.push(newPitch);\n        lastPitch = newPitch;\n    }\n    return pitches;\n};\n\n/**\n * One octave of a major scale\n *\n * @function music21.scale.ScaleSimpleMajor\n * @param {music21.pitch.Pitch} tonic\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nscale.ScaleSimpleMajor = function ScaleSimpleMajor(tonic) {\n    const scaleSteps = ['M', 'M', 'm', 'M', 'M', 'M', 'm'];\n    return new scale.SimpleDiatonicScale(tonic, scaleSteps);\n};\n\n/**\n * One octave of a minor scale\n *\n * @function music21.scale.ScaleSimpleMinor\n * @param {music21.pitch.Pitch} tonic\n * @param {string} [minorType='natural] - 'harmonic', 'harmonic-minor', 'melodic', 'melodic-minor', 'melodic-minor-ascending', 'melodic-ascending' or other (=natural/melodic-descending)\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nscale.ScaleSimpleMinor = function ScaleSimpleMinor(tonic, minorType) {\n    const scaleSteps = ['M', 'm', 'M', 'M', 'm', 'M', 'M'];\n    if (typeof (minorType) === 'string') {\n        // \"harmonic minor\" -> \"harmonic-minor\"\n        minorType = minorType.replace(/\\s/g, '-');\n    }\n    if (minorType === 'harmonic'\n        || minorType === 'harmonic-minor') {\n        scaleSteps[5] = 'A';\n        scaleSteps[6] = 'm';\n    } else if (minorType === 'melodic'\n            || minorType === 'melodic-ascending'\n            || minorType === 'melodic-minor'\n            || minorType === 'melodic-minor-ascending') {\n        scaleSteps[4] = 'M';\n        scaleSteps[6] = 'm';\n    }\n    return new scale.SimpleDiatonicScale(tonic, scaleSteps);\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/key -- KeySignature and Key objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21';\n\nimport { base } from './base';\nimport { debug } from './debug';\nimport { interval } from './interval';\nimport { pitch } from './pitch';\nimport { scale } from './scale';\n\n/**\n * key and keysignature module. See {@link music21.key} namespace for details\n *\n * @exports music21/key\n */\n/**\n * Key and KeySignature related objects and methods\n *\n * @namespace music21.key\n * @memberof music21\n * @requires music21/base\n * @requires music21/pitch\n * @requires music21/interval\n * @requires music21/scale\n */\nexport const key = {};\n\nkey.modeSharpsAlter = {\n    'major': 0,\n    'minor': -3,\n    'dorian': -2,\n    'phrygian': -4,\n    'lydian': 1,\n    'mixolydian': -1,\n    'locrian': -5,\n};\n\n/**\n * @class KeySignature\n * @memberof music21.key\n * @description Represents a key signature\n * @param {Int} [sharps=0] -- the number of sharps (negative for flats)\n * @property {Int} [sharps=0] -- number of sharps (negative for flats)\n * @extends music21.base.Music21Object\n * @example\n * var ks = new music21.key.KeySignature(-3); //E-flat major or c minor\n * var s = new music21.stream.Stream();\n * s.keySignature = ks;\n * var n = new music21.note.Note('A-'); // A-flat\n * s.append(n);\n * s.appendNewCanvas();\n */\nexport class KeySignature extends base.Music21Object {\n    constructor(sharps) {\n        super();\n        this.classes.push('KeySignature');\n        this._sharps = sharps || 0; // if undefined\n        this._alteredPitchesCache = undefined;\n\n        // 12 flats/sharps enough for now...\n        this.flatMapping = ['C', 'F', 'B-', 'E-', 'A-', 'D-', 'G-', 'C-', 'F-', 'B--', 'E--', 'A--', 'D--'];\n        this.sharpMapping = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#', 'E#', 'B#'];\n    }\n    get sharps() {\n        return this._sharps;\n    }\n    set sharps(s) {\n        this._alteredPitchesCache = [];\n        this._sharps = s;\n    }\n    /**\n     * Gives the width in pixels necessary to represent the key signature.\n     *\n     * @memberof music21.key.KeySignature#\n     * @var {number} width\n     * @readonly\n     */\n    get width() {\n        return 5 * Math.abs(this.sharps);\n    }\n     /**\n      * An Array of Altered Pitches in KeySignature order (i.e., for flats, Bb, Eb, etc.)\n      *\n      * @memberof music21.key.KeySignature#\n      * @var {Array<music21.pitch.Pitch>} alteredPitches\n      * @readonly\n      * @example\n      * var ks = new music21.key.KeySignature(3)\n      * var ap = ks.alteredPitches\n      * var apName = [];\n      * for (var i = 0; i < ap.length; i++) {\n      *     apName.push(ap[i].name);\n      * }\n      * apName\n      * // [\"F#\", \"C#\", \"G#\"]\n      */\n    get alteredPitches() {\n        if (this._alteredPitchesCache !== undefined) {\n            return this._alteredPitchesCache;\n        }\n        let transStr = 'P5';\n        let startPitch = 'B';\n        if (this.sharps < 0) {\n            transStr = 'P4';\n            startPitch = 'F';\n        }\n        const transInterval = new interval.Interval(transStr);\n        const post = [];\n        let pKeep = new pitch.Pitch(startPitch);\n        for (let i = 0; i < Math.abs(this.sharps); i++) {\n            pKeep = transInterval.transposePitch(pKeep);\n            pKeep.octave = 4;\n            post.push(pKeep);\n        }\n        this._alteredPitchesCache = post;\n        return post;\n    }\n     /**\n      * Return the name of the major key with this many sharps\n      *\n      * @memberof music21.key.KeySignature\n      * @returns {(string|undefined)} name of key\n      * @example\n      * var ks = new music21.key.KeySignature(-3)\n      * ks.majorName()\n      * // \"E-\"\n      */\n    majorName() {\n        if (this.sharps >= 0) {\n            return this.sharpMapping[this.sharps];\n        } else {\n            return this.flatMapping[Math.abs(this.sharps)];\n        }\n    }\n     /**\n      * Return the name of the minor key with this many sharps\n      * @memberof music21.key.KeySignature\n      * @returns {(string|undefined)}\n      */\n    minorName() {\n        const tempSharps = this.sharps + 3;\n        if (tempSharps >= 0) {\n            return this.sharpMapping[tempSharps];\n        } else {\n            return this.flatMapping[Math.abs(tempSharps)];\n        }\n    }\n     /**\n      * returns the vexflow name (just the `majorName()` with \"b\" for \"-\") for\n      * the key signature.  Does not create the object.\n      *\n      * Deprecated.\n      *\n      * @memberof music21.key.KeySignature\n      * @returns {string}\n      */\n    vexflow() {\n        console.log('calling deprecated function KeySignature.vexflow');\n        const tempName = this.majorName();\n        return tempName.replace(/\\-/g, 'b');\n    }\n     /**\n      * Returns the accidental associated with a step in this key, or undefined if none.\n      *\n      * @memberof music21.key.KeySignature\n      * @param {string} step - a valid step name such as \"C\",\"D\", etc., but not \"C#\" etc.\n      * @returns {(music21.pitch.Accidental|undefined)}\n      */\n    accidentalByStep(step) {\n        const aps = this.alteredPitches;\n        for (let i = 0; i < aps.length; i++) {\n            if (aps[i].step === step) {\n                if (aps[i].accidental === undefined) {\n                    return undefined;\n                }\n                 // make a new accidental;\n                return new pitch.Accidental(aps[i].accidental.alter);\n            }\n        }\n        return undefined;\n    }\n     /**\n      * Takes a pitch in C major and transposes it so that it has\n      * the same step position in the current key signature.\n      *\n      * @memberof music21.key.KeySignature\n      * @returns {music21.pitch.Pitch}\n      * @example\n      * var ks = new music21.key.KeySignature(-3)\n      * var p1 = new music21.pitch.Pitch('B')\n      * var p2 = ks.transposePitchFromC(p1)\n      * p2.name\n      * // \"D\"\n      * var p3 = new music21.pitch.Pitch('G-')\n      * var p4 = ks.transposePitchFromC(p3)\n      * p4.name\n      * // \"B--\"\n      */\n    transposePitchFromC(p) {\n        let transInterval;\n        let transTimes;\n        if (this.sharps === 0) {\n            return new pitch.Pitch(p.nameWithOctave);\n        } else if (this.sharps < 0) {\n            transTimes = Math.abs(this.sharps);\n            transInterval = new interval.Interval('P4');\n        } else {\n            transTimes = this.sharps;\n            transInterval = new interval.Interval('P5');\n        }\n        let newPitch = p;\n        for (let i = 0; i < transTimes; i++) {\n            newPitch = transInterval.transposePitch(newPitch);\n            if ((i % 2) === 1) {\n                newPitch.octave -= 1;\n            }\n        }\n        return newPitch;\n    }\n}\nkey.KeySignature = KeySignature;\n\n\n/**\n * Create a Key object. Like a KeySignature but with ideas about Tonic, Dominant, etc.\n *\n * TODO: allow keyName to be a {@link music21.pitch.Pitch}\n *\n * @class Key\n * @memberof music21.key\n * @extends music21.key.KeySignature\n * @param {string} keyName -- a pitch name representing the key (w/ \"-\" for flat)\n * @param {string} [mode] -- if not given then the CASE of the keyName will be used (\"C\" => \"major\", \"c\" => \"minor\")\n */\nexport class Key extends KeySignature {\n    constructor(keyName, mode) {\n        if (keyName === undefined) {\n            keyName = 'C';\n        }\n        if (mode === undefined) {\n            const lowerCase = keyName.toLowerCase();\n            if (keyName === lowerCase) {\n                mode = 'minor';\n            } else {\n                mode = 'major';\n            }\n        }\n\n        const sharpsArray = 'A-- E-- B-- F- C- G- D- A- E- B- F C G D A E B F# C# G# D# A# E# B#'.split(' ');\n        const sharpsIndex = sharpsArray.indexOf(keyName.toUpperCase());\n        if (sharpsIndex === -1) {\n            throw new Music21Exception('Cannot find the key for ' + keyName);\n        }\n        const modeShift = key.modeSharpsAlter[mode] || 0;\n        const sharps = sharpsIndex + modeShift - 11;\n        if (debug) {\n            console.log('Found sharps ' + sharps + ' for key: ' + keyName);\n        }\n        super(sharps);\n        this.tonic = keyName;\n        this.mode = mode;\n    }\n    /**\n     * returns a {@link music21.scale.ScaleSimpleMajor} or {@link music21.scale.ScaleSimpleMinor}\n     * object from the pitch object.\n     *\n     * @memberof music21.key.Key\n     * @param {string|undefined} [scaleType=this.mode] - the type of scale, or the mode.\n     * @returns {object} A music21.scale.Scale subclass.\n     */\n    getScale(scaleType) {\n        if (scaleType === undefined) {\n            scaleType = this.mode;\n        }\n        const pitchObj = new pitch.Pitch(this.tonic);\n        if (scaleType === 'major') {\n            return scale.ScaleSimpleMajor(pitchObj);\n        } else {\n            return scale.ScaleSimpleMinor(pitchObj, scaleType);\n        }\n    }\n}\nkey.Key = Key;\n\nkey.tests = () => {\n    test('music21.key.Key', () => {\n        const testSharps = [\n                            // sharps, mode, given name, given mode\n                            [0, 'minor', 'a'],\n                            [0, 'major', 'C'],\n                            [0, 'major'],\n                            [6, 'major', 'F#'],\n                            [3, 'minor', 'f#'],\n                            [6, 'major', 'f#', 'major'],\n                            [-2, 'major', 'B-'],\n                            [-5, 'minor', 'b-'],\n        ];\n        for (let i = 0; i < testSharps.length; i++) {\n            const thisTest = testSharps[i];\n            const expectedSharps = thisTest[0];\n            const expectedMode = thisTest[1];\n            const givenKeyName = thisTest[2];\n            const givenMode = thisTest[3];\n            const k = new key.Key(givenKeyName, givenMode);\n            const foundSharps = k.sharps;\n            const foundMode = k.mode;\n            equal(foundSharps,\n                    expectedSharps,\n                    'Test sharps: ' + givenKeyName + ' (mode: ' + givenMode + ') ');\n            equal(foundMode,\n                    expectedMode,\n                    'Test mode: ' + givenKeyName + ' (mode: ' + givenMode + ') ');\n        }\n\n        const k = new key.Key('f#');\n        let s = k.getScale();\n        equal(s[2].nameWithOctave, 'A4', 'test minor scale');\n        equal(s[6].nameWithOctave, 'E5');\n        s = k.getScale('major');\n        equal(s[2].nameWithOctave, 'A#4', 'test major scale');\n        equal(s[6].nameWithOctave, 'E#5');\n        s = k.getScale('harmonic minor');\n        equal(s[2].nameWithOctave, 'A4', 'test harmonic minor scale');\n        equal(s[5].nameWithOctave, 'D5');\n        equal(s[6].nameWithOctave, 'E#5');\n\n        equal(k.width, 15, 'checking width is 5 * abs(sharps)');\n    });\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/miditools -- A collection of tools for midi. See the namespace {@link music21.miditools}\n *\n * Copyright (c) 2014-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n * @author Michael Scott Cuthbert\n */\nimport * as $ from 'jquery';\nimport * as eventjs from 'eventjs'; // drag handler...\nimport * as MIDI from 'MIDI';\nimport { chord } from './chord';\nimport { debug } from './debug';\nimport { instrument } from './instrument';\nimport { note } from './note';\n\n/**\n * A collection of tools for midi. See the namespace {@link music21.miditools}\n *\n * @exports music21/miditools\n */\n/**\n * Module that holds **music21** tools for connecting with MIDI.js and somewhat with the\n * events from the Jazz plugin or the WebMIDI protocol.\n *\n * @namespace music21.miditools\n * @memberof music21\n */\nexport const miditools = {};\n\n/**\n * Number of octaves to transpose all incoming midi signals\n *\n * @type {number}\n * @default 0\n */\nmiditools.transposeOctave = 0;\n/**\n * @class Event\n * @memberof music21.miditools\n * @param {number} t - timing information\n * @param {number} a - midi data 1 (N.B. a >> 4 = midiCommand )\n * @param {number} b - midi data 2\n * @param {number} c - midi data 3\n */\nexport class Event {\n    constructor(t, a, b, c) {\n        this.timing = t;\n        this.data1 = a;\n        this.data2 = b;\n        this.data3 = c;\n        this.midiCommand = (a >> 4);\n\n        this.noteOff = (this.midiCommand === 8);\n        this.noteOn = (this.midiCommand === 9);\n\n        this.midiNote = undefined;\n        if (this.noteOn || this.noteOff) {\n            this.midiNote = this.data2 + 12 * miditools.transposeOctave;\n            this.velocity = this.data3;\n        }\n    }\n    /**\n     * Calls MIDI.noteOn or MIDI.noteOff for the note\n     * represented by the Event (if appropriate)\n     *\n     * @memberof music21.miditools.Event\n     * @returns {undefined}\n     */\n    sendToMIDIjs() {\n        if (MIDI !== undefined) {\n            if (this.noteOn) {\n                MIDI.noteOn(0, this.midiNote, this.velocity, 0);\n            } else if (this.noteOff) {\n                MIDI.noteOff(0, this.midiNote, 0);\n            }\n        } else {\n            console.warn('could not playback note because no MIDIout defined');\n        }\n    }\n    /**\n     * Makes a {@link music21.note.Note} object from the event's midiNote number.\n     *\n     * @memberof music21.miditools.Event\n     * @returns {music21.note.Note} - the {@link music21.note.Note} object represented by Event.midiNote\n     */\n    music21Note() {\n        const m21n = new note.Note();\n        m21n.pitch.ps = this.midiNote;\n        return m21n;\n    }\n}\nmiditools.Event = Event;\n\n/**\n * How long to wait in milliseconds before deciding that a note belongs to another chord. Default 100ms\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.maxDelay = 100; // in ms\n/**\n * At what time (in ms since Epoch) the chord started.\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.heldChordTime = 0;\n/**\n * An Array (or undefined) of currently held chords that have not been sent out yet.\n *\n * @memberof music21.miditools\n * @type {Array|undefined}\n */\nmiditools.heldChordNotes = undefined;\n\n/**\n * When, in MS since Jan 1, 1970, was the last {@link music21.note.Note} played.\n * Defaults to the time that the module was loaded.\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.timeOfLastNote = Date.now(); // in ms\n\nmiditools._baseTempo = 60;\n/**\n * Assign (or query) a Metronome object to run all timing information.\n *\n * @memberof music21.miditools\n * @type {music21.tempo.Metronome}\n */\nmiditools.metronome = undefined;\n\nObject.defineProperties(miditools, {\n    'tempo': {\n        enumerable: true,\n        get() {\n            if (this.metronome === undefined) {\n                return this._baseTempo;\n            } else {\n                return this.metronome.tempo;\n            }\n        },\n        set(t) {\n            if (this.metronome === undefined) {\n                this._baseTempo = t;\n            } else {\n                this.metronome.tempo = t;\n            }\n        },\n    },\n});\n\n/* --------- chords ------------- */\n/**\n *  Clears chords that are older than miditools.heldChordTime\n *\n *  Runs a setTimeout on itself.\n *  Calls miditools.sendOutChord\n *\n *  @memberof music21.miditools\n */\nmiditools.clearOldChords = function clearOldChords() {\n    // clear out notes that may be a chord...\n    const nowInMs = Date.now(); // in ms\n    if ((miditools.heldChordTime +\n            miditools.maxDelay) < nowInMs) {\n        miditools.heldChordTime = nowInMs;\n        if (miditools.heldChordNotes !== undefined) {\n            // console.log('to send out chords');\n            miditools.sendOutChord(miditools.heldChordNotes);\n            miditools.heldChordNotes = undefined;\n        }\n    }\n    setTimeout(miditools.clearOldChords, miditools.maxDelay);\n};\n/**\n *  Take a series of jEvent noteOn objects and convert them to a single Chord object\n *  so long as they are all sounded within miditools.maxDelay milliseconds of each other.\n *  this method stores notes in miditools.heldChordNotes (Array).\n *\n *  @param {music21.miditools.Event} jEvent\n *  @memberof music21.miditools\n *  @returns undefined\n */\nmiditools.makeChords = function makeChords(jEvent) { // jEvent is a miditools.Event object\n    if (jEvent.noteOn) {\n        const m21n = jEvent.music21Note();\n        if (miditools.heldChordNotes === undefined) {\n            miditools.heldChordNotes = [m21n];\n        } else {\n            for (let i = 0; i < miditools.heldChordNotes.length; i++) {\n                const foundNote = miditools.heldChordNotes[i];\n                if (foundNote.pitch.ps === m21n.pitch.ps) {\n                    return;  // no duplicates\n                }\n            }\n            miditools.heldChordNotes.push(m21n);\n        }\n    }\n};\n\n/**\n * The last Note or Chord to be sent out from miditools.  This is an important semi-global\n * attribute, since the last element may need to be quantized by quantizeLastNote() to\n * determine its length, since the note may need to be placed into a staff before its total\n * length can be determined.\n *\n * @memberof music21.miditools\n * @type {music21.chord.Chord|music21.note.Note|undefined}\n */\nmiditools.lastElement = undefined;\n\n/**\n * Take the list of Notes and makes a chord out of it, if appropriate and call\n * {@link music21.miditools.callBacks.sendOutChord} callback with the Chord or Note as a parameter.\n *\n * @memberof music21.miditools\n * @param {Array<music21.note.Note>} chordNoteList - an Array of {@link music21.note.Note} objects\n * @returns {(music21.note.Note|music21.chord.Chord|undefined)} A {@link music21.chord.Chord} object,\n * most likely, but maybe a {@link music21.note.Note} object)\n */\nmiditools.sendOutChord = function sendOutChord(chordNoteList) {\n    let appendObject;\n    if (chordNoteList.length > 1) {\n        // console.log(chordNoteList[0].name, chordNoteList[1].name);\n        appendObject = new chord.Chord(chordNoteList);\n    } else if (chordNoteList.length === 1) {\n        appendObject = chordNoteList[0]; // note object\n    } else {\n        return undefined;\n    }\n    appendObject.stemDirection = 'noStem';\n    miditools.quantizeLastNote();\n    miditools.lastElement = appendObject;\n    if (miditools.callBacks.sendOutChord !== undefined) {\n        miditools.callBacks.sendOutChord(appendObject);\n    }\n    return appendObject;\n};\n\n/* ----------- callbacks --------- */\n// TODO: all callbacks (incl. raw, sendOutChord) should be able to be a function or an array of functions\n\n/**\n* callBacks is an object with three keys:\n*\n* - raw: function (t, a, b,c) to call when any midievent arrives. Default: `function (t, a, b, c) { return new miditools.Event(t, a, b, c); }`\n* - general: function ( miditools.Event() ) to call when an Event object has been created. Default: `[miditools.sendToMIDIjs, miditools.quantizeLastNote]`\n* - sendOutChord: function (array_of_note.Note_objects) to call when a sufficient time has passed to build a chord from input. Default: empty function.\n*\n* At present, only \"general\" can take an Array of event listening functions, but I hope to change that for sendOutChord also.\n*\n* \"general\" is usually the callback list to play around with.\n*\n* @memberof music21.miditools\n*/\nmiditools.callBacks = {\n    raw: (t, a, b, c) => new miditools.Event(t, a, b, c),\n    general: [miditools.sendToMIDIjs,\n              miditools.quantizeLastNote],\n    sendOutChord: (arrayOfNotes) => { },\n};\n\n/**\n * Quantizes the lastElement (passed in) or music21.miditools.lastElement.\n *\n * @memberof music21.miditools\n * @param {music21.note.GeneralNote} lastElement - A {@link music21.note.Note} to be quantized\n * @returns {music21.note.GeneralNote} The same {@link music21.note.Note} object passed in with\n * duration quantized\n */\nmiditools.quantizeLastNote = function quantizeLastNote(lastElement) {\n    if (lastElement === undefined) {\n        lastElement = this.lastElement;\n        if (lastElement === undefined) {\n            return undefined;\n        }\n    }\n    lastElement.stemDirection = undefined;\n    const nowInMS = Date.now();\n    const msSinceLastNote = nowInMS - this.timeOfLastNote;\n    this.timeOfLastNote = nowInMS;\n    const normalQuarterNoteLength = 1000 * 60 / this.tempo;\n    const numQuarterNotes = msSinceLastNote / normalQuarterNoteLength;\n    let roundedQuarterLength = Math.round(4 * numQuarterNotes) / 4;\n    if (roundedQuarterLength >= 4) {\n        roundedQuarterLength = 4;\n    } else if (roundedQuarterLength >= 3) {\n        roundedQuarterLength = 3;\n    } else if (roundedQuarterLength > 2) {\n        roundedQuarterLength = 2;\n    } else if (roundedQuarterLength === 1.25) {\n        roundedQuarterLength = 1;\n    } else if (roundedQuarterLength === 0.75) {\n        roundedQuarterLength = 0.5;\n    } else if (roundedQuarterLength === 0) {\n        roundedQuarterLength = 0.125;\n    }\n    lastElement.duration.quarterLength = roundedQuarterLength;\n    return lastElement;\n};\n\n/* ----------- callbacks --------- */\n/**\n * Callback to midiEvent.sendToMIDIjs.\n *\n * @memberof music21.miditools\n * @param {music21.miditools.Event} midiEvent - event to send out.\n * @returns undefined\n */\nmiditools.sendToMIDIjs = (midiEvent) => {\n    midiEvent.sendToMIDIjs();\n};\n\n/* ------------ MIDI.js ----------- */\n\n/**\n * a mapping of soundfont text names to true, false, or \"loading\".\n *\n * @memberof music21.miditools\n * @type {object}\n */\nmiditools.loadedSoundfonts = {};\n\n/**\n * Called after a soundfont has been loaded. The callback is better to be specified elsewhere\n * rather than overriding this important method.\n *\n * @memberof music21.miditools\n * @param {String} soundfont The name of the soundfont that was just loaded\n * @param {function} callback A function to be called after the soundfont is loaded.\n */\nmiditools.postLoadCallback = function postLoadCallback(soundfont, callback) {\n    // this should be bound to MIDI\n    if (debug) {\n        console.log('soundfont loaded about to execute callback.');\n        console.log('first playing two notes very softly -- seems to flush the buffer.');\n    }\n    $('.loadingSoundfont').remove();\n\n    const isFirefox = typeof InstallTrigger !== 'undefined';   // Firefox 1.0+\n    const isAudioTag = (MIDI.technology === 'HTML Audio Tag');\n    const instrumentObj = instrument.find(soundfont);\n    if (instrumentObj !== undefined) {\n        MIDI.programChange(instrumentObj.midiChannel, instrumentObj.midiProgram);\n        if (debug) {\n            console.log(soundfont + ' (' + instrumentObj.midiProgram + ') loaded on ', instrumentObj.midiChannel);\n        }\n        if ((isFirefox === false) && (isAudioTag === false)) {\n            const c = instrumentObj.midiChannel;\n            // Firefox ignores sound volume! so don't play! as does IE and others using HTML audio tag.\n            MIDI.noteOn(c, 36, 1, 0);     // if no notes have been played before then\n            MIDI.noteOff(c, 36, 1, 0.1);  // the second note to be played is always\n            MIDI.noteOn(c, 48, 1, 0.2);   // very clipped (on Safari at least)\n            MIDI.noteOff(c, 48, 1, 0.3);  // this helps a lot.\n            MIDI.noteOn(c, 60, 1, 0.3);   // chrome needs three?\n            MIDI.noteOff(c, 60, 1, 0.4);\n        }\n    }\n    if (callback !== undefined) {\n        callback(instrumentObj);\n    }\n    miditools.loadedSoundfonts[soundfont] = true;\n};\n\n\n/**\n * method to load soundfonts while waiting for other processes that need them\n * to load first.\n *\n * @memberof music21.miditools\n * @param {String} soundfont The name of the soundfont that was just loaded\n * @param {function} callback A function to be called after the soundfont is loaded.\n * @example\n * s = new music21.stream.Stream();\n * music21.miditools.loadSoundfont(\n *     'clarinet',\n *     function(i) {\n *         console.log('instrument object', i, 'loaded');\n *         s.instrument = i;\n * });\n */\nmiditools.loadSoundfont = function loadSoundfont(soundfont, callback) {\n    if (miditools.loadedSoundfonts[soundfont] === true) {\n        if (callback !== undefined) {\n            const instrumentObj = instrument.find(soundfont);\n            callback(instrumentObj);\n        }\n    } else if (miditools.loadedSoundfonts[soundfont] === 'loading') {\n        const waitThenCall = () => {\n            if (miditools.loadedSoundfonts[soundfont] === true) {\n                if (debug) {\n                    console.log('other process has finished loading; calling callback');\n                }\n                if (callback !== undefined) {\n                    const instrumentObj = instrument.find(soundfont);\n                    callback(instrumentObj);\n                }\n            } else {\n                if (debug) {\n                    console.log('waiting for other process load');\n                }\n                setTimeout(waitThenCall, 100);\n            }\n        };\n        waitThenCall();\n    } else {\n        miditools.loadedSoundfonts[soundfont] = 'loading';\n        if (debug) {\n            console.log('waiting for document ready');\n        }\n        $(document).ready(() => {\n            if (debug) {\n                console.log('document ready, waiting to load soundfont');\n            }\n            $(document.body).append($(\"<div class='loadingSoundfont'><b>Loading MIDI Instrument</b>: \" +\n                                      'audio will begin when this message disappears.</div>'));\n            MIDI.loadPlugin({\n                soundfontUrl: music21.soundfontUrl,\n                instrument: soundfont,\n                onsuccess: miditools.postLoadCallback.bind(MIDI, soundfont, callback),\n            });\n        });\n    }\n};\n\n/**\n * MidiPlayer -- embedded midi player.\n *\n * @class MidiPlayer\n * @memberOf music21.miditools\n * @property {number} speed - playback speed scaling (1=default).\n * @property {JQueryDOMObject|undefined} $playDiv - div holding the player,\n */\nexport class MidiPlayer {\n    constructor() {\n        this.player = new music21.MIDI.Players.PlayInstance();\n        this.speed = 1.0;\n        this.$playDiv = undefined;        \n    }\n    /**\n     * @param where\n     * @returns DOMElement\n     */\n    addPlayer(where) {\n        let $where = where;\n        if (where === undefined) {\n            where = document.body;\n        }\n        if (where.jquery === undefined) {\n            $where = $(where);\n        }\n        const $playDiv = $('<div class=\"midiPlayer\">');\n        const $controls = $('<div class=\"positionControls\">');\n        const $playPause = $('<input type=\"image\" src=\"' + music21.m21basePath + '/css/play.png\" align=\"absmiddle\" value=\"play\" class=\"playPause\">');\n        const $stop = $('<input type=\"image\" src=\"' + music21.m21basePath + '/css/stop.png\" align=\"absmiddle\" value=\"stop\" class=\"stopButton\">');\n\n        $playPause.on('click', this.pausePlayStop.bind(this));\n        $stop.on('click', this.stopButton.bind(this));\n        $controls.append($playPause);\n        $controls.append($stop);\n        $playDiv.append($controls);\n\n        const $time = $('<div class=\"timeControls\">');\n        const $timePlayed = $('<span class=\"timePlayed\">0:00</span>');\n        const $capsule = $('<span class=\"capsule\"><span class=\"cursor\"></span></span>');\n        const $timeRemaining = $('<span class=\"timeRemaining\">-0:00</span>');\n        $time.append($timePlayed);\n        $time.append($capsule);\n        $time.append($timeRemaining);\n        $playDiv.append($time);\n\n        $where.append($playDiv);\n        this.$playDiv = $playDiv;\n        return $playDiv;\n    };\n\n    stopButton() {\n        this.pausePlayStop('yes');\n    };\n\n    pausePlayStop(stop) {\n        let d;\n        if (this.$playDiv === undefined) {\n            d = { src: 'doesnt matter' };\n        } else {\n            d = this.$playDiv.find('.playPause')[0];\n        }\n        if (stop === 'yes') {\n            this.player.stop();\n            d.src = music21.m21basePath + '/css/play.png';\n        } else if (this.player.playing || stop === 'pause') {\n            d.src = music21.m21basePath + '/css/play.png';\n            this.player.pause(true);\n        } else {\n            d.src = music21.m21basePath + '/css/pause.png';\n            this.player.resume();\n        }\n    };\n\n\n    base64Load(b64data) {\n        const player = this.player;\n        player.timeWarp = this.speed;\n\n        const m21midiplayer = this;\n        miditools.loadSoundfont('acoustic_grand_piano', () => {\n            player.loadFile(b64data, () => {   // success\n                m21midiplayer.fileLoaded();\n            },\n            undefined,  // loading\n            (e) => {  // failure\n                console.log(e);\n            });\n        });\n    };\n\n    songFinished() {\n        this.pausePlayStop('yes');\n    };\n\n    fileLoaded() {\n        this.updatePlaying();\n    };\n\n    startAndUpdate() {\n        this.player.start();\n        this.updatePlaying();\n    };\n\n\n    updatePlaying() {\n        const self = this;\n        const player = this.player;\n        if (this.$playDiv === undefined) {\n            return;\n        }\n        const $d = this.$playDiv;\n        // update the timestamp\n        const timePlayed = $d.find('.timePlayed')[0];\n        const timeRemaining = $d.find('.timeRemaining')[0];\n        const timeCursor = $d.find('.cursor')[0];\n        const $capsule = $d.find('.capsule');\n        //\n        eventjs.add($capsule[0], 'drag', (event, self) => {\n            eventjs.cancel(event);\n            const player = this.player;\n            player.currentTime = (self.x) / 420 * player.endTime;\n            if (player.currentTime < 0) {\n                player.currentTime = 0;\n            }\n            if (player.currentTime > player.endTime) {\n                player.currentTime = player.endTime;\n            }\n            if (self.state === 'down') {\n                this.pausePlayStop('pause');\n            } else if (self.state === 'up') {\n                this.pausePlayStop('play');\n            }\n        });\n        //\n        function timeFormatting(n) {\n            const minutes = n / 60 >> 0;\n            let seconds = String(n - (minutes * 60) >> 0);\n            if (seconds.length === 1) {\n                seconds = '0' + seconds;\n            }\n            return minutes + ':' + seconds;\n        }\n\n        player.setAnimation((data) => {\n            const percent = data.now / data.end;\n            const now = data.now >> 0; // where we are now\n            const end = data.end >> 0; // end of song\n            if (now === end) { // go to next song\n                self.songFinished();\n            }\n            // display the information to the user\n            timeCursor.style.width = (percent * 100) + '%';\n            timePlayed.innerHTML = timeFormatting(now);\n            timeRemaining.innerHTML = '-' + timeFormatting(end - now);\n        });\n    }\n}\nmiditools.MidiPlayer = MidiPlayer;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/keyboard -- PianoKeyboard rendering and display objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\n\n// Minimum usage:\n\n// var kd = document.getElementById('keyboardDiv');\n// k = new music21.keyboard.Keyboard();\n// k.appendKeyboard(kd, 6, 57); // 88 key keyboard\n\n// configurable:\n// k.scaleFactor = 1.2;  // default 1\n// k.whiteKeyWidth = 40; // default 23\nimport * as $ from 'jquery';\nimport * as MIDI from 'MIDI';\n\nimport { common } from './common';\nimport { miditools } from './miditools';\nimport { pitch } from './pitch';\n\n\n/**\n * Keyboard module, see {@link music21.keyboard} namespace\n *\n * @exports music21/keyboard\n */\n/**\n * keyboard namespace -- tools for creating an onscreen keyboard and interacting with it.\n *\n * @namespace music21.keyboard\n * @memberof music21\n * @requires music21/pitch\n * @requires music21/common\n * @requires music21/miditools\n * @requires jquery\n * @requires MIDI\n */\nexport const keyboard = {};\n/**\n * Represents a single Key\n *\n * @class Key\n * @memberof music21.keyboard\n * @property {Array<function>} callbacks - called when key is clicked/selected\n * @property {number} [scaleFactor=1]\n * @property {music21.keyboard.Keyboard|undefined} parent\n * @property {Int} id - midinumber associated with the key.\n * @property {music21.pitch.Pitch|undefined} pitchObj\n * @property {DOMObject|undefined} svgObj - SVG representing the drawing of the key\n * @property {DOMObject|undefined} noteNameSvgObj - SVG representing the note name drawn on the key\n * @property {string} keyStyle='' - css style information for the key\n * @property {string} keyClass='' - css class information for the key (\"keyboardkey\" + this is the class)\n * @property {number} width - width of key\n * @property {number} height - height of key\n */\nexport class Key {\n    constructor() {\n        this.classes = ['Key']; // name conflict with key.Key\n        this.callbacks = [];\n        this.scaleFactor = 1;\n        this.parent = undefined;\n        this.id = 0;\n        this.width = 23;\n        this.height = 120;\n        this.pitchObj = undefined;\n        this.svgObj = undefined;\n        this.noteNameSvgObj = undefined;\n        this.keyStyle = '';\n        this.keyClass = '';\n    }\n    /**\n     * Gets an SVG object for the key\n     *\n     * @method music21.keyboard.Key#makeKey\n     * @memberof music21.keyboard.Key\n     * @param {number} startX - X position in pixels from left of keyboard to draw key at\n     * @returns {DOMObject} a SVG rectangle for the key\n     */\n    makeKey(startX) {\n        const keyattrs = {\n            style: this.keyStyle,\n            x: startX,\n            y: 0,\n            'class': 'keyboardkey ' + this.keyClass,\n            'id': this.id,\n            width: this.width * this.scaleFactor,\n            height: this.height * this.scaleFactor,\n        };\n        const keyDOM = common.makeSVGright('rect', keyattrs);\n        for (const x in this.callbacks) {\n            if ({}.hasOwnProperty.call(this.callbacks, x)) {\n                keyDOM.addEventListener(x, this.callbacks[x], false);\n            }\n        }\n        this.svgObj = keyDOM;\n        return keyDOM;\n    }\n    /**\n     * Adds a circle (red) on the key (to mark middle C etc.)\n     *\n     * @method music21.keyboard.Key#addCircle\n     * @param {string} [strokeColor='red']\n     * @returns {DOMObject}\n     */\n    addCircle(strokeColor) {\n        if ((this.svgObj === undefined) ||\n                (this.parent === undefined) ||\n                (this.parent.svgObj === undefined)\n        ) {\n            return undefined;\n        }\n        if (strokeColor === undefined) {\n            strokeColor = 'red';\n        }\n        const x = parseInt(this.svgObj.getAttribute('x'));\n        const cx = x + this.parent.scaleFactor * (this.width) / 2;\n        // console.log('cx', cx);\n        const keyattrs = {\n            stroke: strokeColor,\n            'stroke-width': 3,\n            fill: 'none',\n            cx,\n            cy: (this.height - 10) * this.parent.scaleFactor,\n            'class': 'keyboardkeyannotation',\n            r: this.width * this.parent.scaleFactor / 4,\n        };\n\n        const circleDom = common.makeSVGright('circle', keyattrs);\n        this.parent.svgObj.appendChild(circleDom);\n        // console.log(circleDom);\n        return circleDom;\n    }\n    /**\n     * Adds the note name on the key\n     *\n     * @method music21.keyboard.Key#addNoteName\n     * @param {Boolean} [labelOctaves=false] - use octave numbers too?\n     * @returns {DOMObject}\n     */\n    addNoteName(labelOctaves) {\n        if ((this.svgObj === undefined)\n                || (this.parent === undefined)\n                || (this.parent.svgObj === undefined)) {\n            return this;\n        }\n        if ((this.id === 0) && (this.pitchObj === undefined)) {\n            return this;\n        } else if (this.pitchObj === undefined) {\n            this.pitchObj = new pitch.Pitch();\n            this.pitchObj.ps = this.id;\n        }\n        if ((this.pitchObj.accidental !== undefined) &&\n                (this.pitchObj.accidental.alter !== 0)) {\n            return this;\n        }\n        let x = parseInt(this.svgObj.getAttribute('x'));\n        let idStr = this.pitchObj.name;\n        let fontSize = 14;\n        if (labelOctaves === true) {\n            idStr = this.pitchObj.nameWithOctave;\n            fontSize = 12;\n            x -= 2;\n        }\n        fontSize = Math.floor(fontSize * parent.scaleFactor);\n\n        let textfill = 'white';\n        if (this.keyClass === 'whitekey') {\n            textfill = 'black';\n        }\n        const textattrs = {\n            fill: textfill,\n            x: x + this.parent.scaleFactor * (this.width / 2 - 5),\n            y: this.parent.scaleFactor * (this.height - 20),\n            'class': 'keyboardkeyname',\n            'font-size': fontSize,\n        };\n\n        const textDom = common.makeSVGright('text', textattrs);\n        const textNode = document.createTextNode(idStr);\n        textDom.appendChild(textNode);\n        this.noteNameSvgObj = textDom; // store for removing...\n        this.parent.svgObj.appendChild(textDom);\n        return this;\n    }\n    /**\n     * Removes the note name from the key (if exists)\n     *\n     * @method music21.keyboard.Key#removeNoteName\n     * @returns {undefined}\n     */\n    removeNoteName() {\n        if ((this.svgObj === undefined)\n                || (this.parent === undefined)\n                || (this.parent.svgObj === undefined)\n        ) {\n            return;\n        }\n        if (this.noteNameSvgObj === undefined) {\n            return;\n        }\n        if (this.noteNameSvgObj.parentNode === this.parent.svgObj) {\n            this.parent.svgObj.removeChild(this.noteNameSvgObj);\n        }\n        this.noteNameSvgObj = undefined;\n    }\n\n}\nkeyboard.Key = Key;\n\n/**\n * Defaults for a WhiteKey (width, height, keyStyle, keyClass)\n *\n * @class WhiteKey\n * @memberof music21.keyboard\n * @extends music21.keyboard.Key\n */\nexport class WhiteKey extends Key {\n    constructor() {\n        super();\n        this.classes.push('WhiteKey');\n        this.width = 23;\n        this.height = 120;\n        this.keyStyle = 'fill:#fffff6;stroke:black';\n        this.keyClass = 'whitekey';\n    }\n}\nkeyboard.WhiteKey = WhiteKey;\n/**\n * Defaults for a BlackKey (width, height, keyStyle, keyClass)\n *\n * @class BlackKey\n * @memberof music21.keyboard\n * @extends music21.keyboard.Key\n */\nexport class BlackKey extends Key {\n    constructor() {\n        super();\n        this.classes.push('BlackKey');\n        this.width = 13;\n        this.height = 80;\n        this.keyStyle = 'fill:black;stroke:black';\n        this.keyClass = 'blackkey';\n    }\n}\n\nkeyboard.BlackKey = BlackKey;\n\n\n/**\n * A Class representing a whole Keyboard full of keys.\n *\n * @class Keyboard\n * @memberof music21.keyboard\n * @property {number} whiteKeyWidth - default 23\n * @property {number} scaleFactor - default 1\n * @property {object} keyObjects - a mapping of id to {@link music21.keyboard.Key} objects\n * @property {DOMObject} svgObj - the SVG object of the keyboard\n * @property {Boolean} markC - default true\n * @property {Boolean} showNames - default false\n * @property {Boolean} showOctaves - default false\n * @property {string} startPitch - default \"C3\"\n * @property {string} endPitch - default \"C5\"\n * @property {Boolean} hideable - default false -- add a way to hide and show keyboard\n * @property {Boolean} scrollable - default false -- add scroll bars to change octave\n */\nexport class Keyboard {\n    constructor() {\n        this.whiteKeyWidth = 23;\n        this._defaultWhiteKeyWidth = 23;\n        this._defaultBlackKeyWidth = 13;\n        this.scaleFactor = 1;\n        this.height = 120; // does nothing right now...\n        this.keyObjects = {};\n        this.svgObj = undefined;\n\n        this.markC = true;\n        this.showNames = false;\n        this.showOctaves = false;\n\n        this.startPitch = 'C3';\n        this.endPitch = 'C5';\n        this._startDNN = undefined;\n        this._endDNN = undefined;\n\n        this.hideable = false;\n        this.scrollable = false;\n        /**\n         * An object of callbacks on events.\n         *\n         * default:\n         *\n         * - click: this.clickhandler\n         *\n         * @name callbacks\n         * @type {object}\n         * @memberof music21.keyboard.Keyboard#\n         */\n        this.callbacks = {\n            click: this.clickhandler,\n        };\n        //   more accurate offsets from http://www.mathpages.com/home/kmath043.htm\n        this.sharpOffsets = { 0: 14.3333, 1: 18.6666, 3: 13.25, 4: 16.25, 5: 19.75 };\n    }\n    /**\n     * Redraws the SVG associated with this Keyboard\n     *\n     * @method music21.keyboard.Keyboard#redrawSVG\n     * @returns {DOMObject} new svgDOM\n     */\n    redrawSVG() {\n        if (this.svgObj === undefined) {\n            return undefined;\n        }\n        const oldSVG = this.svgObj;\n        const svgParent = oldSVG.parentNode;\n        this.keyObjects = {};\n        const svgDOM = this.createSVG();\n        svgParent.replaceChild(svgDOM, oldSVG);\n        return svgDOM;\n    }\n    /**\n     * Appends a keyboard to the `where` parameter\n     *\n     * @method music21.keyboard.Keyboard#appendKeyboard\n     * @param {JQueryDOMObject|DOMObject} [where]\n     * @returns {music21.keyboard.Keyboard} this\n     */\n    appendKeyboard(where) {\n        if (where === undefined) {\n            where = document.body;\n        } else if (where.jquery !== undefined) {\n            where = where[0];\n        }\n\n        let svgDOM = this.createSVG();\n\n        if (this.scrollable) {\n            svgDOM = this.wrapScrollable(svgDOM)[0];\n        }\n\n        if (this.hideable) {\n            // make it so the keyboard can be shown or hidden...\n            this.appendHideableKeyboard(where, svgDOM);\n        } else {\n            where.appendChild(svgDOM); // svg must use appendChild, not append.\n        }\n        return this;\n    }\n    /**\n     * Handle a click on a given SVG object\n     *\n     * @method music21.keyboard.Keyboard#clickhandler\n     * @param {DOMObject} keyRect - the dom object with the keyboard.\n     */\n    clickhandler(keyRect) {\n        // to-do : integrate with jazzHighlight...\n        const id = keyRect.id;\n        const thisKeyObject = this.keyObjects[id];\n        if (thisKeyObject === undefined) {\n            return; // not on keyboard;\n        }\n        const storedStyle = thisKeyObject.keyStyle;\n        let fillColor = '#c0c000';\n        if (thisKeyObject.keyClass === 'whitekey') {\n            fillColor = 'yellow';\n        }\n        keyRect.setAttribute('style', 'fill:' + fillColor + ';stroke:black');\n        miditools.loadSoundfont('acoustic_grand_piano', (i) => {\n            MIDI.noteOn(i.midiChannel, id, 100, 0);\n            MIDI.noteOff(i.midiChannel, id, 500);\n        });\n        setTimeout(() => {\n            keyRect.setAttribute('style', storedStyle);\n        }, 500);\n    }\n\n    /**\n     * Draws the SVG associated with this Keyboard\n     *\n     * @method music21.keyboard.Keyboard#createSVG\n     * @returns {DOMObject} new svgDOM\n     */\n    createSVG() {\n        // DNN = pitch.diatonicNoteNum;\n        // this._endDNN = final key note. I.e., the last note to be included, not the first note not included.\n        // 6, 57 gives a standard 88-key keyboard;\n        if (this._startDNN === undefined) {\n            if (typeof this.startPitch === 'string') {\n                const tempP = new pitch.Pitch(this.startPitch);\n                this._startDNN = tempP.diatonicNoteNum;\n            }  else {\n                this._startDNN = this.startPitch;\n            }\n        }\n\n        if (this._endDNN === undefined) {\n            if (typeof this.endPitch === 'string') {\n                const tempP = new pitch.Pitch(this.endPitch);\n                this._endDNN = tempP.diatonicNoteNum;\n            } else {\n                this._endDNN = this.endPitch;\n            }\n        }\n\n        let currentIndex = (this._startDNN - 1) % 7; // C = 0\n        const keyboardDiatonicLength = 1 + this._endDNN - this._startDNN;\n        const totalWidth = this.whiteKeyWidth * this.scaleFactor * keyboardDiatonicLength;\n        const height = 120 * this.scaleFactor;\n        const heightString = height.toString() + 'px';\n\n        const svgDOM = common.makeSVGright('svg', {\n            'xml:space': 'preserve',\n            'height': heightString,\n            'width': totalWidth.toString() + 'px',\n            'class': 'keyboardSVG',\n        });\n        const movingPitch = new pitch.Pitch('C4');\n        const blackKeys = [];\n        const thisKeyboardObject = this;\n\n        for (let wki = 0; wki < keyboardDiatonicLength; wki++) {\n            movingPitch.diatonicNoteNum = this._startDNN + wki;\n            const wk = new keyboard.WhiteKey();\n            wk.id = movingPitch.midi;\n            wk.parent = this;\n            this.keyObjects[movingPitch.midi] = wk;\n            wk.scaleFactor = this.scaleFactor;\n            wk.width = this.whiteKeyWidth;\n            wk.callbacks.click = function whitekeyCallbacksClick() { thisKeyboardObject.clickhandler(this); };\n\n            const wkSVG = wk.makeKey(this.whiteKeyWidth * this.scaleFactor * wki);\n            svgDOM.appendChild(wkSVG);\n\n            if (((currentIndex === 0)\n                    || (currentIndex === 1)\n                    || (currentIndex === 3)\n                    || (currentIndex === 4)\n                    || (currentIndex === 5)) && (wki !== keyboardDiatonicLength - 1)) {\n                // create but do not append blackkey to the right of whitekey\n                const bk = new keyboard.BlackKey();\n                bk.id = movingPitch.midi + 1;\n                this.keyObjects[movingPitch.midi + 1] = bk;\n                bk.parent = this;\n\n                bk.scaleFactor = this.scaleFactor;\n                bk.width = this._defaultBlackKeyWidth * this.whiteKeyWidth / this._defaultWhiteKeyWidth;\n                bk.callbacks.click = function blackKeyClicksCallback() { thisKeyboardObject.clickhandler(this); };\n\n                let offsetFromWhiteKey = this.sharpOffsets[currentIndex];\n                offsetFromWhiteKey *= this.whiteKeyWidth / this._defaultWhiteKeyWidth * this.scaleFactor;\n                const bkSVG = bk.makeKey(this.whiteKeyWidth * this.scaleFactor * wki + offsetFromWhiteKey);\n                blackKeys.push(bkSVG);\n            }\n            currentIndex += 1;\n            currentIndex %= 7;\n        }\n        // append blackkeys later since they overlap white keys;\n        for (let bki = 0; bki < blackKeys.length; bki++) {\n            svgDOM.appendChild(blackKeys[bki]);\n        }\n\n        this.svgObj = svgDOM;\n        if (this.markC) { this.markMiddleC(); }\n        if (this.showNames) { this.markNoteNames(this.showOctaves); }\n\n        return svgDOM;\n    }\n\n    /**\n     * Puts a circle on middle c.\n     *\n     * @method music21.keyboard.Keyboard#markMiddleC\n     * @param {string} [strokeColor='red']\n     */\n    markMiddleC(strokeColor) {\n        const midC = this.keyObjects[60];\n        if (midC !== undefined) {\n            midC.addCircle('red');\n        }\n    }\n    /**\n     * Puts note names on every white key.\n     *\n     * @method music21.keyboard.Keyboard#markNoteNames\n     * @param {Boolean} [labelOctaves=false]\n     */\n    markNoteNames(labelOctaves) {\n        this.removeNoteNames(); // in case...\n        for (const midi in this.keyObjects) {\n            if ({}.hasOwnProperty.call(this.keyObjects, midi)) {\n                const keyObj = this.keyObjects[midi];\n                keyObj.addNoteName(labelOctaves);\n            }\n        }\n    }\n\n    /**\n     * Remove note names on the keys, if they exist\n     *\n     * @method music21.keyboard.Keyboard#removeNoteNames\n     */\n    removeNoteNames() {\n        for (const midi in this.keyObjects) {\n            if ({}.hasOwnProperty.call(this.keyObjects, midi)) {\n                const keyObj = this.keyObjects[midi];\n                keyObj.removeNoteName();\n            }\n        }\n    }\n\n\n    /**\n     * Wraps the SVG object inside a scrollable set of buttons\n     *\n     * Do not call this directly, just use createSVG after changing the\n     * scrollable property on the keyboard to True.\n     *\n     * @method music21.keyboard.Keyboard#wrapScrollable\n     * @param {DOMObject} svgDOM\n     * @returns {JQueryDOMObject}\n     */\n    wrapScrollable(svgDOM) {\n        const $wrapper = $(\"<div class='keyboardScrollableWrapper'></div>\").css({\n            display: 'inline-block',\n        });\n        const $bDown = $(\"<button class='keyboardOctaveDown'>&lt;&lt;</button>\").css({\n            'font-size': Math.floor(this.scaleFactor * 15).toString() + 'px',\n        }).bind('click', () => {\n            miditools.transposeOctave -= 1;\n            this._startDNN -= 7;\n            this._endDNN -= 7;\n            this.redrawSVG();\n        });\n        const $bUp = $(\"<button class='keyboardOctaveUp'>&gt;&gt;</button>\").css({\n            'font-size': Math.floor(this.scaleFactor * 15).toString() + 'px',\n        }).bind('click', () => {\n            miditools.transposeOctave += 1;\n            this._startDNN += 7;\n            this._endDNN += 7;\n            this.redrawSVG();\n        });\n        const $kWrapper = $(\"<div style='display:inline-block; vertical-align: middle' class='keyboardScrollableInnerDiv'></div>\");\n        $kWrapper[0].appendChild(svgDOM);\n        $wrapper.append($bDown);\n        $wrapper.append($kWrapper);\n        $wrapper.append($bUp);\n        return $wrapper;\n    }\n    /**\n     * Puts a hideable keyboard inside a Div with the proper controls.\n     *\n     * Do not call this directly, just use createSVG after changing the\n     * hideable property on the keyboard to True.\n     *\n     * @method music21.keyboard.Keyboard#appendHideableKeyboard\n     * @param {DOMObject} where\n     * @param {DOMObject} keyboardSVG\n     */\n    appendHideableKeyboard(where, keyboardSVG) {\n        const $container = $(\"<div class='keyboardHideableContainer'/>\");\n        const $bInside = $(\"<div class='keyboardToggleInside'>â†¥</div>\").css({\n            display: 'inline-block',\n            'padding-top': '40px',\n            'font-size': '40px',\n        });\n        const $b = $(\"<div class='keyboardToggleOutside'/>\").css({\n            display: 'inline-block',\n            'vertical-align': 'top',\n            background: 'white',\n        });\n        $b.append($bInside);\n        $b.data('defaultDisplay', $container.find('.keyboardSVG').css('display'));\n        $b.data('state', 'down');\n        $b.click(keyboard.triggerToggleShow);\n        const $explain = $(\"<div class='keyboardExplain'>Show keyboard</div>\")\n        .css({\n            'display': 'none',\n            'background-color': 'white',\n            'padding': '10px 10px 10px 10px',\n            'font-size': '12pt',\n        });\n        $b.append($explain);\n        $container.append($b);\n        $container[0].appendChild(keyboardSVG); // svg must use appendChild, not append.\n        $(where).append($container);\n        return $container;\n    }\n}\n\n/**\n * triggerToggleShow -- event for keyboard is shown or hidden.\n *\n * @function music21.keyboard.triggerToggleShow\n * @param {Event} e\n */\nkeyboard.triggerToggleShow = function triggerToggleShow(e) {\n    // \"this\" refers to the object clicked\n    // e -- event is not used.\n    const $t = $(this);\n    const state = $t.data('state');\n    const $parent = $t.parent();\n    let $k = $parent.find('.keyboardScrollableWrapper');\n    if ($k.length === 0) { // not scrollable\n        $k = $parent.find('.keyboardSVG');\n    }\n    const $bInside = $t.find('.keyboardToggleInside');\n    const $explain = $parent.find('.keyboardExplain');\n    if (state === 'up') {\n        $bInside.text('â†¥');\n        $bInside.css('padding-top', '40px');\n        $explain.css('display', 'none');\n        let dd = $t.data('defaultDisplay');\n        if (dd === undefined) {\n            dd = 'inline';\n        }\n        $k.css('display', dd);\n        $t.data('state', 'down');\n    } else {\n        $k.css('display', 'none');\n        $explain.css('display', 'inline-block');\n        $bInside.text('â†§');\n        $bInside.css('padding-top', '10px');\n        $t.data('state', 'up');\n    }\n};\n\n/**\n * highlight the keyboard stored in \"this\" appropriately\n *\n * @function music21.keyboard.jazzHighlight\n * @param {Event} e\n * @example\n * var midiCallbacksPlay = [music21.miditools.makeChords,\n *                          music21.miditools.sendToMIDIjs,\n *                          music21.keyboard.jazzHighlight.bind(k)];\n */\nkeyboard.jazzHighlight = function jazzHighlight(e) {\n    // e is a miditools.event object -- call with this = keyboard.Keyboard object via bind...\n    if (e === undefined) {\n        return;\n    }\n    if (e.noteOn) {\n        const midiNote = e.midiNote;\n        if (this.keyObjects[midiNote] !== undefined) {\n            const keyObj = this.keyObjects[midiNote];\n            const svgObj = keyObj.svgObj;\n            let intensityRGB = '';\n            let normalizedVelocity = (e.velocity + 25) / 127;\n            if (normalizedVelocity > 1) {\n                normalizedVelocity = 1.0;\n            }\n\n            if (keyObj.keyClass === 'whitekey') {\n                const intensity = normalizedVelocity.toString();\n                intensityRGB = 'rgba(255, 255, 0, ' + intensity + ')';\n            } else {\n                const intensity = (Math.floor(normalizedVelocity * 255)).toString();\n                intensityRGB = 'rgb(' + intensity + ',' + intensity + ',0)';\n                // console.log(intensityRGB);\n            }\n            svgObj.setAttribute('style', 'fill:' + intensityRGB + ';stroke:black');\n        }\n    } else if (e.noteOff) {\n        const midiNote = e.midiNote;\n        if (this.keyObjects[midiNote] !== undefined) {\n            const keyObj = this.keyObjects[midiNote];\n            const svgObj = keyObj.svgObj;\n            svgObj.setAttribute('style', keyObj.keyStyle);\n        }\n    }\n}; // call this with a bind(keyboard.Keyboard object)...\n\nkeyboard.Keyboard = Keyboard;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/meter -- TimeSignature objects\n *\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as Vex from 'vexflow';\nimport { base } from './base';\nimport { duration } from './duration';\n\n/**\n * meter module. See {@link music21.meter} namespace for details.\n *\n * @exports music21/meter\n */\n\n/**\n * Meter and TimeSignature Classes (esp. {@link music21.meter.TimeSignature} ) and methods.\n *\n * @namespace music21.meter\n * @memberof music21\n * @requires music21/base\n * @requires music21/duration\n */\nexport const meter = {};\n\n\n/**\n * A MUCH simpler version of the music21p TimeSignature object.\n *\n * @class TimeSignature\n * @memberof music21.meter\n * @param {string} meterString - a string (\"4/4\", \"3/8\" etc.) to initialize the TimeSignature.\n * @property {Int} [numerator=4]\n * @property {Int} [denominator=4]\n * @property {Array<Array<Int>>} beatGroups - groupings of beats; inner arrays are numerator, denominator\n * @property {string} ratioString - a string like \"4/4\"\n * @property {music21.duration.Duration} barDuration - a Duration object representing the expressed total length of the TimeSignature.\n */\nexport class TimeSignature extends base.Music21Object {\n    constructor(meterString) {\n        super();\n        this.classes.push('TimeSignature');\n        this._numerator = 4;\n        this._denominator = 4;\n        this.beatGroups = [];\n        if (typeof (meterString) === 'string') {\n            this.ratioString = meterString;\n        }\n    }\n    get numerator() {\n        return this._numerator;\n    }\n    set numerator(s) {\n        this._numerator = s;\n    }\n    get denominator() {\n        return this._denominator;\n    }\n    set denominator(s) {\n        this._denominator = s;\n    }\n    get ratioString() {\n        return this.numerator.toString() + '/' + this.denominator.toString();\n    }\n    set ratioString(meterString) {\n        const meterList = meterString.split('/');\n        this.numerator = parseInt(meterList[0]);\n        this.denominator = parseInt(meterList[1]);\n    }\n    get barDuration() {\n        const ql = 4.0 * this._numerator / this._denominator;\n        return new duration.Duration(ql);\n    }\n    /**\n     * Compute the Beat Group according to this time signature.\n     *\n     * @memberof music21.meter.TimeSignature\n     * @returns {Array<Array<Int>>} a list of numerator and denominators, find a list of beat groups.\n     */\n    computeBeatGroups() {\n        const tempBeatGroups = [];\n        let numBeats = this.numerator;\n        let beatValue = this.denominator;\n        if (beatValue < 8 && numBeats >= 5) {\n            const beatsToEighthNoteRatio = 8 / beatValue; // hopefully Int -- right Brian Ferneyhough?\n            beatValue = 8;\n            numBeats *= beatsToEighthNoteRatio;\n        }\n\n        if (beatValue >= 8) {\n            while (numBeats >= 5) {\n                tempBeatGroups.push([3, beatValue]);\n                numBeats -= 3;\n            }\n            if (numBeats === 4) {\n                tempBeatGroups.push([2, beatValue]);\n                tempBeatGroups.push([2, beatValue]);\n            } else if (numBeats > 0) {\n                tempBeatGroups.push([numBeats, beatValue]);\n            }\n        } else if (beatValue === 2) {\n            tempBeatGroups.push([1, 2]);\n        } else if (beatValue <= 1) {\n            tempBeatGroups.push([1, 1]);\n        } else { // 4/4, 2/4, 3/4, standard stuff\n            tempBeatGroups.push([2, 8]);\n        }\n        return tempBeatGroups;\n    }\n    /**\n     * Compute the Beat Group according to this time signature for VexFlow. For beaming.\n     *\n     * @memberof music21.meter.TimeSignature\n     * @param {Vex} Vex - a reference to the Vex object\n     * @returns {Array<Vex.Flow.Fraction>} a list of numerator and denominator groups, for VexFlow\n     */\n    vexflowBeatGroups() {\n        let tempBeatGroups;\n        if (this.beatGroups.length > 0) {\n            tempBeatGroups = this.beatGroups;\n        } else {\n            tempBeatGroups = this.computeBeatGroups();\n        }\n        // console.log(tempBeatGroups);\n        const vfBeatGroups = [];\n        for (let i = 0; i < tempBeatGroups.length; i++) {\n            const bg = tempBeatGroups[i];\n            vfBeatGroups.push(new Vex.Flow.Fraction(bg[0], bg[1]));\n        }\n        return vfBeatGroups;\n\n        //  if (numBeats % 3 == 0 && beatValue < 4) {\n        //  // 6/8, 3/8, 9/8, etc.\n        //  numBeats = numBeats / 3;\n        //  beatValue = beatValue / 3;\n        //  }\n    }\n}\n\nmeter.TimeSignature = TimeSignature;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/renderOptions -- an object that defines the render options for a Stream\n *\n * note: no parallel in music21p\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { common } from './common';\n/**\n * renderOptions module, see {@link music21.renderOptions}\n *\n * @exports music21/renderOptions\n */\n/**\n * Options for rendering a stream\n *\n * @namespace music21.renderOptions\n * @memberof music21\n */\nexport const renderOptions = {};\n\n/**\n * An object that contains information on rendering the current stream\n *\n * Found on every Stream as `.renderOptions`\n *\n * @class RenderOptions\n * @memberof music21.renderOptions\n */\nexport class RenderOptions {\n    constructor() {\n        const defaultOptions = {\n            displayClef: true,\n            displayTimeSignature: true,\n            displayKeySignature: true,\n\n            scaleFactor: { x: 0.7, y: 0.7 },\n\n            top: 0,\n            left: undefined,\n            width: undefined,\n            overriddenWidth: undefined,\n            height: undefined,\n            naiveHeight: 120,\n\n            systemIndex: 0,\n            partIndex: 0,\n            measureIndex: 0,\n\n            systemMeasureIndex: 0,\n            systemPadding: undefined,\n            naiveSystemPadding: 40,\n\n            stemDirection: undefined,\n\n            maxSystemWidth: undefined,\n            rightBarline: undefined,\n            staffLines: 5,\n            staffConnectors: ['single', 'brace'],\n            staffPadding: 60,\n            events: {\n                'click': 'play',\n                'dblclick': undefined,\n                // resize\n            },\n            startNewSystem: false,\n            startNewPage: false,\n            showMeasureNumber: undefined,\n        };\n        common.merge(this, defaultOptions);\n    }\n}\nrenderOptions.RenderOptions = RenderOptions\n","import * as $ from 'jquery';\nimport { common } from './common';\n\n/**\n * module with tools for working with Streams. See {@link music21.streamInteraction} namespace.\n *\n * @exports music21/streamInteraction\n */\n/**\n * Objects that work with Streams to provide interactions\n *\n * @namespace music21.streamInteraction\n * @memberof music21\n * @requires music21/common\n * @requires music21/stream\n */\nexport const streamInteraction = {};\n\n/**\n * Object for adding scrolling while playing.\n *\n * @class ScrollPlayer\n * @memberof music21.streamInteraction\n * @param {music21.stream.Stream} s -- Stream\n * @param {canvas} c -- canvas\n * @property {music21.streamInteraction.PixelMapper} pixelMapper - an object that can map current pixel to notes and vice versa.\n * @property {number} [tempo=s.tempo]\n * @property {number} lastX - last X value\n * @property {Int} lastNoteIndex - index of last note played\n * @property {SVGDOMObject} barDOM - DOM object representing the scrolling bar\n * @property {SVGDOMObject} svgDOM - DOM object holding the scrolling bar (overlaid on top of canvas)\n * @property {DOMObject} canvasParent - the parent DOM object for `this.canvas`\n * @property {Int} lastTimeout - a numerical reference to a timeout object created by `setTimeout`\n * @property {number} startTime - the time in ms when the scrolling started\n * @property {Int} [previousSystemIndex=0] - the last systemIndex being scrolled\n * @property {number} [eachSystemHeight=120] - currently all systems need to have the same height.\n * @property {Int} [timingMS=50] - amount of time between polls to scroll\n * @property {function} savedRenderOptionClick - starting ScrollPlayer overrides the `'click'` event for the stream, switching it to Stop. this saves it for restoring later.\n */\nexport class ScrollPlayer {\n    constructor(s, c) {\n        this.pixelMapper = new streamInteraction.PixelMapper(s);\n        this.stream = s;\n        this.canvas = c;\n        this.tempo = s.tempo;\n        this.lastX = 0;\n        this.lastNoteIndex = -1;\n        this.barDOM = undefined;\n        this.svgDOM = undefined;\n        this.canvasParent = undefined;\n        this.lastTimeout = undefined;\n        this.startTime = new Date().getTime();\n        this.previousSystemIndex = 0;\n        this.eachSystemHeight = 120;\n        this.timingMS = 50;\n        this.savedRenderOptionClick = undefined;\n        /**\n         * function, bound to `this` to scroll the barDOM.\n         *\n         * calls itself until a stop click is received or the piece ends.\n         *\n         * @method streamInteraction.ScrollPlayer#scrollScore\n         * @memberof music21.streamInteraction.ScrollPlayer\n         */\n        this.scrollScore = (function scrollScore() {\n            const timeSinceStartInMS = new Date().getTime() - this.startTime;\n            const offset = timeSinceStartInMS / 1000 * this.tempo / 60;\n            const pm = this.pixelMapper;\n            const systemIndex = pm.getSystemIndexAtOffset(offset);\n\n            if (systemIndex > this.previousSystemIndex) {\n                this.lastX = -100; // arbitrary negative...\n                this.previousSystemIndex = systemIndex;\n                this.barDOM.setAttribute('y', systemIndex * this.eachSystemHeight);\n            }\n            let x = pm.getXAtOffset(offset);\n            x = Math.floor(x);\n\n            // console.log(x);\n\n            if (x > this.lastX) {\n                this.barDOM.setAttribute('x', x);\n                this.lastX = x;\n            }\n            // pm is a pixelMap not a Stream\n            for (let j = 0; j < pm.allMaps.length; j++) {\n                const pmOff = pm.allMaps[j].offset;\n                if (j <= this.lastNoteIndex)  {\n                    continue;\n                } else if (Math.abs(offset - pmOff) > 0.1) {\n                    continue;\n                }\n                const elList = pm.allMaps[j].elements;\n                for (let elIndex = 0; elIndex < elList.length; elIndex++) {\n                    const el = elList[elIndex];\n                    if (el !== undefined && el.playMidi !== undefined) {\n                        el.playMidi(this.tempo);\n                    }\n                }\n                this.lastNoteIndex = j;\n            }\n            // console.log(x, offset);\n            // console.log(barDOM.setAttribute);\n            let newTimeout;\n            if (x < pm.maxX || systemIndex < pm.maxSystemIndex) {\n                // console.log(x, pm.maxX);\n                newTimeout = setTimeout(this.scrollScore, this.timingMS);\n                this.lastTimeout = newTimeout;\n            } else {\n                const fauxEvent = undefined;\n                this.stopPlaying(fauxEvent);\n            }\n        }).bind(this);\n    }\n\n\n    /**\n     * Create the scrollbar (barDOM), the svg to place it in (svgDOM)\n     * and append it over the stream.\n     *\n     * Sets as a consequence:\n     * - this.barDOM\n     * - this.svgDOM\n     * - this.eachSystemHeight\n     * - this.canvasParent\n     *\n     * @memberof music21.streamInteraction.ScrollPlayer\n     * @returns {SVGDOMObject} scroll bar\n     */\n    createScrollBar() {\n        const canvas = this.canvas;\n        const svgDOM = common.makeSVGright('svg', {\n            'height': canvas.height.toString() + 'px',\n            'width': canvas.width.toString() + 'px',\n            'style': 'position:absolute; top: 0px; left: 0px;',\n        });\n        const scaleY = this.stream.renderOptions.scaleFactor.y;\n        const eachSystemHeight = canvas.height / (scaleY * (this.pixelMapper.maxSystemIndex + 1));\n        const barDOM = common.makeSVGright('rect', {\n            width: 10,\n            height: eachSystemHeight - 6,  // small fudge for separation\n            x: this.pixelMapper.startX,\n            y: 3,\n            style: 'fill: rgba(255, 255, 20, .5);stroke:white',\n        });\n        barDOM.setAttribute('transform', 'scale(' + scaleY  + ')');\n        svgDOM.appendChild(barDOM);\n\n        const canvasParent = $(canvas).parent()[0];\n        canvasParent.appendChild(svgDOM);\n        this.barDOM = barDOM;\n        this.svgDOM = svgDOM;\n        this.canvasParent = canvasParent;\n        this.eachSystemHeight = eachSystemHeight;\n        return barDOM;\n    }\n\n    /**\n     * start playing! Create a scroll bar and start scrolling\n     *\n     * (set this to an event on stream, or something...)\n     *\n     * currently called from {@link music21.stream.Stream#scrollScoreStart} via\n     * {@link music21.stream.Stream#renderScrollableCanvas}. Will change.\n     *\n     * @memberof music21.streamInteraction.ScrollPlayer\n     */\n    startPlaying() {\n        this.createScrollBar();\n\n        this.savedRenderOptionClick = this.stream.renderOptions.events.click;\n        this.stream.renderOptions.events.click = (function startPlayingClick(e) { this.stopPlaying(e); }).bind(this);\n        this.stream.setRenderInteraction(this.canvasParent);\n        this.scrollScore();\n    }\n\n    /**\n     * Called when the ScrollPlayer should stop playing\n     *\n     * @memberof music21.streamInteraction.ScrollPlayer\n     * @param {DOMEvent} [event]\n     */\n    stopPlaying(event) {\n        this.stream.renderOptions.events.click = this.savedRenderOptionClick;\n        this.barDOM.setAttribute('style', 'display:none');\n        // TODO: generalize...\n        this.canvasParent.removeChild(this.svgDOM);\n        if (this.lastTimeout !== undefined) {\n            clearTimeout(this.lastTimeout);\n        }\n        this.stream.setRenderInteraction(this.canvasParent);\n        if (event !== undefined) {\n            event.stopPropagation();\n        }\n    }\n}\nstreamInteraction.ScrollPlayer = ScrollPlayer;\n\n\n/**\n * A `PixelMapper` is an object that knows how to map offsets to pixels on a flat Stream.\n *\n * Helper for ScrollPlayer and soon other places...\n *\n * @class PixelMapper\n * @memberof music21.streamInteraction\n * @param {music21.stream.Stream} s - stream object\n * @property {Array<music21.streamInteraction.PixelMap>} allMaps - a `PixelMap` object for each offset in the Stream and one additional one for the end of the Stream.\n * @property {music21.stream.Stream} s - stream object\n * @property {music21.stream.Stream} notesAndRests - `this.stream.flat.notesAndRests`\n * @property {number} pixelScaling - `this.stream.renderOptions.scaleFactor.x`\n * @property {number} startX - (readonly) starting x\n * @property {number} maxX - (readonly) ending x\n * @property {Int} maxSystemIndex - the index of the last system.\n */\nexport class PixelMapper {\n    constructor(s) {\n        this.allMaps = [];\n        this.stream = s;\n        this.notesAndRests = this.stream.flat.notesAndRests;\n        this.pixelScaling = s.renderOptions.scaleFactor.x;\n        this.processStream(s);\n    }\n    get startX() {\n        return this.allMaps[0].x;\n    }\n    get maxX() {\n        const m = this.allMaps[this.allMaps.length - 1];\n        return m.x;\n    }\n    get maxSystemIndex() {\n        return this.allMaps[this.allMaps.length - 1].systemIndex;\n    }\n    /**\n     * Creates `PixelMap` objects for every note in the stream, and an extra\n     * one mapping the end of the final offset.\n     *\n     * @memberof music21.streamInteraction.PixelMapper\n     * @returns {Array<music21.streamInteraction.PixelMap>}\n     */\n    processStream() {\n        const ns = this.notesAndRests;\n        for (let i = 0; i < ns.length; i++) {\n            const n = ns.get(i);\n            this.addNoteToMap(n);\n        }\n        // prepare final map.\n        const finalStave =  ns.get(-1).activeVexflowNote.stave;\n        const finalX = (finalStave.x + finalStave.width);\n        const endOffset = ns.get(-1).duration.quarterLength + ns.get(-1).offset;\n\n        const lastMap = new streamInteraction.PixelMap(this, endOffset);\n        lastMap.elements = [undefined];\n        lastMap.x = finalX;\n        lastMap.systemIndex = this.allMaps[this.allMaps.length - 1].systemIndex;\n        this.allMaps.push(lastMap);\n        return this.allMaps;\n    }\n\n\n    /**\n     * Adds a {@link music21.base.Music21Object}, usually a {@link music21.note.Note} object,\n     * to the maps for the PixelMapper if a {@link music21.streamInteraction.PixelMap} object\n     * already exists at that location, or creates a new `PixelMap` if one does not exist.\n     *\n     * @memberof music21.streamInteraction.PixelMapper\n     * @param {music21.base.Music21Object} n - note or other object\n     * @returns {music21.streamInteraction.PixelMap} PixelMap added to.\n     */\n    addNoteToMap(n) {\n        const currentOffset = n.offset;\n        const properMap = this.findMapForExactOffset(currentOffset);\n        if (properMap !== undefined) {\n            properMap.elements.push(n);\n            return properMap;\n        } else {\n            const pmap = new streamInteraction.PixelMap(this, currentOffset);\n            pmap.elements = [n];\n            this.allMaps.push(pmap);\n            return pmap;\n        }\n    }\n    /**\n     * Finds a `PixelMap` object if one matches this exact offset. Otherwise returns undefined\n     *\n     * @memberof music21.streamInteraction.PixelMapper\n     * @param {number} o offset\n     * @returns {music21.streamInteraction.PixelMap|undefined}\n     */\n    findMapForExactOffset(o) {\n        for (let j = this.allMaps.length - 1; j >= 0; j -= 1) {\n            // find the last map with this offset. searches backwards for speed.\n            if (this.allMaps[j].offset === o) {\n                return this.allMaps[j];\n            }\n        }\n        return undefined;\n    }\n\n    /**\n     *  returns an array of two pixel maps: the previous/current one and the\n            next/current one (i.e., if the offset is exactly the offset of a pixel map\n            the prevNoteMap and nextNoteMap will be the same; similarly if the offset is\n            beyond the end of the score)\n\n     * @memberof music21.streamInteraction.PixelMapper\n     * @param {number} offset\n     * @returns {Array<music21.streamInteraction.PixelMap|undefined>} returns two PixelMaps; or either (but not both) can be undefined\n     * @example\n     * var s = new music21.tinyNotation.TinyNotation('3/4 c4 d8 e f4 g4 a4 b4');\n     * var can = s.appendNewCanvas();\n     * var pm = new music21.streamInteraction.PixelMapper(s);\n     * var pmaps = pm.getPixelMapsAropundOffset(1.25);\n     * var prev = pmaps[0];\n     * var next = pmaps[1];\n     * prev.offset\n     * // 1\n     * next.offset\n     * // 1.5\n     * prev.x\n     * // 97...\n     * next.x\n     * // 123...\n     */\n    getPixelMapsAroundOffset(offset) {\n        let prevNoteMap;\n        let nextNoteMap;\n        for (let i = 0; i < this.allMaps.length; i++) {\n            const thisMap = this.allMaps[i];\n            if (thisMap.offset <= offset) {\n                prevNoteMap = thisMap;\n            }\n            if (thisMap.offset >= offset) {\n                nextNoteMap = thisMap;\n                break;\n            }\n        }\n        if (prevNoteMap === undefined && nextNoteMap === undefined) {\n            const lastNoteMap = this.allMaps[this.allMaps.length - 1];\n            prevNoteMap = lastNoteMap;\n            nextNoteMap = lastNoteMap;\n        } else if (prevNoteMap === undefined) {\n            prevNoteMap = nextNoteMap;\n        } else if (nextNoteMap === undefined) {\n            nextNoteMap = prevNoteMap;\n        }\n        return [prevNoteMap, nextNoteMap];\n    }\n    /**\n     * Uses the stored offsetToPixelMaps to get the pixel X for the offset.\n     *\n     * @memberof music21.streamInteraction.PixelMapper\n     * @param {number} offset\n     * @param {Array<music21.streamInteraction.PixelMap>} offsetToPixelMaps\n     * @returns {number}\n     * @example\n     * var s = new music21.tinyNotation.TinyNotation('3/4 c4 d8 e f4 g4 a4 b4');\n     * var can = s.appendNewCanvas();\n     * var pm = new music21.streamInteraction.PixelMapper(s);\n     * pm.getXAtOffset(0.0); // exact placement of a note\n     * // 89.94...\n     * pm.getXAtOffset(0.5); // between two notes\n     * // 138.63...\n     */\n    getXAtOffset(offset) {\n        // returns the proper\n        const twoNoteMaps = this.getPixelMapsAroundOffset(offset);\n        const prevNoteMap = twoNoteMaps[0];\n        const nextNoteMap = twoNoteMaps[1];\n        const pixelScaling = this.pixelScaling;\n        const offsetFromPrev = offset - prevNoteMap.offset;\n        const offsetDistance = nextNoteMap.offset - prevNoteMap.offset;\n        let pixelDistance = nextNoteMap.x - prevNoteMap.x;\n        if (nextNoteMap.systemIndex !== prevNoteMap.systemIndex) {\n            const stave = prevNoteMap.elements[0].activeVexflowNote.stave;\n            pixelDistance = (stave.x + stave.width) * pixelScaling - prevNoteMap.x;\n        }\n        let offsetToPixelScale = 0;\n        if (offsetDistance !== 0) {\n            offsetToPixelScale = pixelDistance / offsetDistance;\n        } else {\n            offsetToPixelScale = 0;\n        }\n        const pixelsFromPrev = offsetFromPrev * offsetToPixelScale;\n        const offsetX = prevNoteMap.x + pixelsFromPrev;\n        return offsetX / pixelScaling;\n    }\n\n    /**\n     * Uses the stored offsetToPixelMaps to get the systemIndex active at the current time.\n     *\n     * @memberof music21.streamInteraction.PixelMapper\n     * @param {number} offset\n     * @returns {number} systemIndex of the offset\n     */\n    getSystemIndexAtOffset(offset) {\n        const twoNoteMaps = this.getPixelMapsAroundOffset(offset);\n        const prevNoteMap = twoNoteMaps[0];\n        return prevNoteMap.systemIndex;\n    }\n}\nstreamInteraction.PixelMapper = PixelMapper;\n\n\n/*  PIXEL MAP */\n\n/**\n * A PixelMap maps one offset to one x location.\n *\n * The offset does NOT have to be the offset of an element. Offsets are generally\n * measured from the start of the flat stream.\n *\n * @class PixelMap\n * @memberof music21.streamInteraction\n * @param {music21.streamInteraction.PixelMapper} mapper - should eventually be a weakref...\n * @param {number} offset - the offset that is being mapped.\n * @property {Array<music21.base.Music21Object>} elements -- elements being mapped to.\n * @property {number} offset - the offset inputted\n * @property {number} x - x value in pixels for this offset\n * @property {Int} systemIndex - the systemIndex at which this offset appears.\n * @example\n * // not a particularly realistic example, since it requires so much setup...\n * var s = new music21.tinyNotation.TinyNotation('3/4 c4 d8 e f4 g4 a4 b4');\n * var can = s.appendNewCanvas();\n * var pmapper = new music21.streamInteraction.PixelMapper(s);\n * var pmapA = new music21.streamInteraction.PixelMap(pmapper, 2.0);\n * pmapA.elements = [s.flat.get(3)];\n * pmapA.offset;\n * // 2\n * pmapA.x;\n * // 149.32...\n * pmapA.systemIndex\n * // 0\n */\nexport class PixelMap {\n    constructor(mapper, offset) {\n        this.pixelScaling = mapper.pixelScaling; // should be a Weakref...\n        this.elements = [];\n        this.offset = offset; // important\n        this._x = undefined;\n        this._systemIndex = undefined;\n    }\n    get x() {\n        if (this._x !== undefined) {\n            return this._x;\n        } else if (this.elements.length === 0) {\n            return 0; // error!\n        } else {\n            return this.elements[0].x * this.pixelScaling;\n        }\n    }\n    set x(x) {\n        this._x = x;\n    }\n    get systemIndex() {\n        if (this._systemIndex !== undefined) {\n            return this._systemIndex;\n        } else if (this.elements.length === 0) {\n            return 0; // error!\n        } else {\n            return this.elements[0].systemIndex;\n        }\n    }\n    set systemIndex(systemIndex) {\n        this._systemIndex = systemIndex;\n    }\n}\nstreamInteraction.PixelMap = PixelMap;\n\n/*  NOT DONE YET */\nexport class CursorSelect {\n    constructor(s) {\n        this.stream = s;\n        this.activeElementHierarchy = [undefined];\n    }\n}\nstreamInteraction.CursorSelect = CursorSelect;\n","import * as $ from 'jquery';\nimport * as Vex from 'vexflow';\n\nimport { debug } from './debug';\nimport { duration } from './duration';\n/**\n * for rendering vexflow. Will eventually go to music21/converter/vexflow\n *\n * See {@link music21.vfShow} namespace for details\n *\n * @exports music21/vfShow\n */\n/**\n * Vexflow display related objects and methods.\n *\n * @namespace music21.vfShow\n * @memberof music21\n * @requires music21/common\n * @requires vexflow\n */\nexport const vfShow = {};\n\n/**\n * Represents a stack of objects that need to be rendered together.\n *\n * An intermediary state for showing created by {@link music21.vfShow.Renderer}.\n *\n * @class RenderStack\n * @memberof music21.vfShow\n * @property {Array<Vex.Flow.Voice>} voices - Vex.Flow.Voice objects\n * @property {Array<music21.stream.Stream>} streams - {@link music21.stream.Stream} objects associated with the voices\n * @property {Array} textVoices - Vex.Flow.Voice objects for the text.\n */\nexport class RenderStack {\n    constructor() {\n        this.voices = [];\n        this.streams = [];\n        this.textVoices = [];\n    }\n    /**\n     * @memberof music21.vfShow.RenderStack\n     * @returns {Array} this.voices and this.textVoices as one array\n     */\n    allTickables() {\n        const t = [];\n        t.push(...this.voices);\n        t.push(...this.textVoices);\n        return t;\n    }\n}\nvfShow.RenderStack = RenderStack;\n\n\n/**\n * Renderer is a function that takes a stream, an\n * optional existing canvas element and a DOM\n * element where the canvas element should be placed\n * and renders the stream as Vexflow on the\n * canvas element, placing it then in the where\n * DOM.\n *\n * \"s\" can be any type of Stream.\n *\n * \"canvas\" and \"where\" can be either a DOM\n * element or a jQuery object.\n *\n * @class Renderer\n * @memberof music21.vfShow\n * @param {music21.stream.Stream} s - main stream to render\n * @param {canvas} [canvas] - existing canvas element\n * @param {DOMObject|jQueryDOMObject} [where=document.body] - where to render the stream\n * @property {Vex.Flow.Renderer} vfRenderer - a Vex.Flow.Renderer to use (will create if not existing)\n * @property {Vex.Flow.Context} ctx - a Vex.Flow.Context (Canvas or Raphael [not yet]) to use.\n * @property {canvas} canvas - canvas element\n * @property {jQueryDOMObject} $canvas - jQuery canvas element\n * @property {jQueryDOMObject} $where - jQuery element to render onto\n * @property {Vex.Flow.Formatter} activeFormatter - formatter\n * @property {Array<Vex.Flow.Beam>} beamGroups - beamGroups\n * @property {Array<Vex.Flow.StaveTie>} ties - ties\n * @property {Array<number>} systemBreakOffsets - where to break the systems\n * @property {Array<Vex.Flow.Tuplet>} vfTuplets - tuplets represented in Vexflow\n * @property {Array<music21.vfShow.RenderStack>} stacks - array of RenderStack objects\n */\nexport class Renderer {\n    constructor(s, canvas, where) {\n        this.stream = s;\n        // this.streamType = s.classes[-1];\n\n        this.canvas = undefined;\n        this.$canvas = undefined;\n        this.$where = undefined;\n        this.activeFormatter = undefined;\n        this._vfRenderer = undefined;\n        this._ctx = undefined;\n        this.beamGroups = [];\n        this.stacks = []; // an Array of RenderStacks: {voices: [Array of Vex.Flow.Voice objects],\n        //                            streams: [Array of Streams, usually Measures]}\n        this.ties = [];\n        this.systemBreakOffsets = [];\n        this.vfTuplets = [];\n        // this.measureFormatters = [];\n        if (where !== undefined) {\n            if (where.jquery !== undefined) {\n                this.$where = where;\n            } else {\n                this.$where = $(where);\n            }\n        }\n        if (canvas !== undefined) {\n            if (canvas.jquery !== undefined) {\n                this.$canvas = canvas;\n                this.canvas = canvas[0];\n            } else {\n                this.canvas = canvas;\n                this.$canvas = $(canvas);\n            }\n        }\n    }\n    get vfRenderer() {\n        if (this._vfRenderer !== undefined) {\n            return this._vfRenderer;\n        } else {\n            this._vfRenderer = new Vex.Flow.Renderer(this.canvas, Vex.Flow.Renderer.Backends.CANVAS);\n            return this._vfRenderer;\n        }\n    }\n    set vfRenderer(vfr) {\n        this._vfRenderer = vfr;\n    }\n    get ctx() {\n        if (this._ctx !== undefined) {\n            return this._ctx;\n        } else {\n            this._ctx = this.vfRenderer.getContext();\n            if (this.stream && this.stream.renderOptions) {\n                this._ctx.scale(this.stream.renderOptions.scaleFactor.x,\n                        this.stream.renderOptions.scaleFactor.y);\n            }\n            return this._ctx;\n        }\n    }\n    set ctx(ctx) {\n        this._ctx = ctx;\n    }\n    /**\n     *\n     * main function to render a Stream.\n     *\n     * if s is undefined, uses the stored Stream from\n     * the constructor object.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream]\n     */\n    render(s) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n\n        let isScorelike = false;\n        let isPartlike = false;\n        const hasSubStreams = s.hasSubStreams();\n\n        if (s.isClassOrSubclass('Score')) {\n            isScorelike = true;\n        } else if (hasSubStreams && s.get(0).hasSubStreams()) {\n            isScorelike = true;\n        } else if (hasSubStreams) {\n            isPartlike = true;\n        }\n        // requires organization Score -> Part -> Measure -> elements...\n        if (isScorelike) {\n            this.prepareScorelike(s);\n        } else if (isPartlike) {\n            this.preparePartlike(s);\n        } else {\n            this.prepareArrivedFlat(s);\n        }\n        this.formatMeasureStacks();\n        this.drawTies();\n        this.drawMeasureStacks();\n        this.drawBeamGroups();\n        this.drawTuplets();\n    }\n    /**\n     * Prepares a scorelike stream (i.e., one with parts or\n     * Streams that should be rendered vertically like parts)\n     * for rendering and adds Staff Connectors\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Score} s - prepare a stream of parts (i.e., Score)\n     */\n    prepareScorelike(s) {\n        // console.log('prepareScorelike called');\n        for (let i = 0; i < s.length; i++) {\n            const subStream = s.get(i);\n            this.preparePartlike(subStream);\n        }\n        this.addStaffConnectors(s);\n    }\n    /**\n     *\n     * Prepares a Partlike stream (that is one with Measures\n     * or substreams that should be considered like Measures)\n     * for rendering.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Part} p\n     */\n    preparePartlike(p) {\n        // console.log('preparePartlike called');\n        this.systemBreakOffsets = [];\n        for (let i = 0; i < p.length; i++) {\n            const subStream = p.get(i);\n            if (subStream.renderOptions.startNewSystem) {\n                this.systemBreakOffsets.push(subStream.offset);\n            }\n            if (i === p.length - 1) {\n                subStream.renderOptions.rightBarline = 'end';\n            }\n            if (this.stacks[i] === undefined) {\n                this.stacks[i] = new vfShow.RenderStack();\n            }\n            this.prepareMeasure(subStream, this.stacks[i]);\n        }\n        this.prepareTies(p);\n    }\n    /**\n     *\n     * Prepares a score that arrived flat... sets up\n     * stacks and ties after calling prepareFlat\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} m - a flat stream (maybe a measure or voice)\n     */\n    prepareArrivedFlat(m) {\n        const stack = new vfShow.RenderStack();\n        this.prepareMeasure(m, stack);\n        this.stacks[0] = stack;\n        this.prepareTies(m);\n    }\n    /**\n     *\n     * Prepares a measure (w/ or w/o voices) or generic Stream -- makes accidentals,\n     * associates a Vex.Flow.Stave with the stream and\n     * returns a vexflow Voice object\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Measure} m - a measure object (w or w/o voices)\n     * @param {music21.vfShow.RenderStack} stack - a RenderStack object to prepare into.\n     */\n    prepareMeasure(m, stack) {\n        if (m.hasVoices === undefined || m.hasVoices() === false) {\n            this.prepareFlat(m, stack);\n        } else {\n            // TODO: don't assume that all elements are Voices;\n            let stave;\n            const rendOp = m.renderOptions; // get render options from Measure;\n            for (let voiceIndex = 0; voiceIndex < m.length; voiceIndex++) {\n                const voiceStream = m.get(voiceIndex);\n                stave = this.prepareFlat(voiceStream, stack, stave, rendOp);\n            }\n        }\n        return stack;\n    }\n    /**\n     * Main internal routine to prepare a flat stream\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - a flat stream object\n     * @param {music21.vfShow.RenderStack} stack - a RenderStack object to prepare into.\n     * @param {Vex.Flow.Stave} [optionalStave] - an optional existing stave.\n     * @param {object} [optional_renderOp] - render options. Passed to {@link music21.vfShow.Renderer#renderStave}\n     * @returns {Vex.Flow.Stave} staff to return too (also changes the `stack` parameter and runs `makeAccidentals` on s)\n     */\n    prepareFlat(s, stack, optionalStave, optional_renderOp) {\n        s.makeAccidentals();\n        let stave;\n        if (optionalStave !== undefined) {\n            stave = optionalStave;\n        } else {\n            stave = this.renderStave(s, optional_renderOp);\n        }\n        s.activeVFStave = stave;\n        const voice = this.getVoice(s, stave);\n        stack.voices.push(voice);\n        stack.streams.push(s);\n\n        if (s.hasLyrics()) {\n            stack.textVoices.push(this.getLyricVoice(s, stave));\n        }\n\n        return stave;\n    }\n    /**\n     * Render the Vex.Flow.Stave from a flat stream and draws it.\n     *\n     * Just draws the stave, not the notes, etc.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [m=this.stream] - a flat stream\n     * @param {object} [optional_rendOp] - render options, passed to {@link music21.vfShow.Renderer#newStave} and {@link music21.vfShow.Renderer#setClefEtc}\n     * @returns {Vex.Flow.Stave} stave\n     */\n    renderStave(m, optional_rendOp) {\n        if (m === undefined) {\n            m = this.stream;\n        }\n        const ctx = this.ctx;\n        // stave will be passed in from Measure when we have Voices\n        const stave = this.newStave(m, optional_rendOp);\n\n        this.setClefEtc(m, stave, optional_rendOp);\n        stave.setContext(ctx);\n        stave.draw();\n        return stave;\n    }\n    /**\n     * Draws the Voices (music and text) from `this.stacks`\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawMeasureStacks() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.stacks.length; i++) {\n            const voices = this.stacks[i].allTickables();\n            for (let j = 0; j < voices.length; j++) {\n                const v = voices[j];\n                v.draw(ctx);\n            }\n        }\n    }\n    /**\n     * draws the tuplets.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawTuplets() {\n        const ctx = this.ctx;\n        this.vfTuplets.forEach((vft) => {\n            vft.setContext(ctx).draw();\n        });\n    }\n    /**\n     * draws the ties\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawTies() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.ties.length; i++) {\n            this.ties[i].setContext(ctx).draw();\n        }\n    }\n    /**\n     * Finds all tied notes and creates the proper Vex.Flow.StaveTie objects in\n     * `this.ties`.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Part} p - a Part or similar object\n     */\n    prepareTies(p) {\n        const pf = p.flat.notesAndRests;\n        // console.log('newSystemsAt', this.systemBreakOffsets);\n        for (let i = 0; i < pf.length - 1; i++) {\n            const thisNote = pf.get(i);\n            if (thisNote.tie === undefined || thisNote.tie.type === 'stop') {\n                continue;\n            }\n            const nextNote = pf.get(i + 1);\n            let onSameSystem = true;\n            // this.systemBreakOffsets.length will be 0 for a flat score\n            for (let sbI = 0; sbI < this.systemBreakOffsets.length; sbI++) {\n                const thisSystemBreak = this.systemBreakOffsets[sbI];\n                if (thisNote.offset < thisSystemBreak && nextNote.offset >= thisSystemBreak) {\n                    onSameSystem = false;\n                    break;\n                }\n            }\n            if (onSameSystem) {\n                const vfTie = new Vex.Flow.StaveTie({\n                    first_note: thisNote.activeVexflowNote,\n                    last_note: nextNote.activeVexflowNote,\n                    first_indices: [0],\n                    last_indices: [0],\n                });\n                this.ties.push(vfTie);\n            } else {\n                // console.log('got me a tie across systemBreaks!');\n                const vfTie1 = new Vex.Flow.StaveTie({\n                    first_note: thisNote.activeVexflowNote,\n                    first_indices: [0],\n                });\n                this.ties.push(vfTie1);\n                const vfTie2 = new Vex.Flow.StaveTie({\n                    last_note: nextNote.activeVexflowNote,\n                    first_indices: [0],\n                });\n                this.ties.push(vfTie2);\n            }\n        }\n    }\n    /**\n     * Returns a Vex.Flow.Voice object with all the tickables (i.e., Notes, Voices, etc.)\n     *\n     * Does not draw it...\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream] -- usually a Measure or Voice\n     * @param {Vex.Flow.Stave} stave - not optional (would never fly in Python...)\n     * @returns {Vex.Flow.Voice}\n     */\n    getVoice(s, stave) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n\n        // gets a group of notes as a voice, but completely unformatted and not drawn.\n        const notes = this.vexflowNotes(s, stave);\n        const voice = this.vexflowVoice(s);\n        voice.setStave(stave);\n\n        voice.addTickables(notes);\n        return voice;\n    }\n    /**\n     * Returns a Vex.Flow.Voice with the lyrics set to render in the proper place.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s -- usually a Measure or Voice\n     * @param {Vex.Flow.Stave} stave\n     * @returns {Vex.Flow.Voice}\n     */\n    getLyricVoice(s, stave) {\n        const textVoice = this.vexflowVoice(s);\n        const lyrics = this.vexflowLyrics(s, stave);\n        textVoice.setStave(stave);\n        textVoice.addTickables(lyrics);\n        return textVoice;\n    }\n    /**\n     * Aligns all of `this.stacks` (after they've been prepared) so they align properly.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    formatMeasureStacks() {\n        // adds formats the voices, then adds the formatter information to every note in a voice...\n        for (let i = 0; i < this.stacks.length; i++) {\n            const stack = this.stacks[i];\n            const voices = stack.voices;\n            const measures = stack.streams;\n            const formatter = this.formatVoiceGroup(stack);\n            for (let j = 0; j < measures.length; j++) {\n                const m = measures[j];\n                const v = voices[j];\n                this.applyFormatterInformationToNotes(v.stave, m, formatter);\n            }\n        }\n    }\n    /**\n     * Formats a single voice group from a stack.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.vfShow.RenderStack} stack\n     * @param {Boolean} [autoBeam=measures[0].autoBeam]\n     * @returns {Vex.Flow.Formatter}\n     */\n    formatVoiceGroup(stack, autoBeam) {\n        // formats a group of voices to use the same formatter; returns the formatter\n        // if autoBeam is true then it will apply beams for each voice and put them in\n        // this.beamGroups;\n        const allTickables = stack.allTickables();\n        const voices = stack.voices;\n        const measures = stack.streams;\n        if (autoBeam === undefined) {\n            autoBeam = measures[0].autoBeam;\n        }\n\n        const formatter = new Vex.Flow.Formatter();\n        // var minLength = formatter.preCalculateMinTotalWidth([voices]);\n        // console.log(minLength);\n        if (voices.length === 0) {\n            return formatter;\n        }\n        let maxGlyphStart = 0; // find the stave with the farthest start point -- diff key sig, etc.\n        for (let i = 0; i < allTickables.length; i++) {\n            // console.log(voices[i], voices[i].stave, i);\n            if (allTickables[i].stave.start_x > maxGlyphStart) {\n                maxGlyphStart = allTickables[i].stave.start_x;\n            }\n        }\n        for (let i = 0; i < allTickables.length; i++) {\n            allTickables[i].stave.start_x = maxGlyphStart; // corrected!\n        }\n        // TODO: should do the same for end_x -- for key sig changes, etc...\n\n        const stave = voices[0].stave; // all staves should be same length, so does not matter;\n        formatter.joinVoices(allTickables);\n        formatter.formatToStave(allTickables, stave);\n        if (autoBeam) {\n            for (let i = 0; i < voices.length; i++) {\n                // find beam groups -- n.b. this wipes out stemDirection. worth it usually...\n                const voice = voices[i];\n                let beatGroups = [new Vex.Flow.Fraction(2, 8)]; // default beam groups\n                if (measures[i] !== undefined && measures[i].timeSignature !== undefined) {\n                    beatGroups = measures[i].timeSignature.vexflowBeatGroups(Vex); // TODO: getContextByClass...\n                    // console.log(beatGroups);\n                }\n                const beamGroups = Vex.Flow.Beam.applyAndGetBeams(voice, undefined, beatGroups);\n                this.beamGroups.push(...beamGroups);\n            }\n        }\n        return formatter;\n    }\n    /**\n     * Draws the beam groups.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawBeamGroups() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.beamGroups.length; i++) {\n            this.beamGroups[i].setContext(ctx).draw();\n        }\n    }\n    /**\n     * Return a new Vex.Flow.Stave object, which represents\n     * a single MEASURE of notation in m21j\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @returns {Vex.Flow.Stave}\n     */\n    newStave(s, rendOp) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        if (rendOp === undefined) {\n            rendOp = s.renderOptions;\n        }\n        // measure level...\n        let width = rendOp.width;\n        if (width === undefined) {\n            width = s.estimateStaffLength() + rendOp.staffPadding;\n        }\n        let top = rendOp.top;// * rendOp.scaleFactor.y;\n        if (top === undefined) {\n            top = 0;\n        }\n        let left = rendOp.left;\n        if (left === undefined) {\n            left = 10;\n        }\n        // console.log('streamLength: ' + streamLength);\n        if (debug) {\n            console.log('creating new stave: left:' + left + ' top: ' + top + ' width: ' + width);\n        }\n        const stave = new Vex.Flow.Stave(left, top, width);\n        return stave;\n    }\n    /**\n     * Sets the number of stafflines, puts the clef on the Stave, adds keySignature, timeSignature, and rightBarline\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @param {Vex.Flow.Stave} stave\n     * @param {object} [rendOp=s.renderOptions] - a {@link music21.renderOptions.RenderOptions} object that might have `{showMeasureNumber: boolean, rightBarLine: string<{'single', 'double', 'end'}>}`\n     */\n    setClefEtc(s, stave, rendOp) {\n        if (rendOp === undefined) {\n            rendOp = s.renderOptions;\n        }\n        this.setStafflines(s, stave);\n        if (rendOp.showMeasureNumber) {\n            stave.setMeasure(rendOp.measureIndex + 1);\n        }\n        if (rendOp.displayClef) {\n            let ottava;\n            const size = 'default';\n            if (s.clef.octaveChange === 1) {\n                ottava = '8va';\n            } else if (s.clef.octaveChange === -1) {\n                ottava = '8vb';\n            }\n            stave.addClef(s.clef.name, size, ottava);\n        }\n        if ((s.keySignature !== undefined) && (rendOp.displayKeySignature)) {\n            stave.addKeySignature(s.keySignature.vexflow());\n        }\n\n        if ((s.timeSignature !== undefined) && (rendOp.displayTimeSignature)) {\n            stave.addTimeSignature(\n                    s.timeSignature.numerator.toString() + '/' +\n                    s.timeSignature.denominator.toString()); // TODO: convertToVexflow...\n        }\n        if (rendOp.rightBarline !== undefined) {\n            const bl = rendOp.rightBarline;\n            const barlineMap = {\n                'single': 'SINGLE',\n                'double': 'DOUBLE',\n                'end': 'END',\n            };\n            const vxBL = barlineMap[bl];\n            if (vxBL !== undefined) {\n                stave.setEndBarType(Vex.Flow.Barline.type[vxBL]);\n            }\n        }\n    }\n    /**\n     * Sets the number of stafflines properly for the Stave object.\n     *\n     * This method does not just set Vex.Flow.Stave#setNumLines() except\n     * if the number of lines is 0 or >=4, because the default in VexFlow is\n     * to show the bottom(top?), not middle, lines and that looks bad.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - stream to get the `.staffLines` from `s.renderOptions` from -- should allow for overriding.\n     * @param {Vex.Flow.Stave} vexflowStave - stave to set the staff lines for.\n     */\n    setStafflines(s, vexflowStave) {\n        const rendOp = s.renderOptions;\n        if (rendOp.staffLines !== 5) {\n            if (rendOp.staffLines === 0) {\n                vexflowStave.setNumLines(0);\n            } else if (rendOp.staffLines === 1) {\n                // Vex.Flow.Stave.setNumLines hides all but the top line.\n                // this is better\n                vexflowStave.options.line_config = [{ visible: false },\n                                                    { visible: false },\n                                                    { visible: true }, // show middle\n                                                    { visible: false },\n                                                    { visible: false },\n                                                    ];\n            } else if (rendOp.staffLines === 2) {\n                vexflowStave.options.line_config = [{ visible: false },\n                                                    { visible: false },\n                                                    { visible: true }, // show middle\n                                                    { visible: true },\n                                                    { visible: false },\n                                                    ];\n            } else if (rendOp.staffLines === 3) {\n                vexflowStave.options.line_config = [{ visible: false },\n                                                    { visible: true },\n                                                    { visible: true }, // show middle\n                                                    { visible: true },\n                                                    { visible: false },\n                                                    ];\n            } else {\n                vexflowStave.setNumLines(rendOp.staffLines);\n            }\n        }\n    }\n    /**\n     *\n     * Gets the Vex.Flow.StaveNote objects from a Stream.\n     *\n     * Also changes `this.vfTuplets`.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream] - flat stream to find notes in\n     * @param {Vex.Flow.Stave} stave\n     * @returns {Array<Vex.Flow.StaveNote>} notes to return\n     */\n    vexflowNotes(s, stave) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        // runs on a flat stream, returns a list of voices...\n        const notes = [];\n        const vfTuplets = [];\n        let activeTuplet;\n        let activeTupletLength = 0.0;\n        let activeTupletVexflowNotes = [];\n\n        const options = { clef: s.clef, stave };\n        for (let i = 0; i < s.length; i++) {\n            const thisEl = s.get(i);\n            if (thisEl.isClassOrSubclass('GeneralNote') && (thisEl.duration !== undefined)) {\n                const vfn = thisEl.vexflowNote(options);\n                if (vfn === undefined) {\n                    console.error('Cannot create a vexflowNote from: ', thisEl);\n                }\n                // sets thisEl.activeVexflowNote -- may be overwritten but not so fast...\n                if (stave !== undefined) {\n                    vfn.setStave(stave);\n                }\n                notes.push(vfn);\n\n                // account for tuplets...\n                if (thisEl.duration.tuplets.length > 0) {\n                    // only support one tuplet -- like vexflow\n                    const m21Tuplet = thisEl.duration.tuplets[0];\n                    if (activeTuplet === undefined) {\n                        activeTuplet = m21Tuplet;\n                    }\n                    activeTupletVexflowNotes.push(vfn);\n                    activeTupletLength += thisEl.duration.quarterLength;\n                    // console.log(activeTupletLength, activeTuplet.totalTupletLength());\n                    if (activeTupletLength >= activeTuplet.totalTupletLength() ||\n                            Math.abs(activeTupletLength - activeTuplet.totalTupletLength()) < 0.001) {\n                        // console.log(activeTupletVexflowNotes);\n                        const tupletOptions = { num_notes: activeTuplet.numberNotesActual,\n                                notes_occupied: activeTuplet.numberNotesNormal };\n                        // console.log('tupletOptions', tupletOptions);\n                        const vfTuplet = new Vex.Flow.Tuplet(activeTupletVexflowNotes,\n                                tupletOptions);\n                        if (activeTuplet.tupletNormalShow === 'ratio') {\n                            vfTuplet.setRatioed(true);\n                        }\n\n                        vfTuplets.push(vfTuplet);\n                        activeTupletLength = 0.0;\n                        activeTuplet = undefined;\n                        activeTupletVexflowNotes = [];\n                    }\n                }\n            }\n        }\n        if (activeTuplet !== undefined) {\n            console.warn('incomplete tuplet found in stream: ', s);\n        }\n        if (vfTuplets.length > 0) {\n            this.vfTuplets.push(...vfTuplets);\n        }\n        return notes;\n    }\n\n    /**\n     * Gets an Array of `Vex.Flow.TextNote` objects from any lyrics found in s\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - flat stream to search.\n     * @param {Vex.Flow.Stave} stave\n     * @returns {Array<Vex.Flow.TextNote>}\n     */\n    vexflowLyrics(s, stave) {\n        const getTextNote = (text, font, d) => {\n            // console.log(text, font, d);\n            const t1 = new Vex.Flow.TextNote({\n                text,\n                font,\n                duration: d,\n            }).setLine(11).setStave(stave).setJustification(Vex.Flow.TextNote.Justification.LEFT);\n            return t1;\n        };\n\n        if (s === undefined) {\n            s = this.stream;\n        }\n        const font = {\n            family: 'Serif',\n            size: 12,\n            weight: '',\n        };\n        // runs on a flat, gapless, no-overlap stream, returns a list of TextNote objects...\n        const lyricsObjects = [];\n        for (let i = 0; i < s.length; i++) {\n            const el = s.get(i);\n            const lyricsArray = el.lyrics;\n            let text;\n            let d = el.duration.vexflowDuration;\n            let addConnector = false;\n            if (lyricsArray.length === 0) {\n                text = '';\n            } else {\n                text = lyricsArray[0].text;\n                if (text === undefined) {\n                    text = '';\n                }\n                if (lyricsArray[0].syllabic === 'middle' || lyricsArray[0].syllabic === 'begin') {\n                    addConnector = ' ' + lyricsArray[0].lyricConnector;\n                    const tempQl = el.duration.quarterLength / 2.0;\n                    d = new duration.Duration(tempQl).vexflowDuration;\n                }\n            }\n            const t1 = getTextNote(text, font, d);\n            lyricsObjects.push(t1);\n            if (addConnector !== false) {\n                const connector = getTextNote(addConnector, font, d);\n                lyricsObjects.push(connector);\n            }\n        }\n        return lyricsObjects;\n    }\n    /**\n     * Creates a Vex.Flow.Voice of the appropriate length given a Stream.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @returns {Vex.Flow.Voice}\n     */\n    vexflowVoice(s) {\n        const totalLength = s.duration.quarterLength;\n\n        let num1024 = Math.round(totalLength / (1 / 256));\n        let beatValue = 1024;\n\n        if (num1024 % 512 === 0)  {\n            beatValue = 2;\n            num1024 /= 512;\n        } else if (num1024 % 256 === 0)  {\n            beatValue = 4;\n            num1024 /= 256;\n        } else if (num1024 % 128 === 0)  {\n            beatValue = 8;\n            num1024 /= 128;\n        } else if (num1024 % 64 === 0)  {\n            beatValue = 16;\n            num1024 /= 64;\n        } else if (num1024 % 32 === 0)  {\n            beatValue = 32;\n            num1024 /= 32;\n        } else if (num1024 % 16 === 0)  {\n            beatValue = 64;\n            num1024 /= 16;\n        } else if (num1024 % 8 === 0)  {\n            beatValue = 128;\n            num1024 /= 8;\n        } else if (num1024 % 4 === 0)  {\n            beatValue = 256;\n            num1024 /= 4;\n        } else if (num1024 % 2 === 0)  {\n            beatValue = 512;\n            num1024 /= 2;\n        }\n        // console.log('creating voice');\n        if (debug) {\n            console.log('New voice, num_beats: ' + num1024.toString() + ' beat_value: ' + beatValue.toString());\n        }\n        const vfv = new Vex.Flow.Voice({ num_beats: num1024,\n            beat_value: beatValue,\n            resolution: Vex.Flow.RESOLUTION });\n\n        // from vexflow/src/voice.js\n        //\n        // Modes allow the addition of ticks in three different ways:\n        //\n        // STRICT: This is the default. Ticks must fill the voice.\n        // SOFT:   Ticks can be added without restrictions.\n        // FULL:   Ticks do not need to fill the voice, but can't exceed the maximum\n        //         tick length.\n        vfv.setMode(Vex.Flow.Voice.Mode.SOFT);\n        return vfv;\n    }\n    staffConnectorsMap(connectorType) {\n        const connectorMap = {\n            'brace': Vex.Flow.StaveConnector.type.BRACE,\n            'single': Vex.Flow.StaveConnector.type.SINGLE,\n            'double': Vex.Flow.StaveConnector.type.DOUBLE,\n            'bracket': Vex.Flow.StaveConnector.type.BRACKET,\n        };\n        return connectorMap[connectorType];\n    }\n\n    /**\n     * If a stream has parts (NOT CHECKED HERE) create and draw an appropriate Vex.Flow.StaveConnector\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Score} s\n     */\n    addStaffConnectors(s) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        const numParts = s.length;\n        if (numParts < 2) {\n            return;\n        }\n\n        const firstPart = s.get(0);\n        const lastPart = s.get(-1);\n        const numMeasures = firstPart.length;\n        for (let mIndex = 0; mIndex < numMeasures; mIndex++) {\n            const thisPartMeasure = firstPart.get(mIndex);\n            const lastPartMeasure = lastPart.get(mIndex); // only needed once per system but\n            // good for symmetry.\n            if (thisPartMeasure.renderOptions.startNewSystem) {\n                const topVFStaff = thisPartMeasure.activeVFStave;\n                const bottomVFStaff = lastPartMeasure.activeVFStave;\n                /* TODO: warning if no staves... */\n                for (let i = 0; i < s.renderOptions.staffConnectors.length; i++) {\n                    const sc = new Vex.Flow.StaveConnector(topVFStaff, bottomVFStaff);\n                    const scTypeM21 = s.renderOptions.staffConnectors[i];\n                    const scTypeVF = this.staffConnectorsMap(scTypeM21);\n                    sc.setType(scTypeVF);\n                    sc.setContext(this.ctx);\n                    sc.draw();\n                }\n            }\n        }\n    }\n\n    /**\n     * The process of putting a Stream onto a canvas affects each of the\n     * elements in the Stream by adding pieces of information to\n     * each {@link music21.base.Music21Object} -- see `applyFormatterInformationToNotes`\n     *\n     * You might want to remove this information; this routine does that.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - can have parts, measures, etc.\n     * @param {boolean} [recursive=false]\n     */\n    removeFormatterInformation(s, recursive) {\n        s.storedVexflowStave = undefined;\n        for (let i = 0; i < s.length; i++) {\n            const el = s.get(i);\n            el.x = undefined;\n            el.y = undefined;\n            el.width = undefined;\n            el.systemIndex = undefined;\n            el.activeVexflowNote = undefined;\n            if (recursive && el.isClassOrSubclass('Stream')) {\n                this.removeFormatterInformation(el, recursive);\n            }\n        }\n    }\n\n    /**\n     * Adds the following pieces of information to each Note\n     *\n     * - el.x -- x location in pixels\n     * - el.y -- y location in pixels\n     * - el.width - width of element in pixels.\n     * - el.systemIndex -- which system is it on\n     * - el.activeVexflowNote - which Vex.Flow.StaveNote is it connected with.\n     *\n     * mad props to our friend Vladimir Viro for figuring this out! Visit http://peachnote.com/\n     *\n     * Also sets s.storedVexflowStave to stave.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {Vex.Flow.Stave} stave\n     * @param {music21.stream.Stream} [s=this.stream]\n     * @param {Vex.Flow.Formatter} formatter\n     */\n    applyFormatterInformationToNotes(stave, s, formatter) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        let noteOffsetLeft = 0;\n        // var staveHeight = 80;\n        if (stave !== undefined) {\n            noteOffsetLeft = stave.start_x + stave.glyph_start_x;\n            if (debug) {\n                console.log('noteOffsetLeft: ' + noteOffsetLeft + ' ; stave.start_x: ' + stave.start_x);\n                console.log('Bottom y: ' + stave.getBottomY());\n            }\n            // staveHeight = stave.height;\n        }\n\n        let nextTicks = 0;\n        for (let i = 0; i < s.length; i++) {\n            const el = s.get(i);\n            if (el.isClassOrSubclass('GeneralNote')) {\n                const vfn = el.activeVexflowNote;\n                if (vfn === undefined) {\n                    continue;\n                }\n                const nTicks = parseInt(vfn.ticks);\n                const formatterNote = formatter.tContexts.map[String(nextTicks)];\n                nextTicks += nTicks;\n                el.x = vfn.getAbsoluteX();\n                // these are a bit hacky...\n                el.systemIndex = s.renderOptions.systemIndex;\n\n                // console.log(i + \" \" + el.x + \" \" + formatterNote.x + \" \" + noteOffsetLeft);\n                if (formatterNote === undefined) {\n                    continue;\n                }\n\n                el.width = formatterNote.width;\n                if (el.pitch !== undefined) { // note only...\n                    el.y = (stave.getBottomY() - (s.clef.lowestLine - el.pitch.diatonicNoteNum) *\n                            stave.options.spacing_between_lines_px);\n                    // console.log('Note DNN: ' + el.pitch.diatonicNoteNum + \" ; y: \" + el.y);\n                }\n            }\n        }\n        if (debug) {\n            for (let i = 0; i < s.length; i++) {\n                const n = s.get(i);\n                if (n.pitch !== undefined) {\n                    console.log(n.pitch.diatonicNoteNum + ' ' + n.x + ' ' + (n.x + n.width));\n                }\n            }\n        }\n        s.storedVexflowStave = stave;\n    }\n}\nvfShow.Renderer = Renderer;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/stream -- Streams -- objects that hold other Music21Objects\n *\n * Does not implement the full features of music21p Streams by a long shot...\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006-16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\nimport * as MIDI from 'MIDI';\n\nimport { Music21Exception } from './exceptions21';\n\nimport { base } from './base';\nimport { clef } from './clef';\nimport { common } from './common';\nimport { debug } from './debug';\nimport { duration } from './duration';\nimport { instrument } from './instrument';\nimport { meter } from './meter';\nimport { note } from './note';\nimport { pitch } from './pitch';\nimport { renderOptions } from './renderOptions';\nimport { streamInteraction } from './streamInteraction';\nimport { vfShow } from './vfShow';\n\n/**\n * powerful stream module, See {@link music21.stream} namespace\n * @exports music21/stream\n */\n/**\n * Streams are powerful music21 objects that hold Music21Object collections,\n * such as {@link music21.note.Note} or {@link music21.chord.Chord} objects.\n *\n * Understanding the {@link music21.stream.Stream} object is of fundamental\n * importance for using music21.  Definitely read the music21(python) tutorial\n * on using Streams before proceeding\n *\n * @namespace music21.stream\n * @memberof music21\n * @requires music21/base\n * @requires music21/renderOptions\n * @requires music21/clef\n * @requires music21/vfShow\n * @requires music21/duration\n * @requires music21/common\n * @requires music21/meter\n * @requires music21/pitch\n * @requires music21/streamInteraction\n * @requires jquery\n */\nexport const stream = {};\n\n/**\n * A generic Stream class -- a holder for other music21 objects\n * Will be subclassed into {@link music21.stream.Score},\n * {@link music21.stream.Part},\n * {@link music21.stream.Measure},\n * {@link music21.stream.Voice}, but most functions will be found here.\n *\n * @class Stream\n * @memberof music21.stream\n * @extends music21.base.Music21Object\n *\n * @property {Array<music21.base.Music21Object>} elements - the elements in the stream. DO NOT MODIFY individual components (consider it like a Python tuple)\n * @property {Int} length - (readonly) the number of elements in the stream.\n * @property {music21.duration.Duration} duration - the total duration of the stream's elements\n * @property {music21.clef.Clef} clef - the clef for the Stream (if there is one; if there are multiple, then the first clef)\n * @property {music21.meter.TimeSignature} timeSignature - the first TimeSignature of the Stream\n * @property {music21.key.KeySignature} keySignature - the first KeySignature for the Stream\n * @property {music21.renderOptions.RenderOptions} renderOptions - an object specifying how to render the stream\n * @property {music21.stream.Stream} flat - (readonly) a flattened representation of the Stream\n * @property {music21.stream.Stream} notes - (readonly) the stream with only {@link music21.note.Note} and {@link music21.chord.Chord} objects included\n * @property {music21.stream.Stream} notesAndRests - (readonly) like notes but also with {@link music21.note.Rest} objects included\n * @property {music21.stream.Stream} parts - (readonly) a filter on the Stream to just get the parts (NON-recursive)\n * @property {music21.stream.Stream} measures - (readonly) a filter on the Stream to just get the measures (NON-recursive)\n * @property {number} tempo - tempo in beats per minute (will become more sophisticated later, but for now the whole stream has one tempo\n * @property {music21.instrument.Instrument|undefined} instrument - an instrument object associated with the stream (can be set with a string also, but will return an `Instrument` object)\n * @property {Boolean} autoBeam - whether the notes should be beamed automatically or not (will be moved to `renderOptions` soon)\n * @property {Int} [staffLines=5] - number of staff lines\n * @property {function|undefined} changedCallbackFunction - function to call when the Stream changes through a standard interface\n * @property {number} maxSystemWidth - confusing... should be in renderOptions\n */\nexport class Stream extends base.Music21Object {\n    constructor() {\n        super();\n        this.classes.push('Stream');\n        this._duration = undefined;\n\n        this._elements = [];\n        this._elementOffsets = [];\n        this._clef = undefined;\n        this.displayClef = undefined;\n\n        this._keySignature =  undefined; // a music21.key.KeySignature object\n        this._timeSignature = undefined; // a music21.meter.TimeSignature object\n        this._instrument = undefined;\n\n        this._autoBeam = undefined;\n        this.activeVFStave = undefined;\n        this.renderOptions = new renderOptions.RenderOptions();\n        this._tempo = undefined;\n\n        this.staffLines = 5;\n\n        this._stopPlaying = false;\n        this._allowMultipleSimultaneousPlays = true; // not implemented yet.\n        this.changedCallbackFunction = undefined; // for editable canvases\n        /**\n         * A function bound to the current stream that\n         * will changes the stream. Used in editableAccidentalCanvas, among other places.\n         *\n         *      var can = s.appendNewCanvas();\n         *      $(can).on('click', s.canvasChangerFunction);\n         *\n         * @memberof music21.stream.Stream\n         * @param {Event} e\n         * @returns {music21.base.Music21Object|undefined} - returns whatever changedCallbackFunction does.\n         */\n        this.canvasChangerFunction = (e) => {\n            const canvasElement = e.currentTarget;\n            const [clickedDiatonicNoteNum, foundNote] = this.findNoteForClick(canvasElement, e);\n            if (foundNote === undefined) {\n                if (debug) {\n                    console.log('No note found');\n                }\n                return undefined;\n            }\n            return this.noteChanged(clickedDiatonicNoteNum, foundNote, canvasElement);\n        };\n    }\n    get duration() {\n        if (this._duration !== undefined) {\n            return this._duration;\n        }\n        let highestTime = 0.0;\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            let endTime = el.offset;\n            if (el.duration !== undefined) {\n                endTime += el.duration.quarterLength;\n            }\n            if (endTime > highestTime) {\n                highestTime = endTime;\n            }\n        }\n        return new duration.Duration(highestTime);\n    }\n    set duration(newDuration) {\n        this._duration = newDuration;\n    }\n    get flat() {\n        if (this.hasSubStreams()) {\n            const tempEls = [];\n            for (let i = 0; i < this.length; i++) {\n                const el = this.get(i);\n                // console.log(i, this.length);\n                if (el.elements !== undefined) {\n                    const offsetShift = el.offset;\n                    // console.log('offsetShift', offsetShift, el.classes[el.classes.length -1]);\n                    const elFlat = el.flat;\n                    for (let j = 0; j < elFlat.length; j++) {\n                        // offset should NOT be null because already in Stream\n                        elFlat.get(j).offset += offsetShift;\n                    }\n                    tempEls.push(...elFlat._elements);\n                } else {\n                    tempEls.push(el);\n                }\n            }\n            const newSt = this.clone(false);\n            newSt.elements = tempEls;\n            return newSt;\n        } else {\n            return this;\n        }\n    }\n    get notes() { return this.getElementsByClass(['Note', 'Chord']); }\n    get notesAndRests() {\n        return this.getElementsByClass('GeneralNote');\n    }\n    get tempo() {\n        if (this._tempo === undefined && this.activeSite !== undefined) {\n            return this.activeSite.tempo;\n        } else if (this._tempo === undefined) {\n            return 150;\n        } else {\n            return this._tempo;\n        }\n    }\n    set tempo(newTempo) {\n        this._tempo = newTempo;\n    }\n    get instrument() {\n        if (this._instrument === undefined && this.activeSite !== undefined) {\n            return this.activeSite.instrument;\n        } else {\n            return this._instrument;\n        }\n    }\n    set instrument(newInstrument) {\n        if (typeof newInstrument === 'string') {\n            newInstrument = new instrument.Instrument(newInstrument);\n        }\n        this._instrument = newInstrument;\n    }\n    get clef() {\n        if (this._clef === undefined && this.activeSite === undefined) {\n            return new clef.Clef('treble');\n        } else if (this._clef === undefined) {\n            return this.activeSite.clef;\n        } else {\n            return this._clef;\n        }\n    }\n    set clef(newClef) {\n        this._clef = newClef;\n    }\n    get keySignature() {\n        if (this._keySignature === undefined && this.activeSite !== undefined) {\n            return this.activeSite.keySignature;\n        } else {\n            return this._keySignature;\n        }\n    }\n    set keySignature(newKeySignature) {\n        this._keySignature = newKeySignature;\n    }\n    get timeSignature() {\n        if (this._timeSignature === undefined && this.activeSite !== undefined) {\n            return this.activeSite.timeSignature;\n        } else {\n            return this._timeSignature;\n        }\n    }\n    set timeSignature(newTimeSignature) {\n        if (typeof (newTimeSignature) === 'string') {\n            newTimeSignature = new meter.TimeSignature(newTimeSignature);\n        }\n        this._timeSignature = newTimeSignature;\n    }\n    get autoBeam() {\n        if (this._autoBeam === undefined && this.activeSite !== undefined) {\n            return this.activeSite.autoBeam;\n        } else if (this._autoBeam !== undefined) {\n            return this._autoBeam;\n        } else {\n            return true; // default...\n        }\n    }\n    set autoBeam(ab) {\n        this._autoBeam = ab;\n    }\n    get maxSystemWidth() {\n        let baseMaxSystemWidth = 750;\n        if (this.renderOptions.maxSystemWidth === undefined\n                && this.activeSite !== undefined) {\n            baseMaxSystemWidth = this.activeSite.maxSystemWidth;\n        } else if (this.renderOptions.maxSystemWidth !== undefined) {\n            baseMaxSystemWidth = this.renderOptions.maxSystemWidth;\n        }\n        return (baseMaxSystemWidth / this.renderOptions.scaleFactor.x);\n    }\n    set maxSystemWidth(newSW) {\n        this.renderOptions.maxSystemWidth = newSW * this.renderOptions.scaleFactor.x;\n    }\n    get parts() {\n        const parts = [];\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Part')) {\n                parts.push(el);\n            }\n        }\n        return parts;\n    }\n    /* TODO -- make it return a Stream.Part and not list. to match music21p\n     * but okay for now */\n    get measures() {\n        const measures = [];\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Measure')) {\n                measures.push(el);\n            }\n        }\n        return measures;\n    }\n    get length() {\n        return this._elements.length;\n    }\n    get elements() {\n        return this._elements;\n    }\n    set elements(newElements) {\n        let highestOffsetSoFar = 0.0;\n        this._elements = [];\n        this._elementOffsets = [];\n        const tempInsert = [];\n        let i;\n        let thisEl;\n        for (i = 0; i < newElements.length; i++) {\n            thisEl = newElements[i];\n            const thisElOffset = thisEl.offset;\n            if (thisElOffset === null || thisElOffset === highestOffsetSoFar) {\n                // append\n                this._elements.push(thisEl);\n                thisEl.offset = highestOffsetSoFar;\n                this._elementOffsets.push(highestOffsetSoFar);\n                if (thisEl.duration === undefined) {\n                    console.error('No duration for ', thisEl, ' in ', this);\n                }\n                highestOffsetSoFar += thisEl.duration.quarterLength;\n            } else { // append -- slow\n                tempInsert.push(thisEl);\n            }\n        }\n        // console.warn('end', highestOffsetSoFar, tempInsert);\n        for (i = 0; i < tempInsert.length; i++) {\n            thisEl = tempInsert[i];\n            this.insert(thisEl.offset, thisEl);\n        }\n    }\n\n    /* override protoM21Object.clone() */\n    clone(deep) {\n        const ret = Object.create(this.constructor.prototype);\n        for (const key in this) {            \n            if ({}.hasOwnProperty.call(this, key) === false) {\n                continue;\n            }\n            if (key === 'activeSite') {\n                ret[key] = this[key];\n            } else if (key === 'renderOptions') {\n                ret[key] = common.merge({}, this[key]);\n            } else if (deep !== true && (key === '_elements' || key === '_elementOffsets')) {\n                ret[key] = this[key].slice(); // shallow copy...\n            } else if (deep && (key === '_elements' || key === '_elementOffsets')) {\n                if (key === '_elements') {\n                    // console.log('got elements for deepcopy');\n                    ret._elements = [];\n                    ret._elementOffsets = [];\n                    for (let j = 0; j < this._elements.length; j++) {\n                        ret._elementOffsets[j] = this._elementOffsets[j];\n                        const el = this._elements[j];\n                        // console.log('cloning el: ', el.name);\n                        const elCopy = el.clone(deep);\n                        elCopy.activeSite = ret;\n                        ret._elements[j] = elCopy;\n                    }\n                }\n            } else if (key === 'activeVexflowNote' || key === 'storedVexflowstave') {\n                // do nothing -- do not copy vexflowNotes -- permanent recursion\n            } else if (\n                    Object.getOwnPropertyDescriptor(this, key).get !== undefined\n                    || Object.getOwnPropertyDescriptor(this, key).set !== undefined\n            ) {\n                // do nothing\n            } else if (typeof (this[key]) === 'function') {\n                // do nothing -- events might not be copied.\n            } else if (this[key] !== null && this[key] !== undefined && this[key].isMusic21Object === true) {\n                // console.log('cloning...', key);\n                ret[key] = this[key].clone(deep);\n            } else {\n                ret[key] = this[key];\n            }\n        }\n        return ret;\n    }\n\n    /**\n     * Add an element to the end of the stream, setting its `.offset` accordingly\n     *\n     * @memberof music21.stream.Stream\n     * @param {music21.base.Music21Object} el - element to append\n     * @returns {this}\n     */\n    append(el) {\n        try {\n            if ((el.isClassOrSubclass !== undefined) && el.isClassOrSubclass('NotRest')) {\n                // set stem direction on output...;\n            }\n            let elOffset = 0.0;\n            if (this._elements.length > 0) {\n                const lastQL = this._elements[this._elements.length - 1].duration.quarterLength;\n                elOffset = this._elementOffsets[this._elementOffsets.length - 1] + lastQL;\n            }\n            this._elementOffsets.push(elOffset);\n            this._elements.push(el);\n            el.offset = elOffset;\n            el.activeSite = this; // would prefer weakref, but does not exist in JS.\n        } catch (err) {\n            console.error('Cannot append element ', el, ' to stream ', this, ' : ', err);\n        }\n        return this;\n    }\n\n    /**\n     * Add an element to the specified place in the stream, setting its `.offset` accordingly\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} offset - offset to place.\n     * @param {music21.base.Music21Object} el - element to append\n     * @returns {this}\n     */\n    insert(offset, el) {\n        try {\n            if ((el.isClassOrSubclass !== undefined) && el.isClassOrSubclass('NotRest')) {\n                // set stem direction on output\n                // this.clef.setStemDirection(el);\n            }\n            for (let i = 0; i < this._elements.length; i++) {\n                const testOffset = this._elementOffsets[i];\n                if (testOffset <= offset) {\n                    continue;\n                } else {\n                    this._elementOffsets.splice(i, 0, offset);\n                    this._elements.splice(i, 0, el);\n                    el.offset = offset;\n                    el.activeSite = this;\n                    return this;\n                }\n            }\n            // no element found. insert at end;\n            this._elementOffsets.push(offset);\n            this._elements.push(el);\n            el.offset = offset;\n            el.activeSite = this; // would prefer weakref, but does not exist in JS.\n        } catch (err) {\n            console.error('Cannot insert element ', el, ' to stream ', this, ' : ', err);\n        }\n        return this;\n    }\n\n    /**\n     * Remove and return the last element in the stream, or return undefined if the stream is empty\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.base.Music21Object|undefined} last element in the stream\n     */\n    pop() {\n        // remove last element;\n        if (this.length > 0) {\n            const el = this.get(-1);\n            this._elementOffsets.pop();\n            this._elements.pop();\n            return el;\n        } else {\n            return undefined;\n        }\n    }\n\n    /**\n     * Get the `index`th element from the Stream.  Equivalent to the\n     * music21p format of s[index].  Can use negative indexing to get from the end.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} index - can be -1, -2, to index from the end, like python\n     * @returns {music21.base.Music21Object|undefined}\n     */\n    get(index) {\n        // substitute for Python stream __getitem__; supports -1 indexing, etc.\n        let el;\n        if (index === undefined) {\n            return undefined;\n        } else if (Math.abs(index) > this._elements.length) {\n            return undefined;\n        } else if (index === this._elements.length) {\n            return undefined;\n        } else if (index < 0) {\n            el = this._elements[this._elements.length + index];\n            el.offset = this._elementOffsets[this._elements.length + index];\n            return el;\n        } else {\n            el = this._elements[index];\n            el.offset = this._elementOffsets[index];\n            return el;\n        }\n    }\n    /*  --- ############# END ELEMENT FUNCTIONS ########## --- */\n\n    /**\n     * Returns Boolean about whether this stream contains any other streams.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasSubStreams() {\n        let hasSubStreams = false;\n        for (let i = 0; i < this.length; i++) {\n            const el = this.elements[i];\n            if (el.isClassOrSubclass('Stream')) {\n                hasSubStreams = true;\n                break;\n            }\n        }\n        return hasSubStreams;\n    }\n    /**\n     * Takes a stream and places all of its elements into\n     * measures (:class:`~music21.stream.Measure` objects)\n     * based on the :class:`~music21.meter.TimeSignature` objects\n     * placed within\n     * the stream. If no TimeSignatures are found in the\n     * stream, a default of 4/4 is used.\n\n     * If `options.inPlace` is true, the original Stream is modified and lost\n     * if `options.inPlace` is False, this returns a modified deep copy.\n\n     * @memberof music21.stream.Stream\n     * @param {object} options\n     * @returns {music21.stream.Stream}\n     */\n    makeMeasures(options) {\n        const params = {\n            meterStream: undefined,\n            refStreamOrTimeRange: undefined,\n            searchContext: false,\n            innerBarline: undefined,\n            finalBarline: 'final',\n            bestClef: false,\n            inPlace: false,\n        };\n        common.merge(params, options);\n        let voiceCount;\n        if (this.hasVoices()) {\n            voiceCount = this.getElementsByClass('Voice').length;\n        } else {\n            voiceCount = 0;\n        }\n        // meterStream\n        const meterStream = this.getElementsByClass('TimeSignature');\n        if (meterStream.length === 0) {\n            meterStream.append(this.timeSignature);\n        }\n        // getContextByClass('Clef')\n        const clefObj = this.clef;\n        const offsetMap = this.offsetMap();\n        let oMax = 0;\n        for (let i = 0; i < offsetMap.length; i++) {\n            if (offsetMap[i].endTime > oMax) {\n                oMax = offsetMap[i].endTime;\n            }\n        }\n        // console.log('oMax: ', oMax);\n        const post = new this.constructor();\n        // derivation\n        let o = 0.0;\n        let measureCount = 0;\n        let lastTimeSignature;\n        let m;\n        let mStart;\n        while (true) {\n            m = new stream.Measure();\n            m.number = measureCount + 1;\n            // var thisTimeSignature = meterStream.getElementAtOrBefore(o);\n            const thisTimeSignature = this.timeSignature;\n            if (measureCount === 0) {\n                // simplified...\n            }\n            m.clef = clefObj;\n            m.timeSignature = thisTimeSignature.clone();\n\n            for (let voiceIndex = 0; voiceIndex < voiceCount; voiceIndex++) {\n                const v = new stream.Voice();\n                v.id = voiceIndex;\n                m.insert(0, v);\n            }\n            post.insert(o, m);\n            o += thisTimeSignature.barDuration.quarterLength;\n            if (o >= oMax) {\n                break;\n            } else {\n                measureCount += 1;\n            }\n        }\n        for (let i = 0; i < offsetMap.length; i++) {\n            const ob = offsetMap[i];\n            const e = ob.element;\n            const start = ob.offset;\n            const voiceIndex = ob.voiceIndex;\n\n            // if 'Spanner' in e.classes;\n            lastTimeSignature = undefined;\n            for (let j = 0; j < post.length; j++) {\n                m = post.get(j); // nothing but measures...\n                if (m.timeSignature !== undefined) {\n                    lastTimeSignature = m.timeSignature;\n                }\n                mStart = m.getOffsetBySite(post);\n                const mEnd = mStart + lastTimeSignature.barDuration.quarterLength;\n                if (start >= mStart && start < mEnd) {\n                    break;\n                }\n            }\n            // if not match, raise Exception;\n            const oNew = start - mStart;\n            if (m.clef === e) {\n                continue;\n            }\n            if (oNew === 0 && e.isClassOrSubclass('TimeSignature')) {\n                continue;\n            }\n            let insertStream = m;\n            if (voiceIndex !== undefined) {\n                insertStream = m.getElementsByClass('Voice').get(voiceIndex);\n            }\n            insertStream.insert(oNew, e);\n        }\n        // set barlines, etc.\n        if (params.inPlace !== true) {\n            return post;\n        } else {\n            this.elements = [];\n            // endElements\n            // elementsChanged;\n            for (let i = 0; i < post.length; i++) {\n                const e = post.get(i);\n                this.insert(e.offset, e);\n            }\n            return this; // javascript style;\n        }\n    }\n\n    /**\n     * Returns true if any note in the stream has lyrics, otherwise false\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasLyrics() {\n        for (let i = 0; i < this.length; i++) {\n            const el = this.elements[i];\n            if (el.lyric !== undefined) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Returns a list of OffsetMap objects\n     *\n     * @memberof music21.stream.Stream\n     * @returns [music21.stream.OffsetMap]\n     */\n    offsetMap() {\n        const offsetMap = [];\n        let groups = [];\n        if (this.hasVoices()) {\n            $.each(this.getElementsByClass('Voice').elements, (i, v) => {\n                groups.push([v.flat, i]);\n            });\n        } else {\n            groups = [[this, undefined]];\n        }\n        for (let i = 0; i < groups.length; i++) {\n            const group = groups[i][0];\n            const voiceIndex = groups[i][1];\n            for (let j = 0; j < group.length; j++) {\n                const e = group.get(j);\n                const dur = e.duration.quarterLength;\n                const offset = e.offset; // TODO: getOffsetBySite(group)\n                const endTime = offset + dur;\n                const thisOffsetMap = new stream.OffsetMap(e, offset, endTime, voiceIndex);\n                offsetMap.push(thisOffsetMap);\n            }\n        }\n        return offsetMap;\n    }\n\n\n    /**\n     * Find all elements with a certain class; if an Array is given, then any\n     * matching class will work.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Array<string>|string} classList - a list of classes to find\n     * @returns {music21.stream.Stream}\n     */\n    getElementsByClass(classList) {\n        const tempEls = [];\n        for (let i = 0; i < this.length; i++) {\n            const thisEl = this.get(i);\n            // console.warn(thisEl);\n            if (thisEl.isClassOrSubclass === undefined) {\n                console.err('what the hell is a ', thisEl, 'doing in a Stream?');\n            } else if (thisEl.isClassOrSubclass(classList)) {\n                tempEls.push(thisEl);\n            }\n        }\n        const newSt = new stream.Stream(); // TODO: take Stream class Part, etc.\n        newSt.elements = tempEls;\n        return newSt;\n    }\n    /**\n     * Sets Pitch.accidental.displayStatus for every element with a\n     * pitch or pitches in the stream. If a natural needs to be displayed\n     * and the Pitch does not have an accidental object yet, adds one.\n     *\n     * Called automatically before appendCanvas routines are called.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.stream.Stream} this\n     */\n    makeAccidentals() {\n        // cheap version of music21p method\n        const extendableStepList = {};\n        const stepNames = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\n        for (let i = 0; i < stepNames.length; i++) {\n            const stepName = stepNames[i];\n            let stepAlter = 0;\n            if (this.keySignature !== undefined) {\n                const tempAccidental = this.keySignature.accidentalByStep(stepName);\n                if (tempAccidental !== undefined) {\n                    stepAlter = tempAccidental.alter;\n                    // console.log(stepAlter + \" \" + stepName);\n                }\n            }\n            extendableStepList[stepName] = stepAlter;\n        }\n        const lastOctaveStepList = [];\n        let lastStepDict;\n        let p;\n        for (let i = 0; i < 10; i++) {\n            lastStepDict = $.extend({}, extendableStepList);\n            lastOctaveStepList.push(lastStepDict);\n        }\n        const lastOctavelessStepDict = $.extend({}, extendableStepList); // probably unnecessary, but safe...\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.pitch !== undefined) { // note\n                p = el.pitch;\n                lastStepDict = lastOctaveStepList[p.octave];\n                this._makeAccidentalForOnePitch(p, lastStepDict, lastOctavelessStepDict);\n            } else if (el._notes !== undefined) { // chord\n                for (let j = 0; j < el._notes.length; j++) {\n                    p = el._notes[j].pitch;\n                    lastStepDict = lastOctaveStepList[p.octave];\n                    this._makeAccidentalForOnePitch(p, lastStepDict, lastOctavelessStepDict);\n                }\n            }\n        }\n        return this;\n    }\n\n//  returns pitch\n    _makeAccidentalForOnePitch(p, lastStepDict, lastOctavelessStepDict) {\n        let newAlter;\n        if (p.accidental === undefined) {\n            newAlter = 0;\n        } else {\n            newAlter = p.accidental.alter;\n        }\n        // console.log(p.name + \" \" + lastStepDict[p.step].toString());\n        if ((lastStepDict[p.step] !== newAlter)\n                || (lastOctavelessStepDict[p.step] !== newAlter)) {\n            if (p.accidental === undefined) {\n                p.accidental = new pitch.Accidental('natural');\n            }\n            p.accidental.displayStatus = true;\n            // console.log(\"setting displayStatus to true\");\n        } else if ((lastStepDict[p.step] === newAlter)\n                && (lastOctavelessStepDict[p.step] === newAlter)) {\n            if (p.accidental !== undefined) {\n                p.accidental.displayStatus = false;\n            }\n            // console.log(\"setting displayStatus to false\");\n        }\n        lastStepDict[p.step] = newAlter;\n        lastOctavelessStepDict[p.step] = newAlter;\n        return p;\n    }\n\n    /**\n     * Sets the render options for any substreams (such as placing them\n     * in systems, etc.) DOES NOTHING for music21.stream.Stream, but is\n     * overridden in subclasses.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.stream.Stream} this\n     */\n    setSubstreamRenderOptions() {\n        /* does nothing for standard streams ... */\n        return this;\n    }\n    /**\n     * Resets all the RenderOptions back to defaults. Can run recursively\n     * and can also preserve the `RenderOptions.events` object.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Boolean} [recursive=false]\n     * @param {Boolean} [preserveEvents=false]\n     * @returns {music21.stream.Stream} this\n     */\n    resetRenderOptions(recursive, preserveEvents) {\n        const oldEvents = this.renderOptions.events;\n        this.renderOptions = new renderOptions.RenderOptions();\n        if (preserveEvents) {\n            this.renderOptions.events = oldEvents;\n        }\n\n        if (recursive) {\n            for (let i = 0; i < this.length; i++) {\n                const el = this.get(i);\n                if (el.isClassOrSubclass('Stream')) {\n                    el.resetRenderOptions(recursive, preserveEvents);\n                }\n            }\n        }\n        return this;\n    }\n\n\n//  * *********  VexFlow functionality\n\n    /**\n     * Uses {@link music21.vfShow.Renderer} to render Vexflow onto an\n     * existing canvas object.\n     *\n     * Sets canvas.storedStream to this\n     *\n     * Runs `this.setRenderInteraction` on the canvas.\n     *\n     * Will be moved to vfShow eventually when converter objects are enabled...maybe.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject|JQueryDOMObject} canvas - a canvas object\n     * @returns {music21.stream.Stream} this\n     */\n    renderVexflowOnCanvas(canvas) {\n        if (canvas.jquery) {\n            canvas = canvas[0];\n        }\n        const vfr = new vfShow.Renderer(this, canvas);\n        vfr.render();\n        canvas.storedStream = this;\n        this.setRenderInteraction(canvas);\n        return this;\n    }\n\n    /**\n     * Estimate the stream height for the Stream.\n     *\n     * If there are systems they will be incorporated into the height unless `ignoreSystems` is `true`.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Boolean} [ignoreSystems=false]\n     * @returns {number} height in pixels\n     */\n    estimateStreamHeight(ignoreSystems) {\n        const staffHeight = this.renderOptions.naiveHeight;\n        const systemPadding = this.systemPadding;\n        let numSystems;\n        if (this.isClassOrSubclass('Score')) {\n            const numParts = this.length;\n            numSystems = this.numSystems();\n            if (numSystems === undefined || ignoreSystems) {\n                numSystems = 1;\n            }\n            const scoreHeight = (numSystems * staffHeight * numParts) + ((numSystems - 1) * systemPadding);\n            // console.log('scoreHeight of ' + scoreHeight);\n            return scoreHeight;\n        } else if (this.isClassOrSubclass('Part')) {\n            numSystems = 1;\n            if (!ignoreSystems) {\n                numSystems = this.numSystems();\n            }\n            if (debug) {\n                console.log('estimateStreamHeight for Part: numSystems [' + numSystems +\n                        '] * staffHeight [' + staffHeight + '] + (numSystems [' + numSystems +\n                        '] - 1) * systemPadding [' + systemPadding + '].'\n                );\n            }\n            return (numSystems * staffHeight) + ((numSystems - 1) * systemPadding);\n        } else {\n            return staffHeight;\n        }\n    }\n\n    /**\n     * Estimates the length of the Stream in pixels.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {number} length in pixels\n     */\n    estimateStaffLength() {\n        let i;\n        let totalLength;\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        if (this.hasVoices()) {\n            let maxLength = 0;\n            for (i = 0; i < this.length; i++) {\n                const v = this.get(i);\n                if (v.isClassOrSubclass('Stream')) {\n                    const thisLength = v.estimateStaffLength() + v.renderOptions.staffPadding;\n                    if (thisLength > maxLength) {\n                        maxLength = thisLength;\n                    }\n                }\n            }\n            return maxLength;\n        } else if (this.hasSubStreams()) { // part\n            totalLength = 0;\n            for (i = 0; i < this.length; i++) {\n                const m = this.get(i);\n                if (m.isClassOrSubclass('Stream')) {\n                    totalLength += m.estimateStaffLength() + m.renderOptions.staffPadding;\n                    if ((i !== 0) && (m.renderOptions.startNewSystem === true)) {\n                        break;\n                    }\n                }\n            }\n            return totalLength;\n        } else {\n            const rendOp = this.renderOptions;\n            totalLength = 30 * this.length;\n            totalLength += rendOp.displayClef ? 20 : 0;\n            totalLength += (rendOp.displayKeySignature && this.keySignature) ? this.keySignature.width : 0;\n            totalLength += rendOp.displayTimeSignature ? 30 : 0;\n            // totalLength += rendOp.staffPadding;\n            return totalLength;\n        }\n    }\n\n//  * ***** MIDI related routines...\n\n    /**\n     * Plays the Stream through the MIDI/sound playback (for now, only MIDI.js is supported)\n     *\n     * `options` can be an object containing:\n     * - instrument: {@link music21.instrument.Instrument} object (default, `this.instrument`)\n     * - tempo: number (default, `this.tempo`)\n     *\n     * Does not have functionality for stopping etc., will be removed eventually\n     * and replaced with something better in {@link music21.streamInteraction}\n     *\n     * @memberof music21.stream.Stream\n     * @param {object} [options] - object of playback options\n     * @returns {music21.stream.Stream} this\n     */\n    playStream(options) {\n        const params = {\n            instrument: this.instrument,\n            tempo: this.tempo,\n            done: undefined,\n            startNote: undefined,\n        };\n        common.merge(params, options);\n        const startNote = params.startNote;\n        let currentNote = 0;\n        if (startNote !== undefined) {\n            currentNote = startNote;\n        }\n        const flatEls = this.flat.elements;\n        const lastNote = flatEls.length;\n        this._stopPlaying = false;\n        const thisStream = this;\n\n        const playNext = function playNext(elements, params) {\n            if (currentNote < lastNote && !thisStream._stopPlaying) {\n                const el = elements[currentNote];\n                let nextNote;\n                if (currentNote < lastNote + 1) {\n                    nextNote = elements[currentNote + 1];\n                }\n                let milliseconds = 0;\n                if (el.playMidi !== undefined) {\n                    milliseconds = el.playMidi(params.tempo, nextNote, params);\n                }\n                currentNote += 1;\n                setTimeout(() => { playNext(elements, params); }, milliseconds);\n            } else if (params && params.done) {\n                params.done.call();\n            }\n        };\n        playNext(flatEls, params);\n        return this;\n    }\n\n    /**\n     * Stops a stream from playing if it currently is.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {musci21.stream.Stream} this\n     */\n    stopPlayStream() {\n        // turns off all currently playing MIDI notes (on any stream) and stops playback.\n        this._stopPlaying = true;\n        for (let i = 0; i < 127; i++) {\n            MIDI.noteOff(0, i, 0);\n        }\n        return this;\n    }\n    /* ----------------------------------------------------------------------\n     *\n     *  Canvas routines -- to be factored out eventually.\n     *\n     */\n\n    /**\n     * Creates and returns a new `&lt;canvas&gt;` object.\n     *\n     * Calls setSubstreamRenderOptions() first.\n     *\n     * Does not render on canvas.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} width - will use `this.estimateStaffLength()` + `this.renderOptions.staffPadding` if not given\n     * @param {number|string|undefined} height - if undefined will use `this.renderOptions.height`. If still undefined, will use `this.estimateStreamHeight()`\n     * @returns {JQueryDOMObject} canvas in jquery.\n     */\n    createNewCanvas(width, height) {\n        if (this.hasSubStreams()) {\n            this.setSubstreamRenderOptions();\n        }\n\n        const newCanvas = $('<canvas/>'); // .css('border', '1px red solid');\n\n        if (width !== undefined) {\n            if (typeof width === 'string') {\n                width = common.stripPx(width);\n            }\n            newCanvas.attr('width', width);\n        } else {\n            const computedWidth = this.estimateStaffLength() + this.renderOptions.staffPadding + 0;\n            newCanvas.attr('width', computedWidth);\n        }\n        if (height !== undefined) {\n            newCanvas.attr('height', height);\n        } else {\n            let computedHeight;\n            if (this.renderOptions.height === undefined) {\n                computedHeight = this.estimateStreamHeight();\n                // console.log('computed Height estim: ' + computedHeight);\n            } else {\n                computedHeight = this.renderOptions.height;\n                // console.log('computed Height: ' + computedHeight);\n            }\n            newCanvas.attr('height', computedHeight * this.renderOptions.scaleFactor.y);\n        }\n        return newCanvas;\n    }\n\n    /**\n     * Creates a rendered, playable canvas where clicking plays it.\n     *\n     * Called from appendNewCanvas() etc.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} width\n     * @param {number|string|undefined} height\n     * @returns {JQueryDOMObject} canvas\n     */\n    createPlayableCanvas(width, height) {\n        this.renderOptions.events.click = 'play';\n        return this.createCanvas(width, height);\n    }\n\n    /**\n     * Creates a new canvas and renders vexflow on it\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} [width]\n     * @param {number|string|undefined} [height]\n     * @returns {JQueryDOMObject} canvas\n     */\n    createCanvas(width, height) {\n        const $newCanvas = this.createNewCanvas(width, height);\n        this.renderVexflowOnCanvas($newCanvas);\n        return $newCanvas;\n    }\n    /**\n     * Creates a new canvas, renders vexflow on it, and appends it to the DOM.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject|DOMObject} [appendElement=document.body] - where to place the canvas\n     * @param {number|string} [width]\n     * @param {number|string} [height]\n     * @returns {DOMObject} canvas (not the jQueryDOMObject -- this is a difference with other routines and should be fixed. TODO: FIX)\n     *\n     */\n    appendNewCanvas(appendElement, width, height) {\n        if (appendElement === undefined) {\n            appendElement = 'body';\n        }\n        let $appendElement = appendElement;\n        if (appendElement.jquery === undefined) {\n            $appendElement = $(appendElement);\n        }\n\n//      if (width === undefined && this.renderOptions.maxSystemWidth === undefined) {\n//      var $bodyElement = bodyElement;\n//      if (bodyElement.jquery === undefined) {\n//      $bodyElement = $(bodyElement);\n//      }\n//      width = $bodyElement.width();\n//      };\n\n        const canvasBlock = this.createCanvas(width, height);\n        $appendElement.append(canvasBlock);\n        return canvasBlock[0];\n    }\n\n    /**\n     * Replaces a particular Canvas with a new rendering of one.\n     *\n     * Note that if 'where' is empty, will replace all canvases on the page.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject|DOMObject} [where] - the canvas to replace or a container holding the canvas(es) to replace.\n     * @param {Boolean} [preserveCanvasSize=false]\n     * @returns {JQueryDOMObject} the canvas\n     */\n    replaceCanvas(where, preserveCanvasSize) {\n        // if called with no where, replaces all the canvases on the page...\n        if (where === undefined) {\n            where = 'body';\n        }\n        let $where;\n        if (where.jquery === undefined) {\n            $where = $(where);\n        } else {\n            $where = where;\n            where = $where[0];\n        }\n        let $oldCanvas;\n        if ($where.prop('tagName') === 'CANVAS') {\n            $oldCanvas = $where;\n        } else {\n            $oldCanvas = $where.find('canvas');\n        }\n        // TODO: Max Width!\n        if ($oldCanvas.length === 0) {\n            throw new Music21Exception('No canvas defined for replaceCanvas!');\n        } else if ($oldCanvas.length > 1) {\n            // change last canvas...\n            // replacing each with canvasBlock doesn't work\n            // anyhow, it just resizes the canvas but doesn't\n            // draw.\n            $oldCanvas = $($oldCanvas[$oldCanvas.length - 1]);\n        }\n\n        let canvasBlock;\n        if (preserveCanvasSize) {\n            const width = $oldCanvas.width();\n            const height = $oldCanvas.height();\n            canvasBlock = this.createCanvas(width, height);\n        } else {\n            canvasBlock = this.createCanvas();\n        }\n\n        $oldCanvas.replaceWith(canvasBlock);\n        return canvasBlock;\n    }\n\n    /**\n     * Renders a canvas which has a scrollbar when clicked.\n     *\n     * (this is a dumb way of doing this.  Expect it to disappear...)\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject|DOMObject} [where]\n     * @returns {DOMObject} canvas\n     */\n    renderScrollableCanvas(where) {\n        let $where = where;\n        if (where === undefined) {\n            $where = $(document.body);\n        } else if (where.jquery === undefined) {\n            $where = $(where);\n        }\n        const $innerDiv = $('<div>').css('position', 'absolute');\n        let c;\n        this.renderOptions.events.click = (function renderOptionsOuterEventClick(storedThis) {\n            return (function renderOptionsInnerEventClick(event) {\n                storedThis.scrollScoreStart(c, event);\n            });\n        }(this)); // create new function with this stream as storedThis\n        c = this.appendNewCanvas($innerDiv);\n        this.setRenderInteraction($innerDiv);\n        $where.append($innerDiv);\n        return c;\n    }\n\n    /**\n     * Sets up a {@link music21.streamInteraction.ScrollPlayer} for this\n     * canvas.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} c - canvas\n     * @param {Event} [event] - the event that caused the scrolling to start\n     * (needed because `event.stopPropagation()` is called)\n     * @returns {music21.streamInteraction.ScrollPlayer}\n     */\n    scrollScoreStart(c, event) {\n        const scrollPlayer = new streamInteraction.ScrollPlayer(this, c);\n        scrollPlayer.startPlaying();\n        if (event !== undefined) {\n            event.stopPropagation();\n        }\n        return scrollPlayer;\n    }\n\n\n    /**\n     * Set the type of interaction on the canvas based on\n     *    - Stream.renderOptions.events.click\n     *    - Stream.renderOptions.events.dblclick\n     *    - Stream.renderOptions.events.resize\n     *\n     * Currently the only options available for each are:\n     *    - 'play' (string)\n     *    - 'reflow' (string; only on event.resize)\n     *    - customFunction (will receive event as a first variable; should set up a way to\n     *                    find the original stream; var s = this; var f = function () { s...}\n     *                   )\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvasOrDiv - canvas or the Div surrounding it.\n     * @returns {music21.stream.Stream} this\n     */\n    setRenderInteraction(canvasOrDiv) {\n        let $canvas = canvasOrDiv;\n        if (canvasOrDiv === undefined) {\n            return this;\n        } else if (canvasOrDiv.jquery === undefined) {\n            $canvas = $(canvasOrDiv);\n        }\n        // TODO: assumes that canvas has a .storedStream function? can this be done by setting\n        // a variable var storedStream = this; and thus get rid of the assumption?\n        const playFunc = (function playStreamBound() { this.playStream(); }).bind(this);\n\n        $.each(this.renderOptions.events, $.proxy(function setRenderInteractionProxy(eventType, eventFunction) {\n            $canvas.off(eventType);\n            if (typeof (eventFunction) === 'string' && eventFunction === 'play') {\n                $canvas.on(eventType, playFunc);\n            } else if (typeof (eventFunction) === 'string' && eventType === 'resize' && eventFunction === 'reflow') {\n                this.windowReflowStart($canvas);\n            } else if (eventFunction !== undefined) {\n                $canvas.on(eventType, eventFunction);\n            }\n        }, this));\n        return this;\n    }\n\n    /**\n     *\n     * Recursively search downward for the closest storedVexflowStave...\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Vex.Flow.Stave|undefined}\n     */\n    recursiveGetStoredVexflowStave() {\n        let storedVFStave = this.storedVexflowStave;\n        if (storedVFStave === undefined) {\n            if (!this.hasSubStreams()) {\n                return undefined;\n            } else {\n                const subStreams = this.getElementsByClass('Stream');\n                storedVFStave = subStreams.get(0).storedVexflowStave;\n                if (storedVFStave === undefined) {\n                    // TODO: bad programming ... should support continuous recurse\n                    // but good enough for now...\n                    if (subStreams.get(0).hasSubStreams()) {\n                        storedVFStave = subStreams.get(0).get(0).storedVexflowStave;\n                    }\n                }\n            }\n        }\n        return storedVFStave;\n    }\n\n    /**\n     * Given a mouse click, or other event with .pageX and .pageY,\n     * find the x and y for the canvas.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvas\n     * @param {Event} e\n     * @returns {Array<number>} two-elements, [x, y] in pixels.\n     */\n    getUnscaledXYforCanvas(canvas, e) {\n        let offset = null;\n        if (canvas === undefined) {\n            offset = { left: 0, top: 0 };\n        } else {\n            offset = $(canvas).offset();\n        }\n        /*\n         * mouse event handler code from: http://diveintohtml5.org/canvas.html\n         */\n        let xClick;\n        let yClick;\n        if (e.pageX !== undefined && e.pageY !== undefined) {\n            xClick = e.pageX;\n            yClick = e.pageY;\n        } else {\n            xClick = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\n            yClick = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\n        }\n        const xPx = (xClick - offset.left);\n        const yPx = (yClick - offset.top);\n        return [xPx, yPx];\n    }\n\n    /**\n     * return a list of [scaledX, scaledY] for\n     * a canvas element.\n     *\n     * xScaled refers to 1/scaleFactor.x -- for instance, scaleFactor.x = 0.7 (default)\n     * x of 1 gives 1.42857...\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvas\n     * @param {Event} e\n     * @returns {Array<number>} [scaledX, scaledY]\n     */\n    getScaledXYforCanvas(canvas, e) {\n        const [xPx, yPx] = this.getUnscaledXYforCanvas(canvas, e);\n        const pixelScaling = this.renderOptions.scaleFactor;\n\n        const yPxScaled = yPx / pixelScaling.y;\n        const xPxScaled = xPx / pixelScaling.x;\n        return [xPxScaled, yPxScaled];\n    }\n    /**\n     *\n     * Given a Y position find the diatonicNoteNum that a note at that position would have.\n     *\n     * searches this.storedVexflowStave\n     *\n     * Y position must be offset from the start of the stave...\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} yPxScaled\n     * @returns {Int}\n     */\n    diatonicNoteNumFromScaledY(yPxScaled) {\n        const storedVFStave = this.recursiveGetStoredVexflowStave();\n        // for (var i = -10; i < 10; i++) {\n        //    console.log(\"line: \" + i + \" y: \" + storedVFStave.getYForLine(i));\n        // }\n        const lineSpacing = storedVFStave.options.spacing_between_lines_px;\n        const linesAboveStaff = storedVFStave.options.space_above_staff_ln;\n\n        const notesFromTop = yPxScaled * 2 / lineSpacing;\n        const notesAboveLowestLine = ((storedVFStave.options.num_lines - 1 + linesAboveStaff) * 2) - notesFromTop;\n        const clickedDiatonicNoteNum = this.clef.lowestLine + Math.round(notesAboveLowestLine);\n        return clickedDiatonicNoteNum;\n    }\n\n    /**\n     *\n     * Return the note at pixel X (or within allowablePixels [default 10])\n     * of the note.\n     *\n     * systemIndex element is not used on bare Stream\n\n     * @memberof music21.stream.Stream\n     * @param {number} xPxScaled\n     * @param {number} [allowablePixels=10]\n     * @param {number} [unused_systemIndex]\n     * @returns {music21.base.Music21Object|undefined}\n     */\n    noteElementFromScaledX(xPxScaled, allowablePixels, unused_systemIndex) {\n        let foundNote;\n        if (allowablePixels === undefined) {\n            allowablePixels = 10;\n        }\n\n        for (let i = 0; i < this.length; i++) {\n            const n = this.get(i);\n            /* should also\n             * compensate for accidentals...\n             */\n            if (xPxScaled > (n.x - allowablePixels)\n                    && xPxScaled < (n.x + n.width + allowablePixels)) {\n                foundNote = n;\n                break; /* O(n); can be made O(log n) */\n            }\n        }\n        // console.log(n.pitch.nameWithOctave);\n        return foundNote;\n    }\n\n    /**\n     * Given an event object, and an x and y location, returns a two-element array\n     * of the pitch.Pitch.diatonicNoteNum that was clicked (i.e., if C4 was clicked this\n     * will return 29; if D4 was clicked this will return 30) and the closest note in the\n     * stream that was clicked.\n     *\n     * Return a list of [diatonicNoteNum, closestXNote]\n     * for an event (e) called on the canvas (canvas)\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvas\n     * @param {Event} e\n     * @param {number} x\n     * @param {number} y\n     * @returns {Array} [diatonicNoteNum, closestXNote]\n     */\n    findNoteForClick(canvas, e, x, y) {\n        if (x === undefined || y === undefined) {\n            [x, y] = this.getScaledXYforCanvas(canvas, e);\n        }\n        const clickedDiatonicNoteNum = this.diatonicNoteNumFromScaledY(y);\n        const foundNote = this.noteElementFromScaledX(x);\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * Change the pitch of a note given that it has been clicked and then\n     * call changedCallbackFunction\n     *\n     * To be removed...\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} clickedDiatonicNoteNum\n     * @param {music21.base.Music21Object} foundNote\n     * @param {DOMObject} canvas\n     * @returns {any} output of changedCallbackFunction\n     */\n    noteChanged(clickedDiatonicNoteNum, foundNote, canvas) {\n        const n = foundNote;\n        const p = new pitch.Pitch('C');\n        p.diatonicNoteNum = clickedDiatonicNoteNum;\n        p.accidental = n.pitch.accidental;\n        n.pitch = p;\n        n.stemDirection = undefined;\n        this.activeNote = n;\n        this.redrawCanvas(canvas);\n        if (this.changedCallbackFunction !== undefined) {\n            return this.changedCallbackFunction({ foundNote: n, canvas });\n        } else {\n            return undefined;\n        }\n    }\n    /**\n     * Redraws a canvas, keeping the events of the previous canvas.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvas\n     * @returns {music21.stream.Stream} this\n     */\n    redrawCanvas(canvas) {\n        // this.resetRenderOptions(true, true); // recursive, preserveEvents\n        // this.setSubstreamRenderOptions();\n        const $canvas = $(canvas); // works even if canvas is already $jquery\n        const $newCanv = this.createNewCanvas(canvas.width,\n                canvas.height);\n        this.renderVexflowOnCanvas($newCanv);\n        $canvas.replaceWith($newCanv);\n        common.jQueryEventCopy($.event, $canvas, $newCanv); /* copy events -- using custom extension... */\n        return this;\n    }\n\n    /**\n     * Renders a stream on a canvas with the ability to edit it and\n     * a toolbar that allows the accidentals to be edited.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} [width]\n     * @param {number} [height]\n     * @returns {DOMObject} &lt;div&gt; tag around the canvas.\n     */\n    editableAccidentalCanvas(width, height) {\n        /*\n         * Create an editable canvas with an accidental selection bar.\n         */\n        const d = $('<div/>').css('text-align', 'left').css('position', 'relative');\n        const buttonDiv = this.getAccidentalToolbar();\n        d.append(buttonDiv);\n        d.append($(\"<br clear='all'/>\"));\n        this.renderOptions.events.click = this.canvasChangerFunction;\n        this.appendNewCanvas(d, width, height); // var can =\n        return d;\n    }\n\n\n    /*\n     * Canvas toolbars...\n     */\n\n    /**\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} minAccidental - alter of the min accidental (default -1)\n     * @param {Int} maxAccidental - alter of the max accidental (default 1)\n     * @returns {DOMObject} the accidental toolbar.\n     */\n    getAccidentalToolbar(minAccidental, maxAccidental) {\n        if (minAccidental === undefined) {\n            minAccidental = -1;\n        }\n        if (maxAccidental === undefined) {\n            maxAccidental = 1;\n        }\n        minAccidental = Math.round(minAccidental);\n        maxAccidental = Math.round(maxAccidental);\n\n        const addAccidental = function addAccidentalClicked(clickedButton, alter) {\n            /*\n             * To be called on a button...\n             *   this will usually refer to a window Object\n             */\n            const accidentalToolbar = $(clickedButton).parent();\n            const siblingCanvas = accidentalToolbar.parent().find('canvas');\n            const s = siblingCanvas[0].storedStream;\n            if (s.activeNote !== undefined) {\n                const n = s.activeNote;\n                n.pitch.accidental = new pitch.Accidental(alter);\n                /* console.log(n.pitch.name); */\n                s.redrawCanvas(siblingCanvas[0]);\n                if (s.changedCallbackFunction !== undefined) {\n                    s.changedCallbackFunction({ canvas: siblingCanvas[0] });\n                }\n            }\n        };\n\n\n        const buttonDiv = $('<div/>').attr('class', 'buttonToolbar vexflowToolbar').css('position', 'absolute').css('top', '10px');\n        buttonDiv.append($('<span/>').css('margin-left', '50px'));\n        const clickFunc = function addAccidentalClickFunc() {\n            addAccidental(this, $(this).data('alter'));\n        };\n        for (let i = minAccidental; i <= maxAccidental; i++) {\n            const acc = new pitch.Accidental(i);\n            buttonDiv.append($('<button>' + acc.unicodeModifier + '</button>')\n                    .data('alter', i)\n                    .click(clickFunc)\n//                  .css('font-family', 'Bravura')\n//                  .css('font-size', '40px')\n            );\n        }\n        return buttonDiv;\n    }\n    /**\n     *\n     * @memberof music21.stream.Stream\n     * @returns {DOMObject} a play toolbar\n     */\n    getPlayToolbar() {\n        const buttonDiv = $('<div/>').attr('class', 'playToolbar vexflowToolbar').css('position', 'absolute').css('top', '10px');\n        buttonDiv.append($('<span/>').css('margin-left', '50px'));\n        const bPlay = $('<button>&#9658</button>');\n        bPlay.click(() => { this.playStream(); });\n        buttonDiv.append(bPlay);\n        const bStop = $('<button>&#9724</button>');\n        bStop.click(() => { this.stopPlayStream(); });\n        buttonDiv.append(bStop);\n        return buttonDiv;\n    }\n//  reflow\n\n    /**\n     * Begins a series of bound events to the window that makes it\n     * so that on resizing the stream is redrawn and reflowed to the\n     * new size.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject} jCanvas\n     * @returns {music21.stream.Stream} this\n     */\n    windowReflowStart(jCanvas) {\n        // set up a bunch of windowReflow bindings that affect the canvas.\n        const callingStream = this;\n        let jCanvasNow = jCanvas;\n        $(window).bind('resizeEnd', () => {\n            // do something, window hasn't changed size in 500ms\n            const jCanvasParent = jCanvasNow.parent();\n            const newWidth = jCanvasParent.width();\n            const canvasWidth = newWidth;\n            // console.log(canvasWidth);\n            console.log('resizeEnd triggered', newWidth);\n            // console.log(callingStream.renderOptions.events.click);\n            callingStream.resetRenderOptions(true, true); // recursive, preserveEvents\n            // console.log(callingStream.renderOptions.events.click);\n            callingStream.maxSystemWidth = canvasWidth - 40;\n            jCanvasNow.remove();\n            const canvasObj = callingStream.appendNewCanvas(jCanvasParent);\n            jCanvasNow = $(canvasObj);\n        });\n        $(window).resize(function resizeCanvasTo() {\n            if (this.resizeTO) {\n                clearTimeout(this.resizeTO);\n            }\n            this.resizeTO = setTimeout(function resizeToTimeout() {\n                $(this).trigger('resizeEnd');\n            }, 200);\n        });\n        setTimeout(function triggerResizeOnCreateCanvas() {\n            const $window = $(window);\n            const doResize = $window.data('triggerResizeOnCreateCanvas');\n            if (doResize === undefined || doResize === true) {\n                $(this).trigger('resizeEnd');\n                $window.data('triggerResizeOnCreateCanvas', false);\n            }\n        }, 1000);\n        return this;\n    }\n    /**\n     * Does this stream have a {@link music21.stream.Voice} inside it?\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasVoices() {\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Voice')) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n}\nstream.Stream = Stream;\n\n\n/**\n *\n * @class Voice\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Voice extends Stream {\n    constructor() {\n        super();\n        this.classes.push('Voice');\n    }\n}\nstream.Voice = Voice;\n\n\n/**\n * @class Measure\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Measure extends Stream {\n    constructor() {\n        super();\n        this.classes.push('Measure');\n        this.number = 0; // measure number\n    }\n}\nstream.Measure = Measure;\n\n/**\n * Part -- specialized to handle Measures inside it\n *\n * @class Part\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Part extends Stream {\n    constructor() {\n        super();\n        this.classes.push('Part');\n        this.systemHeight = this.renderOptions.naiveHeight;\n    }\n\n    /**\n     * How many systems does this Part have?\n     *\n     * Does not change any reflow information, so by default it's always 1.\n     *\n     * @memberof music21.stream.Part\n     * @returns {Number}\n     */\n    numSystems() {\n        let numSystems = 0;\n        const subStreams = this.getElementsByClass('Stream');\n        for (let i = 0; i < subStreams.length; i++) {\n            if (subStreams.get(i).renderOptions.startNewSystem) {\n                numSystems++;\n            }\n        }\n        if (numSystems === 0) {\n            numSystems = 1;\n        }\n        return numSystems;\n    }\n\n    /**\n     * Find the width of every measure in the Part.\n     *\n     * @memberof music21.stream.Part\n     * @returns {Array<number>}\n     */\n    getMeasureWidths() {\n        /* call after setSubstreamRenderOptions */\n        const measureWidths = [];\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Measure')) {\n                const elRendOp = el.renderOptions;\n                measureWidths[elRendOp.measureIndex] = elRendOp.width;\n            }\n        }\n        /* console.log(measureWidths);\n         *\n         */\n        return measureWidths;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#estimateStaffLength\n     *\n     * @memberof music21.stream.Part\n     * @returns {number}\n     */\n    estimateStaffLength() {\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        if (this.hasSubStreams()) { // part with Measures underneath\n            let totalLength = 0;\n            const subStreams = this.getElementsByClass('Measure');\n            for (let i = 0; i < subStreams.length; i++) {\n                const m = subStreams.get(i);\n                // this looks wrong, but actually seems to be right. moving it to\n                // after the break breaks things.\n                totalLength += m.estimateStaffLength() + m.renderOptions.staffPadding;\n                if ((i !== 0) && (m.renderOptions.startNewSystem === true)) {\n                    break;\n                }\n            }\n            return totalLength;\n        }\n        // no measures found in part... treat as measure\n        const tempM = new stream.Measure();\n        tempM.elements = this.elements;\n        return tempM.estimateStaffLength();\n    }\n    /**\n     * Divide a part up into systems and fix the measure\n     * widths so that they are all even.\n     *\n     * Note that this is done on the part level even though\n     * the measure widths need to be consistent across parts.\n     *\n     * This is possible because the system is deterministic and\n     * will come to the same result for each part.  Opportunity\n     * for making more efficient through this...\n     *\n     * @memberof music21.stream.Part\n     * @param systemHeight\n     * @returns {Array}\n     */\n    fixSystemInformation(systemHeight) {\n        /*\n         * console.log('system height: ' + systemHeight);\n         */\n        if (systemHeight === undefined) {\n            systemHeight = this.systemHeight; /* part.show() called... */\n        } else if (debug) {\n            console.log('overridden systemHeight: ' + systemHeight);\n        }\n        const systemPadding = this.renderOptions.systemPadding || this.renderOptions.naiveSystemPadding;\n        const measureWidths = this.getMeasureWidths();\n        const maxSystemWidth = this.maxSystemWidth; /* of course fix! */\n        const systemCurrentWidths = [];\n        const systemBreakIndexes = [];\n        let lastSystemBreak = 0; /* needed to ensure each line has at least one measure */\n        const startLeft = 20; /* TODO: make it obtained elsewhere */\n        let currentLeft = startLeft;\n        let i;\n        for (i = 0; i < measureWidths.length; i++) {\n            const currentRight = currentLeft + measureWidths[i];\n            /* console.log(\"left: \" + currentLeft + \" ; right: \" + currentRight + \" ; m: \" + i); */\n            if ((currentRight > maxSystemWidth) && (lastSystemBreak !== i)) {\n                systemBreakIndexes.push(i - 1);\n                systemCurrentWidths.push(currentLeft);\n                // console.log('setting new width at ' + currentLeft);\n                currentLeft = startLeft + measureWidths[i];\n                lastSystemBreak = i;\n            } else {\n                currentLeft = currentRight;\n            }\n        }\n        // console.log(systemCurrentWidths);\n        // console.log(systemBreakIndexes);\n\n        let currentSystemIndex = 0;\n        let leftSubtract = 0;\n        for (i = 0; i < this.length; i++) {\n            const m = this.get(i);\n            if (m.renderOptions === undefined) {\n                continue;\n            }\n            if (i === 0) {\n                m.renderOptions.startNewSystem = true;\n            }\n            currentLeft = m.renderOptions.left;\n\n            if (systemBreakIndexes.indexOf(i - 1) !== -1) {\n                /* first measure of new System */\n                leftSubtract = currentLeft - 20;\n                m.renderOptions.displayClef = true;\n                m.renderOptions.displayKeySignature = true;\n                m.renderOptions.startNewSystem = true;\n                currentSystemIndex++;\n            } else if (i !== 0) {\n                m.renderOptions.startNewSystem = false;\n                m.renderOptions.displayClef = false;\n                m.renderOptions.displayKeySignature = false;\n            }\n            m.renderOptions.systemIndex = currentSystemIndex;\n            let currentSystemMultiplier;\n            if (currentSystemIndex >= systemCurrentWidths.length) {\n                /* last system... non-justified */\n                currentSystemMultiplier = 1;\n            } else {\n                const currentSystemWidth = systemCurrentWidths[currentSystemIndex];\n                currentSystemMultiplier = maxSystemWidth / currentSystemWidth;\n                // console.log('systemMultiplier: ' + currentSystemMultiplier + ' max: ' + maxSystemWidth + ' current: ' + currentSystemWidth);\n            }\n            /* might make a small gap? fix? */\n            const newLeft = currentLeft - leftSubtract;\n            // console.log('M: ' + i + ' ; old left: ' + currentLeft + ' ; new Left: ' + newLeft);\n            m.renderOptions.left = Math.floor(newLeft * currentSystemMultiplier);\n            m.renderOptions.width = Math.floor(m.renderOptions.width * currentSystemMultiplier);\n            const newTop = m.renderOptions.top + (currentSystemIndex * (systemHeight + systemPadding));\n            // console.log('M: ' + i + '; New top: ' + newTop + \" ; old Top: \" + m.renderOptions.top);\n            m.renderOptions.top = newTop;\n        }\n\n        return systemCurrentWidths;\n    }\n    /**\n     * overrides music21.stream.Stream#setSubstreamRenderOptions\n     *\n     * figures out the `.left` and `.top` attributes for all contained measures\n     *\n     * @memberof music21.stream.Part\n     */\n    setSubstreamRenderOptions() {\n        let currentMeasureIndex = 0; /* 0 indexed for now */\n        let currentMeasureLeft = 20;\n        const rendOp = this.renderOptions;\n        let lastTimeSignature;\n        let lastKeySignature;\n        let lastClef;\n\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Measure')) {\n                const elRendOp = el.renderOptions;\n                elRendOp.measureIndex = currentMeasureIndex;\n                elRendOp.top = rendOp.top;\n                elRendOp.partIndex = rendOp.partIndex;\n                elRendOp.left = currentMeasureLeft;\n\n                if (currentMeasureIndex === 0) {\n                    lastClef = el._clef;\n                    lastTimeSignature = el._timeSignature;\n                    lastKeySignature = el._keySignature;\n\n                    elRendOp.displayClef = true;\n                    elRendOp.displayKeySignature = true;\n                    elRendOp.displayTimeSignature = true;\n                } else {\n                    if (el._clef !== undefined\n                            && lastClef !== undefined\n                            && el._clef.name !== lastClef.name) {\n                        console.log('changing clefs for ', elRendOp.measureIndex, ' from ',\n                                lastClef.name, ' to ', el._clef.name);\n                        lastClef = el._clef;\n                        elRendOp.displayClef = true;\n                    } else {\n                        elRendOp.displayClef = false;\n                    }\n\n                    if (el._keySignature !== undefined\n                            && lastKeySignature !== undefined\n                            && el._keySignature.sharps !== lastKeySignature.sharps) {\n                        lastKeySignature = el._keySignature;\n                        elRendOp.displayKeySignature = true;\n                    } else {\n                        elRendOp.displayKeySignature = false;\n                    }\n\n                    if (el._timeSignature !== undefined && lastTimeSignature !== undefined &&\n                            el._timeSignature.ratioString !== lastTimeSignature.ratioString) {\n                        lastTimeSignature = el._timeSignature;\n                        elRendOp.displayTimeSignature = true;\n                    } else {\n                        elRendOp.displayTimeSignature = false;\n                    }\n                }\n                elRendOp.width = el.estimateStaffLength() + elRendOp.staffPadding;\n                elRendOp.height = el.estimateStreamHeight();\n                currentMeasureLeft += elRendOp.width;\n                currentMeasureIndex++;\n            }\n        }\n        return this;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#findNoteForClick\n     * by taking into account systems\n     *\n     * @memberof music21.stream.Part\n     * @param {DOMObject} canvas\n     * @param {Event} e\n     * @returns {Array} [clickedDiatonicNoteNum, foundNote]\n     */\n    findNoteForClick(canvas, e) {\n        const [x, y] = this.getScaledXYforCanvas(canvas, e);\n\n        // debug = true;\n        if (debug) {\n            console.log('this.estimateStreamHeight(): ' +\n                    this.estimateStreamHeight() + ' / $(canvas).height(): ' + $(canvas).height());\n        }\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            systemPadding =  this.renderOptions.naiveSystemPadding;\n        }\n        const systemIndex = Math.floor(y / (this.systemHeight + systemPadding));\n        const scaledYRelativeToSystem = y - systemIndex * (this.systemHeight + systemPadding);\n        const clickedDiatonicNoteNum = this.diatonicNoteNumFromScaledY(scaledYRelativeToSystem);\n\n        const foundNote = this.noteElementFromScaledX(x, undefined, systemIndex);\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * Override the noteElementFromScaledX for Stream\n     * to take into account sub measures...\n     *\n     * @memberof music21.stream.Part\n     * @param {number} scaledX\n     * @param {number} allowablePixels\n     * @param {Int} systemIndex\n     * @returns {music21.base.Music21Object|undefined}\n     */\n    noteElementFromScaledX(scaledX, allowablePixels, systemIndex) {\n        let gotMeasure;\n        for (let i = 0; i < this.length; i++) {\n            // TODO: if not measure, do not crash...\n            const m = this.get(i);\n            const rendOp = m.renderOptions;\n            const left = rendOp.left;\n            const right = left + rendOp.width;\n            const top = rendOp.top;\n            const bottom = top + rendOp.height;\n            if (debug) {\n                console.log('Searching for X:' + Math.round(scaledX) +\n                        ' in M ' + i +\n                        ' with boundaries L:' + left + ' R:' + right +\n                        ' T: ' + top + ' B: ' + bottom);\n            }\n            if (scaledX >= left && scaledX <= right) {\n                if (systemIndex === undefined) {\n                    gotMeasure = m;\n                    break;\n                } else if (rendOp.systemIndex === systemIndex) {\n                    gotMeasure = m;\n                    break;\n                }\n            }\n        }\n        if (gotMeasure) {\n            return gotMeasure.noteElementFromScaledX(scaledX, allowablePixels);\n        } else {\n            return undefined;\n        }\n    }\n\n}\nstream.Part = Part;\n\n\n/**\n * Scores with multiple parts\n *\n * @class Score\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Score extends Stream {\n    constructor() {\n        super();\n        this.classes.push('Score');\n        this.measureWidths = [];\n        this.partSpacing = this.renderOptions.naiveHeight;\n    }\n    get systemPadding() {\n        const numParts = this.parts.length;\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            if (numParts === 1) {\n                systemPadding = this.renderOptions.naiveSystemPadding; // fix to 0\n            } else {\n                systemPadding = this.renderOptions.naiveSystemPadding;\n            }\n        }\n        return systemPadding;\n    }\n\n    /**\n     * overrides music21.stream.Stream#setSubstreamRenderOptions\n     *\n     * figures out the `.left` and `.top` attributes for all contained parts\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    setSubstreamRenderOptions() {\n        let currentPartNumber = 0;\n        let currentPartTop = 0;\n        const partSpacing = this.partSpacing;\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n\n            if (el.isClassOrSubclass('Part')) {\n                el.renderOptions.partIndex = currentPartNumber;\n                el.renderOptions.top = currentPartTop;\n                el.setSubstreamRenderOptions();\n                currentPartTop += partSpacing;\n                currentPartNumber++;\n            }\n        }\n        this.evenPartMeasureSpacing();\n        const ignoreNumSystems = true;\n        const currentScoreHeight = this.estimateStreamHeight(ignoreNumSystems);\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Part')) {\n                el.fixSystemInformation(currentScoreHeight);\n            }\n        }\n        this.renderOptions.height = this.estimateStreamHeight();\n        return this;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#estimateStaffLength\n     *\n     * @memberof music21.stream.Score\n     * @returns {number}\n     */\n    estimateStaffLength() {\n        // override\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        for (let i = 0; i < this.length; i++) {\n            const p = this.get(i);\n            if (p.isClassOrSubclass('Part')) {\n                return p.estimateStaffLength();\n            }\n        }\n        // no parts found in score... use part...\n        console.log('no parts found in score');\n        const tempPart = new stream.Part();\n        tempPart.elements = this.elements;\n        return tempPart.estimateStaffLength();\n    }\n\n    /* MIDI override */\n    /**\n     * Overrides the default music21.stream.Stream#playStream\n     *\n     * Works crappily -- just starts *n* midi players.\n     *\n     * Render scrollable score works better...\n     *\n     * @memberof music21.stream.Score\n     * @param {object} params -- passed to each part\n     * @returns {music21.stream.Score} this\n     */\n    playStream(params) {\n        // play multiple parts in parallel...\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Part')) {\n                el.playStream(params);\n            }\n        }\n        return this;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#stopPlayScore()\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    stopPlayStream() {\n        for (let i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Part')) {\n                el.stopPlayStream();\n            }\n        }\n        return this;\n    }\n    /*\n     * Canvas routines\n     */\n    /**\n     * call after setSubstreamRenderOptions\n     * gets the maximum measure width for each measure\n     * by getting the maximum for each measure of\n     * Part.getMeasureWidths();\n     *\n     * Does this work? I found a bug in this and fixed it that should have\n     * broken it!\n     *\n     * @memberof music21.stream.Score\n     * @returns {Array<number>}\n     */\n    getMaxMeasureWidths() {\n        const maxMeasureWidths = [];\n        const measureWidthsArrayOfArrays = [];\n        let i;\n        // TODO: Do not crash on not partlike...\n        for (i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            measureWidthsArrayOfArrays.push(el.getMeasureWidths());\n        }\n        for (i = 0; i < measureWidthsArrayOfArrays[0].length; i++) {\n            let maxFound = 0;\n            for (let j = 0; j < this.length; j++) {\n                if (measureWidthsArrayOfArrays[j][i] > maxFound) {\n                    maxFound = measureWidthsArrayOfArrays[j][i];\n                }\n            }\n            maxMeasureWidths.push(maxFound);\n        }\n        // console.log(measureWidths);\n        return maxMeasureWidths;\n    }\n\n    /**\n     * @memberof music21.stream.Score\n     * @param {DOMObject} canvas\n     * @param {Event} e\n     * @returns {Array} [diatonicNoteNum, m21Element]\n     */\n    findNoteForClick(canvas, e) {\n        /**\n         * Returns a list of [clickedDiatonicNoteNum, foundNote] for a\n         * click event, taking into account that the note will be in different\n         * Part objects (and different Systems) given the height and possibly different Systems.\n         *\n         */\n        const [x, y] = this.getScaledXYforCanvas(canvas, e);\n\n        const numParts = this.parts.length;\n        const systemHeight = numParts * this.partSpacing + this.systemPadding;\n        const systemIndex = Math.floor(y / systemHeight);\n        const scaledYFromSystemTop = y - systemIndex * systemHeight;\n        const partIndex = Math.floor(scaledYFromSystemTop / this.partSpacing);\n        const scaledYinPart = scaledYFromSystemTop - partIndex * this.partSpacing;\n        // console.log('systemIndex: ' + systemIndex + \" partIndex: \" + partIndex);\n        const rightPart = this.get(partIndex);\n        const clickedDiatonicNoteNum = rightPart.diatonicNoteNumFromScaledY(scaledYinPart);\n\n        const foundNote = rightPart.noteElementFromScaledX(x, undefined, systemIndex);\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * How many systems are there? Calls numSystems() on the first part.\n     *\n     * @memberof music21.stream.Score\n     * @returns {Int}\n     */\n    numSystems() {\n        return this.getElementsByClass('Part').get(0).numSystems();\n    }\n\n    /**\n     * Fixes the part measure spacing for all parts.\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    evenPartMeasureSpacing() {\n        const measureStacks = [];\n        let currentPartNumber = 0;\n        const maxMeasureWidth = [];\n        let i;\n        let j;\n        for (i = 0; i < this.length; i++) {\n            const el = this.get(i);\n            if (el.isClassOrSubclass('Part')) {\n                const measureWidths = el.getMeasureWidths();\n                for (j = 0; j < measureWidths.length; j++) {\n                    const thisMeasureWidth = measureWidths[j];\n                    if (measureStacks[j] === undefined) {\n                        measureStacks[j] = [];\n                        maxMeasureWidth[j] = thisMeasureWidth;\n                    } else if (thisMeasureWidth > maxMeasureWidth[j]) {\n                        maxMeasureWidth[j] = thisMeasureWidth;\n                    }\n                    measureStacks[j][currentPartNumber] = thisMeasureWidth;\n                }\n                currentPartNumber++;\n            }\n        }\n        let currentLeft = 20;\n        for (i = 0; i < maxMeasureWidth.length; i++) {\n            // TODO: do not assume, only elements in Score are Parts and in Parts are Measures...\n            const measureNewWidth = maxMeasureWidth[i];\n            for (j = 0; j < this.length; j++) {\n                const part = this.get(j);\n                const measure = part.get(i);\n                const rendOp = measure.renderOptions;\n                rendOp.width = measureNewWidth;\n                rendOp.left = currentLeft;\n            }\n            currentLeft += measureNewWidth;\n        }\n        return this;\n    }\n}\nstream.Score = Score;\n\n\n// small Class; a namedtuple in music21p\nexport class OffsetMap {\n    constructor(element, offset, endTime, voiceIndex) {\n        this.element = element;\n        this.offset = offset;\n        this.endTime = endTime;\n        this.voiceIndex = voiceIndex;\n    }\n}\nstream.OffsetMap = OffsetMap;\n\n// Tests...\n\nstream.tests = function streamTests() {\n    test('music21.stream.Stream', () => {\n        const s = new stream.Stream();\n        s.append(new note.Note('C#5'));\n        s.append(new note.Note('D#5'));\n        const n = new note.Note('F5');\n        n.duration.type = 'half';\n        s.append(n);\n        equal(s.length, 3, 'Simple stream length');\n    });\n\n    test('music21.stream.Stream.duration', () => {\n        const s = new stream.Stream();\n        equal(s.duration.quarterLength, 0, 'EmptyString QuarterLength');\n        s.append(new note.Note('C#5'));\n        equal(s.duration.quarterLength, 1.0, '1 quarter QuarterLength');\n        const n =  new note.Note('F5');\n        n.duration.type = 'half';\n        s.append(n);\n        equal(s.duration.quarterLength, 3.0, '3 quarter QuarterLength');\n        s.duration = new duration.Duration(3.0);\n        s.append(new note.Note('D#5'));\n        equal(s.duration.quarterLength, 3.0, 'overridden duration -- remains');\n\n        const sc = new stream.Score();\n        const p1 = new stream.Part();\n        const p2 = new stream.Part();\n        const m1 = new stream.Measure();\n        const m2 = new stream.Measure();\n        const n11 = new note.Note();\n        const n12 = new note.Note();\n        n12.duration.type = 'half';\n        const n13 = new note.Note();\n        n13.duration.type = 'eighth'; // incomplete measure\n        m1.append(n11);\n        m1.append(n12);\n        m1.append(n13);\n        const n21 = new note.Note();\n        n21.duration.type = 'whole';\n        m2.append(n21);\n        p1.append(m1);\n        p2.append(m2);\n        sc.insert(0, p1);\n        sc.insert(0, p2);\n        equal(sc.duration.quarterLength, 4.0, 'duration of streams with nested parts');\n        equal(sc.flat.duration.quarterLength, 4.0, 'duration of flat stream with overlapping notes');\n        n21.duration.type = 'half';\n        equal(sc.duration.quarterLength, 3.5, 'new duration with nested parts');\n        equal(sc.flat.duration.quarterLength, 3.5, 'new duration of flat stream');\n    });\n\n\n    test('music21.stream.Stream.insert and offsets', () => {\n        const s = new stream.Stream();\n        s.append(new note.Note('C#5'));\n        const n3 = new note.Note('E5');\n        s.insert(2.0, n3);\n        let n2 = new note.Note('D#5');\n        s.insert(1.0, n2);\n        equal(s.get(0).name, 'C#');\n        equal(s.get(1).name, 'D#');\n        equal(s.get(2).name, 'E');\n        equal(s.get(0).offset, 0.0);\n        equal(s.get(1).offset, 1.0);\n        equal(s.get(2).offset, 2.0);\n        const p = new stream.Part();\n        const m1 = new stream.Measure();\n        const n1 = new note.Note('C#');\n        n1.duration.type = 'whole';\n        m1.append(n1);\n        const m2 = new stream.Measure();\n        n2 = new note.Note('D#');\n        n2.duration.type = 'whole';\n        m2.append(n2);\n        p.append(m1);\n        p.append(m2);\n        equal(p.get(0).get(0).offset, 0.0);\n        const pf = p.flat;\n        equal(pf.get(1).offset, 4.0);\n        const pf2 = p.flat; // repeated calls do not change\n        equal(pf2.get(1).offset, 4.0, 'repeated calls do not change offset');\n        const pf3 = pf2.flat;\n        equal(pf3.get(1).offset, 4.0, '.flat.flat does not change offset');\n    });\n\n    test('music21.stream.Stream.canvas', () => {\n        const s = new stream.Stream();\n        s.append(new note.Note('C#5'));\n        s.append(new note.Note('D#5'));\n        const n = new note.Note('F5');\n        n.duration.type = 'half';\n        s.append(n);\n        const c = s.createNewCanvas(100, 50);\n        equal(c.attr('width'), 100, 'stored width matches');\n        equal(c.attr('height'), 50, 'stored height matches');\n    });\n\n    test('music21.stream.Stream.getElementsByClass', () => {\n        const s = new stream.Stream();\n        const n1 = new note.Note('C#5');\n        const n2 = new note.Note('D#5');\n        const r = new note.Rest();\n        const tc = new clef.TrebleClef();\n        s.append(tc);\n        s.append(n1);\n        s.append(r);\n        s.append(n2);\n        let c = s.getElementsByClass('Note');\n        equal(c.length, 2, 'got two notes');\n        equal(c.get(0), n1, 'n1 first');\n        equal(c.get(1), n2, 'n2 second');\n        c = s.getElementsByClass('Clef');\n        equal(c.length, 1, 'got clef from subclass');\n        c = s.getElementsByClass(['Note', 'TrebleClef']);\n        equal(c.length, 3, 'got multiple classes');\n        c = s.getElementsByClass('GeneralNote');\n        equal(c.length, 3, 'got multiple subclasses');\n    });\n    test('music21.stream.offsetMap', () => {\n        const n = new note.Note('G3');\n        const o = new note.Note('A3');\n        const s = new stream.Measure();\n        s.insert(0, n);\n        s.insert(0.5, o);\n        const om = s.offsetMap();\n        equal(om.length, 2, 'offsetMap should have length 2');\n        const omn = om[0];\n        const omo = om[1];\n        equal(omn.element, n, 'omn element should be n');\n        equal(omn.offset, 0.0, 'omn offset should be 0');\n        equal(omn.endTime, 1.0, 'omn endTime should be 1.0');\n        equal(omn.voiceIndex, undefined, 'omn voiceIndex should be undefined');\n        equal(omo.element, o, 'omo element should be o');\n        equal(omo.offset, 0.5, 'omo offset should be 0.5');\n        equal(omo.endTime, 1.5, 'omo endTime should be 1.5');\n    });\n    test('music21.stream.Stream appendNewCanvas ', () => {\n        const n = new note.Note('G3');\n        const s = new stream.Measure();\n        s.append(n);\n        s.appendNewCanvas(document.body);\n        equal(s.length, 1, 'ensure that should have one note');\n        const n1 = new note.Note('G3');\n        const s1 = new stream.Measure();\n        s1.append(n1);\n        const n2 = new note.Note('G3');\n        s1.append(n2);\n        const n3 = new note.Note('G3');\n        s1.append(n3);\n        const n4 = new note.Note('G3');\n        s1.append(n4);\n        const div1 = s1.editableAccidentalCanvas();\n        $(document.body).append(div1);\n    });\n};\n\n","// future -- rewrite of Score and Part to Page, System, SystemPart\n// not currently used\n// import * as $ from 'jquery';\n// import { base } from './base';\n// import { renderOptions } from './renderOptions';\nimport { stream } from './stream';\n// import { common } from './common';\n/**\n * Does not work yet, so not documented\n *\n */\nexport const layout = {};\nlayout.makeLayoutFromScore = function makeLayoutFromScore(score, containerWidth) {\n    /*\n     * Divide a part up into systems and fix the measure\n     * widths so that they are all even.\n     *\n     * Note that this is done on the part level even though\n     * the measure widths need to be consistent across parts.\n     *\n     * This is possible because the system is deterministic and\n     * will come to the same result for each part.  Opportunity\n     * for making more efficient through this...\n     */\n    // var systemHeight = score.systemHeight; /* part.show() called... */\n    // var systemPadding = score.systemPadding;\n    const parts = score.parts;\n    // console.log(parts);\n    const numParts = parts.length;\n    const partZero = parts[0];\n    const numMeasures = partZero.length;\n\n    const measureWidths = partZero.getMeasureWidths();\n    const maxSystemWidth = containerWidth || score.maxSystemWidth; /* of course fix! */\n\n    const layoutScore = new layout.LayoutScore();\n    const currentPage = new layout.Page(); // to-do multiple pages...\n    currentPage.measureStart = 1;\n    currentPage.measureEnd = numMeasures;\n\n    layoutScore.insert(0, currentPage);\n\n    let currentSystem = new layout.System();\n    let currentSystemNumber = 1;\n    currentSystem.measureStart = 1;\n    let currentStaves = [];\n\n    const staffMaker = (staffHolder, numParts, measureStart) => {\n        for (let pNum = 0; pNum < numParts; pNum++) {\n            const staff = new layout.Staff();\n            staff.measureStart = measureStart;\n            staff.staffNumber = pNum + 1;\n            staffHolder.push(staff);\n        }\n    };\n    staffMaker(currentStaves, numParts, 1);\n\n    const systemCurrentWidths = [];\n    const systemBreakIndexes = [];\n    let lastSystemBreak = 0; /* needed to ensure each line has at least one measure */\n    const startLeft = 20; /* TODO: make it obtained elsewhere */\n    let currentLeft = startLeft;\n    // let currentSystemTop = 0;\n    // var partTopOffsets = [];\n    // const ignoreSystemsInCalculatingScoreHeight = true;\n    // const systemHeight = score.estimateStreamHeight(ignoreSystemsInCalculatingScoreHeight);\n\n    for (let i = 0; i < measureWidths.length; i++) {\n        const currentRight = currentLeft + measureWidths[i];\n        /* console.log(\"left: \" + currentLeft + \" ; right: \" + currentRight + \" ; m: \" + i); */\n        if ((currentRight > maxSystemWidth) && (lastSystemBreak !== i)) {\n            // new system...\n            for (let j = 0; j < currentStaves.length; j++) {\n                currentStaves.measureEnd = i;\n                currentSystem.insert(0, currentStaves[j]);\n            }\n            currentStaves = [];\n            staffMaker(currentStaves, numParts, i + 1);\n            // currentSystemTop += systemHeight;\n            currentSystem.measureEnd = i;\n            currentPage.insert(0, currentSystem);\n            currentSystemNumber += 1;\n            currentSystem = new layout.System();\n            currentSystem.measureStart = i + 1;\n            currentSystem.systemNumber = currentSystemNumber;\n\n            systemBreakIndexes.push(i - 1);\n            systemCurrentWidths.push(currentLeft);\n            console.log('setting new width at ' + currentLeft + ' measure ' + i);\n            currentLeft = startLeft + measureWidths[i];\n            lastSystemBreak = i;\n        } else {\n            currentLeft = currentRight;\n        }\n        for (let pNum = 0; pNum < currentStaves.length; pNum++) {\n            currentStaves[pNum].append(parts[pNum].get(i));\n        }\n    }\n    for (let j = 0; j < currentStaves.length; j++) {\n        currentStaves.measureEnd = measureWidths.length - 1;\n        currentSystem.insert(0, currentStaves[j]);\n    }\n    currentPage.insert(0, currentSystem);\n    return layoutScore;\n};\n\n\nexport class LayoutScore extends stream.Score {\n    constructor() {\n        super();\n        this.classes.push('LayoutScore');\n        this.scoreLayout = undefined;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.top = 0;\n        this.left = 0;\n    }\n    get pages() { \n        return this.getElementsByClass('Page'); \n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n    /**\n     * return a tuple of (top, bottom) for a staff, specified by a given pageId,\n     * systemId, and staffId in PIXELS.\n    \n     * @param pageId\n     * @param systemId\n     * @param staffId\n     * @param units -- \"pixels\" or \"tenths\" (not supported)\n     */\n    \n    getPositionForStaff(pageId, systemId, staffId, units) {\n        units = units || 'pixels';\n    }\n}\nlayout.LayoutScore = LayoutScore;\n\n\n/**\n * All music must currently be on page 1.\n */\nexport class Page extends stream.Score {\n    constructor() {\n        super();\n        this.classes.push('Page');\n        this.pageNumber = 1;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this.systemStart = undefined;\n        this.systemEnd = undefined;\n        this.pageLayout = undefined;\n    }\n    get systems() {\n        return this.getElementsByClass('System');\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\nlayout.Page = Page;\n\nexport class System extends stream.Score {\n    constructor() {\n        super();\n        this.classes.push('System');\n        this.systemNumber = 1;\n        this.systemLayout = undefined;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.top = undefined;\n        this.left = undefined;\n    }\n    get staves() { \n        return this.getElementsByClass('Staff'); \n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\nlayout.System = System;\n\nexport class Staff extends stream.Part {\n    constructor() {\n        super();\n        this.classes.push('Staff');\n        this.staffNumber = 1;\n        this.optimized = 0;\n        this.top = undefined;\n        this.left = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.inheritedHeight = undefined;\n        this.staffLayout = undefined;\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\n\nlayout.Staff = Staff;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/roman -- roman.RomanNumberal -- Chord subclass\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21';\n\nimport { chord } from './chord';\nimport { debug } from './debug';\nimport { key } from './key';\nimport { pitch } from './pitch';\nimport { interval } from './interval';\n\n/**\n * Roman numeral module. See {@link music21.roman} namespace\n *\n * @exports music21/roman\n */\n/**\n * music21.roman -- namespace for dealing with RomanNumeral analysis.\n *\n * @namespace music21.roman\n * @memberof music21\n * @requires music21/chord\n * @requires music21/key\n * @requires music21/pitch\n * @requires music21/interval\n */\nexport const roman = {};\n\n/**\n * maps an index number to a roman numeral in lowercase\n *\n * @memberof music21.roman\n * @example\n * music21.roman.romanToNumber[4]\n * // 'iv'\n */\nroman.romanToNumber = [undefined, 'i', 'ii', 'iii', 'iv', 'v', 'vi', 'vii'];\n\n/**\n * Represents a RomanNumeral.  By default, capital Roman Numerals are\n * major chords; lowercase are minor.\n *\n * see music21p's roman module for better instructions.\n *\n * current limitations:\n *\n * no inversions\n * no numeric figures except 7\n * no d7 = dominant 7\n * no frontAlterationAccidentals\n * no secondary dominants\n * no Aug6th chords\n *\n * @class RomanNumeral\n * @memberof music21.roman\n * @extends music21.chord.Chord\n * @param {string} figure - the roman numeral as a string, e.g., 'IV', 'viio', 'V7'\n * @param {string|music21.key.Key} [keyStr='C']\n * @property {Array<music21.pitch.Pitch>} scale - (readonly) returns the scale associated with the roman numeral\n * @property {music21.key.Key} key - the key associated with the RomanNumeral (not allowed to be undefined yet)\n * @property {string} figure - the figure as passed in\n * @property {string} degreeName - the name associated with the scale degree, such as \"mediant\" etc., scale 7 will be \"leading tone\" or \"subtonic\" appropriately\n * @property {Int} scaleDegree\n * @property {string} impliedQuality - \"major\", \"minor\", \"diminished\", \"augmented\"\n * @property {Array<music21.pitch.Pitch>} pitches - RomanNumerals are Chord objects, so .pitches will work for them also.\n */\nexport class RomanNumeral extends chord.Chord {\n    constructor(figure, keyStr) {\n        super();\n        this.classes.push('RomanNumeral');\n        this.figure = figure;\n        this._scale = undefined;\n        this._key = undefined;\n        this.key = keyStr;\n        let currentFigure = figure;\n\n        let impliedQuality = 'major';\n        const lowercase = currentFigure.toLowerCase();\n        if (currentFigure.match('/o')) {\n            impliedQuality = 'half-diminished';\n            currentFigure = currentFigure.replace('/o', '');\n        } else if (currentFigure.match('o')) {\n            impliedQuality = 'diminished';\n            currentFigure = currentFigure.replace('o', '');\n        } else if (currentFigure === lowercase) {\n            impliedQuality = 'minor';\n        }\n\n        const numbersArr = currentFigure.match(/\\d+/);\n        this.numbers = undefined;\n        if (numbersArr != null) {\n            currentFigure = currentFigure.replace(/\\d+/, '');\n            this.numbers = parseInt(numbersArr[0]);\n        }\n\n        const scaleDegree = roman.romanToNumber.indexOf(currentFigure.toLowerCase());\n        if (scaleDegree === -1) {\n            throw new Music21Exception('Cannot make a romanNumeral from ' + currentFigure);\n        }\n        this.scaleDegree = scaleDegree;\n        this.root = this.scale[this.scaleDegree - 1];\n\n        if (this.key.mode === 'minor'\n            && (this.scaleDegree === 6\n                    || this.scaleDegree === 7)) {\n            if (['minor', 'diminished', 'half-diminished'].indexOf(impliedQuality) !== -1) {\n                const raiseTone = new interval.Interval('A1');\n                this.root = raiseTone.transposePitch(this.root);\n                if (debug) {\n                    console.log('raised root because minor/dim on scaleDegree 6 or 7');\n                }\n            }\n        }\n\n        /* temp hack */\n        if (this.numbers === 7) {\n            if (scaleDegree === 5 && impliedQuality === 'major') {\n                impliedQuality = 'dominant-seventh';\n            } else {\n                impliedQuality += '-seventh';\n            }\n        }\n\n        this.impliedQuality = impliedQuality;\n        this.updatePitches();\n    }\n    get scale() {\n        if (this._scale !== undefined) {\n            return this._scale;\n        } else {\n            this._scale = this.key.getScale();\n            return this._scale;\n        }\n    }\n    get key() {\n        return this._key;\n    }\n    set key(keyStr) {\n        if (typeof (keyStr) === 'string') {\n            this._key = new key.Key(keyStr);\n        } else if (typeof (keyStr) === 'undefined') {\n            this._key = new key.Key('C');\n        } else {\n            this._key = keyStr;\n        }\n    }\n    get degreeName() {\n        if (this.scaleDegree < 7) {\n            return [undefined,\n                    'Tonic',\n                    'Supertonic',\n                    'Mediant',\n                    'Subdominant',\n                    'Dominant',\n                    'Submediant'][this.scaleDegree];\n        } else {\n            const tonicPitch = new pitch.Pitch(this.key.tonic);\n            let diffRootToTonic = (tonicPitch.ps - this.root.ps) % 12;\n            if (diffRootToTonic < 0) {\n                diffRootToTonic += 12;\n            }\n            if (diffRootToTonic === 1) {\n                return 'Leading-tone';\n            } else {\n                return 'Subtonic';\n            }\n        }\n    }\n\n\n    /**\n     * Update the .pitches array.  Called at instantiation, but not automatically afterwards.\n     *\n     * @memberof music21.roman.RomanNumeral\n     */\n    updatePitches() {\n        const impliedQuality = this.impliedQuality;\n        const chordSpacing = chord.chordDefinitions[impliedQuality];\n        const chordPitches = [this.root];\n        let lastPitch = this.root;\n        for (let j = 0; j < chordSpacing.length; j++) {\n            // console.log('got them', lastPitch);\n            const thisTransStr = chordSpacing[j];\n            const thisTrans = new interval.Interval(thisTransStr);\n            const nextPitch = thisTrans.transposePitch(lastPitch);\n            chordPitches.push(nextPitch);\n            lastPitch = nextPitch;\n        }\n        this.pitches = chordPitches;\n    }\n\n    /**\n     * Gives a string display.  Note that since inversion is not yet supported\n     * it needs to be given separately.\n     *\n     * Inverting 7th chords does not work.\n     *\n     * @memberof music21.roman.RomanNumeral\n     * @param {string} displayType - ['roman', 'bassName', 'nameOnly', other]\n     * @param {Int} [inversion=0]\n     * @returns {String}\n     */\n    asString(displayType, inversion) {\n        const keyObj = this.key;\n        const tonic = keyObj.tonic;\n        const mode = keyObj.mode;\n\n        if (inversion === undefined) {\n            inversion = 0;\n        }\n        let inversionName = '';\n        if (inversion === 1) {\n            if (displayType === 'roman') {\n                inversionName = '6';\n            } else {\n                inversionName = ' (first inversion)';\n            }\n        } else if (inversion === 2) {\n            if (displayType === 'roman') {\n                inversionName = '64';\n            } else {\n                inversionName = ' (second inversion)';\n            }\n        }\n        let fullChordName;\n        let connector = ' in ';\n        let suffix = '';\n        if (displayType === 'roman') {\n            fullChordName = this.figure;\n        } else if (displayType === 'nameOnly') { // use only with only choice being TONIC\n            fullChordName = '';\n            connector = '';\n            suffix = ' triad';\n        } else if (displayType === 'bassName') {\n            fullChordName = this.bass().name.replace(/\\-/, 'b');\n            connector = ' in ';\n            suffix = '';\n        } else { // \"default\" submediant, etc...\n            fullChordName = this.degreeName;\n            if (this.numbers !== undefined) {\n                fullChordName += ' ' + this.numbers.toString();\n            }\n        }\n        let tonicDisplay = tonic.replace(/\\-/, 'b');\n        if (mode === 'minor') {\n            tonicDisplay = tonicDisplay.toLowerCase();\n        }\n        const chordStr = fullChordName + inversionName + connector + tonicDisplay + ' ' + mode + suffix;\n        return chordStr;\n    }\n}\nroman.RomanNumeral = RomanNumeral;\n\nroman.tests = () => {\n    test('music21.roman.RomanNumeral', () => {\n        const t1 = 'IV';\n        let rn1 = new roman.RomanNumeral(t1, 'F');\n        equal(rn1.scaleDegree, 4, 'test scale dgree of F IV');\n        const scale = rn1.scale;\n        equal(scale[0].name, 'F', 'test scale is F');\n        equal(rn1.root.name, 'B-', 'test root of F IV');\n        equal(rn1.impliedQuality, 'major', 'test quality is major');\n        equal(rn1.pitches[0].name, 'B-', 'test pitches[0] == B-');\n        equal(rn1.pitches[1].name, 'D', 'test pitches[1] == D');\n        equal(rn1.pitches[2].name, 'F', 'test pitches[2] == F');\n        equal(rn1.degreeName, 'Subdominant', 'test is Subdominant');\n\n        let t2 = 'viio7';\n        rn1 = new roman.RomanNumeral(t2, 'a');\n        equal(rn1.scaleDegree, 7, 'test scale dgree of A viio7');\n        equal(rn1.root.name, 'G#', 'test root name == G#');\n        equal(rn1.impliedQuality, 'diminished-seventh', 'implied quality');\n        equal(rn1.pitches[0].name, 'G#', 'test pitches[0] == G#');\n        equal(rn1.pitches[1].name, 'B', 'test pitches[1] == B');\n        equal(rn1.pitches[2].name, 'D', 'test pitches[2] == D');\n        equal(rn1.pitches[3].name, 'F', 'test pitches[3] == F');\n        equal(rn1.degreeName, 'Leading-tone', 'test is Leading-tone');\n\n        t2 = 'V7';\n        rn1 = new roman.RomanNumeral(t2, 'a');\n        equal(rn1.scaleDegree, 5, 'test scale dgree of a V7');\n        equal(rn1.root.name, 'E', 'root name is E');\n        equal(rn1.impliedQuality, 'dominant-seventh', 'implied quality dominant-seventh');\n        equal(rn1.pitches[0].name, 'E', 'test pitches[0] == E');\n        equal(rn1.pitches[1].name, 'G#', 'test pitches[1] == G#');\n        equal(rn1.pitches[2].name, 'B', 'test pitches[2] == B');\n        equal(rn1.pitches[3].name, 'D', 'test pitches[3] == D');\n        equal(rn1.degreeName, 'Dominant', 'test is Dominant');\n\n        t2 = 'VII';\n        rn1 = new roman.RomanNumeral(t2, 'f#');\n        equal(rn1.scaleDegree, 7, 'test scale dgree of a VII');\n        equal(rn1.root.name, 'E', 'root name is E');\n        equal(rn1.impliedQuality, 'major', 'implied quality major');\n        equal(rn1.pitches[0].name, 'E', 'test pitches[0] == E');\n        equal(rn1.pitches[1].name, 'G#', 'test pitches[1] == G#');\n        equal(rn1.pitches[2].name, 'B', 'test pitches[2] == B');\n        equal(rn1.degreeName, 'Subtonic', 'test is Subtonic');\n    });\n\n    test('music21.roman.RomanNumeral - inversions', () => {\n        const t1 = 'IV';\n        const rn1 = new roman.RomanNumeral(t1, 'F');\n        equal(rn1.scaleDegree, 4, 'test scale dgree of F IV');\n        const scale = rn1.scale;\n        equal(scale[0].name, 'F', 'test scale is F');\n        equal(rn1.root.name, 'B-', 'test root of F IV');\n        equal(rn1.impliedQuality, 'major', 'test quality is major');\n        equal(rn1.pitches[0].name, 'B-', 'test pitches[0] == B-');\n        equal(rn1.pitches[1].name, 'D', 'test pitches[1] == D');\n        equal(rn1.pitches[2].name, 'F', 'test pitches[2] == F');\n        equal(rn1.degreeName, 'Subdominant', 'test is Subdominant');\n    });\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/tempo -- tempo and (not in music21p) metronome objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as MIDI from 'MIDI';\nimport * as $ from 'jquery';\n\nimport { prebase } from './prebase';\n\n/* a Music21Object in m21p; the overhead is too high here to follow ... */\n/**\n * tempo module, see {@link music21.tempo}\n *\n * @exports music21/tempo\n */\n/**\n * tempo namespace\n *\n * @namespace music21.tempo\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/base\n * @requires MIDI\n * @property {number} [baseTempo=60] - basic tempo\n */\nexport const tempo = {};\n\n/**\n * Object mapping names to tempo values\n *\n * @name music21.tempo.defaultTempoValues\n * @memberof music21.tempo\n * @example\n * music21.tempo.defaultTempoValues.grave\n * // 40\n */\ntempo.defaultTempoValues = {\n    'larghissimo': 16,\n    'largamente': 32,\n    'grave': 40,\n    'molto adagio': 40,\n    'largo': 46,\n    'lento': 52,\n    'adagio': 56,\n    'slow': 56,\n    'langsam': 56,\n    'larghetto': 60,\n    'adagietto': 66,\n    'andante': 72,\n    'andantino': 80,\n    'andante moderato': 83,\n    'maestoso': 88,\n    'moderato': 92,\n    'moderate': 92,\n    'allegretto': 108,\n    'animato': 120,\n    'allegro moderato': 128,\n    'allegro': 132,\n    'fast': 132,\n    'schnell': 132,\n    'allegrissimo': 140,\n    'molto allegro': 144,\n    'trÃ¨s vite': 144,\n    'vivace': 160,\n    'vivacissimo': 168,\n    'presto': 184,\n    'prestissimo': 208,\n};\n\n\ntempo.baseTempo = 60;\n\n/* --------- metronome ---------- */\n/**\n *\n * @class Metronome\n * @memberof music21.tempo\n * @extends music21.prebase.ProtoM21Object\n * @param {number} [tempo=music21.tempo.baseTempo] - the tempo of the metronome to start\n * @property {number} tempo\n * @property {Int} [numBeatsPerMeasure=4]\n * @property {number} [minTempo=10]\n * @property {number} [maxTempo=600]\n * @property {bool} [flash=false] - flash the tempo\n * @property {bool} [silent=false] - play silently\n * @property {Int} beat - current beat number\n * @property {Int} chirpTimeout - an index of a timeout object for chirping\n */\nexport class Metronome extends prebase.ProtoM21Object {\n    constructor(tempoInt) {\n        super();\n        this.classes.push('Metronome');\n        this._tempo = 60; // overridden by music21.tempo.baseTempo;\n        if (tempoInt === undefined) {\n            this.tempo = tempo.baseTempo;\n        } else {\n            this.tempo = tempoInt;\n        }\n        this.numBeatsPerMeasure = 4;\n        this.minTempo = 10;\n        this.maxTempo = 600;\n        this.beat = this.numBeatsPerMeasure;\n        this.chirpTimeout = undefined;\n        this.silent = false;\n        this.flash = false;\n        this.tempoRanges =     [0, 40, 60, 72, 120, 144, 240, 999];\n        this.tempoIncreases = [0, 1,  2,  3,  4,   6,   8,  15, 100];\n    }\n    get tempo() {\n        return this._tempo;\n    }\n    set tempo(t) {\n        this._tempo = t;\n        if (this._tempo > this.maxTempo) {\n            this._tempo = this.maxTempo;\n        } else if (this._tempo < this.minTempo) {\n            this._tempo = this.minTempo;\n        }\n    }\n    get beatLength() {\n        return 60.0 / this.tempo;\n    }\n    _silentFlash(flashColor) {\n        this.$metronomeDiv.find('.metroFlash').css('background-color', flashColor).fadeOut(\n                this.beatLength * 1000 * 1 / 4, function silentFadeOut() {\n                    $(this).css('background-color', '#ffffff').fadeIn(1);\n                });\n    }\n\n\n    /**\n     * Play a note (a higher one on the downbeat) and start the metronome chirping.\n     *\n     * @memberof music21.tempo.Metronome\n     */\n    chirp() {\n        this.beat += 1;\n        if (this.beat > this.numBeatsPerMeasure) {\n            this.beat = 1;\n            if (this.silent !== true) {\n                MIDI.noteOn(0, 96, 100, 0);\n                MIDI.noteOff(0, 96, 0.1);\n            }\n            if (this.flash === true) {\n                this._silentFlash('#0000f0');\n            }\n        } else {\n            if (this.silent !== true) {\n                MIDI.noteOn(0, 84, 70, 0);\n                MIDI.noteOff(0, 84, 0.1);\n            }\n            if (this.flash === true) {\n                this._silentFlash('#ff0000');\n            }\n        }\n        const that = this;\n        this.chirpTimeout = setTimeout(() => { that.chirp(); },\n                1000 * 60 / this.tempo);\n    }\n\n\n    /**\n     * Stop the metronome from chirping.\n     *\n     * @memberof music21.tempo.Metronome\n     */\n    stopChirp() {\n        if (this.chirpTimeout !== undefined) {\n            clearTimeout(this.chirpTimeout);\n            this.chirpTimeout = undefined;\n        }\n    }\n\n    /**\n     * Increase the metronome tempo one \"click\".\n     *\n     * Value changes depending on the current tempo.  Uses standard metronome guidelines.\n     *\n     * To change the tempo, just set this.tempo = n\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {Int} n - number of clicks to the right\n     * @returns {number} new tempo\n     */\n    increaseSpeed(n) {\n        // increase by one metronome 'click' for every n\n        if (n === undefined) {\n            n = 1;\n        }\n        for (let i = 0; i < n; i++) {\n            let t = this.tempo;\n            for (let tr = 0; tr < this.tempoRanges.length; tr++) {\n                const tempoExtreme = this.tempoRanges[tr];\n                const tempoIncrease = this.tempoIncreases[tr];\n                if (t < tempoExtreme) {\n                    t += tempoIncrease;\n                    t = tempoIncrease * Math.round(t / tempoIncrease);\n                    break;\n                }\n            }\n            // console.log(t);\n            this.tempo = t;\n        }\n        return this.tempo;\n    }\n\n    /**\n     * Decrease the metronome tempo one \"click\"\n     *\n     * To change the tempo, just set this.tempo = n\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {Int} n - number of clicks to the left\n     * @returns {number} new tempo\n     */\n    decreaseSpeed(n) {\n        if (n === undefined) {\n            n = 1;\n        }\n        for (let i = 0; i < n; i++) {\n            let t = this.tempo;\n            const trL = this.tempoRanges.length;\n            for (let tr = 1; tr <= trL; tr++) {\n                const tempoExtreme = this.tempoRanges[trL - tr];\n                const tempoIncrease = this.tempoIncreases[trL - tr + 1];\n                if (t > tempoExtreme) {\n                    t -= tempoIncrease;\n                    t = tempoIncrease * Math.floor(t / tempoIncrease);\n                    break;\n                }\n            }\n            // console.log(t);\n            this.tempo = t;\n        }\n    }\n\n    /**\n     * add a Metronome interface onto the DOM at where\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {JQueryDOMObject|DOMObject} [where='body']\n     * @returns {JQueryDOMObject} - a div holding the metronome.\n     */\n    addDiv(where) {\n        let jWhere;\n        if (where !== undefined && where.jquery !== undefined) {\n            jWhere = where;\n        } else if (where !== undefined) {\n            jWhere = $(where);\n        } else {\n            jWhere = $('body');\n        }\n        const metroThis = this;\n        const tempoHolder = $('<span class=\"tempoHolder\">' + this.tempo.toString() + '</span>');\n        tempoHolder.css({\n            'font-size': '24px',\n            'padding-left': '10px',\n            'padding-right': '10px',\n        });\n        const newDiv = $('<div class=\"metronomeRendered\"></div>');\n        newDiv.append(tempoHolder);\n\n        const b1 = $('<button>start</button>');\n        b1.on('click', () => { metroThis.chirp(); });\n        const b2 = $('<button>stop</button>');\n        b2.on('click', () => { metroThis.stopChirp(); });\n        newDiv.prepend(b2);\n        newDiv.prepend(b1);\n        const b3 = $('<button>up</button>');\n        b3.on('click', function increaseSpeedButton() {\n            metroThis.increaseSpeed();\n            $(this).prevAll('.tempoHolder').html(metroThis.tempo.toString());\n        });\n        const b4 = $('<button>down</button>');\n        b4.on('click', function decreaseSpeedButton() {\n            metroThis.decreaseSpeed();\n            $(this).prevAll('.tempoHolder').html(metroThis.tempo.toString());\n        });\n        newDiv.append(b3);\n        newDiv.append(b4);\n        const $flash = $('<span class=\"metroFlash\">' +\n                '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>');\n        $flash.css('margin-left', '40px');\n        $flash.css('height', '40px');\n\n        newDiv.append($flash);\n\n        jWhere.append(newDiv);\n\n        this.$metronomeDiv = newDiv;\n        return newDiv;\n    }\n}\ntempo.Metronome = Metronome;\n\n","import { prebase } from './prebase';\nimport { Music21Exception } from './exceptions21';\n\n/**\n * Simple tie module {@link music21.tie} namespace\n *\n * @exports music21/tie\n */\n\n/**\n * Tie namespace, just has the {@link music21.tie.Tie} object\n *\n * @namespace music21.tie\n * @memberof music21\n * @requires music21/prebase\n */\nexport const tie = {};\n\n/**\n * Tie class. Found in {@link music21.note.GeneralNote} `.tie`.\n *\n * Does not support advanced music21p values `.to` and `.from`\n *\n * @class Tie\n * @memberof music21.tie\n * @extends music21.prebase.ProtoM21Object\n * @param {string} type - 'start', 'stop', or 'continue'\n * @property {string} type - the tie type\n * @property {string} style - only supports 'normal' for now.\n */\nexport class Tie extends prebase.ProtoM21Object {\n    constructor(type) {\n        super();\n        this._type = undefined;\n        this.style = 'normal';\n        this.type = type;\n    }\n    get type() {\n        return this._type;\n    }\n    set type(t) {\n        if (!(['start', 'stop', 'continue', undefined].includes(t))) {\n            throw new Music21Exception('Tie type must be one of \"start\", \"stop\", \"continue\"');\n        }\n        self._type = t;\n    }\n}\ntie.Tie = Tie;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/tinyNotation -- TinyNotation implementation\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\n\nimport { clef } from './clef';\nimport { duration } from './duration';\nimport { pitch } from './pitch';\nimport { note } from './note';\nimport { meter } from './meter';\nimport { stream } from './stream';\nimport { tie } from './tie';\n\n/**\n * TinyNotation module, see {@link music21.tinyNotation} namespace\n *\n * @exports music21/tinyNotation\n */\n/**\n * @namespace music21.tinyNotation\n * @memberof music21\n * @requires music21/base\n * @requires music21/clef\n * @requires music21/duration\n * @requires music21/pitch\n * @requires music21/note\n * @requires music21/meter\n * @requires music21/stream\n * @requires music21/tie\n */\nexport const tinyNotation = {};\n\n/**\n * Regular expressions object\n *\n * @memberof music21.tinyNotation\n */\ntinyNotation.regularExpressions = {\n    REST: /r/,\n    OCTAVE2: /([A-G])[A-G]+/,\n    OCTAVE3: /([A-G])/,\n    OCTAVE5: /([a-g])('+)/,\n    OCTAVE4: /([a-g])/,\n    EDSHARP: /\\((#+)\\)/,\n    EDFLAT: /\\((\\-+)\\)/,\n    EDNAT: /\\(n\\)/,\n    SHARP: /^[A-Ga-g]+'*(#+)/,  // simple notation finds\n    FLAT: /^[A-Ga-g]+'*(\\-+)/,  // double sharps too\n    NAT: /^[A-Ga-g]+'*n/,  // explicit naturals\n    TYPE: /(\\d+)/,\n    TIE: /.~/, // not preceding ties\n    PRECTIE: /~/,  // front ties\n    ID_EL: /=([A-Za-z0-9]*)/,\n    LYRIC: /_(.*)/,\n    DOT: /\\.+/,\n    TIMESIG: /(\\d+)\\/(\\d+)/,\n\n    TRIP: /trip\\{/,\n    QUAD: /quad\\{/,\n    ENDBRAC: /\\}$/,\n};\n/**\n * Function, not class.\n *\n * Converts a TinyNotation String into a music21 Stream\n *\n * See music21p for examples of what can go into tinynotation. It's an\n * adaptation of Lilypond format, by design Extremely simple!\n *\n * @memberof music21.tinyNotation\n * @param {string} textIn - a valid tinyNotation string\n * @returns {music21.stream.Part|music21.stream.Measure} - a Stream or Part object (if multiple measures)\n * @example\n * var t = \"3/4 c4 B8 c d4 e2.\";\n * var p = music21.tinyNotation.TinyNotation(t);\n * p.duration.quarterLength;\n * // 6.0\n */\ntinyNotation.TinyNotation = function TinyNotation(textIn) {\n    textIn = textIn.trim();\n    const tokens = textIn.split(' ');\n    const p = new stream.Part();\n    let m = new stream.Measure();\n    let currentTSBarDuration = 4.0;\n    let lastDurationQL = 1.0;\n    const storedDict = {\n        lastNoteTied: false,\n        inTrip: false,\n        inQuad: false,\n        endTupletAfterNote: false,\n    };\n    const tnre = tinyNotation.regularExpressions; // faster typing\n    for (let i = 0; i < tokens.length; i++) {\n        // check at first so that a full measure but not over full\n        // gets returned as a stream.Measure object.\n        if (m.duration.quarterLength >= currentTSBarDuration) {\n            p.append(m);\n            m = new stream.Measure();\n        }\n\n        let token = tokens[i];\n        let noteObj;\n        if (tnre.TRIP.exec(token)) {\n            token = token.slice(5); // cut...\n            storedDict.inTrip = true;\n        }\n        if (tnre.QUAD.exec(token)) {\n            token = token.slice(5); // cut...\n            storedDict.inQuad = true;\n        }\n        if (tnre.ENDBRAC.exec(token)) {\n            token = token.slice(0, -1); // cut...\n            storedDict.endTupletAfterNote = true;\n        }\n\n\n        if (tnre.TIMESIG.exec(token)) {\n            const MATCH = tnre.TIMESIG.exec(token);\n            const ts = new meter.TimeSignature();\n            ts.numerator = parseInt(MATCH[1]);\n            ts.denominator = parseInt(MATCH[2]);\n            m.timeSignature = ts;\n            currentTSBarDuration = ts.barDuration.quarterLength;\n            // console.log(currentTSBarDuration);\n            continue;\n        } else if (tnre.REST.exec(token)) {\n            noteObj = new note.Rest(lastDurationQL);\n        } else if (tnre.OCTAVE2.exec(token)) {\n            const MATCH = tnre.OCTAVE2.exec(token);\n            noteObj = new note.Note(MATCH[1], lastDurationQL);\n            noteObj.pitch.octave = 4 - MATCH[0].length;\n        } else if (tnre.OCTAVE3.exec(token)) {\n            const MATCH = tnre.OCTAVE3.exec(token);\n            noteObj = new note.Note(MATCH[1], lastDurationQL);\n            noteObj.pitch.octave = 3;\n        } else if (tnre.OCTAVE5.exec(token)) {\n            // must match octave 5 before 4\n            const MATCH = tnre.OCTAVE5.exec(token);\n            noteObj = new note.Note(MATCH[1].toUpperCase(), lastDurationQL);\n            noteObj.pitch.octave = 3 + MATCH[0].length;\n        } else if (tnre.OCTAVE4.exec(token)) {\n            const MATCH = tnre.OCTAVE4.exec(token);\n            noteObj = new note.Note(MATCH[1].toUpperCase(), lastDurationQL);\n            noteObj.pitch.octave = 4;\n        }\n\n        if (noteObj === undefined) {\n            continue;\n        }\n        if (tnre.TIE.exec(token)) {\n            noteObj.tie = new tie.Tie('start');\n            if (storedDict.lastNoteTied) {\n                noteObj.tie.type = 'continue';\n            }\n            storedDict.lastNoteTied = true;\n        } else if (storedDict.lastNoteTied) {\n            noteObj.tie = new tie.Tie('stop');\n            storedDict.lastNoteTied = false;\n        }\n        if (tnre.SHARP.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('sharp');\n        } else if (tnre.FLAT.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('flat');\n        } else if (tnre.NAT.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('natural');\n            noteObj.pitch.accidental.displayType = 'always';\n        }\n        let MATCH = tnre.TYPE.exec(token);\n        if (MATCH) {\n            const durationType = parseInt(MATCH[0]);\n            noteObj.duration.quarterLength = 4.0 / durationType;\n        }\n        MATCH = tnre.DOT.exec(token);\n        if (MATCH) {\n            const numDots = MATCH[0].length;\n            const multiplier = 1 + (1 - Math.pow(0.5, numDots));\n            noteObj.duration.quarterLength *= multiplier;\n        }\n        lastDurationQL = noteObj.duration.quarterLength;\n        // do before appending tuplets\n\n        if (storedDict.inTrip) {\n            // console.log(noteObj.duration.quarterLength);\n            noteObj.duration.appendTuplet(new duration.Tuplet(3, 2, noteObj.duration.quarterLength));\n        }\n        if (storedDict.inQuad) {\n            noteObj.duration.appendTuplet(new duration.Tuplet(4, 3, noteObj.duration.quarterLength));\n        }\n        if (storedDict.endTupletAfterNote) {\n            storedDict.inTrip = false;\n            storedDict.inQuad = false;\n            storedDict.endTupletAfterNote = false;\n        }\n        m.append(noteObj);\n    }\n    if (p.length > 0) {\n        p.append(m);\n        const thisClef = clef.bestClef(p);\n        p.clef = thisClef;\n        return p; // return measure object if one measure or less\n    } else {\n        m.clef = clef.bestClef(m);\n        return m;\n    }\n};\n\n// render notation divs in HTML\n/**\n * Render all the TinyNotation classes in the DOM as notation\n *\n * Called automatically when music21 is loaded.\n *\n * @memberof music21.tinyNotation\n * @param {string} classTypes - a JQuery selector to find elements to replace.\n */\ntinyNotation.renderNotationDivs = function renderNotationDivs(classTypes, selector) {\n    if (classTypes === undefined) {\n        classTypes = '.music21.tinyNotation';\n    }\n    let allRender = [];\n    if (selector === undefined) {\n        allRender = $(classTypes);\n    } else {\n        if (selector.jquery === undefined) {\n            selector = $(selector);\n        }\n        allRender = selector.find(classTypes);\n    }\n    for (let i = 0; i < allRender.length; i++) {\n        const thisTN = allRender[i];\n        const thisTNJQ = $(thisTN);\n        let thisTNContents;\n        if (thisTNJQ.attr('tinynotationcontents') !== undefined) {\n            thisTNContents = thisTNJQ.attr('tinynotationcontents');\n        } else if (thisTN.textContent !== undefined) {\n            thisTNContents = thisTN.textContent;\n            thisTNContents = thisTNContents.replace(/s+/g, ' '); // no line-breaks, etc.\n        }\n\n        if ((String.prototype.trim !== undefined)\n                && (thisTNContents !== undefined)) {\n            thisTNContents = thisTNContents.trim(); // remove leading, trailing whitespace\n        }\n        if (thisTNContents) {\n            const st = tinyNotation.TinyNotation(thisTNContents);\n            if (thisTNJQ.hasClass('noPlayback')) {\n                st.renderOptions.events.click = undefined;\n            }\n            const newCanvas = st.createCanvas();\n\n            thisTNJQ.attr('tinynotationcontents', thisTNContents);\n            thisTNJQ.empty();\n            thisTNJQ.data('stream', st);\n            thisTNJQ.append(newCanvas);\n            // console.log(thisTNContents);\n        }\n    }\n};\n\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/webmidi -- webmidi or wrapper around the Jazz Plugin\n *\n * For non webmidi --  Uses the cross-platform, cross-browser plugin from\n * http://jazz-soft.net/doc/Jazz-Plugin/Plugin.html\n * P.S. by the standards of divinity of most major religions, Sema Kachalo is a god.\n *\n * Copyright (c) 2014-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006â€“16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\nimport { debug } from './debug';\nimport { common } from './common';\nimport { miditools } from './miditools';\n\n/**\n * webmidi -- for connecting with external midi devices\n *\n * Uses either the webmidi API or the Jazz plugin\n *\n * See {@link music21.webmidi}\n *\n * @exports music21/webmidi\n */\n/**\n * webmidi -- for connecting with external midi devices\n *\n * Uses either the webmidi API or the Jazz plugin\n *\n * @namespace music21.webmidi\n * @memberof music21\n * @requires music21/miditools\n * @requires jquery\n * @property {JazzObject|undefined} storedPlugin - reference to the Jazz object from the plugin; cached from `createPlugin`.\n * @property {string} selectedJazzInterface - the currently connected interface (note that we can only use one right now)\n */\nexport const webmidi = {};\n\nwebmidi.selectedOutputPort = undefined;\nwebmidi.selectedInputPort = undefined;\n\nwebmidi.access = undefined;\nwebmidi.$selectDiv = undefined;\n\nwebmidi.jazzDownloadUrl = 'http://jazz-soft.net/download/Jazz-Plugin/';\nwebmidi.storedPlugin = undefined;\nwebmidi.selectedJazzInterface = undefined; // not the same as \"\" etc. uses last selected interface by default.\n\n/**\n * Called by Jazz MIDI plugin when an event arrives.\n *\n * Shim to convert the data into WebMIDI API format and then call the WebMIDI API midiInArrived\n *\n * See the MIDI spec for information on parameters\n *\n * @memberof music21.webmidi\n * @param {byte} t - timing information\n * @param {byte} a - data 1\n * @param {byte} b - data 2\n * @param {byte} c - data 3\n */\nwebmidi.jazzMidiInArrived = function jazzMidiInArrived(t, a, b, c) {\n    const webmidiEvent = {\n        timestamp: t,\n        data: [a, b, c],\n    };\n    return webmidi.midiInArrived(webmidiEvent);\n};\n\n\n/**\n * Called directly when a MIDI event arrives from the WebMIDI API, or via a Shim (jazzMidiInArrived)\n * when MIDI information comes from JazzMIDI\n *\n * Calls the 'raw' and 'general callbacks when a raw midi event (four bytes)\n * arrives.\n *\n * See the MIDI spec for information on the contents of the three parameters.\n *\n * midiMessageEvent should be an object with two keys: timeStamp (int) and data (array of three int values)\n *\n * @memberof music21.webmidi\n * @param {MidiMessageEvent} midiMessageEvent - midi Information\n */\nwebmidi.midiInArrived = function midiInArrived(midiMessageEvent) {\n    const t = midiMessageEvent.timeStamp;\n    const a = midiMessageEvent.data[0];\n    const b = midiMessageEvent.data[1];\n    const c = midiMessageEvent.data[2];\n    const eventObject = miditools.callBacks.raw(t, a, b, c);\n    if (miditools.callBacks.general instanceof Array) {\n        return miditools.callBacks.general.forEach((el, index, array) => {\n            el(eventObject);\n        });\n    } else if (miditools.callBacks.general !== undefined) {\n        return miditools.callBacks.general(eventObject);\n    } else {\n        return undefined;\n    }\n};\n\n/**\n * Create a hidden tiny, &lt;object&gt; tag in the DOM with the\n * proper classid (`CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90`) to\n * load the Jazz plugin.\n *\n * It will return the plugin if it can or undefined if it cannot. Caches it in webmidi.storedPlugin.\n *\n * @function music21.webmidi.createPlugin\n * @param {DOMObject} [appendElement=document.body] - where to place this hidden object (does not really matter)\n * @param {Boolean} [override=false] - if this method has been called successfully before return the storedPlugin unless override is true.\n * @returns {Jazz|undefined} Jazz MIDI plugin object\n */\nwebmidi.createPlugin = function createPlugin(appendElement, override) {\n    if ((webmidi.storedPlugin) && (override !== true)) {\n        return webmidi.storedPlugin;\n    }\n    if (typeof (appendElement) === 'undefined') {\n        appendElement = $('body')[0];\n    }\n    const obj = document.createElement('object');\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n    if (!obj.isJazz) {\n        obj.type = 'audio/x-jazz';\n    }\n    obj.style.visibility = 'hidden';\n    obj.style.width = '0px';\n    obj.style.height = '0px';\n    appendElement.appendChild(obj);\n\n    if (obj.isJazz) {\n        webmidi.storedPlugin = obj;\n        return obj;\n    } else {\n        appendElement.removeChild(obj);\n        console.error('Cannot use jazz plugin; install at ' + webmidi.jazzDownloadUrl);\n        return undefined;\n    }\n};\n\n/**\n * Creates a &lt;select&gt; object for selecting among the MIDI choices in Jazz\n *\n * @function music21.webmidi.createJazzSelector\n * @param {JQueryDOMObject|DOMObject} [midiSelectDiv=document.body] - object to append the select to\n * @param {object} [options] - see createSelector for details\n * @returns {DOMObject|undefined} DOM object containing the select tag, or undefined if Jazz cannot be loaded.\n */\nwebmidi.createJazzSelector = function createJazzSelector($newSelect, options) {\n    const params = {};\n    common.merge(params, options);\n\n    const Jazz = webmidi.createPlugin();\n    if (Jazz === undefined) {\n        return undefined;\n    }\n\n    $newSelect.change(() => {\n        const selectedInput = $('#midiInSelect option:selected').text();\n        if (selectedInput !== 'None selected') {\n            webmidi.selectedJazzInterface = Jazz.MidiInOpen(selectedInput, webmidi.jazzMidiInArrived);\n        } else {\n            Jazz.MidiInClose();\n        }\n        if (debug) {\n            console.log('current input changed to: ' + webmidi.selectedInterface);\n        }\n    });\n    const midiOptions = Jazz.MidiInList();\n    const noneAppendOption = $(\"<option value='None'>None selected</option>\");\n    $newSelect.append(noneAppendOption);\n\n    let anySelected = false;\n    const allAppendOptions = [];\n    for (let i = 0; i < midiOptions.length; i++) {\n        const $appendOption = $(\"<option value='\" + midiOptions[i] + \"'>\" + midiOptions[i] + '</option>');\n        if (midiOptions[i] === webmidi.selectedJazzInterface) {\n            $appendOption.attr('selected', true);\n            anySelected = true;\n        }\n        allAppendOptions.push($appendOption);\n        // console.log(appendOption);\n        $newSelect.append($appendOption);\n    }\n    if (anySelected === false && midiOptions.length > 0) {\n        $newSelect.val(midiOptions[0]);\n        allAppendOptions[0].attr('selected', true);\n        webmidi.selectedJazzInterface = Jazz.MidiInOpen(midiOptions[0], webmidi.jazzMidiInArrived);\n        anySelected = true;\n    } else {\n        noneAppendOption.attr('selected', true);\n    }\n    if (params.onsuccess !== undefined) {\n        params.onsuccess();\n    }\n    if (anySelected === true && params.oninputsuccess !== undefined) {\n        params.oninputsuccess();\n    } else if (anySelected === false && params.oninputempty !== undefined) {\n        params.oninputempty();\n    }\n    return $newSelect;\n};\n\n/**\n * Function to be called if the webmidi-api selection changes. (not jazz)\n *\n */\nwebmidi.selectionChanged = function selectionChanged() {\n    const selectedInput = webmidi.$select.val();\n    if (selectedInput === webmidi.selectedInputPort) {\n        return false;\n    }\n    const storedStateChange = webmidi.access.onstatechange; // port.close() fires onstatechange, so turn off for a moment.\n    webmidi.access.onstatechange = () => {};\n    if (debug) {\n        console.log('current input changed to: ' + selectedInput);\n    }\n    webmidi.selectedInputPort = selectedInput;\n\n    webmidi.access.inputs.forEach((port) => {\n        if (port.name === selectedInput) {\n            port.onmidimessage = webmidi.midiInArrived;\n        } else {\n            port.close();\n        }\n    });\n    webmidi.access.onstatechange = storedStateChange;\n    return false;\n};\n\n/**\n * Creates a &lt;select&gt; object for selecting among the MIDI choices in Jazz\n *\n * The options object has several parameters:\n *\n * {bool} autoupdate -- should this auto update?\n * {function} onsuccess -- function to call on all successful port queries\n * {function} oninputsuccess -- function to call if successful and at least one input device is found\n * {function} oninputempty -- function to call if successful but no input devices are found.\n * {bool} existingMidiSelect -- is there already a select tag for MIDI?\n *\n * @function music21.webmidi.createSelector\n * @param {JQueryDOMObject|DOMObject} [$midiSelectDiv=$('body')] - object to append the select to\n * @param {object} [options] - see above.\n * @returns {DOMObject|undefined} DOM object containing the select tag, or undefined if Jazz cannot be loaded.\n */\nwebmidi.createSelector = function createSelector($midiSelectDiv, options) {\n    const params = {\n        autoUpdate: true,\n        existingMidiSelect: false,\n    };\n    common.merge(params, options);\n\n    if (typeof ($midiSelectDiv) === 'undefined') {\n        $midiSelectDiv = $('body');\n    }\n    if ($midiSelectDiv.jquery === undefined) {\n        $midiSelectDiv = $($midiSelectDiv);\n    }\n    let $newSelect;\n    const foundMidiSelects = $midiSelectDiv.find('select#midiInSelect');\n    if (foundMidiSelects.length > 0) {\n        $newSelect = foundMidiSelects[0];\n        params.existingMidiSelect = true;\n    } else {\n        $newSelect = $('<select>').attr('id', 'midiInSelect');\n        $midiSelectDiv.append($newSelect);\n    }\n    webmidi.$select = $newSelect;\n\n    if (navigator.requestMIDIAccess === undefined) {\n        webmidi.createJazzSelector($newSelect, params);\n    } else {\n        if (params.existingMidiSelect !== true) {\n            $newSelect.change(webmidi.selectionChanged);\n        }\n        navigator.requestMIDIAccess().then((access) => {\n            webmidi.access = access;\n            webmidi.populateSelect();\n            if (params.autoUpdate) {\n                access.onstatechange = webmidi.populateSelect;\n            }\n            webmidi.$select.change();\n            if (params.onsuccess !== undefined) {\n                params.onsuccess();\n            }\n            if (webmidi.selectedInputPort !== 'None' && params.oninputsuccess !== undefined) {\n                params.oninputsuccess();\n            } else if (webmidi.selectedInputPort === 'None' && params.oninputempty !== undefined) {\n                params.oninputempty();\n            }\n        }, (e) => {\n            $midiSelectDiv.html(e.message);\n        });\n    }\n    miditools.clearOldChords(); // starts the chord checking process.\n    return $newSelect;\n};\n\nwebmidi.populateSelect = function populateSelect() {\n    const inputs = webmidi.access.inputs;\n    webmidi.$select.empty();\n\n    const $noneAppendOption = $(\"<option value='None'>None selected</option>\");\n    webmidi.$select.append($noneAppendOption);\n\n    const allAppendOptions = [];\n    const midiOptions = [];\n    let i = 0;\n    inputs.forEach((port) => {\n        const $appendOption = $(\"<option value='\" + port.name + \"'>\" + port.name + '</option>');\n        allAppendOptions.push($appendOption);\n        midiOptions.push(port.name);\n        // console.log(appendOption);\n        webmidi.$select.append($appendOption);\n        i++;\n    });\n    if (allAppendOptions.length > 0) {\n        webmidi.$select.val(midiOptions[0]);\n        allAppendOptions[0].attr('selected', true);\n    } else {\n        $noneAppendOption.attr('selected', true);\n    }\n    webmidi.$select.change();\n};\n\n// this allows for the deprecated webmidi.callBacks to still work for now.\nwebmidi.callBacks = miditools.callBacks;\n\n/**\n * Example smallest usage of the webmidi toolkit.  see testHTML/midiInRequire.html\n\n<html>\n<head>\n    <title>MIDI In/Jazz Test for Music21j</title>\n    <!-- for MSIE 10 on Windows 8 -->\n    <meta http-equiv=\"X-UA-Compatible\" content=\"requiresActiveX=true\"/>\n    <script data-main=\"../src/music21.js\" src=\"../ext/require/require.js\"></script>\n    <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" />\n\n    <script>\n    var s = \"\";\n    function displayStream(me) {\n        me.sendToMIDIjs();\n        if (me.noteOn) {\n            var m21n = me.music21Note();\n            if (s.length > 7) {\n                s.elements = s.elements.slice(1)\n            }\n            s.append(m21n);\n            var $canvasDiv = $(\"#canvasDiv\");\n            $canvasDiv.empty();\n            var canv = s.appendNewCanvas($canvasDiv);\n        }\n    }\n\n    require(['music21'], function () {\n        s = new music21.stream.Stream();\n        music21.webmidi.createSelector($(\"#putMidiSelectHere\"));\n        music21.miditools.callBacks.general = displayStream;\n    });\n\n\n    </script>\n</head>\n<body>\n<div>\nMIDI Input: <div id=\"putMidiSelectHere\" />\n</div>\n<div id=\"canvasDiv\">\n    <canvas />\n</div>\n</body>\n</html>\n **/\n","import * as $ from 'jquery';\n\nimport { note } from './note';\nimport { stream } from './stream';\nimport { tie } from './tie';\n\n/**\n * Widgets module -- random widgets.  See {@link music21.widgets}\n *\n * @exports music21/widgets\n */\n\n/**\n * Widgets module -- random widgets to make streams etc. work better\n *\n * To be added to\n *\n * @namespace music21.widgets\n * @memberof music21\n */\nexport const widgets = {};\n/**\n * A set of DOM Objects for choosing rhythms\n *\n * @class RhythmChooser\n * @memberof music21.widgets\n * @param {music21.stream.Stream} s - to append to, etc.\n * @param {DOMObject} c - canvas\n * @property {Array<string>} values - an array of rhythmic values and editing functions.\n *           Default: ['whole', 'half','quarter','eighth','16th','dot','undo']\n * @property {Boolean} measureMode - whether to use measures when editing\n * @property {Boolean} tieActive - is a tie active?\n * @property {Boolean} autoAddMeasure - add a measure when one is full? default: true\n * @property {music21.stream.Stream} stream\n * @property {DOMObject} [canvasDiv]\n */\nexport class RhythmChooser {\n    constructor(s, c) {\n        this.stream = s;\n        this.canvasDiv = c;\n        this.values = ['whole', 'half', 'quarter', 'eighth', '16th', 'dot', 'undo'];\n        if (this.stream.hasSubStreams()) {\n            this.measureMode = true;\n        } else {\n            this.measureMode = false;\n        }\n        this.tieActive = false;\n        this.autoAddMeasure = true;\n        /**\n         * A mapping of a type to a string of HTML entities to display in\n         * BravuraText\n         *\n         * @name valueMappings\n         * @type {object}\n         * @memberof music21.widgets.RhythmChooser\n         */\n        this.valueMappings = {\n            whole: '&#xEB9B;&#xE1D2;',\n            half: '&#xEB9B;&#xE1D3;',\n            quarter: '&#xEB9B;&#xE1D5;',\n            eighth: '&#xEB9B;&#xE1D7;',\n            '16th': '&#xEB9B;&#xE1D9;',\n            '32nd': '&#xEB9B;&#xE1DB;', // BUG in Bravura Text\n            addMeasure: '<span style=\"position: relative; top: -20px\">&#xE031</span>',\n            dot: '&#xEB9B;&#xE1E7;',\n            undo: '&#x232B;',\n            tie: '<span style=\"position: relative; top: -20px;\">&#xE1FD</span>',\n            rest_whole: '&#xE4F4;',\n            rest_half: '&#xE4F5;',\n            rest_quarter: '&#xE4E5;',\n            rest_eighth: '&#xE4E6;',\n            rest_16th: '&#xE4E7;',\n            rest_32nd: '&#xE4E8;',\n        };\n        /**\n         * A mapping of a type to a css style\n         *\n         * @name styles\n         * @type {object}\n         * @memberof music21.widgets.RhythmChooser\n         */\n        this.styles = {\n            'undo': 'font-family: serif; font-size: 30pt; top: -2px;',\n        };\n        /**\n         * An object mapping a value type to a function when it is clicked\n         *\n         * the 'default' value handles all types not otherwise given.\n         *\n         * Each function is passed the type that was clicked. Probably only\n         * useful for 'default'\n         *\n         * @name buttonHandlers\n         * @type {object}\n         * @memberof music21.widgets.RhythmChooser#\n         */\n        this.buttonHandlers = {\n            'undo': (unused_t) => {\n                if (this.stream.length > 0) {\n                    return this.stream.pop();\n                } else {\n                    return undefined;\n                }\n            },\n            'dot': (unused_t) => {\n                if (this.stream.length > 0) {\n                    const el = this.stream.pop();\n                    el.duration.dots += 1;\n                    this.stream.append(el);\n                    return el;\n                } else { return undefined; }\n            },\n            'tie': (unused_t) => {\n                if (this.stream.length > 0) {\n                    const el = this.stream.get(-1);\n                    el.tie = new tie.Tie('start');\n                    this.tieActive = true;\n                }\n            },\n            'default': (t) => {\n                let newN = new note.Note('B4');\n                newN.stemDirection = 'up';\n                if (t.indexOf('rest_') === 0) {\n                    newN = new note.Rest();\n                    t = t.slice('rest_'.length);\n                }\n                newN.duration.type = t;\n                if (this.tieActive) {\n                    newN.tie = new tie.Tie('stop');\n                    this.tieActive = false;\n                }\n                this.stream.append(newN);\n                return newN;\n            },\n        };\n        /**\n         * An object mapping a value type to a function when it is clicked if the\n         * RhythmChooser is in measureMode\n         *\n         * the 'default' value handles all types not otherwise given.\n         *\n         * Each function is passed the type that was clicked. Probably only\n         * useful for 'default'\n         *\n         * @name measureButtonHandlers\n         * @type {object}\n         * @memberof music21.widgets.RhythmChooser#\n         */\n        this.measureButtonHandlers = {\n            'undo': (unused_t) => {\n                if (this.stream.length > 0) {\n                    const lastMeasure = this.stream.get(-1);\n                    const retValue = lastMeasure.pop();\n                    if (lastMeasure.length === 0 && this.stream.length > 1) {\n                        this.stream.pop();\n                    }\n                    return retValue;\n                } else {\n                    return undefined;\n                }\n            },\n            'dot': (unused_t) => {\n                if (this.stream.length > 0) {\n                    const lastMeasure = this.stream.get(-1);\n                    const el = lastMeasure.pop();\n                    el.duration.dots += 1;\n                    lastMeasure.append(el);\n                    return el;\n                } else { return undefined; }\n            },\n            'addMeasure': (unused_t) => {\n                const lastMeasure = this.stream.get(-1);\n                const m = new stream.Measure();\n                m.renderOptions.staffLines = lastMeasure.renderOptions.staffLines;\n                m.renderOptions.measureIndex = lastMeasure.renderOptions.measureIndex + 1;\n                m.renderOptions.rightBarline = 'end';\n                lastMeasure.renderOptions.rightBarline = 'single';\n                m.autoBeam = lastMeasure.autoBeam;\n                this.stream.append(m);\n            },\n            'tie': (unused_t) => {\n                const lastMeasure = this.stream.get(-1);\n                let el;\n                if (lastMeasure.length > 0) {\n                    el = lastMeasure.get(-1);\n                } else {\n                    const previousMeasure = this.stream.get(-2);\n                    if (previousMeasure) {\n                        el = previousMeasure.get(-1);\n                    }\n                }\n                if (el !== undefined) {\n                    let tieType = 'start';\n                    if (el.tie !== undefined) { tieType = 'continue'; }\n                    el.tie = new tie.Tie(tieType);\n                    this.tieActive = true;\n                }\n            },\n            'default': (t) => {\n                let newN = new note.Note('B4');\n                newN.stemDirection = 'up';\n                if (t.indexOf('rest_') === 0) {\n                    newN = new note.Rest();\n                    t = t.slice('rest_'.length);\n                }\n                newN.duration.type = t;\n                if (this.tieActive) {\n                    newN.tie = new tie.Tie('stop');\n                    this.tieActive = false;\n                }\n                let lastMeasure = this.stream.get(-1);\n                if (this.autoAddMeasure &&\n                        lastMeasure.duration.quarterLength >=\n                            this.stream.timeSignature.barDuration.quarterLength) {\n                    this.measureButtonHandlers.addMeasure.apply(this, [t]);\n                    lastMeasure = this.stream.get(-1);\n                }\n                lastMeasure.append(newN);\n                return newN;\n            },\n        };\n    }\n    /**\n     * adds a RhythmChooser widget somewhere.\n     *\n     * @memberof music21.widgets.RhythmChooser\n     * @param {DOMObject|JQueryDOMObject} where\n     */\n    addDiv(where) {\n        let $where = where;\n        if (where !== undefined && where.jquery === undefined) {\n            $where = $(where);\n        }\n        const $outer = $('<div class=\"rhythmButtonDiv\"/>');\n        for (let i = 0; i < this.values.length; i++) {\n            const value = this.values[i];\n            const entity = this.valueMappings[value];\n            const $inner = $('<button class=\"btButton\" m21Type=\"' + value + '\">'\n                    + entity + '</button>');\n            if (this.styles[value] !== undefined) {\n                $inner.attr('style', this.styles[value]);\n            }\n\n            $inner.click((function rhythmButtonDiv_click(value) {\n                this.handleButton(value);\n            }).bind(this, value));\n            $outer.append($inner);\n        }\n        if (where !== undefined) {\n            $where.append($outer);\n        }\n        return $outer;\n    }\n    /**\n     * A button has been pressed! Call the appropriate handler and update the stream's canvas (if any)\n     *\n     * @memberof music21.widgets.RhythmChooser\n     * @param {string} t - type of button pressed.\n     */\n    handleButton(t) {\n        let bhs = this.buttonHandlers;\n        if (this.measureMode) {\n            bhs = this.measureButtonHandlers;\n        }\n        let bh = bhs[t];\n        if (bh === undefined) {\n            bh = bhs['default'];\n        }\n        bh.apply(this, [t]);\n        let s = this.stream;\n\n        // redraw score if Part is part of score...\n        if (s.isClassOrSubclass('Part') && s.activeSite !== undefined) {\n            s = s.activeSite;\n        }\n        if (this.canvasDiv !== undefined) {\n            s.replaceCanvas(this.canvasDiv);\n        }\n    }\n}\nwidgets.RhythmChooser = RhythmChooser;\n","// order below doesn't matter, but good to give a sense\n// of what will be needed by almost everyone, and then\n// alphabetical.\nimport * as exceptions21 from './music21/exceptions21';\nimport { debug } from './music21/debug';\nimport { common } from './music21/common';\nimport { prebase } from './music21/prebase';\nimport { base } from './music21/base';\n\nimport { articulations } from './music21/articulations';\nimport { audioSearch } from './music21/audioSearch';\nimport { beam } from './music21/beam';\nimport { chord } from './music21/chord';\nimport { clef } from './music21/clef';\nimport { duration } from './music21/duration';\nimport { dynamics } from './music21/dynamics';\nimport { expressions } from './music21/expressions';\nimport { fromPython } from './music21/fromPython';\nimport { instrument } from './music21/instrument';\nimport { interval } from './music21/interval';\nimport { key } from './music21/key';\nimport { keyboard } from './music21/keyboard';\nimport { layout } from './music21/layout';\nimport { meter } from './music21/meter';\nimport { miditools } from './music21/miditools';\nimport { note } from './music21/note';\nimport { pitch } from './music21/pitch';\nimport { renderOptions } from './music21/renderOptions';\nimport { roman } from './music21/roman';\nimport { stream } from './music21/stream';\nimport { streamInteraction } from './music21/streamInteraction';\nimport { tempo } from './music21/tempo';\nimport { tie } from './music21/tie';\nimport { tinyNotation } from './music21/tinyNotation';\nimport { vfShow } from './music21/vfShow';\nimport { webmidi } from './music21/webmidi';\nimport { widgets } from './music21/widgets';\n\nexport const music21 = {};\n\nmusic21.common = common;\nmusic21.debug = debug;\nmusic21.prebase = prebase;\nmusic21.base = base;\n\nmusic21.articulations = articulations;\nmusic21.audioSearch = audioSearch;\nmusic21.beam = beam;\nmusic21.chord = chord;\nmusic21.clef = clef;\nmusic21.dynamics = dynamics;\nmusic21.duration = duration;\nmusic21.exceptions21 = exceptions21;\nmusic21.expressions = expressions;\nmusic21.fromPython = fromPython;\nmusic21.instrument = instrument;\nmusic21.interval = interval;\nmusic21.key = key;\nmusic21.keyboard = keyboard;\nmusic21.layout = layout;\nmusic21.meter = meter;\nmusic21.miditools = miditools;\nmusic21.note = note;\nmusic21.pitch = pitch;\nmusic21.renderOptions = renderOptions;\nmusic21.roman = roman;\nmusic21.stream = stream;\nmusic21.streamInteraction = streamInteraction;\nmusic21.tempo = tempo;\nmusic21.tie = tie;\nmusic21.tinyNotation = tinyNotation;\nmusic21.vfShow = vfShow;\nmusic21.webmidi = webmidi;\nmusic21.widgets = widgets;\n"],"names":["ExtendableError","message","name","constructor","Error","captureStackTrace","stack","Music21Exception","StreamException","debug","common","merge","mergeRecursive","destination","source","undefined","p","hasOwnProperty","call","Object","e","mixin","common_mixin","OtherParent","thisClassOrObject","proto","getPrototypeOf","classProto","keys","key","statisticalMode","a","length","modeMap","maxEl","maxCount","i","el","makeSVGright","tag","attrs","document","createElementNS","k","setAttribute","ordinalAbbreviation","value","plural","post","valueHundreths","valueMod","rationalize","ql","epsilon","maxDenominator","Math","abs","round","numerator","denominator","stripPx","str","pxIndex","indexOf","slice","parseInt","urlParam","replace","regex","RegExp","results","exec","location","search","decodeURIComponent","jQueryEventCopy","eventObj","from","to","jquery","$","events","data","_data","each","type","handler","event","add","setWindowVisibilityWatcher","callback","hidden","addEventListener","windowFocusChanged","onfocusin","onfocusout","window","onpageshow","onpagehide","onfocus","onblur","evt","v","h","evtMap","focus","focusin","pageshow","blur","focusout","pagehide","callbackState","initialState","visibilityState","initialStateEvent","prebase","ProtoM21Object","classes","isProtoM21Object","isMusic21Object","_cloneCallbacks","ret","getOwnPropertyDescriptor","get","set","babelHelpers.typeof","clone","TypeError","console","log","testClass","Array","duration","typeFromNumDict","quarterTypeIndex","ordinalTypeFromNum","vexflowDurationArray","Duration","push","_quarterLength","_dots","_durationNumber","_type","_tuplets","quarterLength","cloneCallbacksTupletFunction","tupletKey","obj","newTuplets","newTuplet","typeNumber","powerOfTwo","pow","dotsNum","dotMultiplier","durationMultiplier","undottedQuarterLength","dottedMultiplier","unTupletedQl","tupletCorrectedQl","forEach","tuplet","tupletMultiplier","floor","_findDots","tupletRatio","ratioRat","t","Tuplet","appendTuplet","skipUpdateQl","frozen","updateQlFromFeatures","numDots","updateFeaturesFromQl","typeIn","vd","dots","numberNotesActual","numberNotesNormal","durationActual","durationNormal","bracket","placement","tupletActualShow","tupletNormalShow","self","actual","normal","lengthActual","totalTupletLength","numActual","numNormal","ordStr","toString","tests","test","d","music21","equal","vexflowDuration","d2","t2","tuplets","s","stream","Stream","timeSignature","meter","TimeSignature","n1","note","Note","articulations","Accent","append","appendNewCanvas","ok","m6","Measure","renderOptions","staffLines","n6","n7","n6clone","s2","na1","na2","pitch","diatonicNoteNum","s3","Part","m4","m5","p2","sc","Score","insert","base","Music21Object","classSortOrder","_priority","offset","activeSite","isStream","_duration","groups","Music21Object_cloneCallbacks_activeSite","site","_elements","_elementOffsets","newDuration","Articulation","vexflowModifier","setPosition","dynamicScale","lengthScale","vfa","Vex","Flow","LengthArticulation","DynamicArticulation","PitchArticulation","TimbreArticulation","StrongAccent","Staccato","Staccatissimo","Spiccato","Marcato","Tenuto","acc","ten","n","marc","nBoring","measure","audioSearch","fftSize","AudioContextCaller","AudioContext","webkitAudioContext","_audioContext","animationFrameCallbackId","defineProperties","ac","getUserMedia","dictionary","error","alert","mediaStream","userMediaStarted","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","sampleBuffer","currentAnalyser","audioStream","Float32Array","mediaStreamSource","audioContext","createMediaStreamSource","analyser","createAnalyser","connect","animateLoop","minFrequency","maxFrequency","time","getFloatTimeDomainData","frequencyDetected","autoCorrelate","sampleRate","retValue","sampleCallback","requestAnimationFrame","pitchSmoothingSize","lastPitchClassesDetected","lastPitchesDetected","lastCentsDeviationsDetected","smoothPitchExtraction","frequency","shift","midiNumDiffFromFrequency","midiNum","centsOff","mostCommonPitchClass","pitchesMatchingClass","centsMatchingClass","mostCommonPitch","totalSamplePoints","totalSample","j","weight","unused_midiNum","unused_centsOff","buf","SIZE","MAX_SAMPLES","best_offset","best_correlation","rms","foundGoodCorrelation","correlations","val","sqrt","lastCorrelation","correlation","offsetFrequency","midiNumFloat","requestAnimationFramePolyFill","lastTime","vendors","x","cancelAnimationFrame","element","currTime","Date","getTime","timeToCall","max","timeoutId","setTimeout","id","clearTimeout","beam","validBeamTypes","Beam","direction","independentAngle","number","Beams","beamsList","feathered","level","count","setAll","getNumbers","numbers","beamObj","getByNumber","types","b","splitit","split","fill","getTypes","setByNumber","Accidental","accName","_name","_alter","_modifier","_unicodeModifier","displayType","displayStatus","init","toLowerCase","alter","modifier","m","nameToMidi","nameToSteps","stepsToName","midiToName","Pitch","pn","_step","_octave","_accidental","ps","match","nameWithOctave","clefObj","tempPitch","convertPitchToTreble","accidentalType","accidental","outName","step","octave","o","nn","toUpperCase","tempAccidental","storedOctave","newDNN","accidentalAlter","c","clef","AltoClef","vfn","vexflowName","noteheadTypeNames","stemDirectionNames","Lyric","text","syllabic","applyRaw","identifier","lyricConnector","_number","setTextAndSyllabic","_identifier","rawText","GeneralNote","isChord","volume","activeVexflowNote","expressions","lyrics","tie","lyricNumber","lyricIdentifier","maxLyrics","newLyric","foundLyric","thisLyric","options","addDotToAll","stemDirection","setStemDirectionFromClef","setStemDirection","StaveNote","STEM_DOWN","STEM_UP","hasStem","staveDNNSpacing","stave","spacing_between_lines_px","midLine","lowestLine","absDNNfromCenter","absOverOctave","getStemLength","stemHeight","setStemLength","tempo","nextElement","inst","instrument","midiVolume","channel","midiChannel","milliseconds","midNum","isClassOrSubclass","midi","stopTime","MIDI","noteOn","noteOff","_notes","isNaN","NotRest","notehead","noteheadFill","noteheadColor","noteheadParenthesis","beams","isNote","isRest","DNNfromCenter","params","vfd","vexflowKey","vexflowAccidentalsAndDisplay","addAccidental","art","addArticulation","vexflow","exp","setKeyStyle","fillStyle","Rest","lineShift","keyLine","ls","chord","Chord","notes","maxDNNfromCenter","pA","pitches","noteObj","pitchObj","noteObj2","sort","stepsFound","nonDuplicatingPitches","closedChord","removeDuplicatePitches","closedPitches","indexOfPitchesWithPerfectlyStackedThirds","testSteps","currentListOfThirds","tsIndex","chordStepPitch","getChordStep","hasFalse","chordStep","testRoot","root","tempChordStep","semitones","lowest","uniqueChord","cardinality","thirdST","semitonesFromChordStep","fifthST","bass","chordStepsToInversions","testNote","pitchKeys","tn","thisPitches","testRootDNN","thisPitch","thisInterval","tempPitches","addNote","warn","chordDefinitions","lowestLines","Clef","octaveChange","lowestLineTrebleOffset","treble","lowestLineDifference","TrebleClef","Treble8vbClef","Treble8vaClef","BassClef","TenorClef","SopranoClef","MezzoSopranoClef","PercussionClef","bestClef","st","stFlat","flat","totalNotes","totalPitch","averageHeight","c1","dynamics","shortNames","longNames","englishNames","dynamicStrToScalar","Dynamic","_value","_volumeScalar","longName","englishName","dynamic","volumeScalar","Expression","vfe","Fermata","jp","jsonpickle","unpickler","fromPython","Converter","knownUnparsables","handlers","post_restore","_qtrLength","ts","_numerator","displaySequence","_denominator","currentPart","lastClef","lastKeySignature","lastTimeSignature","streamPostRestore","_storedElementOffsetTuples","_clef","_keySignature","_timeSignature","classList","_py_class","streamPart","appendEl","insertAtStart","thisClass","kn","unparsable","keySignature","jss","outStruct","decode","Instrument","instrumentName","partId","partName","partAbbreviation","instrumentId","instrumentAbbreviation","midiProgram","_midiChannel","lowestNote","highestNote","transpostion","inGMPercMap","soundfontFn","find","usedChannels","startChannel","ch","maxMidi","autoAssignMidiChannel","info","instrument_find","fn","midiNumber","interval","IntervalDirections","DESCENDING","OBLIQUE","ASCENDING","IntervalDirectionTerms","MusicOrdinals","GenericInterval","gi","directed","undirected","isSkip","isDiatonicStep","isStep","isUnison","tempSteps","tempOctaves","simpleUndirected","undirectedOctaves","semiSimpleUndirected","octaves","simpleDirected","semiSimpleDirected","perfectable","niceName","simpleNiceName","semiSimpleNiceName","staffDistance","mod7inversion","mod7","specifier","DiatonicInterval","pitch2","oldDiatonicNum","distanceToMove","newDiatonicNumber","newInfo","IntervalConvertDiatonicNumberToStep","IntervalSpecifiersEnum","PERFECT","MAJOR","MINOR","AUGMENTED","DIMINISHED","DBLAUG","DBLDIM","TRPAUG","TRPDIM","QUADAUG","QUADDIM","IntervalNiceSpecNames","IntervalPrefixSpecs","IntervalOrderedPerfSpecs","IntervalPerfSpecifiers","QUADDMIN","IntervalPerfOffset","IntervalOrderedImperfSpecs","IntervalSpecifiers","IntervalMajOffset","IntervalSemitonesGeneric","IntervalAdjustPerfect","IntervalAdjustImperf","generic","diatonicDirectionNiceName","simpleName","semiSimpleName","directedName","directedNiceName","directedSimpleName","directedSimpleNiceName","directedSemiSimpleName","directedSemiSimpleNiceName","semiSimpleNameName","specificName","orderedSpecifierIndex","invertedOrderedSpecIndex","invertedOrderedSpecifier","octaveOffset","semitonesStart","specName","semitonesAdjust","ChromaticInterval","cents","mod12","intervalClass","isChromaticStep","useImplicitOctave","pps","newPitch","IntervalStepNames","dn","stepNumber","stepName","Interval","restArgs","arg0","gI","dI","diatonic","chromatic","getChromatic","n2","gInt","notesToGeneric","cInt","notesToChromatic","intervalsToDiatonic","reinit","diatonicType","sn","consonantNames","transposePitch","halfStepsToFix","p1","staffDist","genDist","convertStaffDistanceToInterval","_getSpecifierFromGenericChromatic","noteVals","normalSemis","theseSemis","semisRounded","scale","SimpleDiatonicScale","tonic","scaleSteps","lastPitch","di","ii","ScaleSimpleMajor","ScaleSimpleMinor","minorType","modeSharpsAlter","KeySignature","sharps","_sharps","_alteredPitchesCache","flatMapping","sharpMapping","tempSharps","tempName","majorName","aps","alteredPitches","transInterval","transTimes","transStr","startPitch","pKeep","Key","keyName","mode","lowerCase","sharpsArray","sharpsIndex","modeShift","scaleType","testSharps","thisTest","expectedSharps","expectedMode","givenKeyName","givenMode","foundSharps","foundMode","getScale","width","miditools","transposeOctave","Event","timing","data1","data2","data3","midiCommand","midiNote","velocity","m21n","maxDelay","heldChordTime","heldChordNotes","timeOfLastNote","now","_baseTempo","metronome","enumerable","clearOldChords","nowInMs","sendOutChord","makeChords","jEvent","music21Note","foundNote","lastElement","chordNoteList","appendObject","quantizeLastNote","callBacks","raw","general","sendToMIDIjs","arrayOfNotes","nowInMS","msSinceLastNote","normalQuarterNoteLength","numQuarterNotes","roundedQuarterLength","midiEvent","loadedSoundfonts","postLoadCallback","soundfont","remove","isFirefox","InstallTrigger","isAudioTag","technology","instrumentObj","programChange","loadSoundfont","waitThenCall","ready","body","loadPlugin","soundfontUrl","onsuccess","bind","MidiPlayer","player","Players","PlayInstance","speed","$playDiv","where","$where","$controls","$playPause","m21basePath","$stop","on","pausePlayStop","stopButton","$time","$timePlayed","$capsule","$timeRemaining","stop","src","playing","pause","resume","b64data","timeWarp","m21midiplayer","loadFile","fileLoaded","updatePlaying","start","$d","timePlayed","timeRemaining","timeCursor","eventjs","cancel","currentTime","endTime","state","timeFormatting","minutes","seconds","String","setAnimation","percent","end","songFinished","style","innerHTML","keyboard","callbacks","scaleFactor","parent","height","svgObj","noteNameSvgObj","keyStyle","keyClass","startX","keyattrs","y","keyDOM","strokeColor","getAttribute","cx","stroke","cy","r","circleDom","appendChild","labelOctaves","idStr","fontSize","textfill","textattrs","textDom","textNode","createTextNode","parentNode","removeChild","WhiteKey","BlackKey","Keyboard","whiteKeyWidth","_defaultWhiteKeyWidth","_defaultBlackKeyWidth","keyObjects","markC","showNames","showOctaves","endPitch","_startDNN","_endDNN","hideable","scrollable","click","clickhandler","sharpOffsets","oldSVG","svgParent","svgDOM","createSVG","replaceChild","wrapScrollable","appendHideableKeyboard","keyRect","thisKeyObject","storedStyle","fillColor","tempP","currentIndex","keyboardDiatonicLength","totalWidth","heightString","movingPitch","blackKeys","thisKeyboardObject","wki","wk","whitekeyCallbacksClick","wkSVG","makeKey","bk","blackKeyClicksCallback","offsetFromWhiteKey","bkSVG","bki","markMiddleC","markNoteNames","midC","addCircle","removeNoteNames","keyObj","addNoteName","removeNoteName","$wrapper","css","display","$bDown","redrawSVG","$bUp","$kWrapper","keyboardSVG","$container","$bInside","$b","background","triggerToggleShow","$explain","$t","$parent","$k","dd","jazzHighlight","intensityRGB","normalizedVelocity","intensity","meterString","beatGroups","ratioString","tempBeatGroups","numBeats","beatValue","beatsToEighthNoteRatio","computeBeatGroups","vfBeatGroups","bg","Fraction","meterList","RenderOptions","defaultOptions","displayClef","displayTimeSignature","displayKeySignature","top","left","overriddenWidth","naiveHeight","systemIndex","partIndex","measureIndex","systemMeasureIndex","systemPadding","naiveSystemPadding","maxSystemWidth","rightBarline","staffConnectors","staffPadding","startNewSystem","startNewPage","showMeasureNumber","streamInteraction","ScrollPlayer","pixelMapper","PixelMapper","canvas","lastX","lastNoteIndex","barDOM","canvasParent","lastTimeout","startTime","previousSystemIndex","eachSystemHeight","timingMS","savedRenderOptionClick","scrollScore","timeSinceStartInMS","pm","getSystemIndexAtOffset","getXAtOffset","allMaps","pmOff","elList","elements","elIndex","playMidi","newTimeout","maxX","maxSystemIndex","fauxEvent","stopPlaying","scaleY","createScrollBar","startPlayingClick","setRenderInteraction","stopPropagation","notesAndRests","pixelScaling","processStream","ns","addNoteToMap","finalStave","finalX","endOffset","lastMap","PixelMap","currentOffset","properMap","findMapForExactOffset","pmap","prevNoteMap","nextNoteMap","thisMap","lastNoteMap","twoNoteMaps","getPixelMapsAroundOffset","offsetFromPrev","offsetDistance","pixelDistance","offsetToPixelScale","pixelsFromPrev","offsetX","mapper","_x","_systemIndex","CursorSelect","activeElementHierarchy","vfShow","RenderStack","voices","streams","textVoices","Renderer","$canvas","activeFormatter","_vfRenderer","_ctx","beamGroups","stacks","ties","systemBreakOffsets","vfTuplets","isScorelike","isPartlike","hasSubStreams","prepareScorelike","preparePartlike","prepareArrivedFlat","formatMeasureStacks","drawTies","drawMeasureStacks","drawBeamGroups","drawTuplets","subStream","addStaffConnectors","prepareMeasure","prepareTies","hasVoices","prepareFlat","rendOp","voiceIndex","voiceStream","optionalStave","optional_renderOp","makeAccidentals","renderStave","activeVFStave","voice","getVoice","hasLyrics","getLyricVoice","optional_rendOp","ctx","newStave","setClefEtc","setContext","draw","allTickables","vft","pf","thisNote","nextNote","onSameSystem","sbI","thisSystemBreak","vfTie","StaveTie","first_note","last_note","first_indices","last_indices","vfTie1","vfTie2","vexflowNotes","vexflowVoice","setStave","addTickables","textVoice","vexflowLyrics","measures","formatter","formatVoiceGroup","applyFormatterInformationToNotes","autoBeam","Formatter","maxGlyphStart","start_x","joinVoices","formatToStave","vexflowBeatGroups","applyAndGetBeams","estimateStaffLength","Stave","setStafflines","setMeasure","ottava","size","addClef","addKeySignature","addTimeSignature","bl","barlineMap","vxBL","setEndBarType","Barline","vexflowStave","setNumLines","line_config","visible","activeTuplet","activeTupletLength","activeTupletVexflowNotes","thisEl","vexflowNote","m21Tuplet","tupletOptions","num_notes","notes_occupied","vfTuplet","setRatioed","getTextNote","font","t1","TextNote","setLine","setJustification","Justification","LEFT","family","lyricsObjects","lyricsArray","addConnector","tempQl","connector","totalLength","num1024","vfv","Voice","num_beats","beat_value","resolution","RESOLUTION","setMode","Mode","SOFT","connectorType","connectorMap","StaveConnector","BRACE","SINGLE","DOUBLE","BRACKET","numParts","firstPart","lastPart","numMeasures","mIndex","thisPartMeasure","lastPartMeasure","topVFStaff","bottomVFStaff","scTypeM21","scTypeVF","staffConnectorsMap","setType","recursive","storedVexflowStave","removeFormatterInformation","noteOffsetLeft","glyph_start_x","getBottomY","nextTicks","nTicks","ticks","formatterNote","tContexts","map","getAbsoluteX","Backends","CANVAS","vfr","vfRenderer","getContext","_instrument","_autoBeam","_tempo","_stopPlaying","_allowMultipleSimultaneousPlays","changedCallbackFunction","canvasChangerFunction","canvasElement","currentTarget","findNoteForClick","clickedDiatonicNoteNum","noteChanged","deep","create","prototype","elCopy","elOffset","lastQL","err","testOffset","splice","pop","index","meterStream","refStreamOrTimeRange","searchContext","innerBarline","finalBarline","inPlace","voiceCount","getElementsByClass","offsetMap","oMax","measureCount","mStart","thisTimeSignature","barDuration","ob","getOffsetBySite","mEnd","oNew","insertStream","lyric","group","dur","thisOffsetMap","OffsetMap","tempEls","newSt","extendableStepList","stepNames","stepAlter","accidentalByStep","lastOctaveStepList","lastStepDict","extend","lastOctavelessStepDict","_makeAccidentalForOnePitch","newAlter","preserveEvents","oldEvents","resetRenderOptions","render","storedStream","ignoreSystems","staffHeight","numSystems","scoreHeight","maxLength","thisLength","done","startNote","currentNote","flatEls","lastNote","thisStream","playNext","setSubstreamRenderOptions","newCanvas","attr","computedWidth","computedHeight","estimateStreamHeight","createCanvas","$newCanvas","createNewCanvas","renderVexflowOnCanvas","appendElement","$appendElement","canvasBlock","preserveCanvasSize","$oldCanvas","prop","replaceWith","$innerDiv","renderOptionsOuterEventClick","storedThis","renderOptionsInnerEventClick","scrollScoreStart","scrollPlayer","startPlaying","canvasOrDiv","playFunc","playStreamBound","playStream","proxy","setRenderInteractionProxy","eventType","eventFunction","off","windowReflowStart","storedVFStave","subStreams","xClick","yClick","pageX","pageY","clientX","scrollLeft","documentElement","clientY","scrollTop","xPx","yPx","getUnscaledXYforCanvas","yPxScaled","xPxScaled","recursiveGetStoredVexflowStave","lineSpacing","linesAboveStaff","space_above_staff_ln","notesFromTop","notesAboveLowestLine","num_lines","allowablePixels","unused_systemIndex","getScaledXYforCanvas","diatonicNoteNumFromScaledY","noteElementFromScaledX","activeNote","redrawCanvas","$newCanv","buttonDiv","getAccidentalToolbar","minAccidental","maxAccidental","addAccidentalClicked","clickedButton","accidentalToolbar","siblingCanvas","clickFunc","addAccidentalClickFunc","unicodeModifier","bPlay","bStop","stopPlayStream","jCanvas","callingStream","jCanvasNow","jCanvasParent","newWidth","canvasWidth","canvasObj","resize","resizeCanvasTo","resizeTO","resizeToTimeout","trigger","triggerResizeOnCreateCanvas","$window","doResize","highestTime","offsetShift","elFlat","newTempo","newInstrument","newClef","newKeySignature","newTimeSignature","ab","baseMaxSystemWidth","newSW","parts","newElements","highestOffsetSoFar","tempInsert","thisElOffset","systemHeight","measureWidths","elRendOp","tempM","getMeasureWidths","systemCurrentWidths","systemBreakIndexes","lastSystemBreak","startLeft","currentLeft","currentRight","currentSystemIndex","leftSubtract","currentSystemMultiplier","currentSystemWidth","newLeft","newTop","currentMeasureIndex","currentMeasureLeft","scaledYRelativeToSystem","scaledX","gotMeasure","right","bottom","partSpacing","currentPartNumber","currentPartTop","evenPartMeasureSpacing","ignoreNumSystems","currentScoreHeight","fixSystemInformation","tempPart","maxMeasureWidths","measureWidthsArrayOfArrays","maxFound","scaledYFromSystemTop","scaledYinPart","rightPart","measureStacks","maxMeasureWidth","thisMeasureWidth","measureNewWidth","part","streamTests","m1","m2","n11","n12","n13","n21","n3","pf2","pf3","tc","om","omn","omo","s1","n4","div1","editableAccidentalCanvas","layout","makeLayoutFromScore","score","containerWidth","partZero","layoutScore","LayoutScore","currentPage","Page","measureStart","measureEnd","currentSystem","System","currentSystemNumber","currentStaves","staffMaker","staffHolder","pNum","staff","Staff","staffNumber","systemNumber","scoreLayout","_width","pageId","systemId","staffId","units","pageNumber","systemStart","systemEnd","pageLayout","systemLayout","optimized","inheritedHeight","staffLayout","roman","romanToNumber","RomanNumeral","figure","keyStr","_scale","_key","currentFigure","impliedQuality","lowercase","numbersArr","scaleDegree","raiseTone","updatePitches","chordSpacing","chordPitches","thisTransStr","thisTrans","nextPitch","inversion","inversionName","fullChordName","suffix","degreeName","tonicDisplay","chordStr","tonicPitch","diffRootToTonic","rn1","defaultTempoValues","baseTempo","Metronome","tempoInt","numBeatsPerMeasure","minTempo","maxTempo","beat","chirpTimeout","silent","flash","tempoRanges","tempoIncreases","flashColor","$metronomeDiv","fadeOut","beatLength","silentFadeOut","fadeIn","_silentFlash","that","chirp","tr","tempoExtreme","tempoIncrease","trL","jWhere","metroThis","tempoHolder","newDiv","b1","b2","stopChirp","prepend","b3","increaseSpeedButton","increaseSpeed","prevAll","html","b4","decreaseSpeedButton","decreaseSpeed","$flash","Tie","includes","tinyNotation","regularExpressions","REST","OCTAVE2","OCTAVE3","OCTAVE5","OCTAVE4","EDSHARP","EDFLAT","EDNAT","SHARP","FLAT","NAT","TYPE","TIE","PRECTIE","ID_EL","LYRIC","DOT","TIMESIG","TRIP","QUAD","ENDBRAC","TinyNotation","textIn","trim","tokens","currentTSBarDuration","lastDurationQL","storedDict","lastNoteTied","inTrip","inQuad","endTupletAfterNote","tnre","token","MATCH","durationType","multiplier","thisClef","renderNotationDivs","classTypes","selector","allRender","thisTN","thisTNJQ","thisTNContents","textContent","hasClass","empty","webmidi","selectedOutputPort","selectedInputPort","access","$selectDiv","jazzDownloadUrl","storedPlugin","selectedJazzInterface","jazzMidiInArrived","webmidiEvent","timestamp","midiInArrived","midiMessageEvent","timeStamp","eventObject","array","createPlugin","override","createElement","classid","isJazz","visibility","createJazzSelector","$newSelect","Jazz","change","selectedInput","MidiInOpen","MidiInClose","selectedInterface","midiOptions","MidiInList","noneAppendOption","anySelected","allAppendOptions","$appendOption","oninputsuccess","oninputempty","selectionChanged","$select","storedStateChange","onstatechange","inputs","port","onmidimessage","close","createSelector","$midiSelectDiv","autoUpdate","existingMidiSelect","foundMidiSelects","requestMIDIAccess","then","populateSelect","$noneAppendOption","widgets","RhythmChooser","canvasDiv","values","measureMode","tieActive","autoAddMeasure","valueMappings","whole","half","quarter","eighth","addMeasure","dot","undo","rest_whole","rest_half","rest_quarter","rest_eighth","rest_16th","rest_32nd","styles","buttonHandlers","unused_t","newN","measureButtonHandlers","lastMeasure","previousMeasure","tieType","apply","$outer","entity","$inner","rhythmButtonDiv_click","handleButton","bhs","bh","replaceCanvas","exceptions21"],"mappings":"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"}