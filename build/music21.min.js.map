{"version":3,"sources":["../src/music21/scale.js","../src/music21/musicxml.js","../src/music21/exceptions21.js","../src/music21/debug.js","../src/music21/common.js","../src/music21/prebase.js","../src/music21/duration.js","../src/music21/sites.js","../src/music21/base.js","../src/music21/articulations.js","../src/music21/audioSearch.js","../src/music21/audioRecording.js","../src/music21/beam.js","../src/music21/pitch.js","../src/music21/interval.js","../src/music21/note.js","../src/music21/chord.js","../src/music21/clef.js","../src/music21/dynamics.js","../src/music21/expressions.js","../src/music21/figuredBass.js","../src/music21/fromPython.js","../src/music21/key.js","../src/music21/harmony.js","../src/music21/instrument.js","../src/music21/miditools.js","../src/music21/keyboard.js","../src/music21/meter.js","../src/music21/renderOptions.js","../src/music21/vfShow.js","../src/music21/stream.js","../src/music21/layout.js","../src/music21/tie.js","../src/music21/roman.js","../src/music21/tempo.js","../src/music21/tinyNotation.js","../src/music21/voiceLeading.js","../src/music21/webmidi.js","../src/loadModules.js"],"names":["SimpleDiatonicScale","tonic","scaleSteps","undefined","pitch","Pitch","Music21Exception","gi","interval","GenericInterval","pitches","lastPitch","i","length","di","DiatonicInterval","ii","Interval","newPitch","transposePitch","debug","console","log","name","push","ScaleSimpleMajor","ScaleSimpleMinor","minorType","replace","hyphenToCamelCase","tag","firstLetter","toUpperCase","seta","m21El","xmlEl","attributeName","transform","$matchEl","$","children","value","contents","eq","text","ExtendableError","message","classCallCheck","this","_this","possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","constructor","Error","captureStackTrace","stack","_ExtendableError","apply","arguments","inherits","StreamException","_Music21Exception","common","merge","mergeRecursive","destination","source","p","hasOwnProperty","e","range","start","stop","step","count","Math","ceil","Array","map","mixin","OtherParent","thisClassOrObject","proto","classProto","key","keys","aggregation","baseClass","_len","mixins","_key","base","_baseClass","_ref","_len2","args","_key2","concat","forEach","copyProps","target","getOwnPropertyNames","getOwnPropertySymbols","prop","match","defineProperty","getOwnPropertyDescriptor","prototype","posMod","a","b","statisticalMode","modeMap","maxEl","maxCount","el","fromRoman","num","inputRoman","subtractionValues","nums","ints","places","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","c","includes","err","return","indexOf","summation","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","toRoman","_typeof","result","floor","repeat","makeSVGright","attrs","document","createElementNS","k","setAttribute","ordinalAbbreviation","plural","post","valueHundreths","valueMod","rationalize","ql","epsilon","maxDenominator","abs","round","numerator","denominator","stripPx","str","pxIndex","slice","parseInt","urlParam","regex","RegExp","results","exec","location","search","decodeURIComponent","arrayEquals","a1","a2","_singletonCounter","SingletonCounter","createClass","setWindowVisibilityWatcher","callback","windowFocusChanged","evt","v","h","evtMap","focus","focusin","pageshow","blur","focusout","pagehide","window","event","callbackState","type","hidden","addEventListener","onfocusin","onfocusout","onpageshow","onpagehide","onfocus","onblur","visibilityState","urls","css","webResources","midiPlayer","soundfontUrl","prebase","ProtoM21Object","_storedClasses","isProtoM21Object","isMusic21Object","_cloneCallbacks","babelHelpers.extends","create","ret","get","set","babelHelpers.typeof","clone","TypeError","testClass","classes","classList","thisConstructor","maxLinks","duration","typeFromNumDict","1","2","4","8","16","32","64","128","256","512","1024","0","0.5","0.25","0.125","0.0625","quarterTypeIndex","ordinalTypeFromNum","vexflowDurationArray","Duration","_prebase$ProtoM21Obje","_quarterLength","_dots","_durationNumber","_type","_tuplets","quarterLength","cloneCallbacksTupletFunction","tupletKey","obj","newTuplets","newTuplet","typeNumber","powerOfTwo","pow","dotsNum","dotMultiplier","durationMultiplier","undottedQuarterLength","dottedMultiplier","unTupletedQl","tupletCorrectedQl","tuplet","tupletMultiplier","_findDots","tupletRatio","ratioRat","t","Tuplet","appendTuplet","skipUpdateQl","frozen","updateQlFromFeatures","numDots","updateFeaturesFromQl","typeIn","vd","dots","_prebase$ProtoM21Obje2","numberNotesActual","numberNotesNormal","durationActual","durationNormal","_this2","bracket","placement","tupletActualShow","tupletNormalShow","actual","normal","lengthActual","totalTupletLength","numActual","numNormal","ordStr","toString","sites","SitesException","SiteRef","isDead","classString","globalSiteIndex","siteIndex","siteWeakref","WeakMap","ref","newSite","_NoneSiteRef","GLOBAL_SITE_STATE_DICT","getId","has","newId","Sites","siteDict","Map","_siteIndex","_lastID","checkSite","_step$value","slicedToArray","site","newFirst","_step2$value","siteRef","keyVal","sort","reverse","innerList","idKey","updateNotAdd","tempSiteRef","delete","regeneratorRuntime","mark","yieldSites","keyRepository","priorityId","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","sortByCreationTime","priorityTarget","excludeNone","wrap","_context","prev","_keysByTime","from","splice","pop","t0","finish","attrName","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","className","options","params","callerFirst","getElementMethod","memo","objs","classNameIsStr","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","objId","getContextByClass","size","Music21Object","keywords","classSortOrder","activeSite","offset","_naiveOffset","_activeSiteStoredOffset","_duration","_priority","groups","isStream","keyName","newObj","self","stringReturns","elementOffset","setElementOffset","payloadExtractor","useSite","flatten","positionStart","lastElement","indexOffset","_elementOffsets","thisElement","_elements","matchClass","isClassOrSubclass","potentialElement","contextSites","returnSortTuples","searchType","contextEl","recursionType","siteObj","offsetInStream","newOffset","positionInStream","_recursionType","newParams","_step3$value","topLevel","inStreamPos","recurType","inStreamOffset","offsetAppend","followDerivation","sortByCreationType","abrupt","t1","newDuration","articulations","Articulation","vexflowModifier","setPosition","dynamicScale","lengthScale","vfa","Vex","Flow","LengthArticulation","_Articulation","DynamicArticulation","_Articulation2","_this3","PitchArticulation","_Articulation3","_this4","TimbreArticulation","_Articulation4","_this5","Accent","_DynamicArticulation","_this6","StrongAccent","_Accent","_this7","Staccato","_LengthArticulation","_this8","Staccatissimo","_Staccato","_this9","Spiccato","_Staccato2","_this10","Marcato","_DynamicArticulation2","_this11","Tenuto","_LengthArticulation2","_this12","audioSearch","fftSize","AudioContextCaller","AudioContext","webkitAudioContext","_audioContext","animationFrameCallbackId","defineProperties","audioContext","MIDI","WebAudio","getContext","globalAudioContext","ac","getUserMedia","dictionary","error","alert","mediaStream","userMediaStarted","n","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","audio","mandatory","optional","sampleBuffer","currentAnalyser","audioStream","Float32Array","mediaStreamSource","createMediaStreamSource","analyser","createAnalyser","connect","animateLoop","minFrequency","maxFrequency","time","getFloatTimeDomainData","frequencyDetected","autoCorrelate","sampleRate","sampleCallback","requestAnimationFrame","pitchSmoothingSize","lastPitchClassesDetected","lastPitchesDetected","lastCentsDeviationsDetected","smoothPitchExtraction","frequency","shift","_audioSearch$midiNumD","midiNumDiffFromFrequency","_audioSearch$midiNumD2","midiNum","centsOff","mostCommonPitchClass","pitchesMatchingClass","centsMatchingClass","mostCommonPitch","totalSamplePoints","totalSample","j","weight","_audioSearch$smoothPi","_audioSearch$smoothPi2","buf","SIZE","MAX_SAMPLES","best_offset","best_correlation","rms","foundGoodCorrelation","correlations","val","sqrt","lastCorrelation","correlation","offsetFrequency","midiNumFloat","Recorder","cfg","config","bufferLen","recording","currCallback","frequencyCanvasInfo","id","width","height","canvasContext","animationFrameID","waveformCanvasInfo","analyserNode","polyfillNavigator","googEchoCancellation","googAutoGainControl","googNoiseSuppression","googHighpassFilter","s","audioStreamConnected","stream","inputPoint","createGain","connectSource","zeroGain","gain","context","setNode","workerBlob","Blob","recorderWorkerJs","workerURL","URL","createObjectURL","worker","Worker","onmessage","blob","data","revokeObjectURL","postMessage","command","node","onaudioprocess","buffer","inputBuffer","getChannelData","createScriptProcessor","createJavaScriptNode","cb","isMono","setupDownload","Date","now","exportWAV","filename","elementId","url","webkitURL","link","getElementById","href","download","AnalyserNode","uint8","Uint8Array","array","getByteTimeDomainData","imax","canvas","numBars","freqByteData","frequencyBinCount","getByteFrequencyData","clearRect","fillStyle","lineCap","multiplier","magnitude","fillRect","updateAnalysers","buffers","amp","min","max","datum","numFrames","audioBuffer","createBuffer","channel","thisChannelBuffer","createBufferSource","audioRecording","beam","validBeamTypes","continue","partial","beamableDurationTypes","Beam","direction","independentAngle","number","Beams","beamsList","feathered","srcList","isRest","fill","beamLast","beamNext","allTypes","getTypes","hasStart","hasStop","bThis","bNext","bThisNum","getNumbers","thisNum","thisBeam","getByNumber","nextBeam","bPrev","prevBeam","level","setAll","numbers","beamObj","types","splitit","split","Accidental","accName","_name","_alter","_modifier","_unicodeModifier","displayType","displayStatus","toLowerCase","alter","modifier","m","nameToMidi","C","D","E","F","G","A","B","nameToSteps","stepsToName","midiToName","pn","_octave","_accidental","ps","nameWithOctave","inPlace","directionInt","octaveStored","octave","diatonicNoteNum","accidental","microtone","_getEnharmonicHelper","clefObj","tempPitch","convertPitchToTreble","accidentalType","o","nn","tempAccidental","storedOctave","newDNN","accidentalAlter","Direction","DESCENDING","OBLIQUE","ASCENDING","IntervalDirectionTerms","MusicOrdinals","directed","undirected","isSkip","isDiatonicStep","isStep","isUnison","tempSteps","tempOctaves","simpleUndirected","undirectedOctaves","semiSimpleUndirected","octaves","simpleDirected","semiSimpleDirected","perfectable","niceName","simpleNiceName","semiSimpleNiceName","staffDistance","mod7inversion","mod7","specifier","pitch2","oldDiatonicNum","distanceToMove","newDiatonicNumber","_interval$convertDiat","convertDiatonicNumberToStep","_interval$convertDiat2","newStep","newOctave","IntervalSpecifiersEnum","PERFECT","MAJOR","MINOR","AUGMENTED","DIMINISHED","DBLAUG","DBLDIM","TRPAUG","TRPDIM","QUADAUG","QUADDIM","IntervalNiceSpecNames","IntervalPrefixSpecs","IntervalOrderedPerfSpecs","IntervalPerfSpecifiers","QUADDMIN","IntervalPerfOffset","IntervalOrderedImperfSpecs","IntervalSpecifiers","IntervalMajOffset","IntervalSemitonesGeneric","3","5","6","7","IntervalAdjustPerfect","P","AA","AAA","AAAA","d","dd","ddd","dddd","IntervalAdjustImperf","M","generic","diatonicDirectionNiceName","simpleName","semiSimpleName","directedName","directedNiceName","directedSimpleName","directedSimpleNiceName","directedSemiSimpleName","directedSemiSimpleNiceName","semiSimpleNameName","specificName","orderedSpecifierIndex","invertedOrderedSpecIndex","invertedOrderedSpecifier","octaveOffset","semitonesStart","specName","semitonesAdjust","semitones","ChromaticInterval","getChromatic","cents","_prebase$ProtoM21Obje3","mod12","intervalClass","isChromaticStep","useImplicitOctave","pps","IntervalStepNames","dn","stepNumber","_prebase$ProtoM21Obje4","restArgs","arg0","gI","dI","diatonic","chromatic","n1","n2","gInt","notesToGeneric","cInt","notesToChromatic","intervalsToDiatonic","reinit","diatonicType","halfStepsToFix","intervalFromGenericAndChromatic","_getSpecifierFromGenericChromatic","dInt","p1","p2","staffDist","genDist","convertStaffDistanceToInterval","noteVals","normalSemis","theseSemis","semisRounded","note","noteheadTypeNames","stemDirectionNames","Lyric","syllabic","applyRaw","identifier","lyricConnector","_number","setTextAndSyllabic","_identifier","style","strokeStyle","fontFamily","fontSize","fontWeight","rawText","GeneralNote","_base$Music21Object","isChord","volume","activeVexflowNote","expressions","lyrics","tie","lyricNumber","lyricIdentifier","maxLyrics","newLyric","foundLyric","thisLyric","clef","vfn","addDotToAll","stemDirection","hasStem","staveDNNSpacing","stave","spacing_between_lines_px","midLine","lowestLine","absDNNfromCenter","absOverOctave","getStemLength","stemHeight","setStemLength","tempo","nextElement","inst","instrument","midiVolume","midiChannel","milliseconds","midNum","midi","stopTime","noteOn","noteOff","_notes","isNaN","NotRest","_GeneralNote","notehead","noteheadFill","noteheadColor","noteheadParenthesis","beams","Note","_NotRest","isNote","DNNfromCenter","renderOptions","setStemDirectionFromClef","vfd","vexflowDuration","vexflowKey","vexflowName","vfnStemDirection","StaveNote","STEM_DOWN","STEM_UP","stem_direction","vexflowAccidentalsAndDisplay","addAccidental","art","addArticulation","vexflow","exp","setStyle","Rest","_GeneralNote2","lineShift","color","keyLine","staffLines","ls","chord","Chord","_note$NotRest","notes","_overrides","_cache","add","sortPitches","maxDNNfromCenter","pA","runSort","noteObj","pitchObj","noteObj2","stepsFound","nonDuplicatingPitches","newroot","root","inversion","closedChord","removeDuplicatePitches","closedPitches","indexOfPitchesWithPerfectlyStackedThirds","testSteps","currentListOfThirds","tsIndex","getChordStep","hasFalse","newRoot","chordStep","testRoot","tempChordStep","lowest","cardinality","thirdST","semitonesFromChordStep","fifthST","third","fifth","seventh","thisPitch","isMajorTriad","isDominantSeventh","isMinorTriad","bass","chordStepsToInversions","testNote","pitchKeys","tn","thisPitches","testRootDNN","thisInterval","tempPitches","addNote","warn","chordDefinitions","major","minor","diminished","augmented","major-seventh","dominant-seventh","minor-seventh","diminished-seventh","half-diminished-seventh","lowestLines","treble","soprano","mezzo-soprano","alto","tenor","percussion","Clef","octaveChange","lowestLineTrebleOffset","lowestLineDifference","TrebleClef","_Clef","Treble8vbClef","_Clef2","Treble8vaClef","_Clef3","BassClef","_Clef4","AltoClef","_Clef5","TenorClef","_Clef6","SopranoClef","_Clef7","MezzoSopranoClef","_Clef8","PercussionClef","_Clef9","bestClef","st","stFlat","flat","totalNotes","totalPitch","averageHeight","clefFromString","clefString","octaveShift","xnStr","trim","thisType","lineNum","arrayEqual","every","ix","Bass8vbClef","dynamics","shortNames","longNames","ppp","pp","mp","mf","f","fp","sf","ff","fff","englishNames","dynamicStrToScalar","None","pppp","ffff","Dynamic","_value","_volumeScalar","longName","englishName","Expression","vfe","Fermata","_Expression","shorthandNotation","","9","11","13","6,5","4,3","4,2","Notation","notationColumn","figureStrings","origNumbers","origModStrings","modifierStrings","_parseNotationColumn","_translateToLonghand","modifiers","figures","_getModifiers","_getFigures","nc","figure","numberString","modifierString","oldNumbers","newNumbers","oldModifierStrings","newModifierStrings","oldNumbersString","temp","newModifierString","Modifier","Figure","specialModifiers","+","/","\\","bb","bbb","bbbb","++","+++","++++","_toAccidental","modStr","pitchNameToAlter","pitchToAlter","modifyPitch","newAccidental","newAlter","figuredBass","jp","jsonpickle","unpickler","fromPython","Converter","knownUnparsables","handlers","music21.duration.Duration","post_restore","_qtrLength","music21.meter.TimeSignature","ts","_numerator","displaySequence","_denominator","music21.stream.Part","currentPart","lastClef","lastKeySignature","lastTimeSignature","streamPostRestore","music21.stream.Score","bind","music21.stream.Stream","music21.stream.Measure","music21.stream.Voice","_storedElementOffsetTuples","_clef","_keySignature","_timeSignature","_py_class","streamPart","appendEl","insertAtStart","thisClass","kn","timeSignature","keySignature","append","insert","jss","decode","Scale","AbstractScale","_Scale","_net","tonicDegree","octaveDuplicating","deterministic","_alteredDegrees","_oneOctaveRealizationCache","other","pitchList","pitchListReal","pLast","intervalList","unused_stepOfPitch","unused_minPitch","unused_maxPitch","unused_direction","unused_reverse","pitchReference","unused_nodeName","nodeDegreeTarget","zeroIndexDegree","pitchTarget","unused_comparisonAttribute","realizedPitches","getRealization","realizedNames","realizedIndex","AbstractDiatonicScale","_AbstractScale","mode","dominantDegree","_buildNetwork","relativeMajorDegree","relativeMinorDegree","_intervalList","toConsumableArray","intVStr","AbstractHarmonicMinorScale","_AbstractScale2","AbstractAscendingMelodicMinorScale","_AbstractScale3","ConcreteScale","_Scale2","abstract","degree","unused_equateTermini","getPitchFromNodeDegree","getRelativeNodeDegree","DiatonicScale","_ConcreteScale","MajorScale","_DiatonicScale","MinorScale","_DiatonicScale2","HarmonicMinorScale","_ConcreteScale2","AscendingMelodicMinorScale","_ConcreteScale3","scale","modeSharpsAlter","dorian","phrygian","lydian","mixolydian","locrian","convertKeyStringToMusic21KeyString","textString","endsWith","startsWith","KeySignature","sharps","_sharps","_alteredPitchesCache","flatMapping","sharpMapping","tempSharps","majorName","aps","alteredPitches","transInterval","transTimes","transStr","startPitch","pKeep","Key","_KeySignature","sharpsArray","sharpsIndex","modeShift","_scale","getScale","scaleType","getPitches","_scale2","pitchFromDegree","_scale3","getScaleDegreeFromPitch","isConcrete","Harmony","_writeAsChord","_roman","chordStepModifications","_degreesList","_figure","parseFigure","_parseFigure","updatePitches","_updatePitches","findFigure","newFigure","keyOrScale","harmony","Instrument","instrumentName","partId","partName","partAbbreviation","instrumentId","instrumentAbbreviation","midiProgram","_midiChannel","lowestNote","highestNote","transpostion","inGMPercMap","soundfontFn","find","usedChannels","startChannel","ch","maxMidi","autoAssignMidiChannel","info","fn","midiNumber","miditools","transposeOctave","Event","timing","data1","data2","data3","midiCommand","midiNote","velocity","m21n","maxDelay","heldChordTime","heldChordNotes","timeOfLastNote","_baseTempo","metronome","enumerable","clearOldChords","nowInMs","sendOutChord","setTimeout","makeChords","jEvent","music21Note","chordNoteList","appendObject","quantizeLastNote","callBacks","raw","general","sendToMIDIjs","arrayOfNotes","nowInMS","msSinceLastNote","normalQuarterNoteLength","numQuarterNotes","roundedQuarterLength","midiEvent","loadedSoundfonts","postLoadCallback","soundfont","remove","isFirefox","InstallTrigger","isAudioTag","technology","instrumentObj","programChange","loadSoundfont","waitThenCall","ready","body","loadPlugin","onsuccess","MidiPlayer","player","Players","PlayInstance","speed","$playDiv","where","$where","jquery","$controls","$playPause","playPng","$stop","stopPng","on","pausePlayStop","stopButton","$time","$timePlayed","$capsule","$timeRemaining","src","playing","pause","pausePng","resume","b64data","timeWarp","m21midiplayer","loadFile","fileLoaded","updatePlaying","timeFormatting","minutes","seconds","String","$d","timePlayed","timeRemaining","timeCursor","eventjs","cancel","currentTime","x","endTime","state","setAnimation","percent","end","songFinished","innerHTML","keyboard","callbacks","scaleFactor","parent","svgObj","noteNameSvgObj","keyStyle","keyClass","startX","keyattrs","y","class","rx","ry","keyDOM","strokeColor","getAttribute","cx","stroke","stroke-width","cy","r","circleDom","appendChild","labelOctaves","idStr","textfill","textattrs","font-size","textDom","textNode","createTextNode","parentNode","removeChild","WhiteKey","_Key","BlackKey","_Key2","Keyboard","whiteKeyWidth","_defaultWhiteKeyWidth","_defaultBlackKeyWidth","keyObjects","markC","showNames","showOctaves","endPitch","_startDNN","_endDNN","hideable","scrollable","click","clickhandler","sharpOffsets","oldSVG","svgParent","svgDOM","createSVG","replaceChild","wrapScrollable","appendHideableKeyboard","keyRect","thisKeyObject","storedStyle","fillColor","tempP","currentIndex","keyboardDiatonicLength","totalWidth","heightString","xml:space","movingPitch","blackKeys","thisKeyboardObject","wki","wk","wkSVG","makeKey","bk","offsetFromWhiteKey","bkSVG","bki","markMiddleC","markNoteNames","midC","addCircle","removeNoteNames","keyObj","addNoteName","removeNoteName","$wrapper","display","$bDown","redrawSVG","$bUp","$kWrapper","keyboardSVG","$container","$bInside","padding-top","$b","vertical-align","background","triggerToggleShow","$explain","background-color","padding","$t","$parent","$k","jazzHighlight","intensityRGB","normalizedVelocity","intensity","meter","TimeSignature","meterString","_beatGroups","_overwrittenBeatCount","_overwrittenBeatDuration","ratioString","tempBeatGroups","numBeats","beatValue","beatsToEighthNoteRatio","beatDuration","beatsFromStart","srcStream","measureStartOffset","naiveBeams","removeSandwichedUnbeamables","depth","beamNumber","dur","pos","startNext","isLast","isFirst","beamPrevious","_offsetToSpan","offsetToSpan","_offsetToSpan2","archetypeSpanStart","archetypeSpanEnd","archetypeSpanNextStart","beamType","getTypeByNumber","setByNumber","sanitizePartialBeams","mergeConnectingPartialBeams","beatGroups","vfBeatGroups","bg","Fraction","meterList","computeBeatGroups","newGroups","overwrite","barDuration","beatCount","RenderOptions","defaultOptions","displayClef","displayTimeSignature","displayKeySignature","top","left","overriddenWidth","naiveHeight","systemIndex","partIndex","measureIndex","systemMeasureIndex","systemPadding","naiveSystemPadding","maxSystemWidth","rightBarline","staffConnectors","staffPadding","events","dblclick","startNewSystem","startNewPage","showMeasureNumber","vfShow","RenderStack","voices","streams","textVoices","voiceToStreamMapping","tickablesByStave","knownStaves","allTickables","thisStaveIndex","currentStaveHolder","Renderer","div","rendererType","$div","activeFormatter","_vfRenderer","_ctx","beamGroups","stacks","vfTies","systemBreakOffsets","vfTuplets","isScorelike","isPartlike","hasSubStreams","prepareScorelike","preparePartlike","prepareArrivedFlat","formatMeasureStacks","drawTies","drawMeasureStacks","drawBeamGroups","drawTuplets","parts","subStream","addStaffConnectors","measureList","measures","prepareMeasure","prepareTies","hasVoices","prepareFlat","rendOp","voiceIndex","voiceStream","optionalStave","optional_renderOp","makeAccidentals","renderStave","activeVFStave","voice","getVoice","hasLyrics","getLyricVoice","optional_rendOp","ctx","newStave","setClefEtc","setContext","draw","vft","pf","notesAndRests","thisNote","nextNote","onSameSystem","sbI","thisSystemBreak","vfTie","StaveTie","first_note","last_note","first_indices","last_indices","vfTie1","vfTie2","vexflowNotes","vexflowVoice","setStave","addTickables","textVoice","vexflowLyrics","formatter","formatVoiceGroup","applyFormatterInformationToNotes","autoBeam","Formatter","maxGlyphStart","getNoteStartX","setNoteStartX","staveTickables","joinVoices","formatToStave","_beamGroups","associatedStream","vexflowBeatGroups","applyAndGetBeams","estimateStaffLength","Stave","setStafflines","setMeasure","ottava","addClef","ksVFName","addKeySignature","addTimeSignature","bl","barlineMap","single","double","vxBL","setEndBarType","Barline","vexflowStave","setNumLines","line_config","visible","activeTuplet","activeTupletLength","activeTupletVexflowNotes","thisEl","vexflowNote","tuplets","tupletOptions","num_notes","notes_occupied","vfTuplet","setRatioed","_vfTuplets","getTextNote","font","lyricObj","TextNote","setLine","setJustification","Justification","LEFT","applyTickMultiplier","lyricsObjects","lyricsArray","addConnector","firstLyric","family","tempQl","connector","totalLength","num1024","vfv","Voice","num_beats","beat_value","resolution","RESOLUTION","setMode","Mode","SOFT","connectorType","brace","StaveConnector","BRACE","SINGLE","DOUBLE","BRACKET","firstPart","lastPart","firstPartMeasures","lastPartMeasures","numMeasures","mIndex","thisPartMeasure","lastPartMeasure","topVFStaff","bottomVFStaff","thisPartVoice","getElementsByClass","lastPartVoice","sc","scTypeM21","scTypeVF","staffConnectorsMap","setType","recursive","storedVexflowStave","removeFormatterInformation","noteOffsetLeft","start_x","glyph_start_x","getBottomY","nextTicks","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","nTicks","ticks","formatterNote","tickContexts","getAbsoluteX","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","backend","Backends","CANVAS","SVG","resize","attr","vfr","vfRenderer","Stream","isMeasure","_instrument","_autoBeam","activeVFRenderer","_tempo","_stopPlaying","_allowMultipleSimultaneousPlays","changedCallbackFunction","DOMChangerFunction","canvasOrSVGElement","currentTarget","_this2$findNoteForCli","findNoteForClick","_this2$findNoteForCli2","clickedDiatonicNoteNum","foundNote","noteChanged","retainContainers","tempEls","offsetShift","elFlat","_getFlatOrSemiFlat","newSt","elements","deep","elCopy","elOrElList","isArray","elOffset","lastQL","elementOrNone","element","amountToShift","shiftingOffsets","index","addElement","meterStream","refStreamOrTimeRange","searchContext","innerBarline","finalBarline","voiceCount","offsetMap","oMax","measureCount","mStart","Measure","thisTimeSignature","oneMeasureLength","ob","getOffsetBySite","mEnd","oNew","insertStream","returnObj","mColl","noteStream","durList","durSum","reduce","total","barQL","paddingLeft","highestTime","getBeams","thisBeams","lyric","each","group","thisOffsetMap","OffsetMap","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_step9","_iterator9","extendableStepList","stepNames","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_step10","_iterator10","stepName","stepAlter","accidentalByStep","lastOctaveStepList","tempOctaveStepDict","extend","lastOctavelessStepDict","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_step11","_iterator11","lastStepDict","_makeAccidentalForOnePitch","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_step12","_iterator12","chordNote","preserveEvents","oldEvents","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_step13","_iterator13","resetRenderOptions","canvasOrSVG","renderVexflow","DOMContains","contains","tagName","makeBeams","render","setRenderInteraction","ignoreSystems","staffHeight","numSystems","numParts","maxLength","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_step14","_iterator14","thisLength","startNote","startNoteIndex","currentNoteIndex","flatEls","lastNoteIndex","thisStream","playNext","playDuration","playMidi","elementType","createNewDOM","setSubstreamRenderOptions","renderElementType","$newCanvasOrDIV","addClass","computedWidth","computedHeight","estimateStreamHeight","createPlayableDOM","createDOM","$newSvg","appendElement","appendNewDOM","$appendElement","svgOrCanvasBlock","preserveSvgSize","replaceDOM","$oldSVGOrCanvas","hasClass","svgBlock","replaceWith","canvasOrDiv","$svg","playFunc","playStream","proxy","eventType","eventFunction","off","windowReflowStart","storedVFStave","subStreams","svg","getUnscaledXYforDOM","xClick","yClick","pageX","pageY","clientX","scrollLeft","documentElement","clientY","scrollTop","getScaledXYforDOM","_getUnscaledXYforDOM","_getUnscaledXYforDOM2","xPx","yPx","pixelScaling","yPxScaled","recursiveGetStoredVexflowStave","lineSpacing","linesAboveStaff","space_above_staff_ln","notesFromTop","notesAboveLowestLine","num_lines","xPxScaled","allowablePixels","allowBackup","backupMaximum","getStreamFromScaledXandSystemIndex","backup","minDistanceSoFar","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_step15","_iterator15","leftDistance","rightDistance","minDistance","_getScaledXYforDOM","_getScaledXYforDOM2","diatonicNoteNumFromScaledY","noteElementFromScaledX","activeNote","redrawDOM","editableAccidentalDOM","$svgDiv","buttonDiv","getAccidentalToolbar","minAccidental","maxAccidental","$siblingSvg","clickEvent","$useSvg","$searchParent","maxSearch","$buttonDiv","acc","$button","unicodeModifier","$bPlay","$bStop","stopPlayStream","jSvg","callingStream","jSvgNow","jSvgParent","newWidth","svgWidth","resizeTO","clearTimeout","trigger","$window","doResize","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_step16","_iterator16","_iteratorNormalCompletion17","_didIteratorError17","_iteratorError17","_step17","_iterator17","newTempo","newInstrument","newClef","newKeySignature","newTimeSignature","ab","baseMaxSystemWidth","newSW","newElements","highestOffsetSoFar","tempInsert","thisElOffset","_Stream","_Stream2","Part","_Stream3","systemHeight","measureWidths","_iteratorNormalCompletion18","_didIteratorError18","_iteratorError18","_step18","_iterator18","elRendOp","_iteratorNormalCompletion19","_didIteratorError19","_iteratorError19","_step19","_iterator19","tempM","getMeasureWidths","systemCurrentWidths","systemBreakIndexes","lastSystemBreak","currentLeft","currentRight","currentSystemIndex","leftSubtract","newLeftSubtract","oldWidth","currentSystemMultiplier","newLeft","newTop","currentMeasureIndex","currentMeasureLeft","_iteratorNormalCompletion20","_didIteratorError20","_iteratorError20","_step20","_iterator20","_getScaledXYforDOM3","_getScaledXYforDOM4","_systemIndexAndScaled","systemIndexAndScaledY","_systemIndexAndScaled2","scaledYRelativeToSystem","gotMeasure","_iteratorNormalCompletion21","_didIteratorError21","_iteratorError21","_step21","_iterator21","right","bottom","Score","_Stream4","partSpacing","currentPartNumber","currentPartTop","_iteratorNormalCompletion22","_didIteratorError22","_iteratorError22","_step22","_iterator22","evenPartMeasureSpacing","currentScoreHeight","_iteratorNormalCompletion23","_didIteratorError23","_iteratorError23","_step23","_iterator23","fixSystemInformation","_iteratorNormalCompletion24","_didIteratorError24","_iteratorError24","_step24","_iterator24","tempPart","_iteratorNormalCompletion25","_didIteratorError25","_iteratorError25","_step25","_iterator25","_iteratorNormalCompletion26","_didIteratorError26","_iteratorError26","_step26","_iterator26","maxMeasureWidths","measureWidthsArrayOfArrays","_iteratorNormalCompletion27","_didIteratorError27","_iteratorError27","_step27","_iterator27","maxFound","_getScaledXYforDOM5","_getScaledXYforDOM6","_systemIndexAndScaled3","_systemIndexAndScaled4","scaledYFromSystemTop","scaledYinPart","rightPart","measureStacks","maxMeasureWidth","_iteratorNormalCompletion28","_didIteratorError28","_iteratorError28","_step28","_iterator28","thisMeasureWidth","measureNewWidth","part","measure","layout","makeLayoutFromScore","score","containerWidth","partZero","layoutScore","LayoutScore","currentPage","Page","measureStart","measureEnd","currentSystem","System","currentSystemNumber","currentStaves","staffMaker","staffHolder","pNum","staff","Staff","staffNumber","systemNumber","_stream$Score","scoreLayout","_width","pageId","systemId","staffId","units","_stream$Score2","pageNumber","systemStart","systemEnd","pageLayout","_stream$Score3","systemLayout","_stream$Part","optimized","inheritedHeight","staffLayout","VALID_TIE_TYPES","Tie","newType","DEFAULTS","divisionsPerQuarter","ScoreParser","xmlText","xmlUrl","$xmlRoot","definesExplicitSystemBreaks","definesExplicitPageBreaks","mxScorePartDict","m21PartObjectsById","partGroupList","musicXmlVersion","xmlDoc","textStatus","scoreFromDOMTree","parseXML","xmlRootToScore","$mxScore","inputM21","parsePartList","$p","$mxScorePart","xmlPartToPart","$mxPart","parser","PartParser","parse","mxPartList","partListElement","$partListElement","atSoundingPitch","staffReferenceList","lastMeasureWasShort","lastMeasureOffset","lastClefs","activeTuplets","maxStaves","lastMeasureNumber","lastNumberSuffix","multiMeasureRestsToCapture","activeMultimeasureRestSpanner","activeInstrument","firstMeasureParsed","$activeAttributes","lastDivisions","appendToScoreAfterParse","lastMeasureParser","parseXmlScorePart","parseMeasures","mxMeasure","$mxMeasure","xmlMeasureToMeasure","measureParser","MeasureParser","setLastMeasureInfo","adjustTimeAttributesFromMeasure","numberSuffix","mHighestTime","mOffsetShift","$mxMeasureElements","divisions","transposition","staffReference","useVoices","voicesById","voiceIndices","Set","staves","attributesAreInternal","measureNumber","staffLayoutObjects","$mxNoteList","$mxLyricList","nLast","chordVoice","fullMeasureRest","restAndNoteCount","rest","parseIndex","offsetMeasureNote","attributeTagsToMethods","musicDataMethods","attributes","parseMeasureAttributes","$c","$mxObj","methName","$mxNote","nextNoteIsChord","$mxObjNext","offsetIncrement","xmlToRest","xmlToSimpleNote","insertInMeasureOrVoice","xmlToChord","freeSpanners","xmlToPitch","xmlNoteToGeneralNoteHelper","$mxPitch","$mxAlter","accAlter","parseFloat","$mxAccidental","accObj","xmlToAccidental","$mxRest","xmlToDuration","xmlToTie","mxDuration","qLen","mxType","durationType","allTies","$t0","$mxElement","parseMeasureNumbers","mNumRaw","mNum","$mxAttributes","mxSub","$mxSub","$mxTime","xmlToTimeSignature","insertIntoMeasureOrVoice","$mxClef","xmlToClef","sign","line","clefOctaveChange","$coc","$mxKey","keySig","xmlToKeySignature","ks","musicxml","roman","figureShorthands","53","63","753","75","73","9753","975","953","97","95","93","653","6b53","643","642","bb7b5b3","bb7b53","b7b5b3","functionalityScores","I","V7","V","V65","I6","V6","V43","I64","IV","i6","viio7","V42","viio65","viio6","#viio65","#viio6","ii65","ii43","ii42","IV6","ii6","VI","#VI","vi","viio","#viio","iio","iio42","bII6","iio43","iio65","#vio","#vio6","III","VII","VII7","IV65","IV7","iii","iii6","vi6","expandShortHand","shorthand","shorthandGroups","shGroupOut","sh","correctSuffixForChordQuality","chordObj","inversionString","fifthType","qualityName","seventhType","romanToNumber","RomanNumeral","_harmony$Harmony","keyStr","_parsingComplete","primaryFigure","secondaryRomanNumeral","secondaryRomanNumeralKey","pivotChord","scaleCardinality","caseMatters","scaleDegree","frontAlterationString","frontAlterationTransposeInterval","frontAlterationAccidental","romanNumeralAlone","impliedQuality","impliedScale","scaleOffset","useImpliedScale","bracketedAlterations","omittedSteps","followsKeyChange","_functionalityScore","workingFigure","useScale","_correctForSecondaryR","_correctForSecondaryRomanNumeral","_correctForSecondaryR2","_parseOmittedSteps","_parseBracketedAlterations","_parseFrontAlterations","_parseRNAloneAmidstAu","_parseRNAloneAmidstAug6","_parseRNAloneAmidstAu2","_setImpliedQualityFromString","_tempRoot","_fixMinorVIandVII","expandedFigure","figuresNotationObj","numbersArr","_alterationRegex","alteration","innerAlteration","_innerAlteration","alterNotation","alterPitch","fati","newFati","_romanNumeralAloneRegex","_augmentedSixthRegex","rm","a6match","bassScaleDegree","bassScaleDegreeFromNotation","bassPitch","numberNotes","thisScaleDegree","pitchName","modifyPitchName","newNewPitch","newPitches","_matchAccidentalsToQuality","omittedPitches","thisCS","_correctBracketedPitches","notationObject","cDNN","tempChord","rootDNN","staffDistanceFromBassToRoot","bassSD","correctSemitones","_findSemitoneSizeForQuality","chordStepsToExamine","thisChordStep","thisCorrect","thisSemis","correctedSemis","faultyPitch","secondaryFigure","secondaryMode","quality","thisStep","matchAlteration","matchDegree","tonicName","inversionName","fullChordName","suffix","degreeName","tonicDisplay","tonicPitch","diffRootToTonic","defaultTempoValues","larghissimo","largamente","grave","molto adagio","largo","lento","adagio","slow","langsam","larghetto","adagietto","andante","andantino","andante moderato","maestoso","moderato","moderate","allegretto","animato","allegro moderato","allegro","fast","schnell","allegrissimo","molto allegro","tr√®s vite","vivace","vivacissimo","presto","prestissimo","baseTempo","Metronome","tempoInt","numBeatsPerMeasure","minTempo","maxTempo","beat","chirpTimeout","silent","flash","tempoRanges","tempoIncreases","flashColor","$metronomeDiv","fadeOut","beatLength","fadeIn","_silentFlash","that","chirp","tr","tempoExtreme","tempoIncrease","trL","jWhere","metroThis","tempoHolder","padding-left","padding-right","newDiv","b1","b2","stopChirp","prepend","b3","increaseSpeed","prevAll","html","b4","decreaseSpeed","$flash","tinyNotation","regularExpressions","REST","OCTAVE2","OCTAVE3","OCTAVE5","OCTAVE4","EDSHARP","EDFLAT","EDNAT","SHARP","FLAT","NAT","TYPE","TIE","PRECTIE","ID_EL","LYRIC","DOT","TIMESIG","PARTBREAK","TRIP","QUAD","ENDBRAC","TinyNotation","textIn","tokens","optionalScore","currentTSBarDuration","lastDurationQL","storedDict","lastNoteTied","inTrip","inQuad","endTupletAfterNote","tnre","token","_token$split","_token$split2","MATCH","returnObject","innerPart","renderNotationDivs","classTypes","selector","allRender","thisTN","$thisTN","thisTNContents","textContent","newSVG","empty","intervalCache","MotionType","antiParallel","contrary","noMotion","oblique","parallel","similar","VoiceLeadingQuartet","v1n1","v1n2","v2n1","v2n2","analyticKey","unison","_v1n1","_v1n2","_v2n1","_v2n2","vIntervals","hIntervals","_findIntervals","which","obliqueMotion","parallelMotion","similarMotion","contraryMotion","antiParallelMotion","requiredInterval","parallelInterval","parallelUnison","parallelOctave","hiddenInterval","n1degree","n2degree","scale2","firstHarmony","secondHarmony","inwardContraryMotion","outwardContraryMotion","_setVoiceNote","keyValue","voiceLeading","webmidi","selectedOutputPort","selectedInputPort","access","$selectDiv","jazzDownloadUrl","storedPlugin","selectedJazzInterface","jazzMidiInArrived","webmidiEvent","timestamp","midiInArrived","midiMessageEvent","timeStamp","eventObject","createPlugin","override","createElement","classid","isJazz","visibility","createJazzSelector","$newSelect","Jazz","change","selectedInput","MidiInOpen","MidiInClose","selectedInterface","midiOptions","MidiInList","noneAppendOption","anySelected","allAppendOptions","$appendOption","oninputsuccess","oninputempty","selectionChanged","$select","storedStateChange","onstatechange","inputs","port","onmidimessage","close","createSelector","$midiSelectDiv","autoUpdate","existingMidiSelect","foundMidiSelects","requestMIDIAccess","then","populateSelect","$noneAppendOption","music21","exceptions21"],"mappings":"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","file":"music21.min.js","sourcesContent":["/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/scale -- Scales\n *\n * Does not implement the full range of scales from music21p\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base.js';\nimport { common } from './common.js';\nimport { debug } from './debug.js';\nimport { interval } from './interval.js';\nimport { pitch } from './pitch.js';\n\nimport { Music21Exception } from './exceptions21.js';\n\n// const DIRECTION_BI = 'bi';\n// const DIRECTION_DESCENDING = 'descending';\n// const DIRECTION_ASCENDING = 'ascending';\n\n/**\n * Scale module. See {@link music21.scale} namespace\n *\n * @exports music21/scale\n */\n/**\n * Scale namespace.  Right now only supports very simple scales.\n *\n * @namespace music21.scale\n * @memberof music21\n * @requires music21/base\n * @requires music21/common\n * @requires music21/debug\n * @requires music21/interval\n * @requires music21/pitch\n */\nexport class Scale extends base.Music21Object {\n    constructor() {\n        super();\n        this.type = 'Scale';\n    }\n\n    get name() {\n        return this.type;\n    }\n\n    get isConcrete() {\n        return false;\n    }\n}\n\nexport class AbstractScale extends Scale {\n    constructor() {\n        super();\n        this._net = []; // simplified -- no IntervalNetwork, just list of intervals\n        this.tonicDegree = 1;\n        this.octaveDuplicating = true;\n        this.deterministic = true;\n        this._alteredDegrees = {};\n        this._oneOctaveRealizationCache = undefined;\n    }\n\n    equals(other) {\n        if (\n            common.arrayEquals(this.classes, other.classes)\n            && this.tonicDegree === other.tonicDegree\n            && common.arrayEquals(this._net, other._net)\n        ) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    buildNetworkFromPitches(pitchList) {\n        const pitchListReal = [];\n        for (const p of pitchList) {\n            if (typeof p === 'string') {\n                pitchListReal.push(new pitch.Pitch(p));\n            } else if (p.classes.includes('Note')) {\n                pitchListReal.push(p.pitch);\n            } else {\n                pitchListReal.push(p);\n            }\n        }\n        pitchList = pitchListReal;\n\n        const pLast = pitchList[pitchList.length - 1];\n        if (pLast.name === pitchList[0]) {\n            const p = pitchList[0].clone();\n            if (pLast.ps > pitchList[0]) {\n                // ascending;\n                while (p.ps < pLast.ps) {\n                    p.octave += 1;\n                }\n            } else {\n                while (p.ps < pLast.ps) {\n                    p.octave += -1;\n                }\n            }\n            pitchList.push(p);\n        }\n\n        const intervalList = [];\n        for (let i = 0; i < pitchList.length - 1; i++) {\n            const thisInterval = new interval.Interval(\n                pitchList[i],\n                pitchList[i + 1]\n            );\n            intervalList.push(thisInterval);\n        }\n        this._net = intervalList;\n    }\n\n    getDegreeMaxUnique() {\n        return this._net.length;\n    }\n\n    getRealization(\n        pitchObj,\n        unused_stepOfPitch,\n        unused_minPitch,\n        unused_maxPitch,\n        unused_direction,\n        unused_reverse\n    ) {\n        // if (direction === undefined) {\n        //     direction = DIRECTION_ASCENDING;\n        // }\n        // if (stepOfPitch === undefined) {\n        //     stepOfPitch = 1;\n        // }\n        if (typeof pitchObj === 'string') {\n            pitchObj = new pitch.Pitch(pitchObj);\n        } else {\n            pitchObj = pitchObj.clone();\n        }\n        const post = [pitchObj];\n        for (const intV of this._net) {\n            pitchObj = intV.transposePitch(pitchObj);\n            post.push(pitchObj);\n        }\n        return post;\n    }\n\n    getPitchFromNodeDegree(pitchReference, unused_nodeName, nodeDegreeTarget) {\n        const zeroIndexDegree = nodeDegreeTarget - 1;\n        for (let i = 0; i < zeroIndexDegree; i++) {\n            const thisIntv = this._net[i % this._net.length];\n            pitchReference = thisIntv.transposePitch(pitchReference);\n        }\n        return pitchReference;\n    }\n\n    getRelativeNodeDegree(\n        pitchReference,\n        unused_nodeName,\n        pitchTarget,\n        unused_comparisonAttribute,\n        unused_direction\n    ) {\n        if (typeof pitchTarget === 'string') {\n            pitchTarget = new pitch.Pitch(pitchTarget);\n        }\n        let realizedPitches;\n        if (this._oneOctaveRealizationCache !== undefined) {\n            realizedPitches = this._oneOctaveRealizationCache;\n        } else {\n            realizedPitches = this.getRealization(pitchReference);\n            this._oneOctaveRealizationCache = realizedPitches;\n        }\n        const realizedNames = [];\n        for (const p of realizedPitches) {\n            realizedNames.push(p.name);\n        }\n        const realizedIndex = realizedNames.indexOf(pitchTarget.name);\n        if (realizedIndex === -1) {\n            return undefined;\n        } else {\n            return realizedIndex + 1;\n        }\n    }\n}\n\nexport class AbstractDiatonicScale extends AbstractScale {\n    constructor(mode) {\n        super();\n        this.type = 'Abstract diatonic';\n        this.tonicDegree = undefined;\n        this.dominantDegree = undefined;\n        this.octaveDuplicating = true;\n        this._buildNetwork(mode);\n    }\n    _buildNetwork(mode) {\n        const srcList = ['M2', 'M2', 'm2', 'M2', 'M2', 'M2', 'm2'];\n        let intervalList;\n        this.tonicDegree = 1;\n        this.dominantDegree = 5;\n        if (['major', 'ionian', undefined].includes(mode)) {\n            intervalList = srcList;\n            this.relativeMajorDegree = 1;\n            this.relativeMinorDegree = 6;\n        } else if (['minor', 'aeolian'].includes(mode)) {\n            intervalList = srcList.slice(5, 7);\n            intervalList.push(...srcList.slice(0, 5));\n            this.relativeMajorDegree = 3;\n            this.relativeMinorDegree = 1;\n        }\n        this._net = [];\n        for (const intVStr of intervalList) {\n            this._net.push(new interval.Interval(intVStr));\n        }\n    }\n}\n\nexport class AbstractHarmonicMinorScale extends AbstractScale {\n    constructor() {\n        super();\n        this.type = 'Abstract harmonic minor';\n        this.octaveDuplicating = true;\n        this._buildNetwork();\n    }\n    _buildNetwork() {\n        const intervalList = ['M2', 'm2', 'M2', 'M2', 'm2', 'A2', 'm2'];\n        this._net = [];\n        for (const intVStr of intervalList) {\n            this._net.push(new interval.Interval(intVStr));\n        }\n    }\n}\n\n// temporary, until bidirectional scales are created\n// no need for descending, since minor takes care of that.\nexport class AbstractAscendingMelodicMinorScale extends AbstractScale {\n    constructor() {\n        super();\n        this.type = 'Abstract ascending melodic minor';\n        this.octaveDuplicating = true;\n        this._buildNetwork();\n    }\n    _buildNetwork() {\n        const intervalList = ['M2', 'm2', 'M2', 'M2', 'M2', 'M2', 'm2'];\n        this._net = [];\n        for (const intVStr of intervalList) {\n            this._net.push(new interval.Interval(intVStr));\n        }\n    }\n}\n\nexport class ConcreteScale extends Scale {\n    constructor(tonic) {\n        super();\n        if (typeof tonic === 'string') {\n            tonic = new pitch.Pitch(tonic);\n        }\n        this.tonic = tonic;\n        this.abstract = undefined;\n    }\n\n    // when adding functionality here, must also be added to key.Key.\n    get isConcrete() {\n        if (this.tonic !== undefined) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    getTonic() {\n        return this.tonic;\n    }\n\n    // transpose\n    // tune\n    // No .romanNumeral function because of circular imports...\n    // romanNumeral(degree) {\n    //     return new roman.RomanNumeral(degree, this);\n    // }\n\n    getPitches(unused_minPitch, unused_maxPitch, unused_direction) {\n        let pitchObj;\n        if (this.tonic === undefined) {\n            pitchObj = new pitch.Pitch('C4');\n        } else {\n            pitchObj = this.tonic;\n        }\n        return this.abstract.getRealization(pitchObj);\n    }\n\n    pitchFromDegree(\n        degree,\n        unused_minPitch,\n        unused_maxPitch,\n        unused_direction,\n        unused_equateTermini\n    ) {\n        return this.abstract.getPitchFromNodeDegree(\n            this.tonic,\n            this.abstract.tonicDegree,\n            degree\n        );\n    }\n\n    getScaleDegreeFromPitch(\n        pitchTarget,\n        unused_direction,\n        unused_comparisonAttribute\n    ) {\n        return this.abstract.getRelativeNodeDegree(\n            this.tonic,\n            this.abstract.tonicDegree,\n            pitchTarget\n        );\n    }\n}\n\nexport class DiatonicScale extends ConcreteScale {\n    constructor(tonic) {\n        super(tonic); // a.k.a. ^2 :-)\n        this.abstract = new AbstractDiatonicScale();\n        this.type = 'diatonic';\n    }\n}\n\nexport class MajorScale extends DiatonicScale {\n    constructor(tonic) {\n        super(tonic); // a.k.a. ^2 :-)\n        this.type = 'major';\n        this.abstract._buildNetwork(this.type);\n    }\n}\n\nexport class MinorScale extends DiatonicScale {\n    constructor(tonic) {\n        super(tonic); // a.k.a. ^2 :-)\n        this.type = 'minor';\n        this.abstract._buildNetwork(this.type);\n    }\n}\n\nexport class HarmonicMinorScale extends ConcreteScale {\n    constructor(tonic) {\n        super(tonic); // a.k.a. ^2 :-)\n        this.type = 'harmonic minor';\n        this.abstract = new AbstractHarmonicMinorScale();\n    }\n}\n\nexport class AscendingMelodicMinorScale extends ConcreteScale {\n    constructor(tonic) {\n        super(tonic); // a.k.a. ^2 :-)\n        this.type = 'harmonic minor';\n        this.abstract = new AbstractAscendingMelodicMinorScale();\n    }\n}\n\n/**\n * Function, not class\n *\n * @function music21.scale.SimpleDiatonicScale\n * @param {music21.pitch.Pitch} tonic\n * @param {Array<string>} scaleSteps - an array of diatonic prefixes,\n *     generally 'M' (major) or 'm' (minor) describing the seconds.\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nexport function SimpleDiatonicScale(tonic, scaleSteps) {\n    if (tonic === undefined) {\n        tonic = new pitch.Pitch('C4');\n    } else if (!(tonic instanceof pitch.Pitch)) {\n        throw new Music21Exception(\n            'Cannot make a scale not from '\n                + 'a music21.pitch.Pitch object: '\n                + tonic\n        );\n    }\n    if (scaleSteps === undefined) {\n        scaleSteps = ['M', 'M', 'm', 'M', 'M', 'M', 'm'];\n    }\n    const gi = new interval.GenericInterval(2);\n    const pitches = [tonic];\n    let lastPitch = tonic;\n    for (let i = 0; i < scaleSteps.length; i++) {\n        const di = new interval.DiatonicInterval(scaleSteps[i], gi);\n        const ii = new interval.Interval(di);\n        const newPitch = ii.transposePitch(lastPitch);\n        if (debug) {\n            console.log('ScaleSimpleMajor -- adding pitch: ' + newPitch.name);\n        }\n        pitches.push(newPitch);\n        lastPitch = newPitch;\n    }\n    return pitches;\n}\n\n/**\n * One octave of a major scale\n *\n * @function music21.scale.ScaleSimpleMajor\n * @param {music21.pitch.Pitch} tonic\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nexport function ScaleSimpleMajor(tonic) {\n    const scaleSteps = ['M', 'M', 'm', 'M', 'M', 'M', 'm'];\n    return SimpleDiatonicScale(tonic, scaleSteps);\n}\n\n/**\n * One octave of a minor scale\n *\n * @function music21.scale.ScaleSimpleMinor\n * @param {music21.pitch.Pitch} tonic\n * @param {string} [minorType='natural'] - 'harmonic', 'harmonic-minor',\n *     'melodic', 'melodic-minor', 'melodic-minor-ascending',\n *     'melodic-ascending' or other (=natural/melodic-descending)\n * @returns {Array<music21.pitch.Pitch>} an octave of scale objects.\n */\nexport function ScaleSimpleMinor(tonic, minorType) {\n    const scaleSteps = ['M', 'm', 'M', 'M', 'm', 'M', 'M'];\n    if (typeof minorType === 'string') {\n        // \"harmonic minor\" -> \"harmonic-minor\"\n        minorType = minorType.replace(/\\s/g, '-');\n    }\n    if (minorType === 'harmonic' || minorType === 'harmonic-minor') {\n        scaleSteps[5] = 'A';\n        scaleSteps[6] = 'm';\n    } else if (\n        minorType === 'melodic'\n        || minorType === 'melodic-ascending'\n        || minorType === 'melodic-minor'\n        || minorType === 'melodic-minor-ascending'\n    ) {\n        scaleSteps[4] = 'M';\n        scaleSteps[6] = 'm';\n    }\n    return SimpleDiatonicScale(tonic, scaleSteps);\n}\n\nexport const scale = {\n    Scale,\n    AbstractScale,\n    AbstractDiatonicScale,\n    AbstractHarmonicMinorScale,\n    AbstractAscendingMelodicMinorScale,\n    ConcreteScale,\n    DiatonicScale,\n    MajorScale,\n    MinorScale,\n    HarmonicMinorScale,\n    AscendingMelodicMinorScale,\n\n    ScaleSimpleMinor,\n    ScaleSimpleMajor,\n    SimpleDiatonicScale,\n};\n","import * as $ from 'jquery';\n\nimport { chord } from './chord.js';\nimport { clef } from './clef.js';\nimport { duration } from './duration.js';\nimport { key } from './key.js';\nimport { meter } from './meter.js';\nimport { note } from './note.js';\nimport { pitch } from './pitch.js';\nimport { stream } from './stream.js';\nimport { tie } from './tie.js';\n\nconst DEFAULTS = {\n    divisionsPerQuarter: 32 * 3 * 3 * 5 * 7,\n};\n\nfunction hyphenToCamelCase(tag) {\n    return tag.replace(/-([a-z])/g, firstLetter =>\n        firstLetter[1].toUpperCase()\n    );\n}\n\nfunction seta(m21El, xmlEl, tag, attributeName, transform) {\n    const $matchEl = $(xmlEl).children(tag);\n    if (!$matchEl) {\n        return;\n    }\n    let value = $matchEl\n        .contents()\n        .eq(0)\n        .text();\n    if (value === undefined || value === '') {\n        return;\n    }\n    if (transform !== undefined) {\n        value = transform(value);\n    }\n    if (attributeName === undefined) {\n        attributeName = hyphenToCamelCase(tag);\n    }\n    m21El[attributeName] = value;\n}\n\nexport class ScoreParser {\n    constructor() {\n        this.xmlText = undefined;\n        this.xmlUrl = undefined;\n        this.$xmlRoot = undefined;\n        this.stream = new stream.Score();\n\n        this.definesExplicitSystemBreaks = false;\n        this.definesExplicitPageBreaks = false;\n\n        this.mxScorePartDict = {};\n        this.m21PartObjectsById = {};\n        this.partGroupList = [];\n        this.parts = [];\n\n        this.musicXmlVersion = '1.0';\n    }\n\n    scoreFromUrl(url) {\n        this.xmlUrl = url;\n        return $.get(url, {}, (xmlDoc, textStatus) =>\n            this.scoreFromDOMTree(xmlDoc)\n        );\n    }\n\n    scoreFromText(xmlText) {\n        this.xmlText = xmlText;\n        const xmlDoc = $.parseXML(xmlText);\n        return this.scoreFromDOMTree(xmlDoc);\n    }\n\n    scoreFromDOMTree(xmlDoc) {\n        this.$xmlRoot = $($(xmlDoc).children('score-partwise'));\n        this.xmlRootToScore(this.$xmlRoot, this.stream);\n        return this.stream;\n    }\n\n    xmlRootToScore($mxScore, inputM21) {\n        let s = inputM21;\n        if (inputM21 === undefined) {\n            s = new stream.Score();\n        }\n        // version\n        // defaults\n        // credit\n        this.parsePartList($mxScore);\n        for (const p of $mxScore.children('part')) {\n            const $p = $(p);\n            const partId = $p.attr('id');\n            // if (partId === undefined) {\n            //     partId = //something\n            // }\n            const $mxScorePart = this.mxScorePartDict[partId];\n            const part = this.xmlPartToPart($p, $mxScorePart);\n            if (part !== undefined) {\n                // partStreams are undefined\n                s.insert(0.0, part);\n                this.m21PartObjectsById[partId] = part;\n                this.parts.push(part);\n            }\n        }\n        // partGroups;\n        // spanners;\n        // definesExplicitSystemreaks, etc.\n        // sort\n        return s;\n    }\n\n    xmlPartToPart($mxPart, $mxScorePart) {\n        const parser = new PartParser($mxPart, $mxScorePart, this);\n        parser.parse();\n        // handle partStreams\n        return parser.stream;\n    }\n\n    parsePartList($mxScore) {\n        const mxPartList = $mxScore.children('part-list');\n        if (!mxPartList) {\n            return;\n        }\n        // const openPartGroups = [];\n        for (const partListElement of mxPartList) {\n            const $partListElement = $(partListElement);\n            const partId = $partListElement.attr('id');\n            this.mxScorePartDict[partId] = $partListElement;\n        }\n        // deal with part-groups\n    }\n}\n\nexport class PartParser {\n    constructor($mxPart, $mxScorePart, parent) {\n        this.$mxPart = $mxPart;\n        this.$mxScorePart = $mxScorePart;\n        // ignore parent for now\n        if ($mxPart !== undefined) {\n            this.partId = $mxPart.attr('id');\n            // ignore empty partId for now\n        }\n        // spannerBundles\n        this.stream = new stream.Part();\n        this.atSoundingPitch = true;\n        this.staffReferenceList = [];\n\n        this.lastTimeSignature = undefined;\n        this.lastMeasureWasShort = false;\n        this.lastMeasureOffset = 0.0;\n        this.lastClefs = {\n            0: new clef.TrebleClef(),\n        };\n        this.activeTuplets = [];\n        this.activeTuplets.length = 7;\n        this.activeTuplets.fill(undefined);\n\n        this.maxStaves = 1;\n        this.lastMeasureNumber = 0;\n        this.lastNumberSuffix = undefined;\n\n        this.multiMeasureRestsToCapture = 0;\n        this.activeMultimeasureRestSpanner = undefined;\n\n        this.activeInstrument = undefined;\n        this.firstMeasureParsed = false;\n        this.$activeAttributes = undefined;\n        this.lastDivisions = DEFAULTS.divisionsPerQuarter;\n\n        this.appendToScoreAfterParse = true;\n        this.lastMeasureParser = undefined;\n    }\n\n    parse() {\n        this.parseXmlScorePart();\n        this.parseMeasures();\n        // atSoundingPitch;\n        // spannerBundles\n        // partStaves;\n    }\n\n    parseXmlScorePart() {\n        const part = this.stream;\n        const $mxScorePart = this.$mxScorePart;\n\n        seta(part, $mxScorePart, 'part-name'); // todo -- clean string\n        // remainder of part names\n        // instruments\n    }\n\n    parseMeasures() {\n        for (const mxMeasure of this.$mxPart.children('measure')) {\n            const $mxMeasure = $(mxMeasure);\n            this.xmlMeasureToMeasure($mxMeasure);\n        }\n        if (this.lastMeasureParser !== undefined) {\n            this.lastMeasureParser.parent = undefined; // gc.\n        }\n    }\n\n    xmlMeasureToMeasure($mxMeasure) {\n        const measureParser = new MeasureParser($mxMeasure, this);\n        measureParser.parse();\n        if (this.lastMeasureParser !== undefined) {\n            this.lastMeasureParser.parent = undefined; // gc.\n        }\n        this.lastMeasureParser = measureParser;\n        // max staves\n        // transposition\n        this.firstMeasureParsed = true;\n        // staffReferenceList\n\n        const m = measureParser.stream;\n        this.setLastMeasureInfo(m);\n        // fullMeasureRests\n\n        // TODO: offsets!!!\n        // this.stream.insert(this.lastMeasureOffset, m);\n        this.stream.append(m);\n\n        this.adjustTimeAttributesFromMeasure(m);\n    }\n\n    setLastMeasureInfo(m) {\n        if (m.number !== this.lastMeasureNumber) {\n            this.lastMeasureNumber = m.number;\n            this.lastNumberSuffix = m.numberSuffix;\n        }\n\n        if (m.timeSignature !== undefined) {\n            this.lastTimeSignature = m.timeSignature;\n        } else if (this.lastTimeSignature === undefined) {\n            this.lastTimeSignature = new meter.TimeSignature('4/4');\n        }\n    }\n\n    adjustTimeAttributesFromMeasure(m) {\n        const mHighestTime = m.highestTime;\n        // ignore incomplete measures.\n        const mOffsetShift = mHighestTime;\n        this.lastMeasureOffset += mOffsetShift;\n    }\n}\n\nexport class MeasureParser {\n    constructor($mxMeasure, parent) {\n        this.$mxMeasure = $mxMeasure;\n        this.$mxMeasureElements = [];\n\n        this.divisions = undefined;\n        this.parent = parent;\n\n        this.transposition = undefined;\n        // spannerBundles\n        this.staffReference = {};\n        // activeTuplets\n        this.useVoices = false;\n        this.voicesById = {};\n        this.voiceIndices = new Set();\n        this.staves = 1;\n        this.$activeAttributes = undefined;\n        this.attributesAreInternal = true;\n        this.measureNumber = undefined;\n        this.numberSuffix = undefined;\n\n        if (parent !== undefined) {\n            this.divisions = parent.lastDivisions;\n        } else {\n            this.divisions = DEFAULTS.divisionsPerQuarter;\n        }\n\n        this.staffLayoutObjects = [];\n        this.stream = new stream.Measure();\n\n        this.$mxNoteList = [];\n        this.$mxLyricList = [];\n        this.nLast = undefined;\n        this.chordVoice = undefined;\n        this.fullMeasureRest = false;\n        this.restAndNoteCount = {\n            rest: 0,\n            note: 0,\n        };\n        this.lastClefs = {\n            0: undefined,\n        };\n        this.parseIndex = 0;\n        this.offsetMeasureNote = 0.0;\n\n        // class attributes in m21p\n        this.attributeTagsToMethods = {\n            time: 'handleTimeSignature',\n            clef: 'handleClef',\n            key: 'handleKeySignature',\n            // 'staff-details': 'handleStaffDetails',\n            // 'measure-style': 'handleMeasureStyle',\n        };\n        this.musicDataMethods = {\n            note: 'xmlToNote',\n            // 'backup': 'xmlBackup',\n            // 'forward': 'xmlForward',\n            // 'direction': 'xmlDirection',\n            attributes: 'parseAttributesTag',\n            // 'harmony': 'xmlHarmony',\n            // 'figured-bass': undefined,\n            // 'sound': undefined,\n            // 'barline': 'xmlBarline',\n            // 'grouping': undefined,\n            // 'link': undefined,\n            // 'bookmark': undefined,\n\n            // Note: <print> is handled separately...\n        };\n    }\n\n    parse() {\n        // mxPrint\n        this.parseMeasureAttributes();\n        // updateVoiceInformation;\n\n        const children = this.$mxMeasure.children();\n        this.$mxMeasureElements = [];\n        for (const c of children) {\n            const $c = $(c);\n            this.$mxMeasureElements.push($c);\n        }\n\n        let i = 0;\n        for (const $mxObj of this.$mxMeasureElements) {\n            const tag = $mxObj[0].tagName;\n            this.parseIndex = i;\n            const methName = this.musicDataMethods[tag];\n            if (methName !== undefined) {\n                this[methName]($mxObj);\n            }\n            i += 1;\n        }\n        // useVoices\n        // fullMeasureRest\n    }\n\n    insertInMeasureOrVoice($mxObj, el) {\n        // TODO: offsets!\n        // this.stream.insert(this.offsetMeasureNote, el);\n        this.stream.append(el);\n    }\n\n    xmlToNote($mxNote) {\n        let nextNoteIsChord = false;\n        const $mxObjNext = this.$mxMeasureElements[this.parseIndex + 1];\n        if ($mxObjNext !== undefined) {\n            if (\n                $mxObjNext[0].tagName === 'note'\n                && $mxObjNext.children('chord').length > 0\n            ) {\n                nextNoteIsChord = true;\n            }\n        }\n        let isChord = false;\n        let isRest = false;\n\n        let offsetIncrement = 0.0;\n        if ($mxNote.children('rest').length > 0) {\n            isRest = true;\n        }\n        if ($mxNote.children('chord').length > 0) {\n            isChord = true;\n        }\n        if (nextNoteIsChord) {\n            isChord = true;\n        }\n\n        let n;\n\n        if (isChord) {\n            this.$mxNoteList.push($mxNote);\n            // chord lyrics\n        } else if (!isChord && !isRest) {\n            // normal note\n            this.restAndNoteCount.note += 1;\n            n = this.xmlToSimpleNote($mxNote);\n        } else {\n            this.restAndNoteCount.rest += 1;\n            n = this.xmlToRest($mxNote);\n        }\n\n        if (!isChord) {\n            // update lyrics\n            // add to staffReference\n            this.insertInMeasureOrVoice($mxNote, n);\n            offsetIncrement = n.duration.quarterLength;\n            this.nLast = n;\n        }\n\n        if (this.$mxNoteList && !nextNoteIsChord) {\n            const c = this.xmlToChord(this.$mxNoteList);\n            // update lyrics\n            // addToStaffRest;\n\n            // voices;\n            this.insertInMeasureOrVoice($mxNote, c);\n\n            this.$mxNoteList = [];\n            this.$mxLyricList = [];\n            offsetIncrement = c.duration.quarterLength;\n            this.nLast = c;\n        }\n\n        this.offsetMeasureNote += offsetIncrement;\n    }\n\n    xmlToChord($mxNoteList) {\n        const notes = [];\n        for (const $mxNote of $mxNoteList) {\n            const freeSpanners = false;\n            notes.push(this.xmlToSimpleNote($mxNote, freeSpanners));\n        }\n        const c = new chord.Chord(notes);\n        // move beams from first note;\n        // move articulations;\n        // move expressions;\n        // move spanners;\n\n        return c;\n    }\n\n    xmlToSimpleNote($mxNote, freeSpanners) {\n        const n = new note.Note();\n        this.xmlToPitch($mxNote, n.pitch);\n        // beams;\n        // stems;\n        // noteheads\n        return this.xmlNoteToGeneralNoteHelper(n, $mxNote, freeSpanners);\n    }\n\n    // xmlToBeam\n    // xmlToBeams\n    // xmlNotehead\n\n    xmlToPitch($mxNote, inputM21) {\n        let p = inputM21;\n        if (inputM21 === undefined) {\n            p = new pitch.Pitch();\n        }\n\n        let $mxPitch;\n        if ($mxNote[0].tagName === 'pitch') {\n            $mxPitch = $mxNote;\n        } else {\n            $mxPitch = $($mxNote.children('pitch')[0]);\n            if ($mxPitch.length === 0) {\n                // whoops!\n                return p;\n            }\n        }\n\n        seta(p, $mxPitch, 'step');\n        seta(p, $mxPitch, 'octave', undefined, parseInt);\n        const $mxAlter = $mxPitch.children('alter');\n        let accAlter;\n        if ($mxAlter) {\n            accAlter = parseFloat($mxAlter.text().trim());\n        }\n\n        const $mxAccidental = $mxNote.children('accidental');\n        // dropping support for musescore 0.9 errors...\n        if ($mxAccidental.length > 0) {\n            const accObj = this.xmlToAccidental($mxAccidental);\n            p.accidental = accObj;\n            p.accidental.displayStatus = true;\n            // independent accidental from alter\n        } else if (accAlter !== undefined) {\n            p.accidental = new pitch.Accidental(accAlter);\n            p.accidental.displayStatus = false;\n        }\n        return p;\n    }\n\n    xmlToAccidental($mxAccidental) {\n        const acc = new pitch.Accidental();\n        // to-do m21/musicxml accidental name differences;\n        const name = $($mxAccidental[0])\n            .text()\n            .trim()\n            .toLowerCase();\n        acc.set(name);\n\n        // set print style\n        // parentheses\n        // bracket\n        // editorial\n        return acc;\n    }\n\n    xmlToRest($mxRest) {\n        const r = new note.Rest();\n        // full measure rest\n        // apply multimeasure rest\n        // display-step, octave, etc.\n        return this.xmlNoteToGeneralNoteHelper(r, $mxRest);\n    }\n\n    xmlNoteToGeneralNoteHelper(n, $mxNote, freeSpanners) {\n        if (freeSpanners === undefined) {\n            freeSpanners = true;\n        }\n        // spanners\n        // setPrintStyle\n        // print-object\n        // dynamics\n        // pizzacato\n        // grace\n        this.xmlToDuration($mxNote, n.duration);\n        // type styles\n        // color\n        // position\n        if ($mxNote.children('tie').length > 0) {\n            n.tie = this.xmlToTie($mxNote);\n        }\n        // grace\n        // notations\n        // editorial\n        return n;\n    }\n\n    xmlToDuration($mxNote, inputM21) {\n        let d = inputM21;\n        if (inputM21 === undefined) {\n            d = new duration.Duration();\n        }\n        const divisions = this.divisions;\n        const mxDuration = $mxNote.children('duration')[0];\n        let qLen = 0.0;\n\n        if (mxDuration) {\n            const noteDivisions = parseFloat(\n                $(mxDuration)\n                    .text()\n                    .trim()\n            );\n            qLen = noteDivisions / divisions;\n        }\n\n        const mxType = $mxNote.children('type')[0];\n        if (mxType) {\n            // long vs longa todo\n            const durationType = $(mxType)\n                .text()\n                .trim();\n            const numDots = $mxNote.children('dot').length;\n            // tuplets!!!! big to-do!\n            d.type = durationType;\n            d.dots = numDots;\n        } else {\n            d.quarterLength = qLen;\n        }\n\n        return d;\n    }\n\n    // xmlGraceToGrace\n    // xmlNotations\n    // xmlTechnicalToArticulation\n    // setHarmonic\n    // handleFingering\n    // xmlToArticulation\n    // xmlOrnamentToExpression\n    // xmlDirectionTypeToSpanners\n    // xmlNotationsToSpanners\n    // xmlToTremolo\n    // xmlOneSpanner\n\n    xmlToTie($mxNote) {\n        const t = new tie.Tie();\n        const allTies = $mxNote.children('tie');\n        if (allTies.length > 1) {\n            t.type = 'continue';\n        } else {\n            const $t0 = $(allTies[0]);\n            t.type = $t0.attr('type');\n        }\n        // style\n        return t;\n    }\n\n    insertIntoMeasureOrVoice($mxElement, el) {\n        this.stream.insert(this.offsetMeasureNote, el);\n    }\n\n    parseMeasureAttributes() {\n        this.parseMeasureNumbers();\n        // width;\n    }\n\n    parseMeasureNumbers() {\n        const mNumRaw = this.$mxMeasure.attr('number');\n        const mNum = parseInt(mNumRaw); // no suffixes...\n        this.stream.number = mNum;\n        if (this.parent) {\n            this.parent.lastMeasureNumber = mNum;\n        }\n        this.measureNumber = mNum;\n    }\n\n    parseAttributesTag($mxAttributes) {\n        this.attributesAreInternal = false;\n        this.$activeAttributes = $mxAttributes;\n        for (const mxSub of $mxAttributes) {\n            const tag = mxSub.tagName;\n            const $mxSub = $(mxSub);\n            const methName = this.attributeTagsToMethods[tag];\n            if (methName !== undefined) {\n                this[methName]($mxSub);\n            } else if (tag === 'staves') {\n                this.staves = parseInt($mxSub.text());\n            } else if (tag === 'divisions') {\n                this.divisions = parseFloat($mxSub.text());\n            }\n            // transpose;\n        }\n        if (this.parent !== undefined) {\n            this.parent.lastDivisions = this.divisions;\n            this.parent.$activeAttributes = this.$activeAttributes;\n        }\n    }\n    // xmlTransposeToInterval\n\n    handleTimeSignature($mxTime) {\n        const ts = this.xmlToTimeSignature($mxTime);\n        this.insertIntoMeasureOrVoice($mxTime, ts);\n    }\n\n    xmlToTimeSignature($mxTime) {\n        // senza-misura\n        // simple time signature only;\n        const numerator = $($mxTime.children('beats')[0])\n            .text()\n            .trim();\n        const denominator = $($mxTime.children('beat-type')[0])\n            .text()\n            .trim();\n        return new meter.TimeSignature(numerator + '/' + denominator);\n        // symbol\n    }\n\n    handleClef($mxClef) {\n        const clefObj = this.xmlToClef($mxClef);\n        this.insertIntoMeasureOrVoice($mxClef, clefObj);\n        this.lastClefs[0] = clefObj;\n    }\n\n    xmlToClef($mxClef) {\n        const sign = $($mxClef.children('sign')[0])\n            .text()\n            .trim();\n        // TODO: percussion, etc.\n        const line = $($mxClef.children('line')[0])\n            .text()\n            .trim();\n\n        let clefOctaveChange = 0;\n        const $coc = $mxClef.children('clef-octave-change');\n        if ($coc.length > 0) {\n            clefOctaveChange = parseInt(\n                $($coc[0])\n                    .text()\n                    .trim()\n            );\n        }\n        return clef.clefFromString(sign + line, clefOctaveChange);\n    }\n\n    handleKeySignature($mxKey) {\n        const keySig = this.xmlToKeySignature($mxKey);\n        this.insertIntoMeasureOrVoice($mxKey, keySig);\n    }\n\n    xmlToKeySignature($mxKey) {\n        const ks = new key.KeySignature();\n        seta(ks, $mxKey, 'fifths', 'sharps', parseInt);\n        // mode!\n        // non-standard and key-octaves\n        return ks;\n    }\n}\n\nexport const musicxml = {\n    ScoreParser,\n    PartParser,\n    MeasureParser,\n};\n","// not working properly...\n\nclass ExtendableError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = this.constructor.name;\n        this.message = message;\n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            this.stack = new Error(message).stack;\n        }\n    }\n}\n\nexport class Music21Exception extends ExtendableError {}\n\nexport class StreamException extends Music21Exception {}\n","export const debug = false;\n","/**\n * common functions\n *\n * @exports music21/common\n */\n/**\n * functions that are useful everywhere...\n *\n * @namespace music21.common\n * @memberof music21\n */\nexport const common = {};\n\n/**\n * concept borrowed from Vex.Flow.Merge, though here the source can be undefined;\n * http://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically\n * recursive parts used in .clone()\n *\n * @function music21.common.merge\n * @param {object} destination - object to have attributes placed into\n * @param {object} source - object to take attributes from.\n * @memberof music21.common\n * @returns {object} destination\n */\ncommon.merge = function mergeRecursive(destination, source) {\n    if (source === undefined || source === null) {\n        return destination;\n    }\n    for (const p in source) {\n        if (!{}.hasOwnProperty.call(source, p)) {\n            continue;\n        }\n        try {\n            // Property in destination object set; update its value.\n            if (source[p].constructor === Object) {\n                destination[p] = mergeRecursive(destination[p], source[p]);\n            } else {\n                destination[p] = source[p];\n            }\n        } catch (e) {\n            // Property in destination object not set; create it and set its value.\n            destination[p] = source[p];\n        }\n    }\n    return destination;\n};\n\ncommon.range = function common_range(start, stop, step) {\n    if (step === undefined) {\n        step = 1;\n    }\n    if (stop === undefined) {\n        stop = start;\n        start = 0;\n    }\n\n    const count = Math.ceil((stop - start) / step);\n    return Array.apply(0, Array(count)).map((e, i) => i * step + start);\n};\n\n/**\n * Mix in another class into this class -- a simple form of multiple inheritance.\n * See articulations.Marcato for an example.\n *\n */\ncommon.mixin = function common_mixin(OtherParent, thisClassOrObject) {\n    let proto = Object.getPrototypeOf(OtherParent);\n    const classProto = Object.getPrototypeOf(thisClassOrObject);\n\n    while (proto) {\n        for (const key in Object.keys(proto)) {\n            if (!{}.hasOwnProperty.call(proto, key)) {\n                continue;\n            }\n            if (!(key in classProto)) {\n                classProto[key] = proto[key];\n            }\n        }\n        proto = Object.getPrototypeOf(proto);\n    }\n};\n\n/**\n * Aggregation -- closer to true multiple inheritance -- prefers last class's functions.  See\n * https://stackoverflow.com/questions/29879267/es6-class-multiple-inheritance\n *\n *  not currently used...\n */\n\ncommon.aggregation = (baseClass, ...mixins) => {\n    class base extends baseClass {\n        constructor(...args) {\n            super(...args);\n            mixins.forEach(mixin => {\n                copyProps(this, new mixin());\n            });\n        }\n    }\n    let copyProps = (target, source) => {\n        // this function copies all properties and symbols, filtering out some special ones\n        Object.getOwnPropertyNames(source)\n            .concat(Object.getOwnPropertySymbols(source))\n            .forEach(prop => {\n                if (\n                    !prop.match(\n                        /^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/\n                    )\n                ) {\n                    Object.defineProperty(\n                        target,\n                        prop,\n                        Object.getOwnPropertyDescriptor(source, prop)\n                    );\n                }\n            });\n    };\n    mixins.forEach(mixin => {\n        // outside contructor() to allow aggregation(A,B,C).staticFunction() to be called etc.\n        copyProps(base.prototype, mixin.prototype);\n        copyProps(base, mixin);\n    });\n    return base;\n};\n\n/**\n * posMod - return a modulo value that is not negative\n *\n * @param  {Int} a value\n * @param  {Int} b modulo\n * @return {Int}   a mod b between 0 and b - 1\n */\n\ncommon.posMod = function posMod(a, b) {\n    return (a % b + b) % b;\n};\n\n/**\n *\n * Returns the statistical mode (most commonly appearing element)\n * in a.\n *\n * In case of tie, returns the first element to reach the maximum\n * number of occurrences.\n *\n * @function music21.common.statisticalMode\n * @param {Array} a - an array to analyze\n * @returns {object} element with the highest frequency in a\n */\ncommon.statisticalMode = function statisticalMode(a) {\n    if (a.length === 0) {\n        return null;\n    }\n    const modeMap = {};\n    let maxEl = a[0];\n    let maxCount = 1;\n    for (let i = 0; i < a.length; i++) {\n        const el = a[i];\n        if (modeMap[el] == null) {\n            modeMap[el] = 0;\n        }\n        modeMap[el] += 1;\n        if (modeMap[el] > maxCount) {\n            maxEl = el;\n            maxCount = modeMap[el];\n        }\n    }\n    return maxEl;\n};\n\n/**\n * fromRoman - Convert a Roman numeral (upper or lower) to an int.\n *\n * @param  {string} num roman numeral representation of a number\n * @return {Int}     integer value of roman numeral;\n */\n\ncommon.fromRoman = function fromRoman(num) {\n    const inputRoman = num.toUpperCase();\n    const subtractionValues = [1, 10, 100];\n    const nums = ['M', 'D', 'C', 'L', 'X', 'V', 'I'];\n    const ints = [1000, 500, 100, 50, 10, 5, 1];\n    const places = [];\n    for (const c of inputRoman) {\n        if (!nums.includes(c)) {\n            throw new Error(\n                'Value is not a valid roman numeral: ' + inputRoman\n            );\n        }\n    }\n    for (let i = 0; i < inputRoman.length; i++) {\n        const c = inputRoman[i];\n        let value = ints[nums.indexOf(c)];\n        if (i < inputRoman.length - 1) {\n            const nextValue = ints[nums.indexOf(inputRoman[i + 1])];\n            if (nextValue > value && subtractionValues.includes(value)) {\n                value *= -1;\n            }\n        }\n        places.push(value);\n    }\n    let summation = 0;\n    for (const n of places) {\n        summation += n;\n    }\n    return summation;\n};\n\n/**\n * toRoman - Convert a number from 1 to 3999 to a roman numeral\n *\n * @param  {Int} num number to convert\n * @return {string}     as roman numeral\n */\n\ncommon.toRoman = function toRoman(num) {\n    if (typeof num !== 'number') {\n        throw new Error('expected integer, got ' + typeof num);\n    }\n    if (num < 0 || num > 4000) {\n        throw new Error('Argument must be between 1 and 3999');\n    }\n    const ints = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];\n    const nums = [\n        'M',\n        'CM',\n        'D',\n        'CD',\n        'C',\n        'XC',\n        'L',\n        'XL',\n        'X',\n        'IX',\n        'V',\n        'IV',\n        'I',\n    ];\n    let result = '';\n    for (let i = 0; i < ints.length; i++) {\n        const count = Math.floor(num / ints[i]);\n        result += nums[i].repeat(count);\n        num -= ints[i] * count;\n    }\n    return result;\n};\n\n/**\n * Creates a DOMObject of an SVG figure using the correct `document.createElementNS` call.\n *\n * @function music21.common.makeSVGright\n * @param {string} [tag='svg'] - a tag, such as 'rect', 'circle', 'text', or 'svg'\n * @param {object} [attrs] - attributes to pass to the tag.\n * @memberof music21.common\n * @returns {DOMObject}\n */\ncommon.makeSVGright = function makeSVGright(tag='svg', attrs) {\n    // see http://stackoverflow.com/questions/3642035/jquerys-append-not-working-with-svg-element\n    // normal JQuery does not work.\n    if (attrs === undefined) {\n        attrs = {};\n    }\n\n    const el = document.createElementNS('http://www.w3.org/2000/svg', tag);\n    for (const k in attrs) {\n        if (!{}.hasOwnProperty.call(attrs, k)) {\n            continue;\n        }\n        el.setAttribute(k, attrs[k]);\n    }\n    return el;\n};\n\n/**\n * Take a number such as 32 and return a string such as \"nd\"\n * (for \"32nd\") etc.\n *\n * @function music21.common.ordinalAbbreviation\n * @param {Int} value\n * @param {Boolean} [plural=false] - make plural (note that \"21st\" plural is \"21st\")\n * @return {string}\n */\ncommon.ordinalAbbreviation = function ordinalAbbreviation(value, plural) {\n    let post = '';\n    const valueHundreths = value % 100;\n    if (\n        valueHundreths === 11\n        || valueHundreths === 12\n        || valueHundreths === 13\n    ) {\n        post = 'th';\n    } else {\n        const valueMod = value % 10;\n        if (valueMod === 1) {\n            post = 'st';\n        } else if (valueMod === 2) {\n            post = 'nd';\n        } else if (valueMod === 3) {\n            post = 'rd';\n        } else {\n            post = 'th';\n        }\n    }\n    if (post !== 'st' && plural) {\n        post += 's';\n    }\n    return post;\n};\n\n/**\n * Find a rational number approximation of this floating point.\n *\n * @function music21.common.rationalize\n * @param {number} ql - number to rationalize\n * @param {number} [epsilon=0.001] - how close to get\n * @param {Int} [maxDenominator=50] - maximum denominator\n * @returns {object|undefined} {'numerator: numerator, 'denominator': denominator}\n */\ncommon.rationalize = function rationalize(ql, epsilon, maxDenominator) {\n    epsilon = epsilon || 0.001;\n    maxDenominator = maxDenominator || 50;\n\n    for (let i = 2; i < maxDenominator; i++) {\n        if (Math.abs(ql * i - Math.round(ql * i)) < epsilon) {\n            const numerator = Math.round(ql * i);\n            const denominator = i;\n            return { numerator, denominator };\n        }\n    }\n    return undefined;\n};\n\n/**\n * Change something that could be a string or number and might\n * end with \"px\" to a number.\n *\n * \"400px\" -> 400\n *\n * @function music21.common.stripPx\n * @param {Int|string} str -- string that might have 'px' at the end or not\n * @returns {Int} a number to use\n */\ncommon.stripPx = function stripPx(str) {\n    if (typeof str === 'string') {\n        const pxIndex = str.indexOf('px');\n        str = str.slice(0, pxIndex);\n        return parseInt(str);\n    } else {\n        return str;\n    }\n};\n\n/**\n * Find name in the query string (?name=value) and return value.\n *\n * @function music21.common.urlParam\n * @param {string} name - url parameter to find\n * @returns {string} may be \"\" if empty.\n */\ncommon.urlParam = function urlParam(name) {\n    name = name.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n    const results = regex.exec(location.search);\n    return results == null\n        ? ''\n        : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\ncommon.arrayEquals = function arrayEquals(a1, a2) {\n    if (a1.length !== a2.length) {\n        return false;\n    }\n    for (let i = 0; i < a1.length; i++) {\n        if (a1[i] instanceof Array && a2[i] instanceof Array) {\n            if (!arrayEquals(a1[i], a2[i])) {\n                return false;\n            }\n        } else if (a1[i] !== a2[i]) {\n            return false;\n        }\n    }\n    return true;\n};\n\nconst _singletonCounter = {};\n_singletonCounter.value = 0;\n\nexport class SingletonCounter {\n    call() {\n        const post = _singletonCounter.value;\n        _singletonCounter.value += 1;\n        return post;\n    }\n}\ncommon.SingletonCounter = SingletonCounter;\n\n/**\n * runs a callback with either \"visible\" or \"hidden\" as the argument anytime the\n * window or document state changes.\n *\n * Depending on the browser, may be called multiple times with the same argument\n * for a single event.  For instance, Safari calls once on losing focus completely\n * but twice for a tab change.\n *\n * @function music21.common.setWindowVisibilityWatcher\n * @param {function} callback\n */\ncommon.setWindowVisibilityWatcher = function setWindowVisibilityWatcher(\n    callback\n) {\n    let hidden = 'hidden';\n\n    // Standards:\n    if (hidden in document) {\n        document.addEventListener('visibilitychange', windowFocusChanged);\n    } else if ('mozHidden' in document) {\n        hidden = 'mozHidden';\n        document.addEventListener('mozvisibilitychange', windowFocusChanged);\n    } else if ('webkitHidden' in document) {\n        hidden = 'webkitHidden';\n        document.addEventListener('webkitvisibilitychange', windowFocusChanged);\n    } else if ('msHidden' in document) {\n        hidden = 'msHidden';\n        document.addEventListener('msvisibilitychange', windowFocusChanged);\n    } else if ('onfocusin' in document) {\n        // IE 9 and lower:\n        document.onfocusin = document.onfocusout = windowFocusChanged;\n    }\n\n    // Also catch window... -- get two calls for a tab shift, but one for window losing focus\n    window.onpageshow = window.onpagehide = window.onfocus = window.onblur = windowFocusChanged;\n\n    function windowFocusChanged(evt) {\n        const v = 'visible';\n        const h = 'hidden';\n        const evtMap = {\n            focus: v,\n            focusin: v,\n            pageshow: v,\n            blur: h,\n            focusout: h,\n            pagehide: h,\n        };\n\n        evt = evt || window.event;\n        let callbackState = '';\n        if (evt.type in evtMap) {\n            callbackState = evtMap[evt.type];\n        } else {\n            callbackState = this[hidden] ? 'hidden' : 'visible';\n        }\n        callback(callbackState, evt);\n    }\n    // set the initial state\n    const initialState\n        = document.visibilityState === 'visible' ? 'focus' : 'blur';\n    const initialStateEvent = { type: initialState };\n    windowFocusChanged(initialStateEvent);\n};\n\ncommon.urls = {\n    css: '/css',\n    webResources: '/webResources',\n    midiPlayer: '/webResources/midiPlayer',\n    soundfontUrl: '/src/ext/soundfonts/FluidR3_GM/',\n};\n","/**\n * module for things that all music21-created objects, not just objects that can live in\n * Stream.elements should inherit. See the {@link music21.prebase} namespace.\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n *\n * @exports music21/prebase\n */\n/**\n * module for things that all music21-created objects, not just objects that can live in\n * Stream.elements should inherit\n *\n * @namespace music21.prebase\n * @memberof music21\n */\nexport const prebase = {};\n/**\n * Class for pseudo-m21 objects to inherit from. The most important attributes that nearly\n * everything in music21 should inherit from are given below.\n *\n * @class ProtoM21Object\n * @memberof music21.prebase\n * @property {Array<string>} classes - An Array of strings of classes that the object belongs to (default ['ProtoM21Object'])\n * @property {Boolean} isProtoM21Object - Does this object descend from {@link music21.prebase.ProtoM21Object}: obviously true.\n * @property {Boolean} isMusic21Object - Does this object descend from {@link music21.base.Music21Object}; default false.\n */\nexport class ProtoM21Object {\n    constructor() {\n        this._storedClasses = undefined;\n        this.isProtoM21Object = true;\n        this.isMusic21Object = false;\n        this._cloneCallbacks = {};\n    }\n\n    get classes() {\n        if (this._storedClasses !== undefined) {\n            return this._storedClasses;\n        }\n        const classList = [];\n        let thisConstructor = this.constructor;\n        let maxLinks = 20;\n        while (\n            thisConstructor !== null\n            && thisConstructor !== undefined\n            && maxLinks\n        ) {\n            maxLinks -= 1;\n            if (thisConstructor.name === '') {\n                break;\n            }\n            classList.push(thisConstructor.name);\n            thisConstructor = Object.getPrototypeOf(thisConstructor);\n        }\n        classList.push('object');\n        this._storedClasses = classList;\n        return classList;\n    }\n\n    /**\n     * Makes (as much as possible) a complete duplicate copy of the object called with .clone()\n     *\n     * Works similarly to Python's copy.deepcopy().\n     *\n     * Every ProtoM21Object has a `._cloneCallbacks` object which maps `{attribute: callbackFunction}`\n     * to handle custom clone cases.  See, for instance, {@link music21.base.Music21Object} which\n     * uses a custom callback to NOT clone the `.activeSite` attribute.\n     *\n     * @returns {object}\n     * @memberof music21.prebase.ProtoM21Object\n     * @example\n     * var n1 = new music21.note.Note(\"C#\");\n     * n1.duration.quarterLength = 4;\n     * var n2 = n1.clone();\n     * n2.duration.quarterLength == 4; // true\n     * n2 === n1; // false\n     */\n    clone(deep = true) {\n        if (!deep) {\n            return Object.assign(\n                Object.create(Object.getPrototypeOf(this)),\n                this\n            );\n        }\n\n        const ret = new this.constructor();\n\n        // todo: do Arrays work?\n        for (const key in this) {\n            // not that we ONLY copy the keys in Ret -- it's easier that way.\n            if ({}.hasOwnProperty.call(this, key) === false) {\n                continue;\n            }\n            if (key in this._cloneCallbacks) {\n                if (this._cloneCallbacks[key] === true) {\n                    ret[key] = this[key];\n                } else if (this._cloneCallbacks[key] === false) {\n                    ret[key] = undefined;\n                } else {\n                    // call the cloneCallbacks function\n                    this._cloneCallbacks[key](key, ret, this);\n                }\n            } else if (\n                Object.getOwnPropertyDescriptor(this, key).get !== undefined\n                || Object.getOwnPropertyDescriptor(this, key).set !== undefined\n            ) {\n                // do nothing\n            } else if (typeof this[key] === 'function') {\n                // do nothing -- events might not be copied.\n            } else if (\n                typeof this[key] === 'object'\n                && this[key] !== null\n                && this[key].isProtoM21Object\n            ) {\n                // console.log('cloning ', key);\n                ret[key] = this[key].clone();\n            } else {\n                try {\n                    ret[key] = this[key];\n                    // music21.common.merge(ret[key], this[key]); // not really necessary?\n                } catch (e) {\n                    if (e instanceof TypeError) {\n                        console.log('typeError:', e, key);\n                        // do nothing\n                    } else {\n                        throw e;\n                    }\n                }\n            }\n        }\n        return ret;\n    }\n    /**\n     * Check to see if an object is of this class or subclass.\n     *\n     * @memberof music21.prebase.ProtoM21Object\n     * @param {(string|string[])} testClass - a class or Array of classes to test\n     * @returns {Boolean}\n     * @example\n     * var n = new music21.note.Note();\n     * n.isClassOrSubclass('Note'); // true\n     * n.isClassOrSubclass('Music21Object'); // true\n     * n.isClassOrSubclass(['Duration', 'NotRest']); // true // NotRest\n     */\n    isClassOrSubclass(testClass) {\n        if (testClass instanceof Array === false) {\n            testClass = [testClass];\n        }\n        for (let i = 0; i < testClass.length; i++) {\n            if (this.classes.includes(testClass[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nprebase.ProtoM21Object = ProtoM21Object;\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/duration -- duration routines\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006-18, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21.js';\n\nimport { common } from './common.js';\nimport { debug } from './debug.js';\nimport { prebase } from './prebase.js';\n/**\n * Duration module. See {@link music21.duration}\n *\n * @requires music21/common\n * @requires music21/prebase\n * @exports music21/duration\n */\n/**\n * Module that holds **music21** classes and\n * tools for dealing with durations, especially\n * the {@link music21.duration.Duration} class.\n *\n * @namespace music21.duration\n * @memberof music21\n */\nexport const duration = {};\n\n/**\n * Object mapping int to name, as in `{1: 'whole'}` etc.\n *\n * @memberof music21.duration\n * @type {object}\n */\nduration.typeFromNumDict = {\n    1: 'whole',\n    2: 'half',\n    4: 'quarter',\n    8: 'eighth',\n    16: '16th',\n    32: '32nd',\n    64: '64th',\n    128: '128th',\n    256: '256th',\n    512: '512th',\n    1024: '1024th',\n    0: 'zero',\n    '0.5': 'breve',\n    '0.25': 'longa',\n    '0.125': 'maxima',\n    '0.0625': 'duplex-maxima',\n};\nduration.quarterTypeIndex = 6; // where is quarter in the following array.\nduration.ordinalTypeFromNum = [\n    'duplex-maxima',\n    'maxima',\n    'longa',\n    'breve',\n    'whole',\n    'half',\n    'quarter',\n    'eighth',\n    '16th',\n    '32nd',\n    '64th',\n    '128th',\n    '256th',\n    '512th',\n    '1024th',\n];\nduration.vexflowDurationArray = [\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    'w',\n    'h',\n    'q',\n    '8',\n    '16',\n    '32',\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n    undefined,\n];\n\n/**\n * Duration object; found as the `.duration` attribute on {@link music21.base.Music21Object} instances\n * such as {@link music21.note.Note}\n *\n * @class Duration\n * @memberof music21.duration\n * @extends music21.prebase.ProtoM21Object\n * @param {(number|undefined)} ql - quarterLength (default 1.0)\n */\nexport class Duration extends prebase.ProtoM21Object {\n    constructor(ql) {\n        super();\n        this._quarterLength = 0.0;\n        this._dots = 0;\n        this._durationNumber = undefined;\n        this._type = 'zero';\n        this._tuplets = [];\n        if (typeof ql === 'string') {\n            this.type = ql;\n        } else if (ql !== undefined) {\n            this.quarterLength = ql;\n        }\n        this._cloneCallbacks._tuplets = this.cloneCallbacksTupletFunction;\n    }\n    /**\n     * Read or sets the number of dots on the duration.\n     *\n     * Updates the quarterLength\n     *\n     * @type Number\n     * @instance\n     * @default 0\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.dots === 0; // true\n     * d.dots = 1;\n     * d.quarterLength == 3; // true;\n     */\n    get dots() {\n        return this._dots;\n    }\n    set dots(numDots) {\n        this._dots = numDots;\n        this.updateQlFromFeatures();\n    }\n    /**\n     * Read or sets the quarterLength of the Duration\n     *\n     * Updates the type, dots, tuplets(?)\n     *\n     * @type Number\n     * @instance\n     * @default 1.0\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.quarterLength == 2.0; // true;\n     * d.quarterLength = 1.75;\n     * d.dots == 2; // true\n     * d.type == 'quarter'; // true\n     */\n    get quarterLength() {\n        return this._quarterLength;\n    }\n    set quarterLength(ql) {\n        if (ql === undefined) {\n            ql = 1.0;\n        }\n        this._quarterLength = ql;\n        this.updateFeaturesFromQl();\n    }\n    /**\n     * Read or sets the type of the duration.\n     *\n     * Updates the quarterLength\n     *\n     * @type String\n     * @instance\n     * @default 'quarter'\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.type == 'half; // true\n     * d.type = 'breve';\n     * d.quarterLength == 8.0; // true\n     * d.dots = 1;\n     * d.type = 'quarter'; // will not change dots\n     * d.quarterLength == 1.5; // true\n     */\n    get type() {\n        return this._type;\n    }\n    set type(typeIn) {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(typeIn);\n        if (typeNumber === -1) {\n            console.log('invalid type ' + typeIn);\n            throw new Music21Exception('invalid type ' + typeIn);\n        }\n        this._type = typeIn;\n        this.updateQlFromFeatures();\n    }\n    /**\n     * Reads the tuplet Array for the duration.\n     *\n     * The tuplet array should be considered Read Only.\n     * Use {@link music21.duration.Duration#appendTuplet} to\n     * add a tuplet (no way to remove yet)\n     *\n     * @type Array<music21.duration.Tuplet>\n     * @instance\n     * @default []\n     * @memberof music21.duration.Duration\n     */\n    get tuplets() {\n        return this._tuplets;\n    }\n    /**\n     * Read-only: the duration expressed for VexFlow\n     *\n     * @type String\n     * @instance\n     * @default 'd'\n     * @memberof music21.duration.Duration\n     * @example\n     * var d = new music21.duration.Duration(2);\n     * d.vexflowDuration == 'h'; // true;\n     * d.dots = 2;\n     * d.vexflowDuration == 'hdd'; // true;\n     */\n    get vexflowDuration() {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this.type);\n        let vd = duration.vexflowDurationArray[typeNumber];\n        if (this.dots > 0) {\n            for (let i = 0; i < this.dots; i++) {\n                vd += 'd'; // vexflow does not handle double dots .. or does it???\n            }\n        }\n        return vd;\n    }\n    cloneCallbacksTupletFunction(tupletKey, ret, obj) {\n        // make sure that tuplets clone properly\n        const newTuplets = [];\n        for (let i = 0; i < obj[tupletKey].length; i++) {\n            const newTuplet = obj[tupletKey][i].clone();\n            // console.log('cloning tuplets', obj[tupletKey][i], newTuplet);\n            newTuplets.push(newTuplet);\n        }\n        ret[tupletKey] = newTuplets;\n    }\n    _findDots(ql) {\n        if (ql === 0) {\n            return 0;\n        } // zero length stream probably;\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this._type);\n        const powerOfTwo = Math.pow(2, duration.quarterTypeIndex - typeNumber);\n        // alert(undottedQL * 1.5 + \" \" + ql)\n        // console.log('find dots called on ql: ', ql, typeNumber, powerOfTwo);\n        for (let dotsNum = 0; dotsNum <= 4; dotsNum++) {\n            const dotMultiplier\n                = (Math.pow(2, dotsNum) - 1.0) / Math.pow(2, dotsNum);\n            const durationMultiplier = 1 + dotMultiplier;\n            if (Math.abs(powerOfTwo * durationMultiplier - ql) < 0.0001) {\n                return dotsNum;\n            }\n        }\n        if (debug) {\n            console.log('no dots available for ql; probably a tuplet', ql);\n        }\n        return 0;\n    }\n    updateQlFromFeatures() {\n        const typeNumber = duration.ordinalTypeFromNum.indexOf(this._type); // must be set property\n        const undottedQuarterLength = Math.pow(\n            2,\n            duration.quarterTypeIndex - typeNumber\n        );\n        const dottedMultiplier\n            = 1 + (Math.pow(2, this._dots) - 1) / Math.pow(2, this._dots);\n        const unTupletedQl = undottedQuarterLength * dottedMultiplier;\n        let tupletCorrectedQl = unTupletedQl;\n        this._tuplets.forEach(tuplet => {\n            tupletCorrectedQl *= tuplet.tupletMultiplier();\n        });\n        this._quarterLength = tupletCorrectedQl;\n    }\n    updateFeaturesFromQl() {\n        const ql = this._quarterLength;\n        this._tuplets = [];\n        if (ql === 0) {\n            this._type = 'zero';\n            this._dots = 0;\n            return;\n        }\n        const powerOfTwo = Math.floor(Math.log(ql + 0.00001) / Math.log(2));\n        let typeNumber = duration.quarterTypeIndex - powerOfTwo;\n        this._type = duration.ordinalTypeFromNum[typeNumber];\n        // console.log(this._findDots);\n        this._dots = this._findDots(ql);\n\n        const undottedQuarterLength = Math.pow(\n            2,\n            duration.quarterTypeIndex - typeNumber\n        );\n        const dottedMultiplier\n            = 1 + (Math.pow(2, this._dots) - 1) / Math.pow(2, this._dots);\n        let unTupletedQl = undottedQuarterLength * dottedMultiplier;\n        if (unTupletedQl !== ql && ql !== 0) {\n            typeNumber -= 1;\n            this._type = duration.ordinalTypeFromNum[typeNumber]; // increase type: eighth to quarter etc.\n            unTupletedQl *= 2;\n            const tupletRatio = ql / unTupletedQl;\n            const ratioRat = common.rationalize(tupletRatio);\n            if (ratioRat === undefined) {\n                // probably a Stream with a length that is inexpressable;\n            } else {\n                const t = new duration.Tuplet(\n                    ratioRat.denominator,\n                    ratioRat.numerator,\n                    new duration.Duration(unTupletedQl)\n                );\n                this.appendTuplet(t, true); // skipUpdateQl\n            }\n            // console.log(ratioRat, ql, unTupletedQl);\n        }\n        return;\n    }\n    /**\n     * Add a tuplet to music21j\n     *\n     * @memberof music21.duration.Duration\n     * @param {music21.duration.Tuplet} newTuplet - tuplet to add to `.tuplets`\n     * @param {boolean} [skipUpdateQl=false] - update the quarterLength afterwards?\n     */\n    appendTuplet(newTuplet, skipUpdateQl) {\n        newTuplet.frozen = true;\n        this._tuplets.push(newTuplet);\n        if (skipUpdateQl !== true) {\n            this.updateQlFromFeatures();\n        }\n    }\n}\n\nduration.Duration = Duration;\n\n/**\n * Represents a Tuplet; found in {@link music21.duration.Duration#tuplets}\n *\n * @class Tuplet\n * @memberof music21.duration\n * @extends music21.prebase.ProtoM21Object\n * @param {number} numberNotesActual - numerator of the tuplet, default 3\n * @param {number} numberNotesNormal - denominator of the tuplet, default 2\n * @param {(music21.duration.Duration|number)} durationActual - duration or quarterLength of duration type, default music21.duration.Duration(0.5)\n * @param {(music21.duration.Duration|number)} durationNormal - unused; see music21p for description\n */\nexport class Tuplet extends prebase.ProtoM21Object {\n    constructor(\n        numberNotesActual,\n        numberNotesNormal,\n        durationActual,\n        durationNormal\n    ) {\n        super();\n        this.numberNotesActual = numberNotesActual || 3;\n        this.numberNotesNormal = numberNotesNormal || 2;\n        this.durationActual = durationActual || new duration.Duration(0.5);\n        if (typeof this.durationActual === 'number') {\n            this.durationActual = new duration.Duration(this.durationActual);\n        }\n        this.durationNormal = durationNormal || this.durationActual;\n\n        this.frozen = false;\n        this.type = undefined;\n        /**\n         * Show a bracket above the tuplet\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {Boolean} bracket\n         * @default true\n         */\n        this.bracket = true;\n        /**\n         * Bracket placement. Options are `above` or `below`.\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {String} placement\n         * @default 'above'\n         */\n        this.placement = 'above';\n\n        /**\n         * What to show above the Tuplet. Options are `number`, `type`, or (string) `none`.\n         *\n         * @memberof music21.duration.Tuplet#\n         * @member {String} tupletActualShow\n         * @default 'number'\n         */\n        this.tupletActualShow = 'number';\n        this.tupletNormalShow = undefined; // undefined, 'ratio' for ratios, 'type' for ratioed notes (does not work)\n    }\n    /**\n     * A nice name for the tuplet.\n     *\n     * @type String\n     * @instance\n     * @readonly\n     * @memberof music21.duration.Tuplet\n     */\n    get fullName() {\n        // actual is what is presented to viewer\n        const numActual = this.numberNotesActual;\n        const numNormal = this.numberNotesNormal;\n\n        if (numActual === 3 && numNormal === 2) {\n            return 'Triplet';\n        } else if (numActual === 5 && (numNormal === 4 || numNormal === 2)) {\n            return 'Quintuplet';\n        } else if (numActual === 6 && numNormal === 4) {\n            return 'Sextuplet';\n        }\n        const ordStr = common.ordinalAbbreviation(numNormal, true); // plural\n        return (\n            'Tuplet of '\n            + numActual.toString()\n            + '/'\n            + numNormal.toString()\n            + ordStr\n        );\n    }\n    /**\n     * Set both durationActual and durationNormal for the tuplet.\n     *\n     * @memberof music21.duration.Tuplet\n     * @param {string} type - a duration type, such as `half`, `quarter`\n     * @returns {music21.duration.Duration} A converted {@link music21.duration.Duration} matching `type`\n     */\n    setDurationType(type) {\n        if (this.frozen === true) {\n            throw new Music21Exception(\n                'A frozen tuplet (or one attached to a duration) is immutable'\n            );\n        }\n        this.durationActual = new duration.Duration(type);\n        this.durationNormal = this.durationActual;\n        return this.durationActual;\n    }\n    /**\n     * Sets the tuplet ratio.\n     *\n     * @memberof music21.duration.Tuplet\n     * @param {Number} actual - number of notes in actual (e.g., 3)\n     * @param {Number} normal - number of notes in normal (e.g., 2)\n     * @returns {undefined}\n     */\n    setRatio(actual, normal) {\n        if (this.frozen === true) {\n            throw new Music21Exception(\n                'A frozen tuplet (or one attached to a duration) is immutable'\n            );\n        }\n        this.numberNotesActual = actual || 3;\n        this.numberNotesNormal = normal || 2;\n    }\n    /**\n     * Get the quarterLength corresponding to the total length that\n     * the completed tuplet (i.e., 3 notes in a triplet) would occupy.\n     *\n     * @memberof music21.duration.Tuplet\n     * @returns {Number} A quarter length.\n     */\n    totalTupletLength() {\n        return this.numberNotesNormal * this.durationNormal.quarterLength;\n    }\n    /**\n     * The amount by which each quarter length is multiplied to get\n     * the tuplet. For instance, in a normal triplet, this is 0.666\n     *\n     * @memberof music21.duration.Tuplet\n     * @returns {Number} A float of the multiplier\n     */\n    tupletMultiplier() {\n        const lengthActual = this.durationActual.quarterLength;\n        return (\n            this.totalTupletLength() / (this.numberNotesActual * lengthActual)\n        );\n    }\n}\nduration.Tuplet = Tuplet;\n","/**\n * Objects for keeping track of relationships among Music21Objects. See {@link music21.sites} namespace\n *\n * Copyright 2017, Michael Scott Cuthbert and cuthbertLab\n * License: BSD\n */\n\nimport { common } from './common.js';\nimport { Music21Exception } from './exceptions21';\n\n/**\n * @namespace music21.sites\n * @memberof music21\n * @requires music21/common\n */\nexport const sites = {};\n\nexport class SitesException extends Music21Exception {}\nsites.SitesException = SitesException;\n\nexport class SiteRef {\n    constructor() {\n        this.isDead = false;\n        this.classString = undefined;\n        this.globalSiteIndex = false;\n        this.siteIndex = undefined;\n        this.siteWeakref = new WeakMap();\n        this.siteWeakref.ref = undefined;\n    }\n    get site() {\n        return this.siteWeakref.ref;\n    }\n\n    set site(newSite) {\n        this.siteWeakref.ref = newSite;\n    }\n}\nsites.SiteRef = SiteRef;\n\nconst _NoneSiteRef = new SiteRef();\n_NoneSiteRef.globalSiteIndex = -2;\n_NoneSiteRef.siteIndex = -2;\n\nconst _singletonCounter = new common.SingletonCounter();\n\nconst GLOBAL_SITE_STATE_DICT = new WeakMap();\n\nsites.getId = function getId(obj) {\n    if (!GLOBAL_SITE_STATE_DICT.has(obj)) {\n        const newId = _singletonCounter.call();\n        GLOBAL_SITE_STATE_DICT.set(obj, newId);\n    }\n    return GLOBAL_SITE_STATE_DICT.get(obj);\n};\n\nexport class Sites {\n    constructor() {\n        this.siteDict = new Map();\n        this.siteDict.set(_NoneSiteRef.siteIndex, _NoneSiteRef);\n        this._siteIndex = 0;\n        this._lastID = -1;\n    }\n\n    get length() {\n        return this.siteDict.size;\n    }\n    includes(checkSite) {\n        for (const [unused_key, siteRef] of this.siteDict) {\n            if (siteRef.site === checkSite) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    _keysByTime(newFirst = true) {\n        const post = [];\n        for (const [key, siteRef] of this.siteDict) {\n            const keyVal = [siteRef.siteIndex, key];\n            post.push(keyVal);\n        }\n        post.sort();\n        if (newFirst) {\n            post.reverse();\n        }\n        return post.map(innerList => innerList[1]);\n    }\n\n    add(obj, idKey, classString) {\n        if (idKey === undefined && obj !== undefined) {\n            idKey = sites.getId(obj);\n        }\n        let updateNotAdd = false;\n        if (this.siteDict.has(idKey)) {\n            const tempSiteRef = this.siteDict.get(idKey);\n            if (!tempSiteRef.isDead && tempSiteRef.site !== undefined) {\n                updateNotAdd = true;\n            }\n        }\n        if (obj !== undefined && classString === undefined) {\n            classString = obj.classes[0];\n        }\n\n        let siteRef;\n        if (updateNotAdd) {\n            siteRef = this.siteDict.get(idKey);\n            siteRef.isDead = false;\n        } else {\n            siteRef = new SiteRef();\n        }\n\n        siteRef.site = obj; // stores a weakRef;\n        siteRef.classString = classString;\n        siteRef.siteIndex = this._siteIndex;\n        this._siteIndex += 1;\n        siteRef.globalSiteIndex = _singletonCounter.call();\n\n        if (!updateNotAdd) {\n            this.siteDict.set(idKey, siteRef);\n        }\n    }\n\n    remove(obj) {\n        const idKey = sites.getId(obj);\n        if (idKey === undefined) {\n            return false;\n        }\n        return this.siteDict.delete(idKey);\n    }\n    \n    clear() {\n        this.siteDict = new Map();\n        this.siteDict.set(_NoneSiteRef.siteIndex, _NoneSiteRef);\n        this._lastID = -1;\n    }\n\n    * yieldSites(\n        sortByCreationTime = false,\n        priorityTarget,\n        excludeNone = false\n    ) {\n        let keyRepository;\n        if (sortByCreationTime === true) {\n            keyRepository = this._keysByTime(false);\n        } else if (sortByCreationTime === 'reverse') {\n            keyRepository = this._keysByTime(true);\n        } else {\n            keyRepository = Array.from(this.siteDict.keys());\n        }\n        if (priorityTarget !== undefined) {\n            const priorityId = sites.getId(priorityTarget);\n            if (keyRepository.includes(priorityId)) {\n                keyRepository.splice(\n                    0,\n                    0,\n                    keyRepository.pop(keyRepository.indexOf(priorityId))\n                );\n            }\n        }\n        for (const key of keyRepository) {\n            const siteRef = this.siteDict.get(key);\n            if (siteRef === _NoneSiteRef) {\n                if (!excludeNone) {\n                    yield siteRef.site;\n                }\n            } else {\n                const obj = siteRef.site;\n                if (obj === undefined) {\n                    siteRef.isDead = true;\n                } else {\n                    yield obj;\n                }\n            }\n        }\n    }\n\n    get(sortByCreationTime = false, priorityTarget, excludeNone = false) {\n        const post = Array.from(\n            this.yieldSites(sortByCreationTime, priorityTarget, excludeNone)\n        );\n\n        // we do this resorting again, because the priority target might not match id and we\n        // want to be extra safe.  If you want fast, use .yieldSites\n        if (priorityTarget !== undefined) {\n            if (post.includes(priorityTarget)) {\n                post.splice(0, 0, post.pop(post.indexOf(priorityTarget)));\n            }\n        }\n        return post;\n    }\n    getAttrByName(attrName) {\n        for (const obj of this.yieldSites('reverse')) {\n            if (obj === undefined) {\n                continue;\n            }\n            if (attrName in obj) {\n                return obj[attrName];\n            }\n        }\n        return undefined;\n    }\n\n    getObjByClass(className, options) {\n        const params = {\n            callerFirst: this,\n            sortByCreationTime: false,\n            priorityTarget: undefined,\n            getElementMethod: 'getElementAtOrBefore',\n            memo: {},\n        };\n        common.merge(params, options);\n        const memo = params.memo;\n        let post;\n        const objs = Array.from(\n            this.yieldSites(\n                params.sortByCreationTime,\n                params.priorityTarget,\n                true // excludeNone\n            )\n        );\n        const classNameIsStr = typeof className === 'string';\n        for (const obj of objs) {\n            if (classNameIsStr) {\n                if (obj.classes.includes(className)) {\n                    post = obj;\n                    break;\n                }\n            } else if (obj instanceof className) {\n                post = obj;\n                break;\n            }\n        }\n        if (post !== undefined) {\n            return post;\n        }\n        for (const obj of objs) {\n            // TODO: check inside object... perhaps should not be done in m21p\n            const objId = sites.getId(obj);\n            if (!(objId in memo)) {\n                memo[objId] = obj;\n            }\n            post = obj.getContextByClass(className, params);\n            if (post !== undefined) {\n                break;\n            }\n        }\n        return post;\n    }\n}\nsites.Sites = Sites;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/base -- objects in base in music21p routines\n *\n * does not load the other modules, music21/moduleLoader.js does that.\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { common } from './common.js';\nimport { duration } from './duration.js';\nimport { prebase } from './prebase.js';\nimport { sites } from './sites.js';\n\n/**\n * module for Music21Objects, see {@link music21.base}\n *\n * @requires music21/common\n * @requires music21/duration\n * @requires music21/prebase\n * @requires music21/sites\n * @exports music21/base\n */\n/**\n * Module for Music21Objects.  Does not load other modules, see {@link music21.moduleLoader}\n * for this functionality.\n *\n * @namespace music21.base\n * @memberof music21\n */\nexport const base = {};\n\n/**\n * Base class for any object that can be placed in a {@link music21.stream.Stream}.\n *\n * @class Music21Object\n * @memberof music21.base\n * @extends music21.prebase.ProtoM21Object\n * @property {object} activeSite - hardlink to a {@link music21.stream.Stream} containing the element.\n * @property {number} classSortOrder - Default sort order for this class (default 20; override in other classes). Lower numbered objects will sort before other objects in the staff if priority and offset are the same.\n * @property {music21.duration.Duration} duration - the duration (object) for the element. (can be set with a quarterLength also)\n * @property {Array} groups - An Array of strings representing group (equivalent to css classes) to assign to the object. (default [])\n * @property {boolean} isMusic21Object - true\n * @property {boolean} isStream - false\n * @property {number} offset - offset from the beginning of the stream (in quarterLength)\n * @property {number} priority - The priority (lower = earlier or more left) for elements at the same offset. (default 0)\n */\nexport class Music21Object extends prebase.ProtoM21Object {\n    constructor(keywords) {\n        super();\n        this.classSortOrder = 20; // default;\n\n        this.activeSite = undefined;\n        this.offset = 0; // for now\n        this._naiveOffset = 0;\n        // this._activeSite = undefined;\n        this._activeSiteStoredOffset = undefined;\n\n        // this._derivation = undefined;\n        // this._style = undefined;\n        // this._editorial = undefined;\n\n        this._duration = new duration.Duration();\n\n        this._priority = 0; // default;\n\n        // this.id = sites.getId(this);\n        this.groups = [];\n        // groups\n        this.sites = new sites.Sites();\n\n        this.isMusic21Object = true;\n        this.isStream = false;\n\n        this.groups = []; // custom object in m21p\n        // this.sites, this.activeSites, this.offset -- not yet...\n        // beat, measureNumber, etc.\n        // lots to do...\n        this._cloneCallbacks.activeSite = function Music21Object_cloneCallbacks_activeSite(\n            keyName,\n            newObj,\n            self\n        ) {\n            newObj[keyName] = undefined;\n        };\n        this._cloneCallbacks.sites = function Music21Object_cloneCallbacks_sites(\n            keyName,\n            newObj,\n            self\n        ) {\n            newObj[keyName] = new sites.Sites();\n        };\n    }\n    get priority() {\n        return this._priority;\n    }\n    set priority(p) {\n        this._priority = p;\n    }\n    get duration() {\n        return this._duration;\n    }\n    set duration(newDuration) {\n        if (typeof newDuration === 'object') {\n            this._duration = newDuration;\n            // common errors below...\n        } else if (typeof newDuration === 'number') {\n            this._duration.quarterLength = newDuration;\n        } else if (typeof newDuration === 'string') {\n            this._duration.type = newDuration;\n        }\n    }\n    get quarterLength() {\n        return this.duration.quarterLength;\n    }\n    set quarterLength(ql) {\n        this.duration.quarterLength = ql;\n    }\n    /**\n     * Return the offset of this element in a given site -- use .offset if you are sure that\n     * site === activeSite.\n     *\n     * Does not change activeSite or .offset\n     *\n     * @memberof music21.base.Music21Object\n     * @param {music21.stream.Stream} site\n     * @returns Number|undefined\n     */\n    getOffsetBySite(site, stringReturns = false) {\n        if (site === undefined) {\n            return this._naiveOffset;\n        }\n        return site.elementOffset(this, stringReturns);\n    }\n\n    /**\n     * setOffsetBySite - sets the offset for a given Stream\n     *\n     * @memberof music21.base.Music21Object\n     * @param  {music21.stream.Stream} site  Stream object\n     * @param  {number} value offset\n     */\n\n    setOffsetBySite(site, value) {\n        if (site !== undefined) {\n            site.setElementOffset(this, value);\n        } else {\n            this._naiveOffset = value;\n        }\n    }\n\n    // ---------- Contexts -------------\n\n    getContextByClass(className, options) {\n        const payloadExtractor = function payloadExtractor(\n            useSite,\n            flatten,\n            positionStart,\n            getElementMethod,\n            classList\n        ) {\n            // this should all be done as a tree...\n            // do not use .flat or .semiFlat so as not\n            // to create new sites.\n\n            // VERY HACKY...\n            let lastElement;\n            for (let i = 0; i < useSite.length; i++) {\n                const indexOffset = useSite._elementOffsets[i];\n                const thisElement = useSite._elements[i];\n                const matchClass = thisElement.isClassOrSubclass(classList);\n                if (flatten === false && !matchClass) {\n                    continue;\n                } else if (!thisElement.isStream && !matchClass) {\n                    continue;\n                }\n                // is a stream or an element of the appropriate class...\n                // first check normal elements\n                if (\n                    getElementMethod.includes('Before')\n                    && indexOffset >= positionStart\n                ) {\n                    if (\n                        getElementMethod.includes('At')\n                        && lastElement === undefined\n                    ) {\n                        lastElement = thisElement;\n                    } else if (matchClass) {\n                        return lastElement;\n                    }\n                } else {\n                    lastElement = thisElement;\n                }\n                if (\n                    getElementMethod.includes('After')\n                    && indexOffset > positionStart\n                    && matchClass\n                ) {\n                    return thisElement;\n                }\n                // now cleck stream... already filtered out flatten == false;\n                if (thisElement.isStream) {\n                    const potentialElement = payloadExtractor(\n                        thisElement,\n                        flatten,\n                        positionStart + indexOffset,\n                        getElementMethod,\n                        classList\n                    );\n                    if (potentialElement !== undefined) {\n                        return potentialElement;\n                    }\n                }\n            }\n            return undefined;\n        };\n\n        const params = {\n            getElementMethod: 'getElementAtOrBefore',\n            sortByCreationTime: false,\n        };\n        common.merge(params, options);\n\n        const getElementMethod = params.getElementMethod;\n        const sortByCreationTime = params.sortByCreationTime;\n\n        if (className !== undefined && !(className instanceof Array)) {\n            className = [className];\n        }\n        if (\n            getElementMethod.includes('At')\n            && this.isClassOrSubclass(className)\n        ) {\n            return this;\n        }\n\n        for (const [site, positionStart, searchType] of this.contextSites({\n            returnSortTuples: true,\n            sortByCreationTime,\n        })) {\n            if (\n                getElementMethod.includes('At')\n                && site.isClassOrSubclass(className)\n            ) {\n                return site;\n            }\n\n            if (\n                searchType === 'elementsOnly'\n                || searchType === 'elementsFirst'\n            ) {\n                const contextEl = payloadExtractor(\n                    site,\n                    false,\n                    positionStart,\n                    getElementMethod,\n                    className\n                );\n                if (contextEl !== undefined) {\n                    contextEl.activeSite = site;\n                    return contextEl;\n                }\n            } else if (searchType !== 'elementsOnly') {\n                if (\n                    getElementMethod.includes('After')\n                    && (className === undefined\n                        || site.isClassOrSubclass(className))\n                ) {\n                    if (\n                        !getElementMethod.includes('NotSelf')\n                        && this !== site\n                    ) {\n                        return site;\n                    }\n                }\n                const contextEl = payloadExtractor(\n                    site,\n                    'semiFlat',\n                    positionStart,\n                    getElementMethod,\n                    className\n                );\n                if (contextEl !== undefined) {\n                    contextEl.activeSite = site;\n                    return contextEl;\n                }\n                if (\n                    getElementMethod.includes('Before')\n                    && (className === undefined\n                        || site.isClassOrSubclass(className))\n                ) {\n                    if (\n                        !getElementMethod.includes('NotSelf')\n                        || this !== site\n                    ) {\n                        return site;\n                    }\n                }\n            }\n        }\n\n        return undefined;\n    }\n\n    * contextSites(options) {\n        const params = {\n            callerFirst: undefined,\n            memo: [],\n            offsetAppend: 0.0,\n            sortByCreationTime: false,\n            priorityTarget: undefined,\n            returnSortTuples: false,\n            followDerivation: true,\n        };\n        common.merge(params, options);\n        const memo = params.memo;\n        if (params.callerFirst === undefined) {\n            params.callerFirst = this;\n            if (this.isStream && !(this in memo)) {\n                const recursionType = this.recursionType;\n                yield [this, 0.0, recursionType];\n            }\n            memo.push(this);\n        }\n\n        if (params.priorityTarget === undefined && !params.sortByCreationType) {\n            params.priorityTarget = this.activeSite;\n        }\n        // const topLevel = this;\n        for (const siteObj of this.sites.yieldSites(\n            params.sortByCreationTime,\n            params.priorityTarget,\n            true // excludeNone\n        )) {\n            if (memo.includes(siteObj)) {\n                continue;\n            }\n            if (siteObj.classes.includes('SpannerStorage')) {\n                continue;\n            }\n\n            // let offset = this.getOffsetBySite(siteObj);\n            // followDerivation;\n            const offsetInStream = siteObj.elementOffset(this);\n            const newOffset = offsetInStream + params.offsetAppend;\n            const positionInStream = newOffset;\n            const recursionType = siteObj.recursionType;\n            yield [siteObj, positionInStream, recursionType];\n            memo.push(siteObj);\n\n            const newParams = {\n                callerFirst: params.callerFirst,\n                memo,\n                offsetAppend: positionInStream, // .offset\n                returnSortTuples: true, // always!\n                sortByCreationTime: params.sortByCreationTime,\n            };\n            for (const [\n                topLevel,\n                inStreamPos,\n                recurType\n            ] of siteObj.contextSites(newParams)) {\n                const inStreamOffset = inStreamPos; // .offset;\n                // const hypotheticalPosition = inStreamOffset; // more complex w/ sortTuples\n\n                if (!memo.includes(topLevel)) {\n                    // if returnSortTuples...\n                    // else\n                    yield [topLevel, inStreamOffset, recurType];\n                    memo.push(topLevel);\n                }\n            }\n        }\n        // if followDerivation...\n    }\n}\n\nbase.Music21Object = Music21Object;\n","import * as Vex from 'vexflow';\n\nimport { common } from './common.js';\nimport { prebase } from './prebase.js';\n\n/**\n * articulations module. See {@link music21.articulations} namespace\n *\n */\n\n/**\n * @namespace music21.articulations\n * @memberof music21\n * @requires music21/prebase, Vexflow\n */\nexport const articulations = {};\n\n/**\n * Represents a single articulation, usually in the `.articulations` Array\n * on a {@link music21.note.Note} or something like that.\n *\n * @class Articulation\n * @memberof music21.articulations\n * @extends music21.prebase.ProtoM21Object\n * @property {string} name\n * @property {string} [placement='above']\n * @property {string} vexflowModifier - the string code to get this accidental in Vexflow\n * @property {number} [dynamicScale=1.0] - multiplier for the dynamic of a note that this is attached to\n * @property {number} [lengthScale=1.0] - multiplier for the length of a note that this is attached to.\n */\nexport class Articulation extends prebase.ProtoM21Object {\n    constructor() {\n        super();\n        this.name = undefined;\n        this.placement = 'above';\n        this.vexflowModifier = undefined;\n        this.setPosition = undefined;\n        this.dynamicScale = 1.0;\n        this.lengthScale = 1.0;\n    }\n\n    /**\n     * Generates a Vex.Flow.Articulation for this articulation.\n     *\n     * @memberof music21.articulations.Articulation\n     * @returns {Vex.Flow.Articulation}\n     */\n    vexflow() {\n        const vfa = new Vex.Flow.Articulation(this.vexflowModifier);\n        if (this.setPosition) {\n            vfa.setPosition(this.setPosition);\n        }\n        return vfa;\n    }\n}\narticulations.Articulation = Articulation;\n/**\n * base class for articulations that change the length of a note...\n *\n * @class LengthArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class LengthArticulation extends Articulation {\n    constructor() {\n        super();\n        this.name = 'length-articulation';\n    }\n}\narticulations.LengthArticulation = LengthArticulation;\n\n/**\n * base class for articulations that change the dynamic of a note...\n *\n * @class DynamicArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class DynamicArticulation extends Articulation {\n    constructor() {\n        super();\n        this.name = 'dynamic-articulation';\n    }\n}\narticulations.DynamicArticulation = DynamicArticulation;\n\n/**\n * base class for articulations that change the pitch of a note...\n *\n * @class PitchArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class PitchArticulation extends Articulation {\n    constructor() {\n        super();\n        this.name = 'pitch-articulation';\n    }\n}\narticulations.PitchArticulation = PitchArticulation;\n\n/**\n * base class for articulations that change the timbre of a note...\n *\n * @class TimbreArticulation\n * @memberof music21.articulations\n * @extends music21.articulations.Articulation\n */\nexport class TimbreArticulation extends Articulation {\n    constructor() {\n        super();\n        this.name = 'timbre-articulation';\n    }\n}\narticulations.TimbreArticulation = TimbreArticulation;\n\n/**\n * 50% louder than usual\n *\n * @class Accent\n * @memberof music21.articulations\n * @extends music21.articulations.DynamicArticulation\n */\nexport class Accent extends DynamicArticulation {\n    constructor() {\n        super();\n        this.name = 'accent';\n        this.vexflowModifier = 'a>';\n        this.dynamicScale = 1.5;\n    }\n}\narticulations.Accent = Accent;\n\n/**\n * 100% louder than usual\n *\n * @class StrongAccent\n * @memberof music21.articulations\n * @extends music21.articulations.Accent\n */\nexport class StrongAccent extends Accent {\n    constructor() {\n        super();\n        this.name = 'strong accent';\n        this.vexflowModifier = 'a^';\n        this.dynamicScale = 2.0;\n    }\n}\narticulations.StrongAccent = StrongAccent;\n\n/**\n * no playback for now.\n *\n * @class Staccato\n * @memberof music21.articulations\n * @extends music21.articulations.LengthArticulation\n */\nexport class Staccato extends LengthArticulation {\n    constructor() {\n        super();\n        this.name = 'staccato';\n        this.vexflowModifier = 'a.';\n    }\n}\narticulations.Staccato = Staccato;\n\n/**\n * no playback for now.\n *\n * @class Staccatissimo\n * @memberof music21.articulations\n * @extends music21.articulations.Staccato\n */\nexport class Staccatissimo extends Staccato {\n    constructor() {\n        super();\n        this.name = 'staccatissimo';\n        this.vexflowModifier = 'av';\n    }\n}\narticulations.Staccatissimo = Staccatissimo;\n\n/**\n * no playback or display for now.\n *\n * @class Spiccato\n * @memberof music21.articulations\n * @extends music21.articulations.Staccato\n */\nexport class Spiccato extends Staccato {\n    constructor() {\n        super();\n        this.name = 'spiccato';\n        this.vexflowModifier = undefined;\n    }\n}\narticulations.Spiccato = Spiccato;\n\n/**\n * @class Marcato\n * @memberof music21.articulations\n * @extends music21.articulations.DynamicArticulation\n * @extends music21.articulations.LengthArticulation\n */\nexport class Marcato extends DynamicArticulation {\n    constructor() {\n        super();\n        common.mixin(LengthArticulation, this);\n        this.name = 'marcato';\n        this.vexflowModifier = 'a^';\n        this.dynamicScale = 1.7;\n    }\n}\narticulations.Marcato = Marcato;\n\n/**\n * @class Tenuto\n * @memberof music21.articulations\n * @extends music21.articulations.LengthArticulation\n */\nexport class Tenuto extends LengthArticulation {\n    constructor() {\n        super();\n        this.name = 'tenuto';\n        this.vexflowModifier = 'a-';\n    }\n}\narticulations.Tenuto = Tenuto;\n","import MIDI from 'MIDI';\n\nimport { common } from './common.js';\n\n/**\n * audioSearch module. See {@link music21.audioSearch} namespace\n *\n * @exports music21/audioSearch\n */\n/**\n * @namespace music21.audioSearch\n * @memberof music21\n * @requires music21/pitch\n * @requires music21/common\n */\n\nexport const audioSearch = {};\n// functions based on the prototype created by Chris Wilson's MIT License version\n// and on Jordi Bartolome Guillen's audioSearch module for music21\n\naudioSearch.fftSize = 2048;\n\naudioSearch.AudioContextCaller\n    = window.AudioContext || window.webkitAudioContext;\naudioSearch._audioContext = null;\naudioSearch.animationFrameCallbackId = null;\n\nObject.defineProperties(audioSearch, {\n    audioContext: {\n        get: () => {\n            if (audioSearch._audioContext !== null) {\n                return audioSearch._audioContext;\n            } else {\n                // AudioContext should be a singleton, but MIDI reports loaded before it is!\n                if (\n                    MIDI !== undefined\n                    && MIDI.WebAudio !== undefined\n                    && MIDI.WebAudio.getContext() !== undefined\n                ) {\n                    window.globalAudioContext = MIDI.WebAudio.getContext();\n                } else if (typeof window.globalAudioContext === 'undefined') {\n                    window.globalAudioContext = new audioSearch.AudioContextCaller();\n                }\n                audioSearch._audioContext = window.globalAudioContext;\n                return audioSearch._audioContext;\n            }\n        },\n        set: ac => {\n            audioSearch._audioContext = ac;\n        },\n    },\n});\n\n/**\n *\n * @function music21.audioSearch.getUserMedia\n * @memberof music21.audioSearch\n * @param {object} dictionary - optional dictionary to fill\n * @param {function} callback - callback on success\n * @param {function} error - callback on error\n */\naudioSearch.getUserMedia = function getUserMedia(dictionary, callback, error) {\n    if (error === undefined) {\n        /* eslint no-alert: \"off\"*/\n        error = () => {\n            alert(\n                'navigator.getUserMedia either not defined (Safari, IE) or denied.'\n            );\n        };\n    }\n    if (callback === undefined) {\n        callback = mediaStream => {\n            audioSearch.userMediaStarted(mediaStream);\n        };\n    }\n    const n = navigator;\n    // need to polyfill navigator, or binding problems are hard...\n    n.getUserMedia\n        = n.getUserMedia\n        || n.webkitGetUserMedia\n        || n.mozGetUserMedia\n        || n.msGetUserMedia;\n\n    if (n.getUserMedia === undefined) {\n        error();\n    }\n    if (dictionary === undefined) {\n        dictionary = {\n            audio: {\n                mandatory: {},\n                optional: [],\n            },\n        };\n    }\n    n.getUserMedia(dictionary, callback, error);\n};\n\naudioSearch.sampleBuffer = null;\naudioSearch.currentAnalyser = null;\n\naudioSearch.userMediaStarted = function userMediaStarted(audioStream) {\n    /**\n     * This function which patches Safari requires some time to get started\n     * so we call it on object creation.\n     */\n    audioSearch.sampleBuffer = new Float32Array(audioSearch.fftSize / 2);\n    const mediaStreamSource = audioSearch.audioContext.createMediaStreamSource(\n        audioStream\n    );\n    const analyser = audioSearch.audioContext.createAnalyser();\n    analyser.fftSize = audioSearch.fftSize;\n    mediaStreamSource.connect(analyser);\n    audioSearch.currentAnalyser = analyser;\n    audioSearch.animateLoop();\n};\n\naudioSearch.minFrequency = 55;\naudioSearch.maxFrequency = 1050;\naudioSearch.animateLoop = function animateLoop(time) {\n    audioSearch.currentAnalyser.getFloatTimeDomainData(\n        audioSearch.sampleBuffer\n    );\n    // returns best frequency or -1\n    const frequencyDetected = audioSearch.autoCorrelate(\n        audioSearch.sampleBuffer,\n        audioSearch.audioContext.sampleRate,\n        audioSearch.minFrequency,\n        audioSearch.maxFrequency\n    );\n    const retValue = audioSearch.sampleCallback(frequencyDetected);\n    if (retValue !== -1) {\n        audioSearch.animationFrameCallbackId = window.requestAnimationFrame(\n            audioSearch.animateLoop\n        );\n    }\n};\n\naudioSearch.pitchSmoothingSize = 40;\naudioSearch.lastPitchClassesDetected = [];\naudioSearch.lastPitchesDetected = [];\naudioSearch.lastCentsDeviationsDetected = [];\n\naudioSearch.smoothPitchExtraction = function smoothPitchExtraction(frequency) {\n    if (frequency === -1) {\n        audioSearch.lastPitchClassesDetected.shift();\n        audioSearch.lastPitchesDetected.shift();\n        audioSearch.lastCentsDeviationsDetected.shift();\n    } else {\n        const [midiNum, centsOff] = audioSearch.midiNumDiffFromFrequency(\n            frequency\n        );\n        if (\n            audioSearch.lastPitchClassesDetected.length\n            > audioSearch.pitchSmoothingSize\n        ) {\n            audioSearch.lastPitchClassesDetected.shift();\n            audioSearch.lastPitchesDetected.shift();\n            audioSearch.lastCentsDeviationsDetected.shift();\n        }\n        audioSearch.lastPitchClassesDetected.push(midiNum % 12);\n        audioSearch.lastPitchesDetected.push(midiNum);\n        audioSearch.lastCentsDeviationsDetected.push(centsOff);\n    }\n    const mostCommonPitchClass = common.statisticalMode(\n        audioSearch.lastPitchClassesDetected\n    );\n    if (mostCommonPitchClass === null) {\n        return [-1, 0];\n    }\n    const pitchesMatchingClass = [];\n    const centsMatchingClass = [];\n    for (let i = 0; i < audioSearch.lastPitchClassesDetected.length; i++) {\n        if (audioSearch.lastPitchClassesDetected[i] === mostCommonPitchClass) {\n            pitchesMatchingClass.push(audioSearch.lastPitchesDetected[i]);\n            centsMatchingClass.push(audioSearch.lastCentsDeviationsDetected[i]);\n        }\n    }\n    const mostCommonPitch = common.statisticalMode(pitchesMatchingClass);\n\n    // find cents difference; weighing more recent samples more...\n    let totalSamplePoints = 0;\n    let totalSample = 0;\n    for (let j = 0; j < centsMatchingClass.length; j++) {\n        const weight = Math.pow(j, 2) + 1;\n        totalSample += weight * centsMatchingClass[j];\n        totalSamplePoints += weight;\n    }\n    const centsOff = Math.floor(totalSample / totalSamplePoints);\n    return [mostCommonPitch, centsOff];\n};\n\naudioSearch.sampleCallback = function sampleCallback(frequency) {\n    const [unused_midiNum, unused_centsOff] = audioSearch.smoothPitchExtraction(\n        frequency\n    );\n};\n\n// from Chris Wilson. Replace with Jordi's\naudioSearch.autoCorrelate = function autoCorrelate(\n    buf,\n    sampleRate,\n    minFrequency,\n    maxFrequency\n) {\n    const SIZE = buf.length;\n    const MAX_SAMPLES = Math.floor(SIZE / 2);\n    if (minFrequency === undefined) {\n        minFrequency = 0;\n    }\n    if (maxFrequency === undefined) {\n        maxFrequency = sampleRate;\n    }\n\n    let best_offset = -1;\n    let best_correlation = 0;\n    let rms = 0;\n    let foundGoodCorrelation = false;\n    const correlations = new Array(MAX_SAMPLES);\n\n    for (let i = 0; i < SIZE; i++) {\n        const val = buf[i];\n        rms += val * val;\n    }\n    rms = Math.sqrt(rms / SIZE);\n    if (rms < 0.01) {\n        return -1;\n    } // not enough signal\n\n    let lastCorrelation = 1;\n    for (let offset = 0; offset < MAX_SAMPLES; offset++) {\n        let correlation = 0;\n        const offsetFrequency = sampleRate / offset;\n        if (offsetFrequency < minFrequency) {\n            break;\n        }\n        if (offsetFrequency > maxFrequency) {\n            continue;\n        }\n\n        for (let i = 0; i < MAX_SAMPLES; i++) {\n            correlation += Math.abs(buf[i] - buf[i + offset]);\n        }\n        correlation = 1 - correlation / MAX_SAMPLES;\n        correlations[offset] = correlation; // store it, for the tweaking we need to do below.\n        if (correlation > 0.9 && correlation > lastCorrelation) {\n            foundGoodCorrelation = true;\n            if (correlation > best_correlation) {\n                best_correlation = correlation;\n                best_offset = offset;\n            }\n        } else if (foundGoodCorrelation) {\n            // short-circuit - we found a good correlation, then a bad one, so we'd just be seeing copies from here.\n            // Now we need to tweak the offset - by interpolating between the values to the left and right of the\n            // best offset, and shifting it a bit.  This is complex, and HACKY in this code (happy to take PRs!) -\n            // we need to do a curve fit on correlations[] around best_offset in order to better determine precise\n            // (anti-aliased) offset.\n\n            // we know best_offset >=1,\n            // since foundGoodCorrelation cannot go to true until the second pass (offset=1), and\n            // we can't drop into this clause until the following pass (else if).\n            const shift\n                = (correlations[best_offset + 1]\n                    - correlations[best_offset - 1])\n                / correlations[best_offset];\n            return sampleRate / (best_offset + 8 * shift);\n        }\n        lastCorrelation = correlation;\n    }\n    if (best_correlation > 0.01) {\n        // console.log(\"f = \" + sampleRate/best_offset + \"Hz (rms: \" + rms + \" confidence: \" + best_correlation + \")\")\n        return sampleRate / best_offset;\n    }\n    return -1;\n    //  var best_frequency = sampleRate/best_offset;\n};\n\n/**\n *\n * @function midiNumDiffFromFrequency\n * @param {Number} frequency\n * @returns {Array<Int>} [miniNumber, centsOff]\n */\naudioSearch.midiNumDiffFromFrequency = function midiNumDiffFromFrequency(\n    frequency\n) {\n    const midiNumFloat = 12 * (Math.log(frequency / 440) / Math.log(2)) + 69;\n    const midiNum = Math.round(midiNumFloat);\n    const centsOff = Math.round(100 * (midiNumFloat - midiNum));\n    return [midiNum, centsOff];\n};\n","import { audioSearch } from './audioSearch.js';\n\n/**\n * Adopted from Matt Diamond's recorder.js code MIT License\n */\nexport class Recorder {\n    constructor(cfg) {\n        const config = cfg || {};\n        this.bufferLen = config.bufferLen || 4096;\n        this.config = config;\n        this.recording = false;\n        this.currCallback = undefined;\n        this.audioContext = audioSearch.audioContext;\n        this.frequencyCanvasInfo = {\n            id: 'frequencyAnalyser',\n            width: undefined,\n            height: undefined,\n            canvasContext: undefined,\n            animationFrameID: undefined,\n        };\n        this.waveformCanvasInfo = {\n            id: 'waveformCanvas',\n            width: undefined,\n            height: undefined,\n            canvasContext: undefined,\n        };\n        this.analyserNode = undefined;\n    }\n\n    /**\n     * Start here -- polyfills navigator, runs getUserMedia and then sends to audioStreamConnected\n     */\n    initAudio() {\n        this.polyfillNavigator();\n        navigator.getUserMedia(\n            {\n                audio: {\n                    mandatory: {\n                        googEchoCancellation: 'false',\n                        googAutoGainControl: 'false',\n                        googNoiseSuppression: 'false',\n                        googHighpassFilter: 'false',\n                        // 'echoCancellation': false,\n                        // 'autoGainControl': false,\n                        // 'noiseSuppression': false,\n                        // 'highpassFilter': false,\n                    },\n                    optional: [],\n                },\n            },\n            s => this.audioStreamConnected(s),\n            error => {\n                console.log('Error getting audio -- try on google Chrome?');\n                console.log(error);\n            }\n        );\n    }\n\n    /**\n     * After the user has given permission to record, this method is called.\n     * It creates a gain point, and then connects the input source to the gain.\n     * It connects an analyserNode (fftSize 2048) to the gain.\n     *\n     * It creates a second gain of 0.0 connected to the destination, so that\n     * we're not hearing what we're playing in in an infinite loop (SUCKS to turn this off...)\n     *\n     * And it calls this.connectSource on the inputPoint so that\n     * we can do something with all these wonderful inputs.\n     */\n    audioStreamConnected(stream) {\n        const inputPoint = this.audioContext.createGain();\n\n        // Create an AudioNode from the stream.\n        const audioInput = this.audioContext.createMediaStreamSource(stream);\n        audioInput.connect(inputPoint);\n\n        const analyserNode = this.audioContext.createAnalyser();\n        analyserNode.fftSize = 2048;\n        this.analyserNode = analyserNode;\n        inputPoint.connect(analyserNode);\n\n        this.connectSource(inputPoint);\n\n        const zeroGain = this.audioContext.createGain();\n        zeroGain.gain.value = 0.0;\n        inputPoint.connect(zeroGain);\n        zeroGain.connect(this.audioContext.destination);\n    }\n\n    /**\n     * Creates a worker to receive and process all the messages asychronously.\n     */\n    connectSource(source) {\n        this.context = source.context;\n        this.setNode();\n\n        // create a Worker with inline code...\n        const workerBlob = new Blob(['(', recorderWorkerJs, ')()'], {\n            type: 'application/javascript',\n        });\n        const workerURL = URL.createObjectURL(workerBlob);\n        this.worker = new Worker(workerURL);\n        /**\n         * When worker sends a message, we just send it to the currentCallback...\n         */\n        this.worker.onmessage = e => {\n            const blob = e.data;\n            this.currCallback(blob);\n        };\n        URL.revokeObjectURL(workerURL);\n\n        this.worker.postMessage({\n            command: 'init',\n            config: {\n                sampleRate: this.context.sampleRate,\n            },\n        });\n\n        /**\n         * Whenever the ScriptProcessorNode receives enough audio to process\n         * (i.e., this.bufferLen stereo samples; default 4096), then it calls onaudioprocess\n         * which is set up to send the event's .getChannelData to the WebWorker via a\n         * postMessage.\n         *\n         * The 'record' command sends no message back.\n         */\n        this.node.onaudioprocess = e => {\n            if (!this.recording) {\n                return;\n            }\n            this.worker.postMessage({\n                command: 'record',\n                buffer: [\n                    e.inputBuffer.getChannelData(0),\n                    e.inputBuffer.getChannelData(1),\n                ],\n            });\n        };\n\n        source.connect(this.node);\n\n        /**\n         * polyfill for Chrome error.\n         *\n         * if the ScriptProcessorNode (this.node) is not connected to an output\n         * the \"onaudioprocess\" event is not triggered in Chrome.\n         */\n        this.node.connect(this.context.destination);\n    }\n\n    /**\n     * Creates a ScriptProcessorNode (preferably) to allow for direct audio processing.\n     *\n     * Sets it to this.node and returns it.\n     */\n    setNode() {\n        const numInputChannels = 2;\n        const numOutputChannels = 2;\n        if (!this.context.createScriptProcessor) {\n            this.node = this.context.createJavaScriptNode(\n                this.bufferLen,\n                numInputChannels,\n                numOutputChannels\n            );\n        } else {\n            this.node = this.context.createScriptProcessor(\n                this.bufferLen,\n                numInputChannels,\n                numOutputChannels\n            );\n        }\n        return this.node;\n    }\n\n    /**\n     * Configure from another source...\n     */\n    configure(cfg) {\n        for (const prop in cfg) {\n            if (Object.hasOwnProperty.call(cfg, prop)) {\n                this.config[prop] = cfg[prop];\n            }\n        }\n    }\n\n    record() {\n        this.recording = true;\n    }\n    stop() {\n        this.recording = false;\n    }\n    clear() {\n        this.worker.postMessage({ command: 'clear' });\n    }\n\n    /**\n     * Directly get the buffers from the worker and then call cb.\n     */\n    getBuffers(cb) {\n        this.currCallback = cb || this.config.callback;\n        this.worker.postMessage({ command: 'getBuffers' });\n    }\n\n    /**\n     * call exportWAV or exportMonoWAV on the worker, then call cb or (if undefined) setupDownload.\n     */\n    exportWAV(cb, type, isMono) {\n        let command = 'exportWAV';\n        if (isMono === true) {\n            // default false\n            command = 'exportMonoWAV';\n        }\n        this.currCallback = cb || this.config.callback;\n        type = type || this.config.type || 'audio/wav';\n        if (!this.currCallback) {\n            this.currCallback = blob => {\n                this.setupDownload(\n                    blob,\n                    'myRecording' + Date.now().toString() + '.wav'\n                );\n            };\n        }\n        this.worker.postMessage({\n            command,\n            type,\n        });\n    }\n\n    exportMonoWAV(cb, type) {\n        this.exportWAV(cb, type, true);\n    }\n\n    setupDownload(blob, filename, elementId) {\n        elementId = elementId || 'save';\n        const url = (window.URL || window.webkitURL).createObjectURL(blob);\n        const link = document.getElementById(elementId);\n        link.href = url;\n        link.download = filename || 'output.wav';\n    }\n\n    /**\n     * Polyfills for getUserMedia (requestAnimationFrame polyfills not needed.)\n     * As of 2016 September, only Edge support unprefixed.\n     */\n    polyfillNavigator() {\n        if (!navigator.getUserMedia) {\n            navigator.getUserMedia\n                = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n        }\n        if (window.AnalyserNode && !window.AnalyserNode.prototype.getFloatTimeDomainData) {\n            const uint8 = new Uint8Array(2048);\n            window.AnalyserNode.prototype.getFloatTimeDomainData = function getFloatTimeDomainData(array) {\n                this.getByteTimeDomainData(uint8);\n                const imax = array.length;\n                for (let i = 0; i < imax; i++) {\n                    array[i] = (uint8[i] - 128) * 0.0078125;\n                }\n            };\n        }\n    }\n\n    updateAnalysers(time) {\n        if (!this.frequencyCanvasInfo.canvasContext) {\n            const canvas = document.getElementById(this.frequencyCanvasInfo.id);\n            if (!canvas) {\n                return;\n            }\n            this.frequencyCanvasInfo.width = canvas.width;\n            this.frequencyCanvasInfo.height = canvas.height;\n            this.frequencyCanvasInfo.canvasContext = canvas.getContext('2d');\n        }\n\n        // analyser draw code here\n        const SPACING = 3;\n        const BAR_WIDTH = 1;\n        const numBars = Math.round(this.frequencyCanvasInfo.width / SPACING);\n        const freqByteData = new Uint8Array(\n            this.analyserNode.frequencyBinCount\n        );\n\n        this.analyserNode.getByteFrequencyData(freqByteData);\n\n        const canvasContext = this.frequencyCanvasInfo.canvasContext;\n        canvasContext.clearRect(\n            0,\n            0,\n            this.frequencyCanvasInfo.width,\n            this.frequencyCanvasInfo.height\n        );\n        canvasContext.fillStyle = '#F6D565';\n        canvasContext.lineCap = 'round';\n        const multiplier = this.analyserNode.frequencyBinCount / numBars;\n\n        // Draw rectangle for each frequency bin.\n        for (let i = 0; i < numBars; ++i) {\n            let magnitude = 0;\n            const offset = Math.floor(i * multiplier);\n            for (let j = 0; j < multiplier; j++) {\n                magnitude += freqByteData[offset + j];\n            }\n            magnitude\n                = magnitude\n                * (this.frequencyCanvasInfo.height / 256)\n                / multiplier;\n            canvasContext.fillStyle\n                = 'hsl( ' + Math.round(i * 360 / numBars) + ', 100%, 50%)';\n            canvasContext.fillRect(\n                i * SPACING,\n                this.frequencyCanvasInfo.height,\n                BAR_WIDTH,\n                -1 * magnitude\n            );\n        }\n\n        this.frequencyCanvasInfo.animationFrameID = window.requestAnimationFrame(\n            t => this.updateAnalysers(t)\n        );\n    }\n\n    drawWaveformCanvas(buffers) {\n        const data = buffers[0]; // one track of stereo recording.\n        if (!this.waveformCanvasInfo.context) {\n            const canvas = document.getElementById(this.waveformCanvasInfo.id);\n            if (!canvas) {\n                return;\n            }\n            this.waveformCanvasInfo.width = canvas.width;\n            this.waveformCanvasInfo.height = canvas.height;\n            this.waveformCanvasInfo.context = canvas.getContext('2d');\n        }\n        const context = this.waveformCanvasInfo.context;\n        const step = Math.ceil(data.length / this.waveformCanvasInfo.width);\n        const amp = this.waveformCanvasInfo.height / 2;\n        context.fillStyle = 'silver';\n        context.clearRect(\n            0,\n            0,\n            this.waveformCanvasInfo.width,\n            this.waveformCanvasInfo.height\n        );\n        for (let i = 0; i < this.waveformCanvasInfo.width; i++) {\n            let min = 1.0;\n            let max = -1.0;\n            for (let j = 0; j < step; j++) {\n                const datum = data[i * step + j];\n                if (datum < min) {\n                    min = datum;\n                }\n                if (datum > max) {\n                    max = datum;\n                }\n            }\n            context.fillRect(\n                i,\n                (1 + min) * amp,\n                1,\n                Math.max(1, (max - min) * amp)\n            );\n        }\n    }\n\n    /**\n     * set this as a callback from getBuffers.  Returns the source so that a stop() command\n     * is possible.\n     */\n    playBuffers(buffers) {\n        const channels = 2;\n        const numFrames = buffers[0].length;\n        const audioBuffer = this.context.createBuffer(\n            channels,\n            numFrames,\n            this.context.sampleRate\n        );\n        for (let channel = 0; channel < channels; channel++) {\n            const thisChannelBuffer = audioBuffer.getChannelData(channel);\n            for (let i = 0; i < numFrames; i++) {\n                thisChannelBuffer[i] = buffers[channel][i];\n            }\n        }\n        const source = this.context.createBufferSource();\n        source.buffer = audioBuffer;\n        source.connect(this.context.destination);\n        source.start();\n        return source;\n    }\n}\n\n/**\n * This code does NOT go through babel, so no arrow functions, let, const, etc.\n */\nconst recorderWorkerJs = `function recorderWorkerJs() {\n    /**\n     *\n     *   Rewritten from Matt Diamond's recorderWorker -- MIT License\n     */\n    RecorderWorker = function RecorderWorker(parentContext) {\n            this.parent = parentContext;\n            this.recLength = 0;\n            this.recBuffersL = [];\n            this.recBuffersR = [];\n            this.sampleRate = undefined;\n    };\n    RecorderWorker.prototype.onmessage = function onmessage(e) {\n            switch (e.data.command) {\n            case 'init':\n                this.init(e.data.config);\n                break;\n            case 'record':\n                this.record(e.data.buffer);\n                break;\n            case 'exportWAV':\n                this.exportWAV(e.data.type);\n                break;\n            case 'exportMonoWAV':\n                this.exportMonoWAV(e.data.type);\n                break;\n            case 'getBuffers':\n                this.getBuffers();\n                break;\n            case 'clear':\n                this.clear();\n                break;\n            default:\n                break;\n            }\n   };\n   RecorderWorker.prototype.postMessage = function postMessage(msg) {\n            this.parent.postMessage(msg);\n   };\n\n   RecorderWorker.prototype.init = function init(config) {\n            this.sampleRate = config.sampleRate;\n   };\n\n   RecorderWorker.prototype.record = function record(inputBuffer) {\n            var inputBufferL = inputBuffer[0];\n            var inputBufferR = inputBuffer[1];\n            this.recBuffersL.push(inputBufferL);\n            this.recBuffersR.push(inputBufferR);\n            this.recLength += inputBufferL.length;\n   };\n\n   RecorderWorker.prototype.exportWAV = function exportWAV(type) {\n            var bufferL = this.mergeBuffers(this.recBuffersL);\n            var bufferR = this.mergeBuffers(this.recBuffersR);\n            var interleaved = this.interleave(bufferL, bufferR);\n            var dataview = this.encodeWAV(interleaved);\n            var audioBlob = new Blob([dataview], { 'type': type });\n\n            this.postMessage(audioBlob);\n   };\n\n   RecorderWorker.prototype.exportMonoWAV = function exportMonoWAV(type) {\n            var bufferL = this.mergeBuffers(this.recBuffersL);\n            var dataview = this.encodeWAV(bufferL);\n            var audioBlob = new Blob([dataview], { 'type': type });\n\n            this.postMessage(audioBlob);\n   };\n\n   RecorderWorker.prototype.mergeBuffers = function mergeBuffers(recBuffers) {\n            var result = new Float32Array(this.recLength);\n            var offset = 0;\n            for (var i = 0; i < recBuffers.length; i++) {\n                result.set(recBuffers[i], offset);\n                offset += recBuffers[i].length;\n            }\n            return result;\n    };\n\n    RecorderWorker.prototype.getBuffers = function getBuffers() {\n            var buffers = [];\n            buffers.push(this.mergeBuffers(this.recBuffersL));\n            buffers.push(this.mergeBuffers(this.recBuffersR));\n            this.postMessage(buffers);\n        };\n\n    RecorderWorker.prototype.clear = function clear() {\n            this.recLength = 0;\n            this.recBuffersL = [];\n            this.recBuffersR = [];\n        }\n\n    RecorderWorker.prototype.interleave = function interleave(inputL, inputR) {\n            var combinedLength = inputL.length + inputR.length;\n            var result = new Float32Array(combinedLength);\n\n            var index = 0;\n            var inputIndex = 0;\n\n            while (index < combinedLength) {\n                result[index++] = inputL[inputIndex];\n                result[index++] = inputR[inputIndex];\n                inputIndex++;\n            }\n            return result;\n        }\n    RecorderWorker.prototype.encodeWAV = function encodeWAV(samples, mono) {\n            var buffer = new ArrayBuffer(44 + (samples.length * 2));\n            var view = new DataView(buffer);\n\n            /* RIFF identifier */\n            writeString(view, 0, 'RIFF');\n\n            /* file length */\n            view.setUint32(4, 32 + samples.length * 2, true);\n\n            /* RIFF type */\n            writeString(view, 8, 'WAVE');\n\n            /* format chunk identifier */\n            writeString(view, 12, 'fmt ');\n\n            /* format chunk length */\n            view.setUint32(16, 16, true);\n\n            /* sample format (raw) */\n            view.setUint16(20, 1, true);\n\n            /* channel count */\n            view.setUint16(22, mono ? 1 : 2, true);\n\n            /* sample rate */\n            view.setUint32(24, this.sampleRate, true);\n\n            /* byte rate (sample rate * block align) */\n            view.setUint32(28, this.sampleRate * 4, true);\n\n            /* block align (channel count * bytes per sample) */\n            view.setUint16(32, 4, true);\n\n            /* bits per sample */\n            view.setUint16(34, 16, true);\n\n            /* data chunk identifier */\n            writeString(view, 36, 'data');\n\n            /* data chunk length */\n            view.setUint32(40, samples.length * 2, true);\n\n            floatTo16BitPCM(view, 44, samples);\n\n            return view;\n        }\n\n    function floatTo16BitPCM(output, offset, input) {\n        for (var i = 0; i < input.length; i++, offset += 2) {\n            var s = Math.max(-1, Math.min(1, input[i]));\n            output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n        }\n    }\n\n    function writeString(view, offset, string) {\n        for (var i = 0; i < string.length; i++) {\n            view.setUint8(offset + i, string.charCodeAt(i));\n        }\n    }\n\n    var recordWorker = new RecorderWorker(this);\n    this.onmessage = (function mainOnMessage(e) { recordWorker.onmessage(e) }).bind(this);\n}`;\n\nexport const audioRecording = { Recorder };\nexport default audioRecording;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/beam -- Beams and Beam class\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21.js';\n\nimport { prebase } from './prebase.js';\nimport { duration } from './duration.js';\n\n/**\n * Module holding beam materials. See {@link music21.beam} namespace.\n *\n * @exports music21/beam\n */\n/**\n * {@link music21.beam.Beam} and {music21.beam.Beams} objects\n *\n * @namespace music21.beam\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/duration\n */\nexport const beam = {};\n\nbeam.validBeamTypes = {\n    start: true,\n    stop: true,\n    continue: true,\n    partial: true,\n};\n\nbeam.beamableDurationTypes = [\n    duration.typeFromNumDict[8],\n    duration.typeFromNumDict[16], duration.typeFromNumDict[32],\n    duration.typeFromNumDict[64], duration.typeFromNumDict[128],\n    duration.typeFromNumDict[256],    \n];\n\n\n/**\n * Object representing a single beam (e.g., a 16th note that is beamed needs two)\n *\n * @class Beam\n * @memberof music21.beam\n * @extends music21.prebase.ProtoM21Object\n * @param {string} type - \"start\", \"stop\", \"continue\", \"partial\"\n * @param {string} direction - only needed for partial beams: \"left\" or \"right\"\n * @property {Int|undefined} number - which beam line does this refer to; 8th = 1, 16th = 2, etc.\n * @property {number|undefined} independentAngle - the angle of this beam if it is different than others (feathered beams)\n */\nexport class Beam extends prebase.ProtoM21Object {\n    constructor(type, direction) {\n        super();\n        this.type = type;\n        this.direction = direction;\n        this.independentAngle = undefined;\n        this.number = undefined;\n    }\n}\nbeam.Beam = Beam;\n/**\n * Object representing a collection of Beams\n *\n * @class Beams\n * @memberof music21.beam\n * @extends music21.prebase.ProtoM21Object\n * @property {Array<music21.beam.Beam>} beamsList - a list of Beam objects\n * @property {Boolean} [feathered=false] - is this a feathered beam.\n * @property {Int} length - length of beamsList\n */\nexport class Beams extends prebase.ProtoM21Object {\n    static naiveBeams(srcList) {\n        const beamsList = [];\n        for (const el of srcList) {\n            if (!beam.beamableDurationTypes.includes(el.duration.type)) {\n                beamsList.push(undefined);\n            } else if (el.isRest) {\n                beamsList.push(undefined);\n            } else {\n                const b = new beam.Beams();\n                b.fill(el.duration.type);\n                beamsList.push(b);\n            }\n        }\n        return beamsList;\n    }\n    \n    static removeSandwichedUnbeamables(beamsList) {\n        let beamLast;\n        let beamNext;\n        for (let i = 0; i < beamsList.length; i++) {\n            if (i !== beamsList.length - 1) {\n                beamNext = beamsList[i + 1];\n            } else {\n                beamNext = undefined;\n            }\n            if (beamLast === undefined && beamNext === undefined) {\n                beamsList[i] = undefined;\n            }\n            beamLast = beamsList[i];\n        }\n        return beamsList;\n    }\n    \n    static sanitizePartialBeams(beamsList) {\n        for (let i = 0; i < beamsList.length; i++) {\n            if (beamsList[i] === undefined) {\n                continue;\n            }\n            const allTypes = beamsList[i].getTypes();\n            if (!allTypes.includes('start') \n                    && !allTypes.includes('stop')\n                    && !allTypes.includes('continue')) {\n                // nothing but partials;\n                beamsList[i] = undefined;\n                continue;\n            }\n            let hasStart = false;\n            let hasStop = false;\n            for (const b of beamsList[i].beamsList) {\n                if (b.type === 'start') {\n                    hasStart = true;\n                    continue;\n                }\n                if (b.type === 'stop') {\n                    hasStop = true;\n                    continue;\n                }\n                if (hasStart && b.type === 'partial' && b.direction === 'left') {\n                    b.direction = 'right';\n                } else if (hasStop && b.type === 'partial' && b.direction === 'right') {\n                    b.direction = 'left';\n                }\n            }\n        }\n        return beamsList;\n    }\n    \n    static mergeConnectingPartialBeams(beamsList) {\n        for (let i = 0; i < beamsList.length - 1; i++) {\n            const bThis = beamsList[i];\n            const bNext = beamsList[i + 1];\n            if (!bThis || !bNext) {\n                continue;\n            }\n            const bThisNum = bThis.getNumbers();\n            if (!bThisNum || bThisNum.length === 0) {\n                continue;\n            }\n            for (const thisNum of bThisNum) {\n                const thisBeam = bThis.getByNumber(thisNum);\n                if (thisBeam.type !== 'partial' || thisBeam.direction !== 'right') {\n                    continue;\n                }\n                if (!(bNext.getNumbers().includes(thisNum))) {\n                    continue;\n                }\n                const nextBeam = bNext.getByNumber(thisNum);\n                if (nextBeam.type === 'partial' || nextBeam.direction === 'right') {\n                    continue;\n                }\n                if (nextBeam.type === 'continue' || nextBeam.type === 'stop') {\n                    // should not happen.\n                    continue;\n                }\n                thisBeam.type = 'start';\n                thisBeam.direction = undefined;\n                if (nextBeam.type === 'partial') {\n                    nextBeam.type = 'stop';\n                } else if (nextBeam.type === 'start') {\n                    nextBeam.type = 'continue';\n                }\n                nextBeam.direction = undefined;\n            }\n        }\n        // now fix partial-lefts that follow stops:\n        for (let i = 1; i < beamsList.length; i++) {\n            const bThis = beamsList[i];\n            const bPrev = beamsList[i - 1];\n            if (!bThis || !bPrev) {\n                continue;\n            }\n            const bThisNum = bThis.getNumbers();\n            if (!bThisNum || bThisNum.length === 0) {\n                continue;\n            }\n            for (const thisNum of bThisNum) {\n                const thisBeam = bThis.getByNumber(thisNum);\n                if (thisBeam.type !== 'partial' || thisBeam.direction !== 'left') {\n                    continue;\n                }\n                if (!(bPrev.getNumbers().includes(thisNum))) {\n                    continue;\n                }\n                const prevBeam = bPrev.getByNumber(thisNum);\n                if (prevBeam.type !== 'stop') {\n                    continue;\n                }\n                thisBeam.type = 'stop';\n                thisBeam.direction = undefined;\n                prevBeam.type = 'continue';\n            }\n        }\n        return beamsList;\n    }\n    \n\n    constructor() {\n        super();\n        this.beamsList = [];\n        this.feathered = false;\n    }\n    get length() {\n        return this.beamsList.length;\n    }\n    /**\n     * Append a new {@link music21.beam.Beam} object to this Beams, automatically creating the Beam\n     *   object and incrementing the number count.\n     *\n     * @memberof music21.beam.Beams\n     * @param {string} type - the type (passed to {@link music21.beam.Beam})\n     * @param {string} [direction=undefined] - the direction if type is \"partial\"\n     * @returns {music21.beam.Beam} newly appended object\n     */\n    append(type, direction) {\n        const obj = new beam.Beam(type, direction);\n        obj.number = this.beamsList.length + 1;\n        this.beamsList.push(obj);\n        return obj;\n    }\n    /**\n     * A quick way of setting the beams list for a particular duration, for\n            instance, fill(\"16th\") will clear the current list of beams in the\n            Beams object and add two beams.  fill(2) will do the same (though note\n            that that is an int, not a string).\n\n     * It does not do anything to the direction that the beams are going in,\n            or by default.  Either set type here or call setAll() on the Beams\n            object afterwards.\n\n     * Both \"eighth\" and \"8th\" work.  Adding more than six beams (i.e. things\n            like 512th notes) raises an error.\n\n     * @memberof music21.beam.Beams\n     * @param {string|Int} level - either a string like \"eighth\" or a number like 1 (=\"eighth\")\n     * @param {string} type - type to fill all beams to.\n     * @returns {this}\n     */\n    fill(level, type) {\n        this.beamsList = [];\n        let count = 1;\n        if (\n            level === 1\n            || level === '8th'\n            || level === duration.typeFromNumDict[8]\n        ) {\n            count = 1;\n        } else if (level === 2 || level === duration.typeFromNumDict[16]) {\n            count = 2;\n        } else if (level === 3 || level === duration.typeFromNumDict[32]) {\n            count = 3;\n        } else if (level === 4 || level === duration.typeFromNumDict[64]) {\n            count = 4;\n        } else if (level === 5 || level === duration.typeFromNumDict[128]) {\n            count = 5;\n        } else if (level === 6 || level === duration.typeFromNumDict[256]) {\n            count = 6;\n        } else {\n            throw new Music21Exception('cannot fill beams for level ' + level);\n        }\n        for (let i = 1; i <= count; i++) {\n            const obj = new beam.Beam();\n            obj.number = i;\n            this.beamsList.push(obj);\n        }\n        if (type !== undefined) {\n            this.setAll(type);\n        }\n        return this;\n    }\n    /**\n     * Get the beam with the given number or throw an exception.\n     *\n     * @memberof music21.beam.Beams\n     * @param {Int} number - the beam number to retrieve (usually one less than the position in `.beamsList`)\n     * @returns {music21.beam.Beam|undefined}\n     */\n    getByNumber(number) {\n        if (!this.getNumbers().includes(number)) {\n            throw new Music21Exception('beam number error: ' + number);\n        }\n        for (const thisBeam of this.beamsList) {\n            if (thisBeam.number === number) {\n                return thisBeam;\n            }\n        }\n        return undefined;\n    }\n    /**\n     * Get an Array of all the numbers for the beams\n     *\n     * @memberof music21.beam.Beams\n     * @returns {Array<Int>} all the numbers\n     */\n    getNumbers() {\n        const numbers = [];\n        for (const thisBeam of this.beamsList) {\n            numbers.push(thisBeam.number);\n        }\n        return numbers;\n    }\n    /**\n     * Returns the type + \"-\" + direction (if direction is defined)\n     * for the beam with the given number.\n     *\n     * @param {Int} number\n     * @returns {music21.beam.Beam|undefined}\n     */\n    getTypeByNumber(number) {\n        const beamObj = this.getByNumber(number);\n        if (beamObj.direction === undefined) {\n            return beamObj.type;\n        } else {\n            const x = beamObj.type + '-' + beamObj.direction;\n            return x;\n        }\n    }\n    /**\n     * Get an Array of all the types for the beams\n     *\n     * @memberof music21.beam.Beams\n     * @returns {Array<string>} all the types\n     */\n    getTypes() {\n        const types = [];\n        for (let i = 0; i < this.length; i++) {\n            types.push(this.beamsList[i].type);\n        }\n        return types;\n    }\n    /**\n     * Set all the {@link music21.beam.Beam} objects to a given type/direction\n     *\n     * @memberof music21.beam.Beams\n     * @param {string} type - beam type\n     * @param {string} [direction] - beam direction\n     * @returns {this}\n     */\n    setAll(type, direction) {\n        if (beam.validBeamTypes[type] === undefined) {\n            throw new Music21Exception('invalid beam type: ' + type);\n        }\n        for (let i = 0; i < this.length; i++) {\n            const b = this.beamsList[i];\n            b.type = type;\n            b.direction = direction;\n        }\n        return this;\n    }\n    /**\n     * Set the {@link music21.beam.Beam} object specified by `number` to a given type/direction\n     *\n     * @memberof music21.beam.Beams\n     * @param {Int} number\n     * @param {string} type\n     * @param {string} [direction]\n     * @returns {this}\n     */\n    setByNumber(number, type, direction) {\n        if (direction === undefined) {\n            const splitit = type.split('-');\n            type = splitit[0];\n            direction = splitit[1]; // can be undefined...\n        }\n        if (beam.validBeamTypes[type] === undefined) {\n            throw new Music21Exception('invalid beam type: ' + type);\n        }\n        for (let i = 0; i < this.length; i++) {\n            if (this.beamsList[i].number === number) {\n                this.beamsList[i].type = type;\n                this.beamsList[i].direction = direction;\n            }\n        }\n        return this;\n    }\n}\nbeam.Beams = Beams;\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/pitch -- pitch routines\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21.js';\n\nimport { prebase } from './prebase.js';\n/**\n * pitch module.  See {@link music21.pitch} namespace\n *\n * @exports music21/pitch\n */\n/**\n * Pitch related objects and methods\n *\n * @namespace music21.pitch\n * @memberof music21\n * @requires music21/prebase\n */\nexport const pitch = {};\n/**\n * @class Accidental\n * @memberof music21.pitch\n * @param {string|number} accName - an accidental name\n * @extends music21.prebase.ProtoM21Object\n */\nexport class Accidental extends prebase.ProtoM21Object {\n    constructor(accName) {\n        super();\n        this._name = '';\n        this._alter = 0.0;\n        this._modifier = '';\n        this._unicodeModifier = '';\n        this.displayType = 'normal'; // \"normal\", \"always\" supported currently\n        this.displayStatus = undefined; // true, false, undefined\n        this.set(accName);\n    }\n    /**\n     * Sets a parameter of the accidental and updates name, alter, and modifier to suit.\n     *\n     * @memberof music21.pitch.Accidental\n     * @param {number|string} accName - the name, number, or modifier to set\n     * @returns {undefined}\n     */\n    set(accName) {\n        if (accName !== undefined && accName.toLowerCase !== undefined) {\n            accName = accName.toLowerCase();\n        }\n\n        if (\n            accName === 'natural'\n            || accName === 'n'\n            || accName === 0\n            || accName === undefined\n        ) {\n            this._name = 'natural';\n            this._alter = 0.0;\n            this._modifier = '';\n            this._unicodeModifier = '‚ôÆ';\n        } else if (accName === 'sharp' || accName === '#' || accName === 1) {\n            this._name = 'sharp';\n            this._alter = 1.0;\n            this._modifier = '#';\n            this._unicodeModifier = '‚ôØ';\n        } else if (\n            accName === 'flat'\n            || accName === '-'\n            || accName === 'b'\n            || accName === -1\n        ) {\n            this._name = 'flat';\n            this._alter = -1.0;\n            this._modifier = '-';\n            this._unicodeModifier = '‚ô≠';\n        } else if (\n            accName === 'double-flat'\n            || accName === '--'\n            || accName === -2\n        ) {\n            this._name = 'double-flat';\n            this._alter = -2.0;\n            this._modifier = '--';\n            this._unicodeModifier = '&#x1d12b;';\n        } else if (\n            accName === 'double-sharp'\n            || accName === '##'\n            || accName === 2\n        ) {\n            this._name = 'double-sharp';\n            this._alter = 2.0;\n            this._modifier = '##';\n            this._unicodeModifier = '&#x1d12a;';\n        } else if (\n            accName === 'triple-flat'\n            || accName === '---'\n            || accName === -3\n        ) {\n            this._name = 'triple-flat';\n            this._alter = -3.0;\n            this._modifier = '---';\n            this._unicodeModifier = '‚ô≠&#x1d12b;';\n        } else if (\n            accName === 'triple-sharp'\n            || accName === '###'\n            || accName === 3\n        ) {\n            this._name = 'triple-sharp';\n            this._alter = 3.0;\n            this._modifier = '###';\n            this._unicodeModifier = '&#x1d12a;';\n        } else if (\n            accName === 'quadruple-flat'\n            || accName === '----'\n            || accName === -4\n        ) {\n            this._name = 'quadruple-flat';\n            this._alter = -4.0;\n            this._modifier = '----';\n            this._unicodeModifier = '‚ô≠&#x1d12b;';\n        } else if (\n            accName === 'quadruple-sharp'\n            || accName === '####'\n            || accName === 4\n        ) {\n            this._name = 'quadruple-sharp';\n            this._alter = 4.0;\n            this._modifier = '####';\n            this._unicodeModifier = '&#x1d12a;';\n        } else {\n            throw new Music21Exception('Accidental is not supported: ' + accName);\n        }\n\n    }\n    /**\n     * Return or set the name of the accidental ('flat', 'sharp', 'natural', etc.);\n     *\n     * When set, updates alter and modifier.\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} name\n     */\n    get name() {\n        return this._name;\n    }\n    set name(n) {\n        this.set(n);\n    }\n    /**\n     * Return or set the alteration amount (-1.0 = flat; 1.0 = sharp; etc.)\n     *\n     * When set, updates name and modifier.\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {number} alter\n     */\n    get alter() {\n        return this._alter;\n    }\n    set alter(alter) {\n        this.set(alter);\n    }\n    /**\n     * Return or set the modifier ('-', '#', '')\n     *\n     * When set, updates alter and name.\n\n     * @memberof music21.pitch.Accidental#\n     * @var {string} modifier\n     */\n    get modifier() {\n        return this._modifier;\n    }\n    set modifier(modifier) {\n        this.set(modifier);\n    }\n    /**\n     * Returns the modifier for vexflow ('b', '#', 'n')\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} vexflowModifier\n     * @readonly\n     */\n    get vexflowModifier() {\n        // todo -- rewrite with mapping.\n        const m = this.modifier;\n        if (m === '') {\n            return 'n';\n        } else if (m === '#') {\n            return '#';\n        } else if (m === '-') {\n            return 'b';\n        } else if (m === '##') {\n            return '##';\n        } else if (m === '--') {\n            return 'bb';\n        } else if (m === '###') {\n            return '###';\n        } else if (m === '---') {\n            return 'bbb';\n        } else {\n            throw new Music21Exception('Vexflow does not support: ' + m);\n        }\n    }\n    /**\n     * Returns the modifier in unicode or\n     * for double and triple accidentals, as a hex escape\n     *\n     * @memberof music21.pitch.Accidental#\n     * @var {string} unicodeModifier\n     * @readonly\n     */\n    get unicodeModifier() {\n        return this._unicodeModifier;\n    }\n}\npitch.Accidental = Accidental;\n\npitch.nameToMidi = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };\npitch.nameToSteps = { C: 0, D: 1, E: 2, F: 3, G: 4, A: 5, B: 6 };\npitch.stepsToName = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\npitch.midiToName = [\n    'C',\n    'C#',\n    'D',\n    'E-',\n    'E',\n    'F',\n    'F#',\n    'G',\n    'A-',\n    'A',\n    'B-',\n    'B',\n];\n\n/**\n * Pitch objects are found in {@link music21.note.Note} objects, and many other places.\n *\n * They do not have a {@link music21.duration.Duration} associated with them, so they\n * cannot be placed inside {@link music21.stream.Stream} objects.\n *\n * Valid pitch name formats are\n * - \"C\", \"D', etc. (\"B\" = American B; \"H\" is not allowed)\n * - \"C#\", \"C-\" (C-flat; do not use \"b\" for flat), \"C##\", \"C###\", \"C--\" etc.\n * - Octave may be specified after the name + accidental: \"C#4\" etc.\n * - Octave can be arbitrarily high (\"C10\") but only as low as \"C0\" because \"C-1\" would be interpreted as C-flat octave 1; shift octave later for very low notes.\n * - If octave is not specified, the system will usually use octave 4, but might adjust according to context. If you do not like this behavior, give an octave always.\n * - Microtones are not supported in music21j (they are in music21p)\n *\n * @class Pitch\n * @memberof music21.pitch\n * @param {string} pn - name of the pitch, with or without octave, see above.\n * @extends music21.prebase.ProtoM21Object\n * @property {music21.pitch.Accidental|undefined} accidental - link to an accidental\n * @property {number} diatonicNoteNum - diatonic number of the pitch, where 29 = C4, C#4, C-4, etc.; 30 = D-4, D4, D#4, etc. updates other properties.\n * @property {number} midi - midi number of the pitch (C4 = 60); readonly. See {@link music21.pitch.Pitch#ps} for setable version.\n * @property {string} name - letter name of pitch + accidental modifier; e.g., B-flat = 'B-'; changes automatically w/ step and accidental\n * @property {string} nameWithOctave - letter name of pitch + accidental modifier + octave; changes automatically w/ step, accidental, and octave\n * @property {number} octave - number for the octave, where middle C = C4, and octaves change between B and C; default 4\n * @property {number} ps - pitch space number, like midi number but floating point and w/ no restriction on range. C4 = 60.0\n * @property {string} step - letter name for the pitch (C-G, A, B), without accidental; default 'C'\n */\nexport class Pitch extends prebase.ProtoM21Object {\n    constructor(pn = 'C') {\n        super();\n        this._step = 'C';\n        this._octave = 4;\n        this._accidental = undefined;\n        /* pn can be a nameWithOctave */\n        if (typeof pn === 'number') {\n            if (pn < 12) {\n                pn += 60; // pitchClass\n            }\n            this.ps = pn;\n        } else if (pn.match(/\\d+/)) {\n            this.nameWithOctave = pn;\n        } else {\n            this.name = pn;\n        }\n    }\n\n    // N.B. cannot use transpose here, because of circular import.\n\n    get step() {\n        return this._step;\n    }\n    set step(s) {\n        this._step = s;\n    }\n    get octave() {\n        return this._octave;\n    }\n    set octave(o) {\n        this._octave = o;\n    }\n    get accidental() {\n        return this._accidental;\n    }\n    set accidental(a) {\n        if (typeof a !== 'object' && a !== undefined) {\n            a = new pitch.Accidental(a);\n        }\n        this._accidental = a;\n    }\n    get name() {\n        if (this.accidental === undefined) {\n            return this.step;\n        } else {\n            return this.step + this.accidental.modifier;\n        }\n    }\n    set name(nn) {\n        this.step = nn.slice(0, 1).toUpperCase();\n        const tempAccidental = nn.slice(1);\n        if (tempAccidental) {\n            // not the empty string\n            this.accidental = tempAccidental; // converts automatically\n        } else {\n            this.accidental = undefined;\n        }\n    }\n    get nameWithOctave() {\n        return this.name + this.octave.toString();\n    }\n    set nameWithOctave(pn) {\n        const storedOctave = pn.match(/\\d+/);\n        if (storedOctave !== undefined) {\n            pn = pn.replace(/\\d+/, '');\n            this.octave = parseInt(storedOctave);\n            this.name = pn;\n        } else {\n            this.name = pn;\n        }\n    }\n    get diatonicNoteNum() {\n        return this.octave * 7 + pitch.nameToSteps[this.step] + 1;\n    }\n    set diatonicNoteNum(newDNN) {\n        newDNN -= 1; // makes math easier\n        this.octave = Math.floor(newDNN / 7);\n        this.step = pitch.stepsToName[newDNN % 7];\n    }\n    get frequency() {\n        return 440 * Math.pow(2, (this.ps - 69) / 12);\n    }\n    get midi() {\n        return Math.floor(this.ps);\n    }\n    get ps() {\n        let accidentalAlter = 0;\n        if (this.accidental !== undefined) {\n            accidentalAlter = parseInt(this.accidental.alter);\n        }\n        return (\n            (this.octave + 1) * 12\n            + pitch.nameToMidi[this.step]\n            + accidentalAlter\n        );\n    }\n    set ps(ps) {\n        this.name = pitch.midiToName[ps % 12];\n        this.octave = Math.floor(ps / 12) - 1;\n    }\n\n    /**\n     * @param {boolean} inPlace\n     * @param {Int} directionInt -- -1 = down, 1 = up\n     */\n    _getEnharmonicHelper(inPlace=false, directionInt) {\n        // differs from Python version because\n        // cannot import interval here.\n        let octaveStored = true;\n        if (this.octave === undefined) {\n            octaveStored = false;\n        }\n        const p = this.clone();\n        p.diatonicNoteNum += directionInt;\n        if (p.accidental === undefined) {\n            p.accidental = new Accidental(0);\n        }\n        while (p.ps % 12 !== this.ps % 12) { // octaveless\n            p.accidental.alter += -1 * directionInt;\n        }\n\n        if (!inPlace) {\n            return p;\n        }\n        this.step = p.step;\n        this.accidental = p.accidental;\n        if (p.microtone === undefined) {\n            this.microtone = p.microtone;\n        }\n        if (!octaveStored) {\n            this.octave = undefined;\n        } else {\n            this.octave = p.octave;\n        }\n        return p;\n    }\n\n    getHigherEnharmonic(inPlace=false) {\n        return this._getEnharmonicHelper(inPlace, 1);\n    }\n\n    getLowerEnharmonic(inPlace=false) {\n        return this._getEnharmonicHelper(inPlace, -1);\n    }\n    /* TODO: isEnharmonic, getEnharmonic, getAllCommonEnharmonics */\n\n    /**\n     * Returns the vexflow name for the pitch in the given clef.\n     *\n     * @memberof music21.pitch.Pitch#\n     * @param {clef.Clef} clefObj - the active {@link music21.clef.Clef} object\n     * @returns {String} - representation in vexflow\n     */\n    vexflowName(clefObj) {\n        // returns a vexflow Key name for this pitch.\n        let tempPitch = this;\n        if (clefObj !== undefined) {\n            try {\n                tempPitch = clefObj.convertPitchToTreble(this);\n            } catch (e) {\n                console.log(e, clefObj);\n            }\n        }\n        let accidentalType = 'n';\n        if (this.accidental !== undefined) {\n            accidentalType = this.accidental.vexflowModifier;\n        }\n        const outName\n            = tempPitch.step + accidentalType + '/' + tempPitch.octave;\n        return outName;\n    }\n}\npitch.Pitch = Pitch;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/interval -- Interval routines\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006-18, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { common } from './common.js';\nimport { debug } from './debug.js';\nimport { prebase } from './prebase.js';\nimport { pitch } from './pitch.js';\n\n/**\n * interval module. See {@link music21.interval} for namespace\n *\n * @exports music21/interval\n */\n/**\n * Interval related objects\n *\n * @namespace music21.interval\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/pitch\n */\nexport const interval = {};\n\n/**\n * Interval Directions as an Object/map\n *\n * @memberof music21.interval\n * @example\n * if (music21.interval.Direction.OBLIQUE >\n *     music21.interval.Direction.ASCENDING ) {\n *    console.log(music21.interval.Direction.DESCENDING);\n * }\n *\n */\ninterval.Direction = {\n    DESCENDING: -1,\n    OBLIQUE: 0,\n    ASCENDING: 1,\n};\n\n/**\n * N.B. a dict in music21p -- the indexes here let Direction call them + 1\n *\n * @memberof music21.interval\n * @example\n * console.log(music21.interval.IntervalDirectionTerms[music21l.interval.Direction.OBLIQUE + 1])\n * // \"Oblique\"\n */\ninterval.IntervalDirectionTerms = ['Descending', 'Oblique', 'Ascending'];\n\n/**\n * ordinals for music terms...\n *\n * @memberof music21.interval\n * @example\n * for (var i = 1; // N.B. 0 = undefined\n *      i < music21.interval.MusicOrdinals.length;\n *      i++) {\n *     console.log(i, music21.interval.MusicOrdinals[i]);\n * }\n * // 1, Unison\n * // 2, Second\n * // 3, Third\n * // ...\n * // 8, Octave\n * // ...\n * // 15, Double Octave\n */\ninterval.MusicOrdinals = [\n    undefined,\n    'Unison',\n    'Second',\n    'Third',\n    'Fourth',\n    'Fifth',\n    'Sixth',\n    'Seventh',\n    'Octave',\n    'Ninth',\n    'Tenth',\n    'Eleventh',\n    'Twelfth',\n    'Thirteenth',\n    'Fourteenth',\n    'Double Octave',\n];\n\n/**\n * Represents an interval such as unison, second, etc.\n *\n * Properties are demonstrated below.\n *\n * @class GenericInterval\n * @memberof music21.interval\n * @param {Int} [gi=1] - generic interval (1 or higher, or -2 or lower)\n * @example\n * var gi = new music21.interval.GenericInterval(-14)\n * gi.value\n * // -14\n * gi.directed\n * // -14\n * gi.undirected\n * // 14\n * gi.direction == music21.interval.Direction.DESCENDING\n * // true\n * gi.isSkip\n * // true\n * gi.isStep\n * // false\n * gi.isDiatonicStep\n * // false  // augmented unisons are not diatonicSteps but can't tell yet..\n * gi.isUnison\n * // false\n * gi.simpledDirected\n * // -7\n * gi.simpleUndirected\n * // 7\n * gi.undirectedOctaves\n * // 1\n * gi.semiSimpleUndirected\n * // 7  -- semiSimple distinguishes between 8 and 1; that's all\n * gi.semiSimpleDirected\n * // 7  -- semiSimple distinguishes between 8 and 1; that's all\n * gi.perfectable\n * // false\n * gi.niceName\n * // \"Fourteenth\"\n * gi.directedNiceName\n * // \"Descending Fourteenth\"\n * gi.simpleNiceName\n * // \"Seventh\"\n * gi.staffDistance\n * // -13\n * gi.mod7inversion\n * // 2  // sevenths invert to seconds\n *\n */\nexport class GenericInterval extends prebase.ProtoM21Object {\n    constructor(gi) {\n        super();\n        if (gi === undefined) {\n            gi = 1;\n        }\n        this.value = gi; // todo: convertGeneric() from python\n        this.directed = this.value;\n        this.undirected = Math.abs(this.value);\n\n        if (this.directed === 1) {\n            this.direction = interval.Direction.OBLIQUE;\n        } else if (this.directed < 0) {\n            this.direction = interval.Direction.DESCENDING;\n        } else if (this.directed > 1) {\n            this.direction = interval.Direction.ASCENDING;\n        }\n        // else (raise exception)\n\n        if (this.undirected > 2) {\n            this.isSkip = true;\n        } else {\n            this.isSkip = false;\n        }\n\n        if (this.undirected === 2) {\n            this.isDiatonicStep = true;\n        } else {\n            this.isDiatonicStep = false;\n        }\n\n        this.isStep = this.isDiatonicStep;\n\n        if (this.undirected === 1) {\n            this.isUnison = true;\n        } else {\n            this.isUnison = false;\n        }\n\n        let tempSteps = common.posMod(this.undirected, 7);\n        let tempOctaves = parseInt(this.undirected / 7);\n        if (tempSteps === 0) {\n            tempOctaves -= 1;\n            tempSteps = 7;\n        }\n        this.simpleUndirected = tempSteps;\n        this.undirectedOctaves = tempOctaves;\n        if (tempSteps === 1 && tempOctaves >= 1) {\n            this.semiSimpleUndirected = 8;\n        } else {\n            this.semiSimpleUndirected = this.simpleUndirected;\n        }\n\n        if (this.direction === interval.Direction.DESCENDING) {\n            this.octaves = -1 * tempOctaves;\n            if (tempSteps !== 1) {\n                this.simpleDirected = -1 * tempSteps;\n            } else {\n                this.simpleDirected = 1; // no descending unisons...\n            }\n            this.semiSimpleDirected = -1 * this.semiSimpleUndirected;\n        } else {\n            this.octaves = tempOctaves;\n            this.simpleDirected = tempSteps;\n            this.semiSimpleDirected = this.semiSimpleUndirected;\n        }\n        if (\n            this.simpleUndirected === 1\n            || this.simpleUndirected === 4\n            || this.simpleUndirected === 5\n        ) {\n            this.perfectable = true;\n        } else {\n            this.perfectable = false;\n        }\n\n        if (this.undirected < interval.MusicOrdinals.length) {\n            this.niceName = interval.MusicOrdinals[this.undirected];\n        } else {\n            this.niceName = this.undirected.toString();\n        }\n\n        this.simpleNiceName = interval.MusicOrdinals[this.simpleUndirected];\n        this.semiSimpleNiceName\n            = interval.MusicOrdinals[this.semiSimpleUndirected];\n\n        if (Math.abs(this.directed) === 1) {\n            this.staffDistance = 0;\n        } else if (this.directed > 1) {\n            this.staffDistance = this.directed - 1;\n        } else if (this.directed < -1) {\n            this.staffDistance = this.directed + 1;\n        }\n        // else: raise IntervalException(\"Non-integer, -1, or 0 not permitted as a diatonic interval\")\n\n        // 2 -> 7; 3 -> 6; 8 -> 1 etc.\n        this.mod7inversion = 9 - this.semiSimpleUndirected;\n\n        if (this.direction === interval.Direction.DESCENDING) {\n            this.mod7 = this.mod7inversion; // see chord.semitonesFromChordStep for usage...\n        } else {\n            this.mod7 = this.simpleDirected;\n        }\n    }\n\n    /**\n     * Returns a new GenericInterval which is the mod7inversion; 3rds (and 10ths etc.) to 6ths, etc.\n     *\n     * @memberof music21.interval.GenericInterval\n     * @returns {music21.interval.GenericInterval}\n     */\n    complement() {\n        return new interval.GenericInterval(this.mod7inversion);\n    }\n\n    /**\n     * Returns a new GenericInterval which has the opposite direction (descending becomes ascending, etc.)\n     *\n     * @memberof music21.interval.GenericInterval\n     * @returns {music21.interval.GenericInterval}\n     */\n    reverse() {\n        if (this.undirected === 1) {\n            return new interval.GenericInterval(1);\n        } else {\n            return new interval.GenericInterval(\n                this.undirected * (-1 * this.direction)\n            );\n        }\n    }\n    /**\n     * Given a specifier, return a new DiatonicInterval with this generic.\n     *\n     * @memberof music21.interval.GenericInterval\n     * @param {string|Int} specifier - a specifier such as \"P\",\"m\",\"M\",\"A\",\"dd\" etc.\n     * @returns {music21.interval.DiatonicInterval}\n     */\n    getDiatonic(specifier) {\n        return new interval.DiatonicInterval(specifier, this);\n    }\n\n    /**\n     * Transpose a pitch by this generic interval, maintaining accidentals\n     *\n     * @memberof music21.interval.GenericInterval\n     * @param {music21.pitch.Pitch} p\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        const pitch2 = new pitch.Pitch();\n        pitch2.step = p.step;\n        pitch2.octave = p.octave;\n\n        const oldDiatonicNum = p.diatonicNoteNum;\n\n        const distanceToMove = this.staffDistance;\n\n        // if not reverse...\n        const newDiatonicNumber = oldDiatonicNum + distanceToMove;\n        const [newStep, newOctave] = interval.convertDiatonicNumberToStep(\n            newDiatonicNumber\n        );\n        pitch2.step = newStep;\n        pitch2.octave = newOctave;\n        if (p.accidental !== undefined) {\n            pitch2.accidental = new pitch.Accidental(p.accidental.name);\n        }\n        return pitch2;\n    }\n}\ninterval.GenericInterval = GenericInterval;\n\ninterval.IntervalSpecifiersEnum = {\n    PERFECT: 1,\n    MAJOR: 2,\n    MINOR: 3,\n    AUGMENTED: 4,\n    DIMINISHED: 5,\n    DBLAUG: 6,\n    DBLDIM: 7,\n    TRPAUG: 8,\n    TRPDIM: 9,\n    QUADAUG: 10,\n    QUADDIM: 11,\n};\n\ninterval.IntervalNiceSpecNames = [\n    'ERROR',\n    'Perfect',\n    'Major',\n    'Minor',\n    'Augmented',\n    'Diminished',\n    'Doubly-Augmented',\n    'Doubly-Diminished',\n    'Triply-Augmented',\n    'Triply-Diminished',\n    'Quadruply-Augmented',\n    'Quadruply-Diminished',\n];\ninterval.IntervalPrefixSpecs = [\n    undefined,\n    'P',\n    'M',\n    'm',\n    'A',\n    'd',\n    'AA',\n    'dd',\n    'AAA',\n    'ddd',\n    'AAAA',\n    'dddd',\n];\n\ninterval.IntervalOrderedPerfSpecs = [\n    'dddd',\n    'ddd',\n    'dd',\n    'd',\n    'P',\n    'A',\n    'AA',\n    'AAA',\n    'AAAA',\n];\n\ninterval.IntervalPerfSpecifiers = [\n    interval.IntervalSpecifiersEnum.QUADDMIN,\n    interval.IntervalSpecifiersEnum.TRPDIM,\n    interval.IntervalSpecifiersEnum.DBLDIM,\n    interval.IntervalSpecifiersEnum.DIMINISHED,\n    interval.IntervalSpecifiersEnum.PERFECT,\n    interval.IntervalSpecifiersEnum.AUGMENTED,\n    interval.IntervalSpecifiersEnum.DBLAUG,\n    interval.IntervalSpecifiersEnum.TRPAUG,\n    interval.IntervalSpecifiersEnum.QUADAUG,\n];\ninterval.IntervalPerfOffset = 4;\n\ninterval.IntervalOrderedImperfSpecs = [\n    'dddd',\n    'ddd',\n    'dd',\n    'd',\n    'm',\n    'M',\n    'A',\n    'AA',\n    'AAA',\n    'AAAA',\n];\n\ninterval.IntervalSpecifiers = [\n    interval.IntervalSpecifiersEnum.QUADDMIN,\n    interval.IntervalSpecifiersEnum.TRPDIM,\n    interval.IntervalSpecifiersEnum.DBLDIM,\n    interval.IntervalSpecifiersEnum.DIMINISHED,\n    interval.IntervalSpecifiersEnum.MINOR,\n    interval.IntervalSpecifiersEnum.MAJOR,\n    interval.IntervalSpecifiersEnum.AUGMENTED,\n    interval.IntervalSpecifiersEnum.DBLAUG,\n    interval.IntervalSpecifiersEnum.TRPAUG,\n    interval.IntervalSpecifiersEnum.QUADAUG,\n];\ninterval.IntervalMajOffset = 5;\n\ninterval.IntervalSemitonesGeneric = {\n    1: 0,\n    2: 2,\n    3: 4,\n    4: 5,\n    5: 7,\n    6: 9,\n    7: 11,\n};\ninterval.IntervalAdjustPerfect = {\n    P: 0,\n    A: 1,\n    AA: 2,\n    AAA: 3,\n    AAAA: 4,\n    d: -1,\n    dd: -2,\n    ddd: -3,\n    dddd: -4,\n}; // offset from Perfect\n\ninterval.IntervalAdjustImperf = {\n    M: 0,\n    m: -1,\n    A: 1,\n    AA: 2,\n    AAA: 3,\n    AAAA: 4,\n    d: -2,\n    dd: -3,\n    ddd: -4,\n    dddd: -5,\n}; // offset from major\n\n/**\n * Represents a Diatonic interval.  See example for usage.\n *\n * @class DiatonicInterval\n * @memberof music21.interval\n * @param {string|Int|undefined} [specifier='P'] - a specifier such as \"P\", \"d\", \"m\", \"M\" etc.\n * @param {music21.interval.GenericInterval|Int} [generic=1] - a `GenericInterval` object or a number to be converted to one\n * @example\n * var di = new music21.interval.DiatonicInterval(\"M\", 10);\n * di.generic.isClassOrSubclass('GenericInterval');\n * // true\n * di.specifierAbbreviation;\n * // 'M'\n * di.name;\n * // 'M10'\n * di.direction == music21.interval.Direction.ASCENDING;\n * // true\n * di.niceName\n * // \"Major Tenth\"\n *\n * // See music21p for more possibilities.\n */\nexport class DiatonicInterval extends prebase.ProtoM21Object {\n    constructor(specifier, generic) {\n        super();\n\n        if (specifier === undefined) {\n            specifier = 'P';\n        }\n        if (generic === undefined) {\n            generic = new interval.GenericInterval(1);\n        } else if (typeof generic === 'number') {\n            generic = new interval.GenericInterval(generic);\n        }\n\n        this.name = '';\n        if (typeof specifier === 'number') {\n            this.specifier = specifier;\n        } else {\n            this.specifier = interval.IntervalPrefixSpecs.indexOf(specifier); // todo: convertSpecifier();\n        }\n        this.generic = generic;\n\n        if (\n            generic.undirected !== 1\n            || specifier === interval.IntervalSpecifiersEnum.PERFECT\n        ) {\n            this.direction = generic.direction;\n        } else if (\n            interval.IntervalPerfSpecifiers.indexOf(specifier)\n            <= interval.IntervalPerfSpecifiers.indexOf(\n                interval.IntervalSpecifiersEnum.DIMINISHED\n            )\n        ) {\n            // diminished unisons -- very controversial\n            this.direction = interval.Direction.DESCENDING;\n        } else {\n            this.direction = interval.Direction.ASCENDING;\n        }\n        const diatonicDirectionNiceName\n            = interval.IntervalDirectionTerms[this.direction + 1];\n        this.name\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.undirected.toString();\n        this.niceName\n            = interval.IntervalNiceSpecNames[this.specifier]\n            + ' '\n            + generic.niceName;\n        this.simpleName\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.simpleUndirected.toString();\n        this.simpleNiceName\n            = interval.IntervalNiceSpecNames[this.specifier]\n            + ' '\n            + generic.simpleNiceName;\n        this.semiSimpleName\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.semiSimpleUndirected.toString();\n        this.semiSimpleNiceName\n            = interval.IntervalNiceSpecNames[this.specifier]\n            + ' '\n            + generic.semiSimpleNiceName;\n        this.directedName\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.directed.toString();\n        this.directedNiceName = diatonicDirectionNiceName + ' ' + this.niceName;\n        this.directedSimpleName\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.simpleDirected.toString();\n        this.directedSimpleNiceName\n            = diatonicDirectionNiceName + ' ' + this.simpleNiceName;\n        this.directedSemiSimpleName\n            = interval.IntervalPrefixSpecs[this.specifier]\n            + generic.semiSimpleDirected.toString();\n        this.directedSemiSimpleNiceName\n            = diatonicDirectionNiceName + ' ' + this.semiSimpleNameName;\n        this.specificName = interval.IntervalNiceSpecNames[this.specifier];\n        this.perfectable = generic.perfectable;\n        this.isDiatonicStep = generic.isDiatonicStep;\n        this.isStep = generic.isStep;\n\n        // generate inversions\n        if (this.perfectable) {\n            this.orderedSpecifierIndex = interval.IntervalOrderedPerfSpecs.indexOf(\n                interval.IntervalPrefixSpecs[this.specifier]\n            );\n            this.invertedOrderedSpecIndex\n                = interval.IntervalOrderedPerfSpecs.length\n                - 1\n                - this.orderedSpecifierIndex;\n            this.invertedOrderedSpecifier\n                = interval.IntervalOrderedPerfSpecs[\n                    this.invertedOrderedSpecIndex\n                ];\n        } else {\n            this.orderedSpecifierIndex = interval.IntervalOrderedImperfSpecs.indexOf(\n                interval.IntervalPrefixSpecs[this.specifier]\n            );\n            this.invertedOrderedSpecIndex\n                = interval.IntervalOrderedImperfSpecs.length\n                - 1\n                - this.orderedSpecifierIndex;\n            this.invertedOrderedSpecifier\n                = interval.IntervalOrderedImperfSpecs[\n                    this.invertedOrderedSpecIndex\n                ];\n        }\n\n        this.mod7inversion\n            = this.invertedOrderedSpecifier + generic.mod7inversion.toString();\n        /* ( if (this.direction == interval.Direction.DESCENDING) {\n\t\t\tthis.mod7 = this.mod7inversion;\n\t\t} else {\n\t\t\tthis.mod7 = this.simpleName;\n\t\t} */\n\n        // TODO: reverse()\n        // TODO: property cents\n    }\n\n    /**\n     * Returns a ChromaticInterval object of the same size.\n     *\n     * @memberof music21.interval.DiatonicInterval\n     * @returns {music21.interval.ChromaticInterval}\n     */\n    getChromatic() {\n        const octaveOffset = Math.floor(\n            Math.abs(this.generic.staffDistance) / 7\n        );\n        const semitonesStart\n            = interval.IntervalSemitonesGeneric[this.generic.simpleUndirected];\n        const specName = interval.IntervalPrefixSpecs[this.specifier];\n\n        let semitonesAdjust = 0;\n        if (this.generic.perfectable) {\n            semitonesAdjust = interval.IntervalAdjustPerfect[specName];\n        } else {\n            semitonesAdjust = interval.IntervalAdjustImperf[specName];\n        }\n\n        let semitones = octaveOffset * 12 + semitonesStart + semitonesAdjust;\n\n        // direction should be same as original\n\n        if (this.generic.direction === interval.Direction.DESCENDING) {\n            semitones *= -1;\n        }\n        if (debug) {\n            console.log(\n                'DiatonicInterval.getChromatic -- octaveOffset: ' + octaveOffset\n            );\n            console.log(\n                'DiatonicInterval.getChromatic -- semitonesStart: '\n                    + semitonesStart\n            );\n            console.log(\n                'DiatonicInterval.getChromatic -- specName: ' + specName\n            );\n            console.log(\n                'DiatonicInterval.getChromatic -- semitonesAdjust: '\n                    + semitonesAdjust\n            );\n            console.log(\n                'DiatonicInterval.getChromatic -- semitones: ' + semitones\n            );\n        }\n        return new interval.ChromaticInterval(semitones);\n    }\n\n    transposePitch(p) {\n        const fullIntervalObject = new Interval(this, this.getChromatic());\n        return fullIntervalObject.transposePitch(p);\n    }\n\n    get specifierAbbreviation() {\n        return interval.IntervalPrefixSpecs[this.specifier];\n    }\n\n    get cents() {\n        return this.getChromatic().cents;\n    }\n}\ninterval.DiatonicInterval = DiatonicInterval;\n\n/**\n * @class ChromaticInterval\n * @memberof music21.interval\n * @param {number} value - number of semitones (positive or negative)\n * @property {number} cents\n * @property {number} value\n * @property {number} undirected - absolute value of value\n * @property {number} mod12 - reduction to one octave\n * @property {number} intervalClass - reduction to within a tritone (11 = 1, etc.)\n *\n */\nexport class ChromaticInterval extends prebase.ProtoM21Object {\n    constructor(value) {\n        super();\n\n        this.semitones = value;\n        this.cents = Math.round(value * 100.0, 5);\n        this.directed = value;\n        this.undirected = Math.abs(value);\n\n        if (this.directed === 0) {\n            this.direction = interval.Direction.OBLIQUE;\n        } else if (this.directed === this.undirected) {\n            this.direction = interval.Direction.ASCENDING;\n        } else {\n            this.direction = interval.Direction.DESCENDING;\n        }\n\n        this.mod12 = common.posMod(this.semitones, 12);\n        this.simpleUndirected = common.posMod(this.undirected, 12);\n        if (this.direction === interval.Direction.DESCENDING) {\n            this.simpleDirected = -1 * this.simpleUndirected;\n        } else {\n            this.simpleDirected = this.simpleUndirected;\n        }\n\n        this.intervalClass = this.mod12;\n        if (this.mod12 > 6) {\n            this.intervalClass = 12 - this.mod12;\n        }\n\n        if (this.undirected === 1) {\n            this.isChromaticStep = true;\n        } else {\n            this.isChromaticStep = false;\n        }\n    }\n    reverse() {\n        return new interval.ChromaticInterval(\n            this.undirected * (-1 * this.direction)\n        );\n    }\n\n    //  TODO: this.getDiatonic()\n\n    /**\n     * Transposes pitches but does not maintain accidentals, etc.\n     *\n     * @memberof music21.interval.ChromaticInterval\n     * @property {music21.pitch.Pitch} p - pitch to transpose\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        let useImplicitOctave = false;\n        if (p.octave === undefined) {\n            // not yet implemented in m21j\n            useImplicitOctave = true;\n        }\n        const pps = p.ps;\n        const newPitch = new pitch.Pitch();\n        newPitch.ps = pps + this.semitones;\n        if (useImplicitOctave) {\n            newPitch.octave = undefined;\n        }\n        return newPitch;\n    }\n}\ninterval.ChromaticInterval = ChromaticInterval;\n\ninterval.IntervalStepNames = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\n\n/**\n * @function music21.interval.convertDiatonicNumberToStep\n * @memberof music21.interval\n * @param {Int} dn - diatonic number, where 29 = C4, C#4 etc.\n * @returns {Array} two element array of {string} stepName and {Int} octave\n */\ninterval.convertDiatonicNumberToStep = function convertDiatonicNumberToStep(\n    dn\n) {\n    let stepNumber;\n    let octave;\n    if (dn === 0) {\n        return ['B', -1];\n    } else if (dn > 0) {\n        octave = Math.floor((dn - 1) / 7);\n        stepNumber = dn - 1 - octave * 7;\n    } else {\n        // low notes... test, because js(floor) != py(int);\n        octave = Math.floor(dn / 7);\n        stepNumber = dn - 1 - (octave + 1) * 7;\n    }\n    const stepName = interval.IntervalStepNames[stepNumber];\n    return [stepName, octave];\n};\n\n/**\n * This is the main, powerful Interval class.\n *\n * Instantiate with either a string (\"M3\") or two {@link music21.pitch.Pitch} or two {@link music21.note.Note}\n *\n * See music21p instructions for usage.\n *\n * @class Interval\n * @memberof music21.interval\n * @example\n * var n1 = new music21.note.Note(\"C4\");\n * var n2 = new music21.note.Note(\"F#5\");\n * var iv = new music21.interval.Interval(n1, n2);\n * iv.isConsonant();\n * // false\n * iv.semitones;\n * // 18\n * iv.niceName\n * // \"Augmented Eleventh\"\n */\nexport class Interval extends prebase.ProtoM21Object {\n    constructor(...restArgs) {\n        super();\n        // todo: allow full range of ways of specifying as in m21p\n        if (restArgs.length === 1) {\n            const arg0 = restArgs[0];\n            if (typeof arg0 === 'string') {\n                // simple...\n                const specifier = arg0.replace(/\\d+/, '').replace(/-/, '');\n                let generic = parseInt(arg0.replace(/\\D+/, ''));\n                if (arg0.includes('-')) {\n                    generic *= -1;\n                }\n                const gI = new interval.GenericInterval(generic);\n                const dI = new interval.DiatonicInterval(specifier, gI);\n                this.diatonic = dI;\n                this.chromatic = this.diatonic.getChromatic();\n            } else if (arg0.specifier !== undefined) {\n                // assume diatonic...\n                this.diatonic = arg0;\n                this.chromatic = this.diatonic.getChromatic();\n            } else {\n                console.error('cant parse string arguments to Interval yet');\n            }\n        } else if (restArgs.length === 2) {\n            if (\n                restArgs[0].pitch === undefined\n                && restArgs[0].diatonicNoteNum === undefined\n            ) {\n                this.diatonic = restArgs[0];\n                this.chromatic = restArgs[1];\n            } else {\n                const n1 = restArgs[0];\n                const n2 = restArgs[1];\n                const gInt = interval.notesToGeneric(n1, n2);\n                const cInt = interval.notesToChromatic(n1, n2);\n\n                this.diatonic = interval.intervalsToDiatonic(gInt, cInt);\n                this.chromatic = cInt;\n            }\n        }\n        this.reinit();\n    }\n    get complement() {\n        return new interval.Interval(this.diatonic.mod7inversion);\n    }\n    reinit() {\n        this.direction = this.chromatic.direction;\n        this.specifier = this.diatonic.specifier;\n        this.diatonicType = this.diatonic.specifier;\n        // this.specificName = this.diatonic.specificName;\n        this.generic = this.diatonic.generic;\n\n        this.name = this.diatonic.name;\n        this.niceName = this.diatonic.niceName;\n        this.simpleName = this.diatonic.simpleName;\n        this.simpleNiceName = this.diatonic.simpleNiceName;\n        this.semiSimpleName = this.diatonic.semiSimpleName;\n        this.semiSimpleNiceName = this.diatonic.semiSimpleNiceName;\n\n        this.directedName = this.diatonic.directedName;\n        this.directedNiceName = this.diatonic.directedNiceName;\n        this.directedSimpleName = this.diatonic.directedSimpleName;\n        this.directedSimpleNiceName = this.diatonic.directedSimpleNiceName;\n\n        // other names...\n        this.isDiatonicStep = this.diatonic.isDiatonicStep;\n\n        this.isChromaticStep = this.chromatic.isChromaticStep;\n        this.semitones = this.chromatic.semitones;\n        this.intervalClass = this.chromatic.intervalClass;\n        this.cents = this.chromatic.cents;\n        this.isStep = this.isChromaticStep || this.isDiatonicStep;\n    }\n\n    /**\n     * @memberof music21.interval.Interval\n     * @returns {Boolean}\n     */\n    isConsonant() {\n        const sn = this.simpleName;\n        const consonantNames = ['P5', 'm3', 'M3', 'm6', 'M6', 'P1'];\n        if (consonantNames.indexOf(sn) !== -1) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    //  todo general: microtones\n    /**\n     * @memberof music21.interval.Interval\n     * @param {music21.pitch.Pitch} p - pitch to transpose\n     * @returns {music21.pitch.Pitch}\n     */\n    transposePitch(p) {\n        // todo: reverse, clearAccidentalDisplay, maxAccidental;\n\n        /*\n        var useImplicitOctave = false;\n        if (p.octave === undefined) {\n            useImplicitOctave = true;\n        }\n         */\n        const pitch2 = this.diatonic.generic.transposePitch(p);\n        pitch2.accidental = undefined;\n        // step and octave are right now, but not necessarily accidental\n        const halfStepsToFix\n            = this.chromatic.semitones - parseInt(pitch2.ps - p.ps);\n        if (halfStepsToFix !== 0) {\n            pitch2.accidental = new pitch.Accidental(halfStepsToFix);\n        }\n        if (debug) {\n            console.log('Interval.transposePitch -- new step ' + pitch2.step);\n            console.log(\n                'Interval.transposePitch -- new octave ' + pitch2.octave\n            );\n            console.log(\n                'Interval.transposePitch -- fixing halfsteps for '\n                    + halfStepsToFix\n            );\n        }\n        return pitch2;\n    }\n}\ninterval.Interval = Interval;\n\ninterval.intervalFromGenericAndChromatic = function intervalFromGenericAndChromatic(\n    gInt,\n    cInt\n) {\n    if (typeof gInt === 'number') {\n        gInt = new GenericInterval(gInt);\n    }\n    if (typeof cInt === 'number') {\n        cInt = new ChromaticInterval(cInt);\n    }\n    const specifier = interval._getSpecifierFromGenericChromatic(gInt, cInt);\n    const dInt = new DiatonicInterval(specifier, gInt);\n    return new Interval(dInt, cInt);\n};\n/**\n * Convert two notes or pitches to a GenericInterval;\n */\ninterval.notesToGeneric = function notesToGeneric(n1, n2) {\n    let p1 = n1;\n    if (n1.pitch !== undefined) {\n        p1 = n1.pitch;\n    }\n    let p2 = n2;\n    if (n2.pitch !== undefined) {\n        p2 = n2.pitch;\n    }\n    const staffDist = p2.diatonicNoteNum - p1.diatonicNoteNum;\n    const genDist = interval.convertStaffDistanceToInterval(staffDist);\n    return new interval.GenericInterval(genDist);\n};\n\ninterval.convertStaffDistanceToInterval = function convertStaffDistanceToInterval(\n    staffDist\n) {\n    if (staffDist === 0) {\n        return 1;\n    } else if (staffDist > 0) {\n        return staffDist + 1;\n    } else {\n        return staffDist - 1;\n    }\n};\n\ninterval.notesToChromatic = function notesToChromatic(n1, n2) {\n    let p1 = n1;\n    if (n1.pitch !== undefined) {\n        p1 = n1.pitch;\n    }\n    let p2 = n2;\n    if (n2.pitch !== undefined) {\n        p2 = n2.pitch;\n    }\n    return new interval.ChromaticInterval(p2.ps - p1.ps);\n};\n\ninterval.intervalsToDiatonic = function intervalsToDiatonic(gInt, cInt) {\n    const specifier = interval._getSpecifierFromGenericChromatic(gInt, cInt);\n    // todo -- convert specifier...\n    return new interval.DiatonicInterval(specifier, gInt);\n};\n\ninterval._getSpecifierFromGenericChromatic = function _getSpecifierFromGenericChromatic(\n    gInt,\n    cInt\n) {\n    const noteVals = [undefined, 0, 2, 4, 5, 7, 9, 11];\n    const normalSemis\n        = noteVals[gInt.simpleUndirected] + 12 * gInt.undirectedOctaves;\n    let theseSemis = 0;\n    if (\n        gInt.direction !== cInt.direction\n        && gInt.direction !== interval.Direction.OBLIQUE\n        && cInt.direction !== interval.Direction.OBLIQUE\n    ) {\n        // intervals like d2 and dd2 etc. (the last test doesn't matter, since -1*0 === 0, but in theory it should be there)\n        theseSemis = -1 * cInt.undirected;\n    } else if (gInt.undirected === 1) {\n        theseSemis = cInt.directed; // matters for unison\n    } else {\n        // all normal intervals\n        theseSemis = cInt.undirected;\n    }\n    const semisRounded = Math.round(theseSemis);\n    let specifier = '';\n    if (gInt.perfectable) {\n        specifier\n            = interval.IntervalPerfSpecifiers[\n                interval.IntervalPerfOffset + semisRounded - normalSemis\n            ];\n    } else {\n        specifier\n            = interval.IntervalSpecifiers[\n                interval.IntervalMajOffset + semisRounded - normalSemis\n            ];\n    }\n    return specifier;\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/note -- Note, Rest, NotRest, GeneralNote\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as MIDI from 'MIDI';\nimport * as Vex from 'vexflow';\n\nimport { prebase } from './prebase.js';\nimport { base } from './base.js';\nimport { debug } from './debug.js';\nimport { pitch } from './pitch.js';\nimport { beam } from './beam.js';\nimport { common } from './common.js';\n\n/**\n * Module for note classes. See the namespace {@link music21.note}\n *\n * @requires music21/common\n * @requires music21/prebase\n * @requires music21/base\n * @requires music21/pitch\n * @requires music21/beam\n * @exports music21/note\n */\n/**\n * Namespace for notes (single pitch) or rests, and some things like Lyrics that go on notes.\n *\n * @namespace music21.note\n * @memberof music21\n * @property {Array} noteheadTypeNames - an Array of allowable notehead names.\n * @property {Array} stemDirectionNames - an Array of allowable stemDirection names.\n */\nexport const note = {};\n\nnote.noteheadTypeNames = [\n    'arrow down',\n    'arrow up',\n    'back slashed',\n    'circle dot',\n    'circle-x',\n    'circled',\n    'cluster',\n    'cross',\n    'diamond',\n    'do',\n    'fa',\n    'inverted triangle',\n    'la',\n    'left triangle',\n    'mi',\n    'none',\n    'normal',\n    'other',\n    're',\n    'rectangle',\n    'slash',\n    'slashed',\n    'so',\n    'square',\n    'ti',\n    'triangle',\n    'x',\n];\n\nnote.stemDirectionNames = [\n    'double',\n    'down',\n    'noStem',\n    'none',\n    'unspecified',\n    'up',\n];\n\n/**\n * Class for a single Lyric attached to a {@link music21.note.GeneralNote}\n *\n * @class Lyric\n * @memberOf music21.note\n * @extends music21.prebase.ProtoM21Object\n * @param {string} text - the text of the lyric\n * @param {number} number=1 - the lyric number\n * @param {string} syllabic=undefined - placement of the syllable ('begin', 'middle', 'end', 'single'); undefined = interpret from text\n * @param {boolean} applyRaw=false - true = display the text exactly as it is or, false = use \"-\" etc. to determine syllabic\n * @param {string} identifier=undefined - identifier for the lyric.\n * @property {string} lyricConnector='-' - what to place between two lyrics that are syllabic.\n * @property {string} text - the text of the lyric syllable.\n * @property {string} syllabic - see above\n * @property {boolean} applyRaw - see above\n * @property {string} identifier - see above; gets .number if undefined\n * @property {number} number - see above\n * @property {string} rawText - text + any connectors\n */\nexport class Lyric extends prebase.ProtoM21Object {\n    constructor(text, number = 1, syllabic, applyRaw, identifier) {\n        super();\n        this.lyricConnector = '-'; // override to place something else between two notes...\n        this.text = text;\n        this._number = number;\n        this.syllabic = syllabic;\n        this.applyRaw = applyRaw || false;\n        this.setTextAndSyllabic(this.text, this.applyRaw);\n        this._identifier = identifier;\n        this.style = {\n            fillStyle: 'black',\n            strokeStyle: 'black',\n            fontFamily: 'Serif',\n            fontSize: 12,\n            fontWeight: '',\n        };\n    }\n    get identifier() {\n        return this._identifier || this._number;\n    }\n    set identifier(i) {\n        this._identifier = i;\n    }\n    // a property just to match m21p\n    get number() {\n        return this._number;\n    }\n    set number(n) {\n        this._number = n;\n    }\n\n    /**\n     * get rawText - gets the raw text.\n     *\n     * @return {string}  raw text\n     */\n    get rawText() {\n        if (this.syllabic === 'begin') {\n            return this.text + this.lyricConnector;\n        } else if (this.syllabic === 'middle') {\n            return this.lyricConnector + this.text + this.lyricConnector;\n        } else if (this.syllabic === 'end') {\n            return this.lyricConnector + this.text;\n        } else {\n            return this.text;\n        }\n    }\n    set rawText(t) {\n        this.setTextAndSyllabic(t, true);\n    }\n\n    /**\n     * setTextAndSyllabic - Given a setting for rawText and applyRaw,\n     *     sets the syllabic type for a lyric based on the rawText\n     *\n     * @param  {string} rawText text\n     * @param  {boolean} applyRaw = false if hyphens should not be applied\n     * @return {undefined}\n     */\n    setTextAndSyllabic(rawText, applyRaw = false) {\n        if (rawText === undefined) {\n            this.text = undefined;\n            return this;\n        }\n\n        if (\n            !applyRaw\n            && rawText.indexOf(this.lyricConnector) === 0\n            && rawText.slice(-1) === this.lyricConnector\n        ) {\n            this.text = rawText.slice(1, -1);\n            this.syllabic = 'middle';\n        } else if (!applyRaw && rawText.indexOf(this.lyricConnector) === 0) {\n            this.text = rawText.slice(1);\n            this.syllabic = 'end';\n        } else if (!applyRaw && rawText.slice(-1) === this.lyricConnector) {\n            this.text = rawText.slice(0, -1);\n            this.syllabic = 'begin';\n        } else {\n            this.text = rawText;\n            if (this.syllabic === undefined) {\n                this.syllabic = 'single';\n            }\n        }\n        return this;\n    }\n}\nnote.Lyric = Lyric;\n\n/* Notes and rests etc... */\n\n/**\n * Superclass for all Note values\n *\n * @class GeneralNote\n * @memberof music21.note\n * @extends music21.base.Music21Object\n * @param {(number|undefined)} [ql=1.0] - quarterLength of the note\n * @property {boolean} [isChord=false] - is this a chord\n * @property {number} quarterLength - shortcut to `.duration.quarterLength`\n * @property {object} activeVexflowNote - most recent Vex.Flow.StaveNote object to be made from this note (could change); default, undefined\n * @property {Array<music21.expressions.Expression>} expressions - array of attached expressions\n * @property {Array<music21.articulations.Articulation>} articulations - array of attached articulations\n * @property {string} lyric - the text of the first {@link music21.note.Lyric} object; can also set one.\n * @property {Array<music21.note.Lyric>} lyrics - array of attached lyrics\n * @property {number} [volume=60] - how loud is this note, 0-127, before articulations\n * @property {number} midiVolume - how loud is this note, taking into account articulations\n * @property {music21.note.Tie|undefined} [tie=undefined] - a tie object\n */\nexport class GeneralNote extends base.Music21Object {\n    constructor(ql) {\n        super();\n        this.isChord = false;\n        if (ql !== undefined) {\n            this.duration.quarterLength = ql;\n        } else {\n            this.duration.quarterLength = 1.0;\n        }\n        this.volume = 60;\n        this.activeVexflowNote = undefined;\n        this.expressions = [];\n        this.articulations = [];\n        this.lyrics = [];\n        this.tie = undefined;\n        /* TODO: editorial objects, color, addLyric, insertLyric, hasLyrics */\n        /* Later: augmentOrDiminish, getGrace, */\n    }\n    get lyric() {\n        if (this.lyrics.length > 0) {\n            return this.lyrics[0].text;\n        } else {\n            return undefined;\n        }\n    }\n    set lyric(value) {\n        this.lyrics = [];\n        if (value !== undefined && value !== false) {\n            this.lyrics.push(new note.Lyric(value));\n        }\n    }\n    get midiVolume() {\n        let volume = this.volume;\n        if (volume === undefined) {\n            volume = 60;\n        }\n        if (this.articulations !== undefined) {\n            this.articulations.forEach(a => {\n                volume *= a.dynamicScale;\n                if (volume > 127) {\n                    volume = 127;\n                } else if (isNaN(volume)) {\n                    volume = 60;\n                }\n            });\n        }\n        volume = Math.floor(volume);\n        return volume;\n    }\n    /**\n     * Add a {@link music21.note.Lyric} object to the Note\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {string} text - text to be added\n     * @param {number} [lyricNumber] - integer specifying lyric (defaults to the current `.lyrics.length` + 1)\n     * @param {boolean} [applyRaw=false] - if `true`, do not parse the text for cluses about syllable placement.\n     * @param {string} [lyricIdentifier] - an optional identifier\n     */\n    addLyric(text, lyricNumber, applyRaw = false, lyricIdentifier) {\n        if (lyricNumber === undefined) {\n            const maxLyrics = this.lyrics.length + 1;\n            const newLyric = new note.Lyric(\n                text,\n                maxLyrics,\n                undefined,\n                applyRaw,\n                lyricIdentifier\n            );\n            this.lyrics.push(newLyric);\n        } else {\n            let foundLyric = false;\n            for (let i = 0; i < this.lyrics.length; i++) {\n                const thisLyric = this.lyrics[i];\n                if (thisLyric.number === lyricNumber) {\n                    thisLyric.text = text;\n                    foundLyric = true;\n                    break;\n                }\n            }\n            if (foundLyric === false) {\n                const newLyric = new note.Lyric(\n                    text,\n                    lyricNumber,\n                    undefined,\n                    applyRaw,\n                    lyricIdentifier\n                );\n                this.lyrics.push(newLyric);\n            }\n        }\n    }\n    /**\n     * Change stem direction according to clef. Does nothing for GeneralNote; overridden in subclasses.\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {music21.clef.Clef} [clef] - clef to set the stem direction of.\n     * @returns {undefined}\n     */\n    setStemDirectionFromClef(clef) {\n        return undefined;\n    }\n    /**\n     * Sets the vexflow accidentals (if any), the dots, and the stem direction\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {Vex.Flow.StaveNote} vfn - a Vex.Flow note\n     * @param {object\n     */\n    vexflowAccidentalsAndDisplay(vfn, options) {\n        if (this.duration.dots > 0) {\n            for (let i = 0; i < this.duration.dots; i++) {\n                vfn.addDotToAll();\n            }\n        }\n        if (debug) {\n            console.log(this.stemDirection);\n        }\n        if (this.stemDirection === 'noStem') {\n            vfn.hasStem = () => false; // need to override...\n            // vfn.render_options.stem_height = 0;\n        } else {\n            // correct VexFlow stem length for notes far from the center line;\n            let staveDNNSpacing = 5;\n            if (options.stave) {\n                staveDNNSpacing = Math.floor(\n                    options.stave.options.spacing_between_lines_px / 2\n                );\n            }\n            if (options.clef !== undefined && this.pitch !== undefined) {\n                const midLine = options.clef.lowestLine + 4;\n                // console.log(midLine);\n                const absDNNfromCenter = Math.abs(\n                    this.pitch.diatonicNoteNum - midLine\n                );\n                const absOverOctave = absDNNfromCenter - 7;\n                // console.log(absOverOctave);\n                if (absOverOctave > 0 && vfn.getStemLength !== undefined) {\n                    const stemHeight\n                        = absOverOctave * staveDNNSpacing + vfn.getStemLength();\n                    vfn.setStemLength(stemHeight);\n                }\n            }\n        }\n    }\n    /**\n     * Play the current element as a MIDI note.\n     *\n     * @memberof music21.note.GeneralNote\n     * @param {number} [tempo=120] - tempo in bpm\n     * @param {(base.Music21Object)} [nextElement] - for determining the length to play in case of tied notes, etc.\n     * @param {object} [options] - other options (currently just `{instrument: {@link music21.instrument.Instrument} }`)\n     * @returns {Number} - delay time in milliseconds until the next element (may be ignored)\n     */\n    playMidi(tempo = 120, nextElement, options) {\n        // returns the number of milliseconds to the next element in\n        // case that can't be determined otherwise.\n        if (options === undefined) {\n            let inst;\n            if (this.activeSite !== undefined) {\n                inst = this.activeSite.instrument;\n            }\n            options = { instrument: inst };\n        }\n\n        const volume = this.midiVolume;\n        let channel = 0;\n        if (options !== undefined && options.instrument !== undefined) {\n            channel = options.instrument.midiChannel;\n        }\n        let milliseconds = 60 * 1000 / tempo;\n        const ql = this.duration.quarterLength;\n        milliseconds = 60 * ql * 1000 / tempo;\n        let midNum;\n        if (this.isClassOrSubclass('Note')) {\n            // Note, not rest\n            midNum = this.pitch.midi;\n            let stopTime = milliseconds / 1000;\n            if (\n                nextElement !== undefined\n                && nextElement.isClassOrSubclass('Note')\n            ) {\n                if (nextElement.pitch.midi !== this.pitch.midi) {\n                    stopTime += 60 * 0.25 / tempo; // legato -- play 16th note longer\n                } else if (\n                    this.tie !== undefined\n                    && (this.tie.type === 'start' || this.tie.type === 'continue')\n                ) {\n                    stopTime += 60 * nextElement.duration.quarterLength / tempo;\n                    // this does not take into account 3 or more notes tied.\n                    // TODO: look ahead at next nexts, etc.\n                }\n            } else if (nextElement === undefined) {\n                // let last note ring an extra beat...\n                stopTime += 60 * 1 / tempo;\n            }\n            // console.log(stopTime);\n            // console.log(this.tie);\n            if (this.tie === undefined || this.tie.type === 'start') {\n                // console.log(volume);\n                MIDI.noteOn(channel, midNum, volume, 0);\n                MIDI.noteOff(channel, midNum, stopTime);\n            } // else { console.log ('not going to play ', this.nameWithOctave); }\n        } else if (this.isClassOrSubclass('Chord')) {\n            // TODO: Tied Chords.\n            for (let j = 0; j < this._notes.length; j++) {\n                midNum = this._notes[j].pitch.midi;\n                MIDI.noteOn(channel, midNum, volume, 0);\n                MIDI.noteOff(channel, midNum, milliseconds / 1000);\n            }\n        } // it's a note.Rest -- do nothing -- milliseconds takes care of it...\n        return milliseconds;\n    }\n}\nnote.GeneralNote = GeneralNote;\n\n/**\n * Specifies that a GeneralNote is not a rest (Unpitched, Note, Chord).\n *\n * @class NotRest\n * @memberof music21.note\n * @extends music21.note.GeneralNote\n * @param {number} [ql=1.0] - length in quarter notes\n * @property {music21.beam.Beams} beams - a link to a beam object\n * @property {string} [notehead='normal'] - notehead type\n * @property {string} [noteheadFill='default'] - notehead fill (to be moved to style...)\n * @property {string|undefined} [noteheadColor=undefined] - notehead color\n * @property {boolean} [noteheadParenthesis=false] - put a parenthesis around the notehead?\n * @property {string|undefined} [stemDirection=undefined] - One of ['up','down','noStem', undefined] -- 'double' not supported\n */\nexport class NotRest extends GeneralNote {\n    constructor(ql) {\n        super(ql);\n        this.notehead = 'normal';\n        this.noteheadFill = 'default';\n        this.noteheadColor = 'black';\n        this.noteheadParenthesis = false;\n        this.volume = undefined; // not a real object yet.\n        this.beams = new beam.Beams();\n        /* TODO: this.duration.linkage -- need durationUnits */\n        this.stemDirection = undefined;\n        /* TODO: check stemDirection, notehead, noteheadFill, noteheadParentheses */\n    }\n}\nnote.NotRest = NotRest;\n\n/* ------- Note ----------- */\n/**\n * A very, very important class! music21.note.Note objects combine a {@link music21.pitch.Pitch}\n * object to describe pitch (highness/lowness) with a {@link music21.duration.Duration} object\n * that defines length, with additional features for drawing the Note, playing it back, etc.\n *\n * Together with {@link music21.stream.Stream} one of the two most important\n * classes in `music21`.\n *\n * See {@link music21.note.NotRest}, {@link music21.note.GeneralNote}, {@link music21.base.Music21Object}\n * and {@link music21.prebase.ProtoM21Object} (or in general, the **extends** list below) for other\n * things you can do with a `Note` object.\n *\n * Missing from music21p: `microtone, pitchClass, pitchClassString, transpose(), fullName`.\n *\n * @class Note\n * @memberof music21.note\n * @extends music21.note.NotRest\n * @param {(string|music21.pitch.Pitch|undefined)} [nn='C4'] - pitch name (\"C\", \"D#\", \"E-\") w/ or w/o octave (\"C#4\"), or a pitch.Pitch object\n * @param {(number|undefined)} [ql=1.0] - length in quarter notes\n * @property {Boolean} [isNote=true] - is it a Note? Yes!\n * @property {Boolean} [isRest=false] - is it a Rest? No!\n * @property {music21.pitch.Pitch} pitch - the {@link music21.pitch.Pitch} associated with the Note.\n * @property {string} name - shortcut to `.pitch.name`\n * @property {string} nameWithOctave - shortcut to `.pitch.nameWithOctave`\n * @property {string} step - shortcut to `.pitch.step`\n * @property {number} octave - shortcut to `.pitch.octave`\n */\nexport class Note extends NotRest {\n    constructor(nn, ql) {\n        super(ql);\n        this.isNote = true; // for speed\n        this.isRest = false; // for speed\n        if (\n            nn !== undefined\n            && nn.isClassOrSubclass !== undefined\n            && nn.isClassOrSubclass('Pitch') === true\n        ) {\n            this.pitch = nn;\n        } else {\n            this.pitch = new pitch.Pitch(nn);\n        }\n    }\n    get name() {\n        return this.pitch.name;\n    }\n    set name(nn) {\n        this.pitch.name = nn;\n    }\n    get nameWithOctave() {\n        return this.pitch.nameWithOctave;\n    }\n    set nameWithOctave(nn) {\n        this.pitch.nameWithOctave = nn;\n    }\n    get step() {\n        return this.pitch.step;\n    }\n    set step(nn) {\n        this.pitch.step = nn;\n    }\n    // no Frequency\n    get octave() {\n        return this.pitch.octave;\n    }\n    set octave(nn) {\n        this.pitch.octave = nn;\n    }\n    /* TODO: transpose, fullName, microtone, pitchclass, pitchClassString */\n    /**\n     * Change stem direction according to clef.\n     *\n     * @memberof music21.note.Note\n     * @param {music21.clef.Clef} [clef] - clef to set the stem direction of.\n     * @returns {music21.note.Note} Original object, for chaining methods\n     */\n    setStemDirectionFromClef(clef) {\n        if (clef === undefined) {\n            return this;\n        } else {\n            const midLine = clef.lowestLine + 4;\n            const DNNfromCenter = this.pitch.diatonicNoteNum - midLine;\n            // console.log(DNNfromCenter, this.pitch.nameWithOctave);\n            if (DNNfromCenter >= 0) {\n                this.stemDirection = 'down';\n            } else {\n                this.stemDirection = 'up';\n            }\n            return this;\n        }\n    }\n    /**\n     * Returns a `Vex.Flow.StaveNote` that approximates this note.\n     *\n     * @memberof music21.note.Note\n     * @param {object} [options={}] - `{clef: {@link music21.clef.Clef} }`\n     * clef to set the stem direction of.\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        const params = {};\n        common.merge(params, options);\n        const clef = params.clef;\n\n        // fixup stem direction -- must happen before Vex.Flow.Note is created...\n        if (\n            this.activeSite !== undefined\n            && this.activeSite.renderOptions.stemDirection !== undefined\n            && note.stemDirectionNames.includes(\n                this.activeSite.renderOptions.stemDirection\n            )\n        ) {\n            this.stemDirection = this.activeSite.renderOptions.stemDirection;\n        } else if (\n            this.stemDirection === undefined\n            && options.clef !== undefined\n        ) {\n            this.setStemDirectionFromClef(options.clef);\n        }\n\n        if (this.duration === undefined) {\n            // console.log(this);\n            return undefined;\n        }\n        const vfd = this.duration.vexflowDuration;\n        if (vfd === undefined) {\n            return undefined;\n        }\n        const vexflowKey = this.pitch.vexflowName(clef);\n\n        const vfnStemDirection\n            = this.stemDirection === 'down'\n                ? Vex.Flow.StaveNote.STEM_DOWN\n                : Vex.Flow.StaveNote.STEM_UP;\n\n        //        const vfnStemDirection = -1;\n        const vfn = new Vex.Flow.StaveNote({\n            keys: [vexflowKey],\n            duration: vfd,\n            stem_direction: vfnStemDirection,\n        });\n        this.vexflowAccidentalsAndDisplay(vfn, params); // clean up stuff...\n        if (this.pitch.accidental !== undefined) {\n            if (\n                this.pitch.accidental.vexflowModifier !== 'n'\n                && this.pitch.accidental.displayStatus !== false\n            ) {\n                vfn.addAccidental(\n                    0,\n                    new Vex.Flow.Accidental(\n                        this.pitch.accidental.vexflowModifier\n                    )\n                );\n            } else if (\n                this.pitch.accidental.displayType === 'always'\n                || this.pitch.accidental.displayStatus === true\n            ) {\n                vfn.addAccidental(\n                    0,\n                    new Vex.Flow.Accidental(\n                        this.pitch.accidental.vexflowModifier\n                    )\n                );\n            }\n        }\n\n        if (this.articulations[0] !== undefined) {\n            for (let i = 0; i < this.articulations.length; i++) {\n                const art = this.articulations[i];\n                // 0 refers to the first pitch (for chords etc.)...\n                vfn.addArticulation(0, art.vexflow());\n            }\n        }\n        if (this.expressions[0] !== undefined) {\n            for (let j = 0; j < this.expressions.length; j++) {\n                const exp = this.expressions[j];\n                // 0 refers to the first pitch (for chords etc.)...\n                vfn.addArticulation(0, exp.vexflow());\n            }\n        }\n        if (this.noteheadColor !== undefined) {\n            vfn.setStyle({ fillStyle: this.noteheadColor, strokeStyle: this.noteheadColor });\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n}\nnote.Note = Note;\n\n/* ------ TODO: Unpitched ------ */\n\n/* ------ Rest ------ */\n\n/**\n * Represents a musical rest.\n *\n * @class Rest\n * @memberof music21.note\n * @extends music21.note.GeneralNote\n * @param {number} [ql=1.0] - length in number of quarterNotes\n * @property {Boolean} [isNote=false]\n * @property {Boolean} [isRest=true]\n * @property {string} [name='rest']\n * @property {number} [lineShift=undefined] - number of lines to shift up or down from default\n * @property {string|undefined} [color='black'] - color of the rest\n */\nexport class Rest extends GeneralNote {\n    constructor(ql) {\n        super(ql);\n        this.isNote = false; // for speed\n        this.isRest = true; // for speed\n        this.name = 'rest'; // for note compatibility\n        this.lineShift = undefined;\n        this.color = 'black';\n    }\n    /**\n     * Returns a `Vex.Flow.StaveNote` that approximates this rest.\n     * Corrects for bug in VexFlow that renders a whole rest too low.\n     *\n     * @memberof music21.note.Rest\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        let keyLine = 'b/4';\n        if (this.duration.type === 'whole') {\n            if (\n                this.activeSite !== undefined\n                && this.activeSite.renderOptions.staffLines !== 1\n            ) {\n                keyLine = 'd/5';\n            }\n        }\n        if (this.lineShift !== undefined) {\n            const p = new pitch.Pitch('B4');\n            let ls = this.lineShift;\n            if (this.duration.type === 'whole') {\n                ls += 2;\n            }\n            p.diatonicNoteNum += ls;\n            keyLine = p.vexflowName(undefined);\n        }\n\n        const vfn = new Vex.Flow.StaveNote({\n            keys: [keyLine],\n            duration: this.duration.vexflowDuration + 'r',\n        });\n        if (this.duration.dots > 0) {\n            for (let i = 0; i < this.duration.dots; i++) {\n                vfn.addDotToAll();\n            }\n        }\n        if (this.color !== undefined) {\n            vfn.setStyle({ fillStyle: this.color, strokeStyle: this.color });\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n}\nnote.Rest = Rest;\n\n/* ------ SpacerRest ------ */\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/chord -- Chord\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as Vex from 'vexflow';\n\nimport { Music21Exception } from './exceptions21.js';\nimport { interval } from './interval.js';\nimport { note } from './note.js';\n\n/**\n * chord Module. See {@link music21.chord} namespace for more details\n *\n * @exports music21/chord\n */\n/**\n * Chord related objects (esp. {@link music21.chord.Chord}) and methods.\n *\n * @namespace music21.chord\n * @memberof music21\n * @requires music21/note\n */\nexport const chord = {};\n\n/**\n * Chord related objects (esp. {@link music21.chord.Chord}) and methods.\n *\n * @class Chord\n * @memberof music21.chord\n * @param {Array<string|music21.note.Note|music21.pitch.Pitch>} [notes] - an Array of strings\n * (see {@link music21.pitch.Pitch} for valid formats), note.Note, or pitch.Pitch objects.\n * @extends music21.note.NotRest\n * @property {number} length - the number of pitches in the Chord (readonly)\n * @property {Array<music21.pitch.Pitch>} pitches - an Array of Pitch objects in the chord. (Consider the Array read only and pass in a new Array to change)\n * @property {Boolean} [isChord=true]\n * @property {Boolean} [isNote=false]\n * @property {Boolean} [isRest=false]\n */\nexport class Chord extends note.NotRest {\n    constructor(notes) {\n        super();\n        if (typeof notes === 'undefined') {\n            notes = [];\n        } else if (typeof notes === 'string') {\n            notes = notes.split(/\\s+/);\n        }\n        this.isChord = true; // for speed\n        this.isNote = false; // for speed\n        this.isRest = false; // for speed\n\n        this._overrides = {};\n        this._cache = {};\n\n        this._notes = [];\n        notes.forEach(this.add, this, false);\n        this.sortPitches();\n    }\n    \n    get length() {\n        return this._notes.length;\n    }\n    get pitches() {\n        const tempPitches = [];\n        for (let i = 0; i < this._notes.length; i++) {\n            tempPitches.push(this._notes[i].pitch);\n        }\n        return tempPitches;\n    }\n    set pitches(tempPitches) {\n        this._notes = [];\n        for (let i = 0; i < tempPitches.length; i++) {\n            let addNote;\n            if (typeof tempPitches[i] === 'string') {\n                addNote = new note.Note(tempPitches[i]);\n            } else if (tempPitches[i].isClassOrSubclass('Pitch')) {\n                addNote = new note.Note();\n                addNote.pitch = tempPitches[i];\n            } else if (tempPitches[i].isClassOrSubclass('Note')) {\n                addNote = tempPitches[i];\n            } else {\n                console.warn('bad pitch', tempPitches[i]);\n                throw new Music21Exception(\n                    'Cannot add pitch from ' + tempPitches[i]\n                );\n            }\n            this._notes.push(addNote);\n        }\n        this._cache = {};\n        this._overrides = {};\n    }\n    setStemDirectionFromClef(clef) {\n        if (clef === undefined) {\n            return this;\n        } else {\n            const midLine = clef.lowestLine + 4;\n            // console.log(midLine, 'midLine');\n            let maxDNNfromCenter = 0;\n            const pA = this.pitches;\n            for (let i = 0; i < this.pitches.length; i++) {\n                const p = pA[i];\n                const DNNfromCenter = p.diatonicNoteNum - midLine;\n                // >= not > so that the highest pitch wins the tie and thus stem down.\n                if (Math.abs(DNNfromCenter) >= Math.abs(maxDNNfromCenter)) {\n                    maxDNNfromCenter = DNNfromCenter;\n                }\n            }\n            if (maxDNNfromCenter >= 0) {\n                this.stemDirection = 'down';\n            } else {\n                this.stemDirection = 'up';\n            }\n            return this;\n        }\n    }\n    /**\n     * Adds a note to the chord, sorting the note array\n     *\n     * @memberof music21.chord.Chord\n     * @param {string|music21.note.Note|music21.pitch.Pitch} notes - the Note or Pitch to be added or a string defining a pitch.\n     * @param {boolean} runSort - Sort after running (default true)\n     * @returns {music21.chord.Chord} the original chord.\n     */\n    add(notes, runSort = true) {\n        if (!(notes instanceof Array)) {\n            notes = [notes];\n        }\n        for (let noteObj of notes) {\n            // takes in either a note or a pitch\n            if (typeof noteObj === 'string') {\n                noteObj = new note.Note(noteObj);\n            } else if (noteObj.isClassOrSubclass('Pitch')) {\n                const pitchObj = noteObj;\n                const noteObj2 = new note.Note();\n                noteObj2.pitch = pitchObj;\n                noteObj = noteObj2;\n            }\n            this._notes.push(noteObj);\n        }\n        // inefficient because sorts after each add, but safe and #(p) is small\n        if (runSort === true) {\n            this.sortPitches();\n        }\n        this._cache = {};\n        return this;\n    }\n\n    sortPitches() {\n        this._notes.sort((a, b) => a.pitch.ps - b.pitch.ps);        \n    }\n    \n    // TODO: add remove\n\n    /**\n     * Removes any pitches that appear more than once (in any octave), removing the higher ones, and returns a new Chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.chord.Chord} A new Chord object with duplicate pitches removed.\n     */\n    removeDuplicatePitches() {\n        const stepsFound = [];\n        const nonDuplicatingPitches = [];\n        const pitches = this.pitches;\n        for (let i = 0; i < pitches.length; i++) {\n            const p = pitches[i];\n            if (stepsFound.indexOf(p.step) === -1) {\n                stepsFound.push(p.step);\n                nonDuplicatingPitches.push(p);\n            }\n        }\n        const closedChord = new chord.Chord(nonDuplicatingPitches);\n        return closedChord;\n    }\n    /**\n     * Finds the Root of the chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.pitch.Pitch} the root of the chord.\n     */\n    root(newroot) {\n        if (newroot !== undefined) {\n            this._overrides.root = newroot;\n            this._cache.root = newroot;\n            this._cache.inversion = undefined;\n        }\n\n        if (this._overrides.root !== undefined) {\n            return this._cache.root;\n        }\n\n        if (this._cache.root !== undefined) {\n            return this._cache.root;\n        }\n\n        const closedChord = this.removeDuplicatePitches();\n        /* var chordBass = closedChord.bass(); */\n        const closedPitches = closedChord.pitches;\n        if (closedPitches.length === 0) {\n            throw new Music21Exception('No notes in Chord!');\n        } else if (closedPitches.length === 1) {\n            return this.pitches[0];\n        }\n        const indexOfPitchesWithPerfectlyStackedThirds = [];\n        const testSteps = [3, 5, 7, 2, 4, 6];\n        for (let i = 0; i < closedPitches.length; i++) {\n            const p = closedPitches[i];\n            const currentListOfThirds = [];\n            for (let tsIndex = 0; tsIndex < testSteps.length; tsIndex++) {\n                const chordStepPitch = closedChord.getChordStep(\n                    testSteps[tsIndex],\n                    p\n                );\n                if (chordStepPitch !== undefined) {\n                    // console.log(p.name + \" \" + testSteps[tsIndex].toString() + \" \" + chordStepPitch.name);\n                    currentListOfThirds.push(true);\n                } else {\n                    currentListOfThirds.push(false);\n                }\n            }\n            // console.log(currentListOfThirds);\n            let hasFalse = false;\n            for (let j = 0; j < closedPitches.length - 1; j++) {\n                if (currentListOfThirds[j] === false) {\n                    hasFalse = true;\n                }\n            }\n            if (hasFalse === false) {\n                indexOfPitchesWithPerfectlyStackedThirds.push(i);\n                return closedChord.pitches[i]; // should do more, but fine...\n                // should test rootedness function, etc. 13ths. etc.\n            }\n        }\n        const newRoot = closedChord.pitches[0]; // fallback, just return the bass...\n        this._cache.root = newRoot;\n        return newRoot;\n    }\n    /**\n     * Returns the number of semitones above the root that a given chordstep is.\n     *\n     * For instance, in a G dominant 7th chord (G, B, D, F), would\n     * return 4 for chordStep=3, since the third of the chord (B) is four semitones above G.\n     *\n     * @memberof music21.chord.Chord\n     * @param {number} chordStep - the step to find, e.g., 1, 2, 3, etc.\n     * @param {music21.pitch.Pitch} [testRoot] - the pitch to temporarily consider the root.\n     * @returns {number|undefined} Number of semitones above the root for this chord step or undefined if no pitch matches that chord step.\n     */\n    semitonesFromChordStep(chordStep, testRoot) {\n        if (testRoot === undefined) {\n            testRoot = this.root();\n        }\n        const tempChordStep = this.getChordStep(chordStep, testRoot);\n        if (tempChordStep === undefined) {\n            return undefined;\n        } else {\n            let semitones = (tempChordStep.ps - testRoot.ps) % 12;\n            if (semitones < 0) {\n                semitones += 12;\n            }\n            return semitones;\n        }\n    }\n    /**\n     * Gets the lowest note (based on .ps not name) in the chord.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {music21.pitch.Pitch} bass pitch\n     */\n    bass() {\n        let lowest;\n        const pitches = this.pitches;\n        for (let i = 0; i < pitches.length; i++) {\n            const p = pitches[i];\n            if (lowest === undefined) {\n                lowest = p;\n            } else if (p.ps < lowest.ps) {\n                lowest = p;\n            }\n        }\n        return lowest;\n    }\n    /**\n     * Counts the number of non-duplicate pitch MIDI Numbers in the chord.\n     *\n     * Call after \"closedPosition()\" to get Forte style cardinality disregarding octave.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {number}\n     */\n    cardinality() {\n        const uniqueChord = this.removeDuplicatePitches();\n        return uniqueChord.pitches.length;\n    }\n\n    /**\n    *\n    * @memberof music21.chord.Chord\n    * @returns {Boolean}\n    */\n    isMajorTriad() {\n        if (this.cardinality() !== 3) {\n            return false;\n        }\n        const thirdST = this.semitonesFromChordStep(3);\n        const fifthST = this.semitonesFromChordStep(5);\n        if (thirdST === 4 && fifthST === 7) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    /**\n    *\n    * @memberof music21.chord.Chord\n    * @returns {Boolean}\n    */\n    isMinorTriad() {\n        if (this.cardinality() !== 3) {\n            return false;\n        }\n        const thirdST = this.semitonesFromChordStep(3);\n        const fifthST = this.semitonesFromChordStep(5);\n        if (thirdST === 3 && fifthST === 7) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    isDominantSeventh() {\n        const third = this.third;\n        const fifth = this.fifth;\n        const seventh = this.seventh;\n\n        if (\n            third === undefined\n            || fifth === undefined\n            || seventh === undefined\n        ) {\n            return false;\n        }\n\n        for (const thisPitch of this.pitches) {\n            const thisInterval = new interval.Interval(this.root(), thisPitch);\n            if (![0, 4, 7, 10].includes(thisInterval.chromatic.mod12)) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    /**\n     * canBeDominantV - Returns true if the chord is a Major Triad or a Dominant Seventh\n     *\n     * @return {Boolean}\n     */\n    canBeDominantV() {\n        if (this.isMajorTriad() || this.isDominantSeventh()) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    /**\n     * Returns true if the chord is a major or minor triad\n     *\n     * @memberof music21.chord.Chord\n     * @returns {Boolean}\n     */\n    canBeTonic() {\n        if (this.isMajorTriad() || this.isMinorTriad()) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    /**\n     * Returns the inversion of the chord as a number (root-position = 0)\n     *\n     * Unlike music21 version, cannot set the inversion, yet.\n     *\n     * TODO: add.\n     *\n     * @memberof music21.chord.Chord\n     * @returns {number}\n     */\n    inversion() {\n        const bass = this.bass();\n        const root = this.root();\n        const chordStepsToInversions = [1, 6, 4, 2, 7, 5, 3];\n        for (let i = 0; i < chordStepsToInversions.length; i++) {\n            const testNote = this.getChordStep(chordStepsToInversions[i], bass);\n            if (testNote !== undefined && testNote.name === root.name) {\n                return i;\n            }\n        }\n        return undefined;\n    }\n    /**\n     * @memberof music21.chord.Chord\n     * @param {object} options - a dictionary of options `{clef: {@music21.clef.Clef} }` is especially important\n     * @returns {Vex.Flow.StaveNote}\n     */\n    vexflowNote(options) {\n        const clef = options.clef;\n\n        const pitchKeys = [];\n        for (let i = 0; i < this._notes.length; i++) {\n            pitchKeys.push(this._notes[i].pitch.vexflowName(clef));\n        }\n        const vfn = new Vex.Flow.StaveNote({\n            keys: pitchKeys,\n            duration: this.duration.vexflowDuration,\n        });\n        this.vexflowAccidentalsAndDisplay(vfn, options); // clean up stuff...\n        for (let i = 0; i < this._notes.length; i++) {\n            const tn = this._notes[i];\n            if (tn.pitch.accidental !== undefined) {\n                if (\n                    tn.pitch.accidental.vexflowModifier !== 'n'\n                    && tn.pitch.accidental.displayStatus !== false\n                ) {\n                    vfn.addAccidental(\n                        i,\n                        new Vex.Flow.Accidental(\n                            tn.pitch.accidental.vexflowModifier\n                        )\n                    );\n                } else if (\n                    tn.pitch.accidental.displayType === 'always'\n                    || tn.pitch.accidental.displayStatus === true\n                ) {\n                    vfn.addAccidental(\n                        i,\n                        new Vex.Flow.Accidental(\n                            tn.pitch.accidental.vexflowModifier\n                        )\n                    );\n                }\n            }\n        }\n        this.activeVexflowNote = vfn;\n        return vfn;\n    }\n    /**\n     * Returns the Pitch object that is a Generic interval (2, 3, 4, etc., but not 9, 10, etc.) above\n     * the `.root()`\n     *\n     * In case there is more that one note with that designation (e.g., `[A-C-C#-E].getChordStep(3)`)\n     * the first one in `.pitches` is returned.\n     *\n     * @memberof music21.chord.Chord\n     * @param {Int} chordStep a positive integer representing the chord step\n     * @param {music21.pitch.Pitch} [testRoot] - the Pitch to use as a temporary root\n     * @returns {music21.pitch.Pitch|undefined}\n     */\n    getChordStep(chordStep, testRoot) {\n        if (testRoot === undefined) {\n            testRoot = this.root();\n        }\n        if (chordStep >= 8) {\n            chordStep %= 7;\n        }\n        const thisPitches = this.pitches;\n        const testRootDNN = testRoot.diatonicNoteNum;\n        for (let i = 0; i < thisPitches.length; i++) {\n            const thisPitch = thisPitches[i];\n            let thisInterval\n                = (thisPitch.diatonicNoteNum - testRootDNN + 1) % 7; // fast cludge\n            if (thisInterval <= 0) {\n                thisInterval += 7;\n            }\n            if (thisInterval === chordStep) {\n                return thisPitch;\n            }\n        }\n        return undefined;\n    }\n\n    get third() {\n        return this.getChordStep(3);\n    }\n    get fifth() {\n        return this.getChordStep(5);\n    }\n    get seventh() {\n        return this.getChordStep(7);\n    }\n}\nchord.Chord = Chord;\n\nchord.chordDefinitions = {\n    major: ['M3', 'm3'],\n    minor: ['m3', 'M3'],\n    diminished: ['m3', 'm3'],\n    augmented: ['M3', 'M3'],\n    'major-seventh': ['M3', 'm3', 'M3'],\n    'dominant-seventh': ['M3', 'm3', 'm3'],\n    'minor-seventh': ['m3', 'M3', 'm3'],\n    'diminished-seventh': ['m3', 'm3', 'm3'],\n    'half-diminished-seventh': ['m3', 'm3', 'M3'],\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/clef -- Clef objects\n *\n * note: only defines a single Clef object for now\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base.js';\nimport { pitch } from './pitch.js';\n\n/**\n * Clef module, see {@link music21.clef} for namespace\n *\n * @exports music21/clef\n */\n/**\n * Clef related objects and properties\n *\n * @namespace music21.clef\n * @memberof music21\n * @requires music21/base\n * @requires music21/pitch\n */\nexport const clef = {};\n/*  music21.Clef\n\tmust be defined before Stream since Stream subclasses call new music21.Clef...\n */\n// TODO: Fix to newest Vexflow format...\nclef.lowestLines = {\n    treble: 31,\n    soprano: 29,\n    'mezzo-soprano': 27,\n    alto: 25,\n    tenor: 23,\n    bass: 19,\n    percussion: 31,\n};\n/**\n * Clefname can be one of\n * \"treble\", \"bass\", \"soprano\", \"mezzo-soprano\", \"alto\", \"tenor\", \"percussion\"\n *\n * @class Clef\n * @memberof music21.clef\n * @extends music21.base.Music21Object\n * @param {string} name - clef name\n * @param {Int} [octaveChange=0] - ottava\n * @property {string|undefined} name\n * @property {Int} lowestLine - diatonicNoteNum (C4 = 29) for the lowest line (in a five-line staff)\n * @property {Int} lowestLineTrebleOffset - difference between the first line of this staff and the first line in treble clef\n * @property {Int} octaveChange\n */\nexport class Clef extends base.Music21Object {\n    constructor(name, octaveChange) {\n        super();\n        if (name !== undefined) {\n            name = name.toLowerCase();\n            this.name = name;\n            this.lowestLine = clef.lowestLines[name];\n            this.lowestLineTrebleOffset\n                = clef.lowestLines.treble - this.lowestLine;\n        } else {\n            this.name = undefined;\n            this.lowestLine = clef.lowestLines.treble;\n            this.lowestLineTrebleOffset = 0;\n        }\n        if (octaveChange === undefined) {\n            this.octaveChange = 0;\n        } else {\n            this.octaveChange = octaveChange;\n            this.lowestLine += 7 * octaveChange;\n            this.lowestLineTrebleOffset -= 7 * octaveChange;\n        }\n    }\n    /**\n     * returns a new pitch object if the clef name is not Treble\n     * designed so it would look the same as it would in treble clef.\n     * for instance, bass-clef 2nd-space C# becomes treble clef 2nd-space A#\n     * used for Vex.Flow which requires all pitches to be input as if they\n     * are in treble clef.\n     *\n     * @memberof music21.clef.Clef\n     * @param {music21.pitch.Pitch} p\n     * @returns {music21.pitch.Pitch} new pitch\n     */\n    convertPitchToTreble(p) {\n        if (this.lowestLine === undefined) {\n            console.log('no first line defined for clef', this.name, this);\n            return p; // error\n        }\n        const lowestLineDifference = this.lowestLineTrebleOffset;\n        const tempPitch = new pitch.Pitch(p.step);\n        tempPitch.octave = p.octave;\n        tempPitch.diatonicNoteNum += lowestLineDifference;\n        tempPitch.accidental = p.accidental;\n        return tempPitch;\n    }\n}\n\nclef.Clef = Clef;\n\n/**\n * A TrebleClef (same as new music21.clef.Clef('treble')\n *\n * @class TrebleClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class TrebleClef extends Clef {\n    constructor() {\n        super('treble');\n    }\n}\nclef.TrebleClef = TrebleClef;\n/**\n * A TrebleClef down an octave (same as new music21.clef.Clef('treble', -1)\n *\n * Unlike music21p, currently not a subclass of TrebleClef.\n *\n * @class Treble8vbClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class Treble8vbClef extends Clef {\n    constructor() {\n        super('treble', -1);\n    }\n}\nclef.Treble8vbClef = Treble8vbClef;\n\n/**\n * A TrebleClef up an octave (same as new music21.clef.Clef('treble', 1)\n *\n * @class Treble8vaClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class Treble8vaClef extends Clef {\n    constructor() {\n        super('treble', 1);\n    }\n}\nclef.Treble8vaClef = Treble8vaClef;\n\n/**\n * A BassClef (same as new music21.clef.Clef('bass')\n *\n * @class BassClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class BassClef extends Clef {\n    constructor() {\n        super('bass');\n    }\n}\nclef.BassClef = BassClef;\n\n/**\n * An AltoClef (same as new music21.clef.Clef('alto')\n *\n * @class AltoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class AltoClef extends Clef {\n    constructor() {\n        super('alto');\n    }\n}\nclef.AltoClef = AltoClef;\n\n/**\n * A Tenor Clef (same as new music21.clef.Clef('tenor')\n *\n * @class TenorClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class TenorClef extends Clef {\n    constructor() {\n        super('tenor');\n    }\n}\nclef.TenorClef = TenorClef;\n/**\n * A Soprano Clef (same as new music21.clef.Clef('soprano')\n *\n * @class SopranoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class SopranoClef extends Clef {\n    constructor() {\n        super('soprano');\n    }\n}\nclef.SopranoClef = SopranoClef;\n\n/**\n * A Mezzo-Soprano Clef (same as new music21.clef.Clef('mezzo-soprano')\n *\n * @class MezzoSopranoClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class MezzoSopranoClef extends Clef {\n    constructor() {\n        super('mezzo-soprano');\n    }\n}\nclef.MezzoSopranoClef = MezzoSopranoClef;\n\n/**\n * A Percussion Clef (same as new music21.clef.Clef('percussion')\n *\n * First line is treated as if it's treble clef. Not available as \"bestClef\"\n *\n * @class PercussionClef\n * @memberof music21.clef\n * @extends music21.clef.Clef\n */\nexport class PercussionClef extends Clef {\n    constructor() {\n        super('percussion');\n    }\n}\nclef.PercussionClef = PercussionClef;\n\n/**\n * Looks at the pitches in a Stream and returns the best clef\n * of Treble and Bass\n *\n * @function music21.clef.bestClef\n * @memberof music21.clef\n * @param {music21.stream.Stream} st\n * @returns {music21.clef.Clef}\n */\nclef.bestClef = function bestClef(st) {\n    // console.log('calling flat on stream: ', st.elements.length, st.classes[st.classes.length - 1]);\n    const stFlat = st.flat;\n    let totalNotes = 0;\n    let totalPitch = 0.0;\n    for (let i = 0; i < stFlat.length; i++) {\n        const el = stFlat.get(i);\n        if (el.pitch !== undefined) {\n            totalNotes += 1;\n            totalPitch += el.pitch.diatonicNoteNum;\n        } else if (el.pitches !== undefined) {\n            for (let j = 0; j < el.pitches.length; j++) {\n                totalNotes += 1;\n                totalPitch += el.pitches[j].diatonicNoteNum;\n            }\n        }\n    }\n    let averageHeight;\n    if (totalNotes === 0) {\n        averageHeight = 29;\n    } else {\n        averageHeight = totalPitch / totalNotes;\n    }\n    // console.log('bestClef: average height', averageHeight);\n    if (averageHeight > 28) {\n        // 29 = c4\n        return new clef.TrebleClef();\n    } else {\n        return new clef.BassClef();\n    }\n};\n\nclef.clefFromString = function clefFromString(clefString, octaveShift) {\n    if (octaveShift === undefined) {\n        octaveShift = 0;\n    }\n    const xnStr = clefString.trim();\n    let thisType;\n    let lineNum;\n    if (xnStr.toLowerCase() === 'percussion') {\n        return new clef.PercussionClef(clefString, octaveShift);\n    } // todo: tab, none, jianpu\n\n    if (xnStr.length === 2) {\n        thisType = xnStr[0].toUpperCase();\n        lineNum = xnStr[1];\n    } else if (xnStr.length === 1) {\n        thisType = xnStr[0].toUpperCase();\n        if (thisType === 'G') {\n            lineNum = 2;\n        } else if (thisType === 'F') {\n            lineNum = 4;\n        } else if (thisType === 'C') {\n            lineNum = 3;\n        } else {\n            lineNum = 0;\n        }\n    }\n\n    const arrayEqual = (a, b) =>\n        a.length === b.length && a.every((el, ix) => el === b[ix]);\n\n    const params = [thisType, lineNum, octaveShift];\n    if (arrayEqual(params, ['G', 2, 0])) {\n        return new clef.TrebleClef();\n    } else if (arrayEqual(params, ['G', 2, -1])) {\n        return new clef.Treble8vbClef();\n    } else if (arrayEqual(params, ['G', 2, 1])) {\n        return new clef.Treble8vaClef();\n    } else if (arrayEqual(params, ['F', 4, 0])) {\n        return new clef.BassClef();\n    } else if (arrayEqual(params, ['F', 4, -1])) {\n        return new clef.Bass8vbClef();\n    } else if (arrayEqual(params, ['C', 3, 0])) {\n        return new clef.AltoClef();\n    } else if (arrayEqual(params, ['C', 4, 0])) {\n        return new clef.TenorClef();\n    } else {\n        return new clef.Clef(xnStr, octaveShift);\n    }\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/dynamics -- Dynamics\n *\n * note that Vex.Flow does not support Dynamics yet and we do not support MIDI dynamics,\n *  so currently of limited value...\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base.js';\n\n/**\n * dynamics Module. See {@link music21.dynamics} for namespace\n *\n * @exports music21/dynamics\n */\n/**\n * Dynamics related objects.\n *\n * N.B. Firefox completely ignores dyanmics on playback!\n *\n * Currently do not export to Vexflow.  :-(\n *\n * @namespace music21.dynamics\n * @memberof music21\n * @requires music21/base\n */\nexport const dynamics = {};\ndynamics.shortNames = [\n    'pppppp',\n    'ppppp',\n    'pppp',\n    'ppp',\n    'pp',\n    'p',\n    'mp',\n    'mf',\n    'f',\n    'fp',\n    'sf',\n    'ff',\n    'fff',\n    'ffff',\n    'fffff',\n    'ffffff',\n];\ndynamics.longNames = {\n    ppp: ['pianississimo'],\n    pp: ['pianissimo'],\n    p: ['piano'],\n    mp: ['mezzopiano'],\n    mf: ['mezzoforte'],\n    f: ['forte'],\n    fp: ['fortepiano'],\n    sf: ['sforzando'],\n    ff: ['fortissimo'],\n    fff: ['fortississimo'],\n};\ndynamics.englishNames = {\n    ppp: ['extremely soft'],\n    pp: ['very soft'],\n    p: ['soft'],\n    mp: ['moderately soft'],\n    mf: ['moderately loud'],\n    f: ['loud'],\n    ff: ['very loud'],\n    fff: ['extremely loud'],\n};\ndynamics.dynamicStrToScalar = {\n    None: [0.5], // default value\n    n: [0.0],\n    pppp: [0.1],\n    ppp: [0.15],\n    pp: [0.25],\n    p: [0.35],\n    mp: [0.45],\n    mf: [0.55],\n    f: [0.7],\n    fp: [0.75],\n    sf: [0.85],\n    ff: [0.85],\n    fff: [0.9],\n    ffff: [0.95],\n};\n\n/**\n * A representation of a dynamic.\n *\n * @class Dynamic\n * @memberof music21.dynamics\n * @extends music21.base.Music21Object\n * @param {number|string} value - either a number between 0 and 1 or a dynamic mark such as \"ff\" or \"mp\"\n * @property {string|undefined} value - a name such as \"pp\" etc.\n * @property {string|undefined} longName - a longer name such as \"pianissimo\"\n * @property {string|undefined} englishName - a name such as \"very soft\"\n * @property {number} volumeScalar - a number between 0 and 1.\n */\nexport class Dynamic extends base.Music21Object {\n    constructor(value) {\n        super();\n        this._value = undefined;\n        this._volumeScalar = undefined;\n        this.longName = undefined;\n        this.englishName = undefined;\n        this.value = value;\n    }\n    get value() {\n        return this._value;\n    }\n    set value(value) {\n        if (typeof value !== 'string') {\n            // assume number\n            this._volumeScalar = value;\n            if (value <= 0) {\n                this._value = 'n';\n            } else if (value < 0.11) {\n                this._value = 'pppp';\n            } else if (value < 0.16) {\n                this._value = 'ppp';\n            } else if (value < 0.26) {\n                this._value = 'pp';\n            } else if (value < 0.36) {\n                this._value = 'p';\n            } else if (value < 0.5) {\n                this._value = 'mp';\n            } else if (value < 0.65) {\n                this._value = 'mf';\n            } else if (value < 0.8) {\n                this._value = 'f';\n            } else if (value < 0.9) {\n                this._value = 'ff';\n            } else {\n                this._value = 'fff';\n            }\n        } else {\n            this._value = value;\n            this._volumeScalar = undefined;\n        }\n        if (this._value in dynamics.longNames) {\n            this.longName = dynamics.longNames[this._value][0];\n        } else {\n            this.longName = undefined;\n        }\n        if (this._value in dynamics.englishNames) {\n            this.englishName = dynamics.englishNames[this._value][0];\n        } else {\n            this.englishName = undefined;\n        }\n    }\n    get volumeScalar() {\n        if (this._volumeScalar !== undefined) {\n            return this._volumeScalar;\n        } else if (this._value in dynamics.dynamicStrToScalar) {\n            return dynamics.dynamicStrToScalar[this._value][0];\n        } else {\n            return undefined;\n        }\n    }\n    set volumeScalar(value) {\n        if (typeof value === 'number' && value <= 1 && value >= 0) {\n            this._volumeScalar = value;\n        }\n    }\n}\ndynamics.Dynamic = Dynamic;\n","import * as Vex from 'vexflow';\n\nimport { base } from './base.js';\n/**\n * Expressions module.  See {@link music21.expressions}\n *\n * @exports music21/expressions\n */\n/**\n * Expressions can be note attached (`music21.note.Note.expressions[]`) or floating...\n *\n * @namespace music21.expressions\n * @memberof music21\n * @requires music21/expressions\n */\nexport const expressions = {};\n\n/**\n * Expressions can be note attached (`music21.note.Note.expressions[]`) or floating...\n *\n * @class Expression\n * @memberof music21.expressions\n * @extends music21.base.Music21Object\n * @property {string} name\n * @property {string} vexflowModifier\n * @property {Int} setPosition\n */\nexport class Expression extends base.Music21Object {\n    constructor() {\n        super();\n        this.name = 'expression';\n        this.vexflowModifier = '';\n        this.setPosition = undefined;\n    }\n    /**\n     * Renders this Expression as a Vex.Flow.Articulation\n     *\n     * (this is not right for all cases)\n     *\n     * @memberof music21.expressions.Expression\n     * @returns {Vex.Flow.Articulation}\n     */\n    vexflow() {\n        const vfe = new Vex.Flow.Articulation(this.vexflowModifier);\n        if (this.setPosition) {\n            vfe.setPosition(this.setPosition);\n        }\n        return vfe;\n    }\n}\nexpressions.Expression = Expression;\n\n/**\n * A fermata...\n *\n * @class Fermata\n * @memberof music21.expressions\n * @extends music21.expressions.Expression\n */\nexport class Fermata extends Expression {\n    constructor() {\n        super();\n        this.name = 'fermata';\n        this.vexflowModifier = 'a@a';\n        this.setPosition = 3;\n    }\n}\nexpressions.Fermata = Fermata;\n","import { pitch } from './pitch.js';\n\nconst shorthandNotation = {\n    '': [5, 3],\n    '5': [5, 3],\n    '6': [6, 3],\n    '7': [7, 5, 3],\n    '9': [9, 7, 5, 3],\n    '11': [11, 9, 7, 5, 3],\n    '13': [13, 11, 9, 7, 5, 3],\n    '6,5': [6, 5, 3],\n    '4,3': [6, 4, 3],\n    '4,2': [6, 4, 2],\n    '2': [6, 4, 2],\n};\n/**\n * In music21p is in figuredBass.notation -- eventually to be moved there.\n */\n\nclass Notation {\n    constructor(notationColumn) {\n        if (notationColumn === undefined) {\n            notationColumn = '';\n        }\n        this.notationColumn = notationColumn;\n        this.figureStrings = undefined;\n        this.origNumbers = undefined;\n        this.origModStrings = undefined;\n        this.numbers = undefined;\n        this.modifierStrings = undefined;\n        this._parseNotationColumn();\n        this._translateToLonghand();\n\n        this.modifiers = undefined;\n        this.figures = undefined;\n        this._getModifiers();\n        this._getFigures();\n    }\n\n    /**\n     * _parseNotationColumn - Given a notation column below a pitch, defines both this.numbers\n     *    and this.modifierStrings, which provide the intervals above the\n     *    bass and (if necessary) how to modify the corresponding pitches\n     *    accordingly.\n     *\n     * @return {undefined}\n     */\n\n    _parseNotationColumn() {\n        const nc = this.notationColumn;\n        const figures = nc.split(/,/);\n        const numbers = [];\n        const modifierStrings = [];\n        const figureStrings = [];\n\n        for (let figure of figures) {\n            figure = figure.trim();\n            figureStrings.push(figure);\n            let numberString = '';\n            let modifierString = '';\n            for (const c of figure) {\n                if (c.match(/\\d/)) {\n                    numberString += c;\n                } else {\n                    modifierString += c;\n                }\n            }\n            let number;\n            if (numberString !== '') {\n                number = parseInt(numberString);\n            }\n            numbers.push(number);\n            if (modifierString === '') {\n                modifierString = undefined;\n            }\n            modifierStrings.push(modifierString);\n        }\n        this.origNumbers = numbers;\n        this.numbers = numbers;\n        this.modifierStrings = modifierStrings;\n        this.figureStrings = figureStrings;\n    }\n\n    _translateToLonghand() {\n        let oldNumbers = this.numbers;\n        let newNumbers = oldNumbers;\n        const oldModifierStrings = this.modifierStrings;\n        let newModifierStrings = oldModifierStrings;\n        const oldNumbersString = oldNumbers.toString();\n\n        if (shorthandNotation[oldNumbersString] !== undefined) {\n            newNumbers = shorthandNotation[oldNumbersString];\n            newModifierStrings = [];\n            const temp = [];\n            for (const number of oldNumbers) {\n                if (number === undefined) {\n                    temp.push(3);\n                } else {\n                    temp.push(number);\n                }\n            }\n            oldNumbers = temp;\n\n            for (const number of newNumbers) {\n                let newModifierString;\n                if (oldNumbers.includes(number)) {\n                    const modifierStringIndex = oldNumbers.indexOf(number);\n                    newModifierString = oldModifierStrings[modifierStringIndex];\n                }\n                newModifierStrings.push(newModifierString);\n            }\n        } else {\n            const temp = [];\n            for (const number of oldNumbers) {\n                if (number === undefined) {\n                    temp.push(3);\n                } else {\n                    temp.push(number);\n                }\n            }\n            newNumbers = temp;\n        }\n        this.numbers = newNumbers;\n        this.modifierStrings = newModifierStrings;\n    }\n\n    _getModifiers() {\n        const modifiers = [];\n        for (let i = 0; i < this.numbers.length; i++) {\n            const modifierString = this.modifierStrings[i];\n            const modifier = new Modifier(modifierString);\n            modifiers.push(modifier);\n        }\n        this.modifiers = modifiers;\n    }\n\n    _getFigures() {\n        const figures = [];\n        for (let i = 0; i < this.numbers.length; i++) {\n            const number = this.numbers[i];\n            const modifierString = this.modifierStrings[i];\n            const figure = new Figure(number, modifierString);\n            figures.push(figure);\n        }\n        this.figures = figures;\n    }\n}\n\nclass Figure {\n    constructor(number, modifierString) {\n        this.number = number;\n        this.modifierString = modifierString;\n        this.modifier = new Modifier(modifierString);\n    }\n}\n\nconst specialModifiers = {\n    '+': '#',\n    '/': '-',\n    '\\\\': '#',\n    b: '-',\n    bb: '--',\n    bbb: '---',\n    bbbb: '-----',\n    '++': '##',\n    '+++': '###',\n    '++++': '####',\n};\n\nclass Modifier {\n    constructor(modifierString) {\n        this.modifierString = modifierString;\n        this.accidental = this._toAccidental();\n    }\n\n    _toAccidental() {\n        let modStr = this.modifierString;\n        if (modStr === undefined || modStr === '') {\n            return undefined;\n        }\n        const a = new pitch.Accidental();\n        if (specialModifiers[modStr] !== undefined) {\n            modStr = specialModifiers[modStr];\n        }\n        a.set(modStr);\n        return a;\n    }\n\n    modifyPitchName(pitchNameToAlter) {\n        const pitchToAlter = new pitch.Pitch(pitchNameToAlter);\n        this.modifyPitch(pitchToAlter, true);\n        return pitchToAlter.name;\n    }\n\n    modifyPitch(pitchToAlter, inPlace) {\n        if (inPlace !== true) {\n            pitchToAlter = pitchToAlter.clone();\n        }\n\n        if (this.accidental === undefined) {\n            return pitchToAlter;\n        }\n\n        if (\n            this.accidental.alter === 0.0\n            || pitchToAlter.accidental === undefined\n        ) {\n            pitchToAlter.accidental = this.accidental.clone();\n        } else {\n            const newAccidental = new pitch.Accidental();\n            const newAlter\n                = pitchToAlter.accidental.alter + this.accidental.alter;\n            newAccidental.set(newAlter);\n            pitchToAlter.accidental = newAccidental;\n        }\n        return pitchToAlter;\n    }\n}\n\nexport const figuredBass = {\n    Notation,\n    Figure,\n    Modifier,\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/fromPython -- Conversion from music21p jsonpickle streams\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n * usage:\n *\n * in python:\n *\n * s = corpus.parse('bwv66.6')\n * stringRepresentingM21JsonPickle = s.freezeStream('jsonpickle')\n *\n * in js:\n *\n * pyConv = new music21.fromPython.Converter();\n * s = pyConv.run(stringRepresentingM21JsonPickle);\n *\n *\n */\nimport * as jsonpickle from 'jsonpickle';\n\nconst jp = jsonpickle;\n/**\n * fromPython module -- see {@link music21.fromPython}\n */\nconst unpickler = jp.unpickler;\n\n/**\n * Converter for taking a Python-encoded jsonpickle music21p stream\n * and loading it into music21j\n *\n * Very very alpha.  See music21(p).vexflow modules to see how it works.\n *\n * Requires Cuthbert's jsonpickle.js port (included in music21j)\n *\n * @namespace music21.fromPython\n * @extends music21\n * @requires jsonpickle\n */\nexport const fromPython = {};\n\n/**\n *\n * @class Converter\n * @memberof music21.fromPython\n * @property {boolean} debug\n * @property {Array<string>} knownUnparsables - list of classes that cannot be parsed\n * @property {object} handlers - object mapping string names of classes to a set of function calls to perform when restoring or post-restoring. (too complicated to explain; read the code)\n */\nexport class Converter {\n    constructor() {\n        this.debug = true;\n        this.knownUnparsables = [\n            'music21.spanner.Line',\n            'music21.instrument.Instrument',\n            'music21.layout.StaffGroup',\n            'music21.layout.StaffLayout',\n            'music21.layout.SystemLayout',\n            'music21.layout.PageLayout',\n            'music21.expressions.TextExpression',\n            'music21.bar.Barline', // Soon...\n            'music21.tempo.MetronomeMark', // should be possible\n            'music21.metadata.Metadata', // Soon...\n        ];\n        this.handlers = {\n            'music21.duration.Duration': {\n                post_restore: d => {\n                    d.quarterLength = d._qtrLength;\n                    return d;\n                },\n            },\n            'music21.meter.TimeSignature': {\n                post_restore: ts => {\n                    ts._numerator = ts.displaySequence._numerator;\n                    ts._denominator = ts.displaySequence._denominator;\n                    return ts;\n                },\n            },\n            'music21.stream.Part': {\n                post_restore: p => {\n                    this.currentPart = p;\n                    this.lastClef = undefined;\n                    this.lastKeySignature = undefined;\n                    this.lastTimeSignature = undefined;\n                    this.streamPostRestore(p);\n                    return p;\n                },\n            },\n            // TODO: all inherit somehow, through _classes or better, prototype...\n            'music21.stream.Score': {\n                post_restore: this.streamPostRestore.bind(this),\n            },\n            'music21.stream.Stream': {\n                post_restore: this.streamPostRestore.bind(this),\n            },\n            'music21.stream.Measure': {\n                post_restore: this.streamPostRestore.bind(this),\n            },\n            'music21.stream.Voice': {\n                post_restore: this.streamPostRestore.bind(this),\n            },\n        };\n        this.currentPart = undefined;\n        this.lastClef = undefined;\n        this.lastKeySignature = undefined;\n        this.lastTimeSignature = undefined;\n    }\n\n    /**\n     * Fixes up some references that cannot be unpacked from jsonpickle.\n     *\n     * @method music21.fromPython.Converter#streamPostRestore\n     * @memberof music21.fromPython.Converter\n     * @param {music21.stream.Stream} s - stream after unpacking from jsonpickle\n     * @returns {music21.stream.Stream}\n     */\n    streamPostRestore(s) {\n        const st = s._storedElementOffsetTuples;\n\n        s._clef = this.lastClef;\n        s._keySignature = this.lastKeySignature;\n        s._timeSignature = this.lastTimeSignature;\n        for (let i = 0; i < st.length; i++) {\n            const el = st[i][0];\n            el.offset = st[i][1];\n            let classList = el.classes;\n            if (classList === undefined) {\n                console.warn('M21object without classes: ', el);\n                console.warn('Javascript classes are: ', el._py_class);\n                classList = [];\n            }\n            let streamPart = this.currentPart;\n            if (streamPart === undefined) {\n                streamPart = s; // possibly a Stream constructed from .measures()\n            }\n\n            let appendEl = true;\n            let insertAtStart = false;\n\n            for (let j = 0; j < classList.length; j++) {\n                const thisClass = classList[j];\n                for (let kn = 0; kn < this.knownUnparsables.length; kn++) {\n                    const unparsable = this.knownUnparsables[kn];\n                    if (unparsable.indexOf(thisClass) !== -1) {\n                        appendEl = false;\n                    }\n                }\n                if (thisClass === 'TimeSignature') {\n                    // console.log(\"Got timeSignature\", streamPart, newM21pObj, storedElement);\n                    s._timeSignature = el;\n                    this.lastTimeSignature = el;\n                    if (\n                        streamPart !== undefined\n                        && streamPart.timeSignature === undefined\n                    ) {\n                        streamPart.timeSignature = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'Clef') {\n                    s._clef = el;\n                    this.lastClef = el;\n                    if (\n                        streamPart !== undefined\n                        && streamPart.clef === undefined\n                    ) {\n                        streamPart.clef = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'KeySignature') {\n                    s._keySignature = el;\n                    this.lastKeySignature = el;\n                    if (\n                        streamPart !== undefined\n                        && streamPart.keySignature === undefined\n                    ) {\n                        streamPart.keySignature = el;\n                    }\n                    appendEl = false;\n                } else if (thisClass === 'Part') {\n                    appendEl = false;\n                    insertAtStart = true;\n                }\n            }\n\n            if (appendEl) {\n                s.append(el); // all but clef, ts, ks\n            } else if (insertAtStart) {\n                s.insert(0, el); // Part\n            }\n        }\n        return s;\n    }\n\n    /**\n     * Run the main decoder\n     *\n     * @method music21.fromPython.Converter#run\n     * @memberof music21.fromPython.Converter\n     * @param {string} jss - stream encoded as JSON\n     * @returns {music21.stream.Stream}\n     */\n    run(jss) {\n        const outStruct = unpickler.decode(jss, this.handlers);\n        return outStruct.stream;\n    }\n}\nfromPython.Converter = Converter;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/key -- KeySignature and Key objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21.js';\n\nimport { base } from './base.js';\n// import { common } from './common.js';\nimport { debug } from './debug.js';\nimport { interval } from './interval.js';\nimport { pitch } from './pitch.js';\nimport { scale } from './scale.js';\n\n/* key and keysignature module. See {@link music21.key} namespace for details\n *\n * @exports music21/key\n */\n/**\n * Key and KeySignature related objects and methods\n *\n * @namespace music21.key\n * @memberof music21\n * @requires music21/base\n * @requires music21/pitch\n * @requires music21/interval\n * @requires music21/scale\n */\nexport const key = {};\n\nkey.modeSharpsAlter = {\n    major: 0,\n    minor: -3,\n    dorian: -2,\n    phrygian: -4,\n    lydian: 1,\n    mixolydian: -1,\n    locrian: -5,\n};\n\nkey.convertKeyStringToMusic21KeyString = function convertKeyStringToMusic21KeyString(\n    textString\n) {\n    if (textString === 'bb') {\n        textString = 'b-';\n    } else if (textString === 'Bb') {\n        textString = 'B-';\n    } else if (textString.endsWith('b') && !textString.startsWith('b')) {\n        textString = textString.replace(/b$/, '-');\n    }\n    return textString;\n};\n\n/**\n * @class KeySignature\n * @memberof music21.key\n * @description Represents a key signature\n * @param {Int} [sharps=0] -- the number of sharps (negative for flats)\n * @property {Int} [sharps=0] -- number of sharps (negative for flats)\n * @extends music21.base.Music21Object\n * @example\n * var ks = new music21.key.KeySignature(-3); //E-flat major or c minor\n * var s = new music21.stream.Stream();\n * s.keySignature = ks;\n * var n = new music21.note.Note('A-'); // A-flat\n * s.append(n);\n * s.appendNewDOM();\n */\nexport class KeySignature extends base.Music21Object {\n    constructor(sharps) {\n        super();\n        this._sharps = sharps || 0; // if undefined\n        this._alteredPitchesCache = undefined;\n\n        // 12 flats/sharps enough for now...\n        this.flatMapping = [\n            'C',\n            'F',\n            'B-',\n            'E-',\n            'A-',\n            'D-',\n            'G-',\n            'C-',\n            'F-',\n            'B--',\n            'E--',\n            'A--',\n            'D--',\n        ];\n        this.sharpMapping = [\n            'C',\n            'G',\n            'D',\n            'A',\n            'E',\n            'B',\n            'F#',\n            'C#',\n            'G#',\n            'D#',\n            'A#',\n            'E#',\n            'B#',\n        ];\n    }\n    get sharps() {\n        return this._sharps;\n    }\n    set sharps(s) {\n        this._alteredPitchesCache = [];\n        this._sharps = s;\n    }\n    /**\n     * Gives the width in pixels necessary to represent the key signature.\n     *\n     * @memberof music21.key.KeySignature#\n     * @var {number} width\n     * @readonly\n     */\n    get width() {\n        if (this.sharps === 0) {\n            return 0;\n        } else {\n            // add 6 to add extra space after the KS...\n            return 12 * Math.abs(this.sharps) + 6;\n        }\n    }\n    /**\n     * An Array of Altered Pitches in KeySignature order (i.e., for flats, Bb, Eb, etc.)\n     *\n     * @memberof music21.key.KeySignature#\n     * @var {Array<music21.pitch.Pitch>} alteredPitches\n     * @readonly\n     * @example\n     * var ks = new music21.key.KeySignature(3)\n     * var ap = ks.alteredPitches\n     * var apName = [];\n     * for (var i = 0; i < ap.length; i++) {\n     *     apName.push(ap[i].name);\n     * }\n     * apName\n     * // [\"F#\", \"C#\", \"G#\"]\n     */\n    get alteredPitches() {\n        if (this._alteredPitchesCache !== undefined) {\n            return this._alteredPitchesCache;\n        }\n        let transStr = 'P5';\n        let startPitch = 'B';\n        if (this.sharps < 0) {\n            transStr = 'P4';\n            startPitch = 'F';\n        }\n        const transInterval = new interval.Interval(transStr);\n        const post = [];\n        let pKeep = new pitch.Pitch(startPitch);\n        for (let i = 0; i < Math.abs(this.sharps); i++) {\n            pKeep = transInterval.transposePitch(pKeep);\n            pKeep.octave = 4;\n            post.push(pKeep);\n        }\n        this._alteredPitchesCache = post;\n        return post;\n    }\n    /**\n     * Return the name of the major key with this many sharps\n     *\n     * @memberof music21.key.KeySignature\n     * @returns {(string|undefined)} name of key\n     * @example\n     * var ks = new music21.key.KeySignature(-3)\n     * ks.majorName()\n     * // \"E-\"\n     */\n    majorName() {\n        if (this.sharps >= 0) {\n            return this.sharpMapping[this.sharps];\n        } else {\n            return this.flatMapping[Math.abs(this.sharps)];\n        }\n    }\n    /**\n     * Return the name of the minor key with this many sharps\n     * @memberof music21.key.KeySignature\n     * @returns {(string|undefined)}\n     */\n    minorName() {\n        const tempSharps = this.sharps + 3;\n        if (tempSharps >= 0) {\n            return this.sharpMapping[tempSharps];\n        } else {\n            return this.flatMapping[Math.abs(tempSharps)];\n        }\n    }\n    /**\n     * returns the vexflow name (just the `majorName()` with \"b\" for \"-\") for\n     * the key signature.  Does not create the object.\n     *\n     * Deprecated.\n     *\n     * @memberof music21.key.KeySignature\n     * @returns {string}\n     */\n    vexflow() {\n        console.log('calling deprecated function KeySignature.vexflow');\n        const tempName = this.majorName();\n        return tempName.replace(/-/g, 'b');\n    }\n    /**\n     * Returns the accidental associated with a step in this key, or undefined if none.\n     *\n     * @memberof music21.key.KeySignature\n     * @param {string} step - a valid step name such as \"C\",\"D\", etc., but not \"C#\" etc.\n     * @returns {(music21.pitch.Accidental|undefined)}\n     */\n    accidentalByStep(step) {\n        const aps = this.alteredPitches;\n        for (let i = 0; i < aps.length; i++) {\n            if (aps[i].step === step) {\n                if (aps[i].accidental === undefined) {\n                    return undefined;\n                }\n                // make a new accidental;\n                return new pitch.Accidental(aps[i].accidental.alter);\n            }\n        }\n        return undefined;\n    }\n    /**\n     * Takes a pitch in C major and transposes it so that it has\n     * the same step position in the current key signature.\n     *\n     * @memberof music21.key.KeySignature\n     * @returns {music21.pitch.Pitch}\n     * @example\n     * var ks = new music21.key.KeySignature(-3)\n     * var p1 = new music21.pitch.Pitch('B')\n     * var p2 = ks.transposePitchFromC(p1)\n     * p2.name\n     * // \"D\"\n     * var p3 = new music21.pitch.Pitch('G-')\n     * var p4 = ks.transposePitchFromC(p3)\n     * p4.name\n     * // \"B--\"\n     */\n    transposePitchFromC(p) {\n        let transInterval;\n        let transTimes;\n        if (this.sharps === 0) {\n            return new pitch.Pitch(p.nameWithOctave);\n        } else if (this.sharps < 0) {\n            transTimes = Math.abs(this.sharps);\n            transInterval = new interval.Interval('P4');\n        } else {\n            transTimes = this.sharps;\n            transInterval = new interval.Interval('P5');\n        }\n        let newPitch = p;\n        for (let i = 0; i < transTimes; i++) {\n            newPitch = transInterval.transposePitch(newPitch);\n            if (i % 2 === 1) {\n                newPitch.octave -= 1;\n            }\n        }\n        return newPitch;\n    }\n}\nkey.KeySignature = KeySignature;\n\n/**\n * Create a Key object. Like a KeySignature but with ideas about Tonic, Dominant, etc.\n *\n * TODO: allow keyName to be a {@link music21.pitch.Pitch}\n * TODO: Scale mixin.\n *\n * @class Key\n * @memberof music21.key\n * @extends music21.key.KeySignature\n * @param {string} keyName -- a pitch name representing the key (w/ \"-\" for flat)\n * @param {string} [mode] -- if not given then the CASE of the keyName will be used (\"C\" => \"major\", \"c\" => \"minor\")\n */\nexport class Key extends KeySignature {\n    constructor(keyName, mode) {\n        if (keyName === undefined) {\n            keyName = 'C';\n        }\n        if (mode === undefined) {\n            const lowerCase = keyName.toLowerCase();\n            if (keyName === lowerCase) {\n                mode = 'minor';\n            } else {\n                mode = 'major';\n            }\n        }\n\n        const sharpsArray = 'A-- E-- B-- F- C- G- D- A- E- B- F C G D A E B F# C# G# D# A# E# B#'.split(\n            ' '\n        );\n        const sharpsIndex = sharpsArray.indexOf(keyName.toUpperCase());\n        if (sharpsIndex === -1) {\n            throw new Music21Exception('Cannot find the key for ' + keyName);\n        }\n        const modeShift = key.modeSharpsAlter[mode] || 0;\n        const sharps = sharpsIndex + modeShift - 11;\n        if (debug) {\n            console.log('Found sharps ' + sharps + ' for key: ' + keyName);\n        }\n        super(sharps);\n\n        this.tonic = new pitch.Pitch(keyName);\n        this.mode = mode;\n        this._scale = this.getScale();\n    }\n    /**\n     * returns a {@link music21.scale.MajorScale} or {@link music21.scale.MinorScale}\n     * object from the pitch object.\n     *\n     * @memberof music21.key.Key\n     * @param {string|undefined} [scaleType=this.mode] - the type of scale, or the mode.\n     * @returns {object} A music21.scale.Scale subclass.\n     */\n    getScale(scaleType) {\n        if (scaleType === undefined) {\n            scaleType = this.mode;\n        }\n        const pitchObj = this.tonic;\n        if (scaleType === 'major') {\n            return new scale.MajorScale(pitchObj);\n        } else if (scaleType === 'minor') {\n            return new scale.MinorScale(pitchObj);\n        } else if (['harmonic minor', 'harmonic-minor'].includes(scaleType)) {\n            return new scale.HarmonicMinorScale(pitchObj);\n        } else if (['melodic minor', 'melodic-minor'].includes(scaleType)) {\n            return new scale.AscendingMelodicMinorScale(pitchObj);\n        } else {\n            return new scale.ConcreteScale(pitchObj);\n        }\n    }\n\n    // when scale.js adds functionality, it must be added here.\n    get isConcrete() {\n        return this._scale.isConcrete;\n    }\n    getPitches(...args) {\n        return this._scale.getPitches(...args);\n    }\n    pitchFromDegree(...args) {\n        return this._scale.pitchFromDegree(...args);\n    }\n    getScaleDegreeFromPitch(...args) {\n        return this._scale.getScaleDegreeFromPitch(...args);\n    }\n}\nkey.Key = Key;\n","import { chord } from './chord.js';\nimport { key } from './key.js';\n\nclass Harmony extends chord.Chord {\n    constructor(figure, keywords) {\n        if (keywords === undefined) {\n            keywords = {};\n        }\n\n        super();\n        this._writeAsChord = false;\n        this._roman = undefined;\n        this.chordStepModifications = [];\n        this._degreesList = [];\n        this._key = undefined;\n        // this._updateBasedOnXMLInput(keywords);\n        this._figure = figure;\n        if (keywords.parseFigure !== false && this._figure !== undefined) {\n            this._parseFigure();\n        }\n        if (\n            this._overrides.bass === undefined\n            && this._overrides.root !== undefined\n        ) {\n            this.bass(this._overrides.root);\n        }\n        if (\n            (keywords.updatePitches && this._figure !== undefined)\n            || this._overrides.root !== undefined\n            || this._overrides.bass !== undefined\n        ) {\n            this._updatePitches();\n        }\n        // this._updateBasedOnXMLInput(keywords);\n        if (\n            keywords.parseFigure !== false\n            && this._figure !== undefined\n            && this._figure.indexOf('sus') !== -1\n            && this._figure.indexOf('sus2') === -1\n        ) {\n            this.root(this.bass());\n        }\n    }\n    _parseFigure() {}\n\n    _updatePitches() {}\n\n    get figure() {\n        if (this._figure === undefined) {\n            return this.findFigure();\n        } else {\n            return this._figure;\n        }\n    }\n    set figure(newFigure) {\n        this._figure = newFigure;\n        if (this._figure !== undefined) {\n            this._parseFigure();\n            this._updatePitches();\n        }\n    }\n\n    get key() {\n        return this._key;\n    }\n    set key(keyOrScale) {\n        if (typeof keyOrScale === 'string') {\n            this._key = new key.Key(keyOrScale);\n        } else {\n            this._key = keyOrScale;\n            this._roman = undefined;\n        }\n    }\n\n    findFigure() {\n        return;\n    }\n}\n\nexport const harmony = {\n    Harmony,\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/instrument -- instrument objects\n *\n * Copyright (c) 2013-16, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì16, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { base } from './base.js';\n\n/**\n * Instrument module, see {@link music21.instrument}\n *\n * @exports music21/instrument\n */\n\n/**\n * Looking for the {@link music21.instrument.Instrument} object? :-)\n *\n * @namespace music21.instrument\n * @memberof music21\n * @requires music21/base\n */\nexport const instrument = {};\n\n/**\n * Represents an instrument.  instrumentNames are found in the ext/soundfonts directory\n *\n * See {@link music21.miditools} and esp. `loadSoundfont` for a way of loading soundfonts into\n * instruments.\n *\n * @class Instrument\n * @memberof music21.instrument\n * @param {string} instrumentName\n * @property {string|undefined} partId\n * @property {string|undefined} partName\n * @property {string|undefined} partAbbreviation\n * @property {string|undefined} instrumentId\n * @property {string|undefined} instrumentName\n * @property {string|undefined} instrumentAbbreviation\n * @property {Int|undefined} midiProgram\n * @property {Int|undefined} midiChannel\n * @property {Int|undefined} lowestNote\n * @property {Int|undefined} highestNote\n * @property {music21.interval.Interval|undefined} transposition\n * @property {Boolean} inGMPercMap=false\n * @property {string|undefined} soundfontFn\n * @property {string|undefined} oggSoundfont - url of oggSoundfont for this instrument\n * @property {string|undefined} mp3Soundfont - url of mp3Soundfont for this instrument\n */\nclass Instrument extends base.Music21Object {\n    constructor(instrumentName) {\n        super();\n        this.classSortOrder = -25;\n\n        this.partId = undefined;\n        this.partName = undefined;\n        this.partAbbreviation = undefined;\n\n        this.instrumentId = undefined;\n        this.instrumentName = instrumentName;\n        this.instrumentAbbreviation = undefined;\n        this.midiProgram = undefined;\n        this._midiChannel = undefined;\n\n        this.lowestNote = undefined;\n        this.highestNote = undefined;\n\n        this.transpostion = undefined;\n\n        this.inGMPercMap = false;\n        this.soundfontFn = undefined;\n\n        if (instrumentName !== undefined) {\n            instrument.find(instrumentName, this);\n        }\n    }\n    /**\n     * Assign an instrument to an unused midi channel.\n     *\n     * Will use the global list of used channels (`music21.instrument.Instrument.usedChannels`)\n     * if not given.  Assigns up to `music21.instrument.maxMidi` channels (16)\n     * Skips 10 unless this.inGMPercMap is true\n     *\n     * @memberof music21.instrument.Instrument\n     * @param {Array<Int>} [usedChannels]\n     * @returns {Number}\n     */\n    autoAssignMidiChannel(usedChannels) {\n        if (usedChannels === undefined) {\n            usedChannels = instrument.usedChannels;\n        }\n        let startChannel = 0;\n        if (this.inGMPercMap) {\n            startChannel = 10;\n        }\n        for (let ch = startChannel; ch < instrument.maxMidi; ch++) {\n            if (ch % 16 === 10 && this.inGMPercMap !== true) {\n                continue; // skip 10 / percussion.\n            }\n            if (\n                usedChannels[ch] === undefined\n                || usedChannels[ch] === this.midiProgram\n            ) {\n                usedChannels[ch] = this.midiProgram;\n                this.midiChannel = ch;\n                return ch;\n            }\n        }\n        // TODO: no channels! throw exception!\n        return undefined;\n    }\n    get oggSounfont() {\n        return this.soundfontFn + '-ogg.js';\n    }\n    get mp3Soundfont() {\n        return this.soundfontFn + '-mp3.js';\n    }\n    get midiChannel() {\n        if (this._midiChannel === undefined) {\n            this.autoAssignMidiChannel();\n        }\n        return this._midiChannel;\n    }\n    set midiChannel(ch) {\n        this._midiChannel = ch;\n    }\n}\ninstrument.Instrument = Instrument;\n\ninstrument.usedChannels = []; // differs from m21p -- stored midiProgram numbers\ninstrument.maxMidi = 16;\n\ninstrument.info = [\n    { fn: 'acoustic_grand_piano', name: 'Acoustic Grand Piano', midiNumber: 0 },\n    {\n        fn: 'bright_acoustic_piano',\n        name: 'Bright Acoustic Piano',\n        midiNumber: 1,\n    },\n    { fn: 'electric_grand_piano', name: 'Electric Grand Piano', midiNumber: 2 },\n    { fn: 'honkytonk_piano', name: 'Honky-tonk Piano', midiNumber: 3 },\n    { fn: 'electric_piano_1', name: 'Electric Piano 1', midiNumber: 4 },\n    { fn: 'electric_piano_2', name: 'Electric Piano 2', midiNumber: 5 },\n    { fn: 'harpsichord', name: 'Harpsichord', midiNumber: 6 },\n    { fn: 'clavinet', name: 'Clavinet', midiNumber: 7 },\n    { fn: 'celesta', name: 'Celesta', midiNumber: 8 },\n    { fn: 'glockenspiel', name: 'Glockenspiel', midiNumber: 9 },\n    { fn: 'music_box', name: 'Music Box', midiNumber: 10 },\n    { fn: 'vibraphone', name: 'Vibraphone', midiNumber: 11 },\n    { fn: 'marimba', name: 'Marimba', midiNumber: 12 },\n    { fn: 'xylophone', name: 'Xylophone', midiNumber: 13 },\n    { fn: 'tubular_bells', name: 'Tubular Bells', midiNumber: 14 },\n    { fn: 'dulcimer', name: 'Dulcimer', midiNumber: 15 },\n    { fn: 'drawbar_organ', name: 'Drawbar Organ', midiNumber: 16 },\n    { fn: 'percussive_organ', name: 'Percussive Organ', midiNumber: 17 },\n    { fn: 'rock_organ', name: 'Rock Organ', midiNumber: 18 },\n    { fn: 'church_organ', name: 'Church Organ', midiNumber: 19 },\n    { fn: 'reed_organ', name: 'Reed Organ', midiNumber: 20 },\n    { fn: 'accordion', name: 'Accordion', midiNumber: 21 },\n    { fn: 'harmonica', name: 'Harmonica', midiNumber: 22 },\n    { fn: 'tango_accordion', name: 'Tango Accordion', midiNumber: 23 },\n    {\n        fn: 'acoustic_guitar_nylon',\n        name: 'Acoustic Guitar (nylon)',\n        midiNumber: 24,\n    },\n    {\n        fn: 'acoustic_guitar_steel',\n        name: 'Acoustic Guitar (steel)',\n        midiNumber: 25,\n    },\n    {\n        fn: 'electric_guitar_jazz',\n        name: 'Electric Guitar (jazz)',\n        midiNumber: 26,\n    },\n    {\n        fn: 'electric_guitar_clean',\n        name: 'Electric Guitar (clean)',\n        midiNumber: 27,\n    },\n    {\n        fn: 'electric_guitar_muted',\n        name: 'Electric Guitar (muted)',\n        midiNumber: 28,\n    },\n    { fn: 'overdriven_guitar', name: 'Overdriven Guitar', midiNumber: 29 },\n    { fn: 'distortion_guitar', name: 'Distortion Guitar', midiNumber: 30 },\n    { fn: 'guitar_harmonics', name: 'Guitar Harmonics', midiNumber: 31 },\n    { fn: 'acoustic_bass', name: 'Acoustic Bass', midiNumber: 32 },\n    {\n        fn: 'electric_bass_finger',\n        name: 'Electric Bass (finger)',\n        midiNumber: 33,\n    },\n    { fn: 'electric_bass_pick', name: 'Electric Bass (pick)', midiNumber: 34 },\n    { fn: 'fretless_bass', name: 'Fretless Bass', midiNumber: 35 },\n    { fn: 'slap_bass_1', name: 'Slap Bass 1', midiNumber: 36 },\n    { fn: 'slap_bass_2', name: 'Slap Bass 2', midiNumber: 37 },\n    { fn: 'synth_bass_1', name: 'Synth Bass 1', midiNumber: 38 },\n    { fn: 'synth_bass_2', name: 'Synth Bass 2', midiNumber: 39 },\n    { fn: 'violin', name: 'Violin', midiNumber: 40 },\n    { fn: 'viola', name: 'Viola', midiNumber: 41 },\n    { fn: 'cello', name: 'Cello', midiNumber: 42 },\n    { fn: 'contrabass', name: 'Contrabass', midiNumber: 43 },\n    { fn: 'tremolo_strings', name: 'Tremolo Strings', midiNumber: 44 },\n    { fn: 'pizzicato_strings', name: 'Pizzicato Strings', midiNumber: 45 },\n    { fn: 'orchestral_harp', name: 'Orchestral Harp', midiNumber: 46 },\n    { fn: 'timpani', name: 'Timpani', midiNumber: 47 },\n    { fn: 'string_ensemble_1', name: 'String Ensemble 1', midiNumber: 48 },\n    { fn: 'string_ensemble_2', name: 'String Ensemble 2', midiNumber: 49 },\n    { fn: 'synth_strings_1', name: 'Synth Strings 1', midiNumber: 50 },\n    { fn: 'synth_strings_2', name: 'Synth Strings 2', midiNumber: 51 },\n    { fn: 'choir_aahs', name: 'Choir Aahs', midiNumber: 52 },\n    { fn: 'voice_oohs', name: 'Voice Oohs', midiNumber: 53 },\n    { fn: 'synth_choir', name: 'Synth Choir', midiNumber: 54 },\n    { fn: 'orchestra_hit', name: 'Orchestra Hit', midiNumber: 55 },\n    { fn: 'trumpet', name: 'Trumpet', midiNumber: 56 },\n    { fn: 'trombone', name: 'Trombone', midiNumber: 57 },\n    { fn: 'tuba', name: 'Tuba', midiNumber: 58 },\n    { fn: 'muted_trumpet', name: 'Muted Trumpet', midiNumber: 59 },\n    { fn: 'french_horn', name: 'French Horn', midiNumber: 60 },\n    { fn: 'brass_section', name: 'Brass Section', midiNumber: 61 },\n    { fn: 'synth_brass_1', name: 'Synth Brass 1', midiNumber: 62 },\n    { fn: 'synth_brass_2', name: 'Synth Brass 2', midiNumber: 63 },\n    { fn: 'soprano_sax', name: 'Soprano Sax', midiNumber: 64 },\n    { fn: 'alto_sax', name: 'Alto Sax', midiNumber: 65 },\n    { fn: 'tenor_sax', name: 'Tenor Sax', midiNumber: 66 },\n    { fn: 'baritone_sax', name: 'Baritone Sax', midiNumber: 67 },\n    { fn: 'oboe', name: 'Oboe', midiNumber: 68 },\n    { fn: 'english_horn', name: 'English Horn', midiNumber: 69 },\n    { fn: 'bassoon', name: 'Bassoon', midiNumber: 70 },\n    { fn: 'clarinet', name: 'Clarinet', midiNumber: 71 },\n    { fn: 'piccolo', name: 'Piccolo', midiNumber: 72 },\n    { fn: 'flute', name: 'Flute', midiNumber: 73 },\n    { fn: 'recorder', name: 'Recorder', midiNumber: 74 },\n    { fn: 'pan_flute', name: 'Pan Flute', midiNumber: 75 },\n    { fn: 'blown_bottle', name: 'Blown bottle', midiNumber: 76 },\n    { fn: 'shakuhachi', name: 'Shakuhachi', midiNumber: 77 },\n    { fn: 'whistle', name: 'Whistle', midiNumber: 78 },\n    { fn: 'ocarina', name: 'Ocarina', midiNumber: 79 },\n    { fn: 'lead_1_square', name: 'Lead 1 (square)', midiNumber: 80 },\n    { fn: 'lead_2_sawtooth', name: 'Lead 2 (sawtooth)', midiNumber: 81 },\n    { fn: 'lead_3_calliope', name: 'Lead 3 (calliope)', midiNumber: 82 },\n    { fn: 'lead_4_chiff', name: 'Lead 4 chiff', midiNumber: 83 },\n    { fn: 'lead_5_charang', name: 'Lead 5 (charang)', midiNumber: 84 },\n    { fn: 'lead_6_voice', name: 'Lead 6 (voice)', midiNumber: 85 },\n    { fn: 'lead_7_fifths', name: 'Lead 7 (fifths)', midiNumber: 86 },\n    { fn: 'lead_8_bass__lead', name: 'Lead 8 (bass + lead)', midiNumber: 87 },\n    { fn: 'pad_1_new_age', name: 'Pad 1 (new age)', midiNumber: 88 },\n    { fn: 'pad_2_warm', name: 'Pad 2 (warm)', midiNumber: 89 },\n    { fn: 'pad_3_polysynth', name: 'Pad 3 (polysynth)', midiNumber: 90 },\n    { fn: 'pad_4_choir', name: 'Pad 4 (choir)', midiNumber: 91 },\n    { fn: 'pad_5_bowed', name: 'Pad 5 (bowed)', midiNumber: 92 },\n    { fn: 'pad_6_metallic', name: 'Pad 6 (metallic)', midiNumber: 93 },\n    { fn: 'pad_7_halo', name: 'Pad 7 (halo)', midiNumber: 94 },\n    { fn: 'pad_8_sweep', name: 'Pad 8 (sweep)', midiNumber: 95 },\n    { fn: 'fx_1_rain', name: 'FX 1 (rain)', midiNumber: 96 },\n    { fn: 'fx_2_soundtrack', name: 'FX 2 (soundtrack)', midiNumber: 97 },\n    { fn: 'fx_3_crystal', name: 'FX 3 (crystal)', midiNumber: 98 },\n    { fn: 'fx_4_atmosphere', name: 'FX 4 (atmosphere)', midiNumber: 99 },\n    { fn: 'fx_5_brightness', name: 'FX 5 (brightness)', midiNumber: 100 },\n    { fn: 'fx_6_goblins', name: 'FX 6 (goblins)', midiNumber: 101 },\n    { fn: 'fx_7_echoes', name: 'FX 7 (echoes)', midiNumber: 102 },\n    { fn: 'fx_8_scifi', name: 'FX 8 (sci-fi)', midiNumber: 103 },\n    { fn: 'sitar', name: 'Sitar', midiNumber: 104 },\n    { fn: 'banjo', name: 'Banjo', midiNumber: 105 },\n    { fn: 'shamisen', name: 'Shamisen', midiNumber: 106 },\n    { fn: 'koto', name: 'Koto', midiNumber: 107 },\n    { fn: 'kalimba', name: 'Kalimba', midiNumber: 108 },\n    { fn: 'bagpipe', name: 'Bagpipe', midiNumber: 109 },\n    { fn: 'fiddle', name: 'Fiddle', midiNumber: 110 },\n    { fn: 'shanai', name: 'Shanai', midiNumber: 111 },\n    { fn: 'tinkle_bell', name: 'Tinkle Bell', midiNumber: 112 },\n    { fn: 'agogo', name: 'Agogo', midiNumber: 113 },\n    { fn: 'steel_drums', name: 'Steel Drums', midiNumber: 114 },\n    { fn: 'woodblock', name: 'Woodblock', midiNumber: 115 },\n    { fn: 'taiko_drum', name: 'Taiko Drum', midiNumber: 116 },\n    { fn: 'melodic_tom', name: 'Melodic Tom', midiNumber: 117 },\n    { fn: 'synth_drum', name: 'Synth Drum', midiNumber: 118 },\n    { fn: 'reverse_cymbal', name: 'Reverse Cymbal', midiNumber: 119 },\n    { fn: 'guitar_fret_noise', name: 'Guitar Fret Noise', midiNumber: 120 },\n    { fn: 'breath_noise', name: 'Breath Noise', midiNumber: 121 },\n    { fn: 'seashore', name: 'Seashore', midiNumber: 122 },\n    { fn: 'bird_tweet', name: 'Bird Tweet', midiNumber: 123 },\n    { fn: 'telephone_ring', name: 'Telephone Ring', midiNumber: 124 },\n    { fn: 'helicopter', name: 'Helicopter', midiNumber: 125 },\n    { fn: 'applause', name: 'Applause', midiNumber: 126 },\n    { fn: 'gunshot', name: 'Gunshot', midiNumber: 127 },\n];\n\n/**\n * Find information for a given instrument (by filename or name)\n * and load it into an instrument object.\n *\n * @function music21.instrument.find\n * @memberof music21.instrument\n * @param {string} fn - name or filename of instrument\n * @param {music21.instrument.Instrument} [inst] - instrument object to load into\n * @returns {music21.instrument.Instrument|undefined}\n */\ninstrument.find = function instrument_find(fn, inst) {\n    if (inst === undefined) {\n        inst = new instrument.Instrument();\n    }\n    for (let i = 0; i < instrument.info.length; i++) {\n        const info = instrument.info[i];\n        if (info.fn === fn || info.name === fn) {\n            inst.soundfontFn = info.fn;\n            inst.instrumentName = info.name;\n            inst.midiProgram = info.midiNumber;\n            return inst;\n        }\n    }\n    return undefined;\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/miditools -- A collection of tools for midi. See the namespace {@link music21.miditools}\n *\n * Copyright (c) 2014-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n * @author Michael Scott Cuthbert\n */\nimport * as $ from 'jquery';\nimport * as eventjs from 'eventjs'; // drag handler...\nimport * as MIDI from 'MIDI';\n\nimport { chord } from './chord.js';\nimport { common } from './common.js';\nimport { debug } from './debug.js';\nimport { instrument } from './instrument.js';\nimport { note } from './note.js';\n\n/**\n * A collection of tools for midi. See the namespace {@link music21.miditools}\n *\n * @exports music21/miditools\n */\n/**\n * Module that holds **music21** tools for connecting with MIDI.js and somewhat with the\n * events from the Jazz plugin or the WebMIDI protocol.\n *\n * @namespace music21.miditools\n * @memberof music21\n */\nexport const miditools = {};\n\n/**\n * Number of octaves to transpose all incoming midi signals\n *\n * @type {number}\n * @default 0\n */\nmiditools.transposeOctave = 0;\n/**\n * @class Event\n * @memberof music21.miditools\n * @param {number} t - timing information\n * @param {number} a - midi data 1 (N.B. a >> 4 = midiCommand )\n * @param {number} b - midi data 2\n * @param {number} c - midi data 3\n */\nexport class Event {\n    constructor(t, a, b, c) {\n        this.timing = t;\n        this.data1 = a;\n        this.data2 = b;\n        this.data3 = c;\n        this.midiCommand = a >> 4;\n\n        this.noteOff = this.midiCommand === 8;\n        this.noteOn = this.midiCommand === 9;\n\n        this.midiNote = undefined;\n        if (this.noteOn || this.noteOff) {\n            this.midiNote = this.data2 + 12 * miditools.transposeOctave;\n            this.velocity = this.data3;\n        }\n    }\n    /**\n     * Calls MIDI.noteOn or MIDI.noteOff for the note\n     * represented by the Event (if appropriate)\n     *\n     * @memberof music21.miditools.Event\n     * @returns {undefined}\n     */\n    sendToMIDIjs() {\n        if (MIDI !== undefined && MIDI.noteOn !== undefined) {\n            // noteOn check because does not exist if no audio context\n            // or soundfont has been loaded, such as if a play event\n            // is triggered before soundfont has been loaded.\n            if (this.noteOn) {\n                MIDI.noteOn(0, this.midiNote, this.velocity, 0);\n            } else if (this.noteOff) {\n                MIDI.noteOff(0, this.midiNote, 0);\n            }\n        } else {\n            console.warn('could not playback note because no MIDIout defined');\n        }\n    }\n    /**\n     * Makes a {@link music21.note.Note} object from the event's midiNote number.\n     *\n     * @memberof music21.miditools.Event\n     * @returns {music21.note.Note} - the {@link music21.note.Note} object represented by Event.midiNote\n     */\n    music21Note() {\n        const m21n = new note.Note();\n        m21n.pitch.ps = this.midiNote;\n        return m21n;\n    }\n}\nmiditools.Event = Event;\n\n/**\n * How long to wait in milliseconds before deciding that a note belongs to another chord. Default 100ms\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.maxDelay = 100; // in ms\n/**\n * At what time (in ms since Epoch) the chord started.\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.heldChordTime = 0;\n/**\n * An Array (or undefined) of currently held chords that have not been sent out yet.\n *\n * @memberof music21.miditools\n * @type {Array|undefined}\n */\nmiditools.heldChordNotes = undefined;\n\n/**\n * When, in MS since Jan 1, 1970, was the last {@link music21.note.Note} played.\n * Defaults to the time that the module was loaded.\n *\n * @memberof music21.miditools\n * @type {number}\n */\nmiditools.timeOfLastNote = Date.now(); // in ms\n\nmiditools._baseTempo = 60;\n/**\n * Assign (or query) a Metronome object to run all timing information.\n *\n * @memberof music21.miditools\n * @type {music21.tempo.Metronome}\n */\nmiditools.metronome = undefined;\n\nObject.defineProperties(miditools, {\n    tempo: {\n        enumerable: true,\n        get() {\n            if (this.metronome === undefined) {\n                return this._baseTempo;\n            } else {\n                return this.metronome.tempo;\n            }\n        },\n        set(t) {\n            if (this.metronome === undefined) {\n                this._baseTempo = t;\n            } else {\n                this.metronome.tempo = t;\n            }\n        },\n    },\n});\n\n/* --------- chords ------------- */\n/**\n *  Clears chords that are older than miditools.heldChordTime\n *\n *  Runs a setTimeout on itself.\n *  Calls miditools.sendOutChord\n *\n *  @memberof music21.miditools\n */\nmiditools.clearOldChords = function clearOldChords() {\n    // clear out notes that may be a chord...\n    const nowInMs = Date.now(); // in ms\n    if (miditools.heldChordTime + miditools.maxDelay < nowInMs) {\n        miditools.heldChordTime = nowInMs;\n        if (miditools.heldChordNotes !== undefined) {\n            // console.log('to send out chords');\n            miditools.sendOutChord(miditools.heldChordNotes);\n            miditools.heldChordNotes = undefined;\n        }\n    }\n    setTimeout(miditools.clearOldChords, miditools.maxDelay);\n};\n/**\n *  Take a series of jEvent noteOn objects and convert them to a single Chord object\n *  so long as they are all sounded within miditools.maxDelay milliseconds of each other.\n *  this method stores notes in miditools.heldChordNotes (Array).\n *\n *  @param {music21.miditools.Event} jEvent\n *  @memberof music21.miditools\n *  @returns undefined\n */\nmiditools.makeChords = function makeChords(jEvent) {\n    // jEvent is a miditools.Event object\n    if (jEvent.noteOn) {\n        const m21n = jEvent.music21Note();\n        if (miditools.heldChordNotes === undefined) {\n            miditools.heldChordNotes = [m21n];\n        } else {\n            for (let i = 0; i < miditools.heldChordNotes.length; i++) {\n                const foundNote = miditools.heldChordNotes[i];\n                if (foundNote.pitch.ps === m21n.pitch.ps) {\n                    return; // no duplicates\n                }\n            }\n            miditools.heldChordNotes.push(m21n);\n        }\n    }\n};\n\n/**\n * The last Note or Chord to be sent out from miditools.  This is an important semi-global\n * attribute, since the last element may need to be quantized by quantizeLastNote() to\n * determine its length, since the note may need to be placed into a staff before its total\n * length can be determined.\n *\n * @memberof music21.miditools\n * @type {music21.chord.Chord|music21.note.Note|undefined}\n */\nmiditools.lastElement = undefined;\n\n/**\n * Take the list of Notes and makes a chord out of it, if appropriate and call\n * {@link music21.miditools.callBacks.sendOutChord} callback with the Chord or Note as a parameter.\n *\n * @memberof music21.miditools\n * @param {Array<music21.note.Note>} chordNoteList - an Array of {@link music21.note.Note} objects\n * @returns {(music21.note.Note|music21.chord.Chord|undefined)} A {@link music21.chord.Chord} object,\n * most likely, but maybe a {@link music21.note.Note} object)\n */\nmiditools.sendOutChord = function sendOutChord(chordNoteList) {\n    let appendObject;\n    if (chordNoteList.length > 1) {\n        // console.log(chordNoteList[0].name, chordNoteList[1].name);\n        appendObject = new chord.Chord(chordNoteList);\n    } else if (chordNoteList.length === 1) {\n        appendObject = chordNoteList[0]; // note object\n    } else {\n        return undefined;\n    }\n    appendObject.stemDirection = 'noStem';\n    miditools.quantizeLastNote();\n    miditools.lastElement = appendObject;\n    if (miditools.callBacks.sendOutChord !== undefined) {\n        miditools.callBacks.sendOutChord(appendObject);\n    }\n    return appendObject;\n};\n\n/* ----------- callbacks --------- */\n// TODO: all callbacks (incl. raw, sendOutChord) should be able to be a function or an array of functions\n\n/**\n* callBacks is an object with three keys:\n*\n* - raw: function (t, a, b,c) to call when any midievent arrives. Default: `function (t, a, b, c) { return new miditools.Event(t, a, b, c); }`\n* - general: function ( miditools.Event() ) to call when an Event object has been created. Default: `[miditools.sendToMIDIjs, miditools.quantizeLastNote]`\n* - sendOutChord: function (array_of_note.Note_objects) to call when a sufficient time has passed to build a chord from input. Default: empty function.\n*\n* At present, only \"general\" can take an Array of event listening functions, but I hope to change that for sendOutChord also.\n*\n* \"general\" is usually the callback list to play around with.\n*\n* @memberof music21.miditools\n*/\nmiditools.callBacks = {\n    raw: (t, a, b, c) => new miditools.Event(t, a, b, c),\n    general: [miditools.sendToMIDIjs, miditools.quantizeLastNote],\n    sendOutChord: arrayOfNotes => {},\n};\n\n/**\n * Quantizes the lastElement (passed in) or music21.miditools.lastElement.\n *\n * @memberof music21.miditools\n * @param {music21.note.GeneralNote} lastElement - A {@link music21.note.Note} to be quantized\n * @returns {music21.note.GeneralNote} The same {@link music21.note.Note} object passed in with\n * duration quantized\n */\nmiditools.quantizeLastNote = function quantizeLastNote(lastElement) {\n    if (lastElement === undefined) {\n        lastElement = this.lastElement;\n        if (lastElement === undefined) {\n            return undefined;\n        }\n    }\n    lastElement.stemDirection = undefined;\n    const nowInMS = Date.now();\n    const msSinceLastNote = nowInMS - this.timeOfLastNote;\n    this.timeOfLastNote = nowInMS;\n    const normalQuarterNoteLength = 1000 * 60 / this.tempo;\n    const numQuarterNotes = msSinceLastNote / normalQuarterNoteLength;\n    let roundedQuarterLength = Math.round(4 * numQuarterNotes) / 4;\n    if (roundedQuarterLength >= 4) {\n        roundedQuarterLength = 4;\n    } else if (roundedQuarterLength >= 3) {\n        roundedQuarterLength = 3;\n    } else if (roundedQuarterLength > 2) {\n        roundedQuarterLength = 2;\n    } else if (roundedQuarterLength === 1.25) {\n        roundedQuarterLength = 1;\n    } else if (roundedQuarterLength === 0.75) {\n        roundedQuarterLength = 0.5;\n    } else if (roundedQuarterLength === 0) {\n        roundedQuarterLength = 0.125;\n    }\n    lastElement.duration.quarterLength = roundedQuarterLength;\n    return lastElement;\n};\n\n/* ----------- callbacks --------- */\n/**\n * Callback to midiEvent.sendToMIDIjs.\n *\n * @memberof music21.miditools\n * @param {music21.miditools.Event} midiEvent - event to send out.\n * @returns undefined\n */\nmiditools.sendToMIDIjs = midiEvent => {\n    midiEvent.sendToMIDIjs();\n};\n\n/* ------------ MIDI.js ----------- */\n\n/**\n * a mapping of soundfont text names to true, false, or \"loading\".\n *\n * @memberof music21.miditools\n * @type {object}\n */\nmiditools.loadedSoundfonts = {};\n\n/**\n * Called after a soundfont has been loaded. The callback is better to be specified elsewhere\n * rather than overriding this important method.\n *\n * @memberof music21.miditools\n * @param {String} soundfont The name of the soundfont that was just loaded\n * @param {function} callback A function to be called after the soundfont is loaded.\n */\nmiditools.postLoadCallback = function postLoadCallback(soundfont, callback) {\n    // this should be bound to MIDI\n    if (debug) {\n        console.log('soundfont loaded about to execute callback.');\n        console.log(\n            'first playing two notes very softly -- seems to flush the buffer.'\n        );\n    }\n    $('.loadingSoundfont').remove();\n\n    const isFirefox = typeof InstallTrigger !== 'undefined'; // Firefox 1.0+\n    const isAudioTag = MIDI.technology === 'HTML Audio Tag';\n    const instrumentObj = instrument.find(soundfont);\n    if (instrumentObj !== undefined) {\n        MIDI.programChange(\n            instrumentObj.midiChannel,\n            instrumentObj.midiProgram\n        );\n        if (debug) {\n            console.log(\n                soundfont + ' (' + instrumentObj.midiProgram + ') loaded on ',\n                instrumentObj.midiChannel\n            );\n        }\n        if (isFirefox === false && isAudioTag === false) {\n            // Firefox ignores sound volume! so don't play! \n            // as does IE and others using HTML audio tag.\n            const channel = instrumentObj.midiChannel;\n            MIDI.noteOn(channel, 36, 1, 0);    // if no notes have been played before then\n            MIDI.noteOff(channel, 36, 1, 0.1); // the second note to be played is always\n            MIDI.noteOn(channel, 48, 1, 0.2);  // very clipped (on Safari at least)\n            MIDI.noteOff(channel, 48, 1, 0.3); // this helps a lot.\n            MIDI.noteOn(channel, 60, 1, 0.3);  // chrome needs three notes?\n            MIDI.noteOff(channel, 60, 1, 0.4);\n        }\n    }\n    if (callback !== undefined) {\n        callback(instrumentObj);\n    }\n    miditools.loadedSoundfonts[soundfont] = true;\n};\n\n/**\n * method to load soundfonts while waiting for other processes that need them\n * to load first.\n *\n * @memberof music21.miditools\n * @param {String} soundfont The name of the soundfont that was just loaded\n * @param {function} callback A function to be called after the soundfont is loaded.\n * @example\n * s = new music21.stream.Stream();\n * music21.miditools.loadSoundfont(\n *     'clarinet',\n *     function(i) {\n *         console.log('instrument object', i, 'loaded');\n *         s.instrument = i;\n * });\n */\nmiditools.loadSoundfont = function loadSoundfont(soundfont, callback) {\n    if (miditools.loadedSoundfonts[soundfont] === true) {\n        // this soundfont has already been loaded once, so just call the callback.\n        if (callback !== undefined) {\n            const instrumentObj = instrument.find(soundfont);\n            callback(instrumentObj);\n        }\n    } else if (miditools.loadedSoundfonts[soundfont] === 'loading') {\n        // we are still waiting for this instrument to load, so\n        // wait for it before calling callback.\n        const waitThenCall = () => {\n            if (miditools.loadedSoundfonts[soundfont] === true) {\n                if (debug) {\n                    console.log(\n                        'other process has finished loading; calling callback'\n                    );\n                }\n                if (callback !== undefined) {\n                    const instrumentObj = instrument.find(soundfont);\n                    callback(instrumentObj);\n                }\n            } else {\n                if (debug) {\n                    console.log('waiting for other process load');\n                }\n                setTimeout(waitThenCall, 100);\n            }\n        };\n        waitThenCall();\n    } else {\n        // soundfont we have not seen before:\n        // set its status to loading and then load it.\n        miditools.loadedSoundfonts[soundfont] = 'loading';\n        if (debug) {\n            console.log('waiting for document ready');\n        }\n        $(document).ready(() => {\n            if (debug) {\n                console.log('document ready, waiting to load soundfont');\n            }\n            $(document.body).append(\n                $(\n                    \"<div class='loadingSoundfont'><b>Loading MIDI Instrument</b>: \"\n                        + 'audio will begin when this message disappears.</div>'\n                )\n            );\n            MIDI.loadPlugin({\n                soundfontUrl: common.urls.soundfontUrl,\n                instrument: soundfont,\n                onsuccess: miditools.postLoadCallback.bind(\n                    MIDI,\n                    soundfont,\n                    callback\n                ),\n            });\n        });\n    }\n};\n\n/**\n * MidiPlayer -- an embedded midi player including the ability to create a\n * playback device.\n *\n * @class MidiPlayer\n * @memberOf music21.miditools\n * @property {number} speed - playback speed scaling (1=default).\n * @property {JQueryDOMObject|undefined} $playDiv - div holding the player,\n */\nexport class MidiPlayer {\n    constructor() {\n        this.player = new MIDI.Players.PlayInstance();\n        this.speed = 1.0;\n        this.$playDiv = undefined;\n    }\n    /**\n     * @param where\n     * @returns DOMElement\n     */\n    addPlayer(where) {\n        let $where = where;\n        if (where === undefined) {\n            where = document.body;\n        }\n        if (where.jquery === undefined) {\n            $where = $(where);\n        }\n        const $playDiv = $('<div class=\"midiPlayer\">');\n        const $controls = $('<div class=\"positionControls\">');\n        const $playPause = $(\n            '<input type=\"image\" src=\"'\n                + this.playPng()\n                + '\" align=\"absmiddle\" value=\"play\" class=\"playPause\">'\n        );\n        const $stop = $(\n            '<input type=\"image\" src=\"'\n                + this.stopPng()\n                + '\" align=\"absmiddle\" value=\"stop\" class=\"stopButton\">'\n        );\n\n        $playPause.on('click', this.pausePlayStop.bind(this));\n        $stop.on('click', this.stopButton.bind(this));\n        $controls.append($playPause);\n        $controls.append($stop);\n        $playDiv.append($controls);\n\n        const $time = $('<div class=\"timeControls\">');\n        const $timePlayed = $('<span class=\"timePlayed\">0:00</span>');\n        const $capsule = $(\n            '<span class=\"capsule\"><span class=\"cursor\"></span></span>'\n        );\n        const $timeRemaining = $('<span class=\"timeRemaining\">-0:00</span>');\n        $time.append($timePlayed);\n        $time.append($capsule);\n        $time.append($timeRemaining);\n        $playDiv.append($time);\n\n        $where.append($playDiv);\n        this.$playDiv = $playDiv;\n        return $playDiv;\n    }\n\n    stopButton() {\n        this.pausePlayStop('yes');\n    }\n\n    playPng() {\n        return common.urls.midiPlayer + '/play.png';\n    }\n    pausePng() {\n        return common.urls.midiPlayer + '/pause.png';\n    }\n    stopPng() {\n        return common.urls.midiPlayer + '/stop.png';\n    }\n\n    pausePlayStop(stop) {\n        let d;\n        if (this.$playDiv === undefined) {\n            d = { src: 'doesnt matter' };\n        } else {\n            d = this.$playDiv.find('.playPause')[0];\n        }\n        if (stop === 'yes') {\n            this.player.stop();\n            d.src = this.playPng();\n        } else if (this.player.playing || stop === 'pause') {\n            d.src = this.playPng();\n            this.player.pause(true);\n        } else {\n            d.src = this.pausePng();\n            this.player.resume();\n        }\n    }\n\n    base64Load(b64data) {\n        const player = this.player;\n        player.timeWarp = this.speed;\n\n        const m21midiplayer = this;\n        miditools.loadSoundfont('acoustic_grand_piano', () => {\n            player.loadFile(\n                b64data,\n                () => {\n                    // success\n                    m21midiplayer.fileLoaded();\n                },\n                undefined, // loading\n                e => {\n                    // failure\n                    console.log(e);\n                }\n            );\n        });\n    }\n\n    songFinished() {\n        this.pausePlayStop('yes');\n    }\n\n    fileLoaded() {\n        this.updatePlaying();\n    }\n\n    startAndUpdate() {\n        this.player.start();\n        this.updatePlaying();\n    }\n\n    updatePlaying() {\n        const self = this;\n        const player = this.player;\n        if (this.$playDiv === undefined) {\n            return;\n        }\n        const $d = this.$playDiv;\n        // update the timestamp\n        const timePlayed = $d.find('.timePlayed')[0];\n        const timeRemaining = $d.find('.timeRemaining')[0];\n        const timeCursor = $d.find('.cursor')[0];\n        const $capsule = $d.find('.capsule');\n        //\n        eventjs.add($capsule[0], 'drag', (event, self) => {\n            eventjs.cancel(event);\n            const player = this.player;\n            player.currentTime = self.x / 420 * player.endTime;\n            if (player.currentTime < 0) {\n                player.currentTime = 0;\n            }\n            if (player.currentTime > player.endTime) {\n                player.currentTime = player.endTime;\n            }\n            if (self.state === 'down') {\n                this.pausePlayStop('pause');\n            } else if (self.state === 'up') {\n                this.pausePlayStop('play');\n            }\n        });\n        //\n        function timeFormatting(n) {\n            const minutes = (n / 60) >> 0;\n            let seconds = String((n - minutes * 60) >> 0);\n            if (seconds.length === 1) {\n                seconds = '0' + seconds;\n            }\n            return minutes + ':' + seconds;\n        }\n\n        player.setAnimation(data => {\n            const percent = data.now / data.end;\n            const now = data.now >> 0; // where we are now\n            const end = data.end >> 0; // end of song\n            if (now === end) {\n                // go to next song\n                self.songFinished();\n            }\n            // display the information to the user\n            timeCursor.style.width = percent * 100 + '%';\n            timePlayed.innerHTML = timeFormatting(now);\n            timeRemaining.innerHTML = '-' + timeFormatting(end - now);\n        });\n    }\n}\nmiditools.MidiPlayer = MidiPlayer;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/keyboard -- PianoKeyboard rendering and display objects\n *\n * Copyright (c) 2013-18, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\n\n// Minimum usage:\n\n// var kd = document.getElementById('keyboardDiv');\n// k = new music21.keyboard.Keyboard();\n// k.appendKeyboard(kd, 6, 57); // 88 key keyboard\n\n// configurable:\n// k.scaleFactor = 1.2;  // default 1\n// k.whiteKeyWidth = 40; // default 23\nimport * as MIDI from 'MIDI';\nimport * as $ from 'jquery';\n\nimport { common } from './common.js';\nimport { miditools } from './miditools.js';\nimport { pitch } from './pitch.js';\n\n/**\n * Keyboard module, see {@link music21.keyboard} namespace\n *\n * @exports music21/keyboard\n */\n/**\n * keyboard namespace -- tools for creating an onscreen keyboard and interacting with it.\n *\n * @namespace music21.keyboard\n * @memberof music21\n * @requires music21/pitch\n * @requires music21/common\n * @requires music21/miditools\n * @requires jquery\n * @requires MIDI\n */\nexport const keyboard = {};\n/**\n * Represents a single Key\n *\n * @class Key\n * @memberof music21.keyboard\n * @property {Array<function>} callbacks - called when key is clicked/selected\n * @property {number} [scaleFactor=1]\n * @property {music21.keyboard.Keyboard|undefined} parent\n * @property {Int} id - midinumber associated with the key.\n * @property {music21.pitch.Pitch|undefined} pitchObj\n * @property {DOMObject|undefined} svgObj - SVG representing the drawing of the key\n * @property {DOMObject|undefined} noteNameSvgObj - SVG representing the note name drawn on the key\n * @property {string} keyStyle='' - css style information for the key\n * @property {string} keyClass='' - css class information for the key (\"keyboardkey\" + this is the class)\n * @property {number} width - width of key\n * @property {number} height - height of key\n */\nexport class Key {\n    constructor() {\n        this.classes = ['Key']; // name conflict with key.Key\n        this.callbacks = [];\n        this.scaleFactor = 1;\n        this.parent = undefined;\n        this.id = 0;\n        this.width = 23;\n        this.height = 120;\n        this.pitchObj = undefined;\n        this.svgObj = undefined;\n        this.noteNameSvgObj = undefined;\n        this.keyStyle = '';\n        this.keyClass = '';\n    }\n    /**\n     * Gets an SVG object for the key\n     *\n     * @method music21.keyboard.Key#makeKey\n     * @memberof music21.keyboard.Key\n     * @param {number} startX - X position in pixels from left of keyboard to draw key at\n     * @returns {DOMObject} a SVG rectangle for the key\n     */\n    makeKey(startX) {\n        const keyattrs = {\n            style: this.keyStyle,\n            x: startX,\n            y: 0,\n            class: 'keyboardkey ' + this.keyClass,\n            id: this.id,\n            width: this.width * this.scaleFactor,\n            height: this.height * this.scaleFactor,\n            rx: 3,\n            ry: 3,\n        };\n        const keyDOM = common.makeSVGright('rect', keyattrs);\n        for (const x in this.callbacks) {\n            if ({}.hasOwnProperty.call(this.callbacks, x)) {\n                keyDOM.addEventListener(x, this.callbacks[x], false);\n            }\n        }\n        this.svgObj = keyDOM;\n        return keyDOM;\n    }\n    /**\n     * Adds a circle (red) on the key (to mark middle C etc.)\n     *\n     * @method music21.keyboard.Key#addCircle\n     * @param {string} [strokeColor='red']\n     * @returns {DOMObject}\n     */\n    addCircle(strokeColor) {\n        if (\n            this.svgObj === undefined\n            || this.parent === undefined\n            || this.parent.svgObj === undefined\n        ) {\n            return undefined;\n        }\n        if (strokeColor === undefined) {\n            strokeColor = 'red';\n        }\n        const x = parseInt(this.svgObj.getAttribute('x'));\n        const cx = x + this.parent.scaleFactor * this.width / 2;\n        // console.log('cx', cx);\n        const keyattrs = {\n            stroke: strokeColor,\n            'stroke-width': 3,\n            fill: 'none',\n            cx,\n            cy: (this.height - 10) * this.parent.scaleFactor,\n            class: 'keyboardkeyannotation',\n            r: this.width * this.parent.scaleFactor / 4,\n        };\n\n        const circleDom = common.makeSVGright('circle', keyattrs);\n        this.parent.svgObj.appendChild(circleDom);\n        // console.log(circleDom);\n        return circleDom;\n    }\n    /**\n     * Adds the note name on the key\n     *\n     * @method music21.keyboard.Key#addNoteName\n     * @param {Boolean} [labelOctaves=false] - use octave numbers too?\n     * @returns {DOMObject}\n     */\n    addNoteName(labelOctaves) {\n        if (\n            this.svgObj === undefined\n            || this.parent === undefined\n            || this.parent.svgObj === undefined\n        ) {\n            return this;\n        }\n        if (this.id === 0 && this.pitchObj === undefined) {\n            return this;\n        } else if (this.pitchObj === undefined) {\n            this.pitchObj = new pitch.Pitch();\n            this.pitchObj.ps = this.id;\n        }\n        if (\n            this.pitchObj.accidental !== undefined\n            && this.pitchObj.accidental.alter !== 0\n        ) {\n            return this;\n        }\n        let x = parseInt(this.svgObj.getAttribute('x'));\n        let idStr = this.pitchObj.name;\n        let fontSize = 14;\n        if (labelOctaves === true) {\n            idStr = this.pitchObj.nameWithOctave;\n            fontSize = 12;\n            x -= 2;\n        }\n        fontSize = Math.floor(fontSize * parent.scaleFactor);\n\n        let textfill = 'white';\n        if (this.keyClass === 'whitekey') {\n            textfill = 'black';\n        }\n        const textattrs = {\n            fill: textfill,\n            x: x + this.parent.scaleFactor * (this.width / 2 - 5),\n            y: this.parent.scaleFactor * (this.height - 20),\n            class: 'keyboardkeyname',\n            'font-size': fontSize,\n        };\n\n        const textDom = common.makeSVGright('text', textattrs);\n        const textNode = document.createTextNode(idStr);\n        textDom.appendChild(textNode);\n        this.noteNameSvgObj = textDom; // store for removing...\n        this.parent.svgObj.appendChild(textDom);\n        return this;\n    }\n    /**\n     * Removes the note name from the key (if exists)\n     *\n     * @method music21.keyboard.Key#removeNoteName\n     * @returns {undefined}\n     */\n    removeNoteName() {\n        if (\n            this.svgObj === undefined\n            || this.parent === undefined\n            || this.parent.svgObj === undefined\n        ) {\n            return;\n        }\n        if (this.noteNameSvgObj === undefined) {\n            return;\n        }\n        if (this.noteNameSvgObj.parentNode === this.parent.svgObj) {\n            this.parent.svgObj.removeChild(this.noteNameSvgObj);\n        }\n        this.noteNameSvgObj = undefined;\n    }\n}\nkeyboard.Key = Key;\n\n/**\n * Defaults for a WhiteKey (width, height, keyStyle, keyClass)\n *\n * @class WhiteKey\n * @memberof music21.keyboard\n * @extends music21.keyboard.Key\n */\nexport class WhiteKey extends Key {\n    constructor() {\n        super();\n        this.width = 23;\n        this.height = 120;\n        this.keyStyle = 'fill:#fffff6;stroke:black';\n        this.keyClass = 'whitekey';\n    }\n}\nkeyboard.WhiteKey = WhiteKey;\n/**\n * Defaults for a BlackKey (width, height, keyStyle, keyClass)\n *\n * @class BlackKey\n * @memberof music21.keyboard\n * @extends music21.keyboard.Key\n */\nexport class BlackKey extends Key {\n    constructor() {\n        super();\n        this.width = 13;\n        this.height = 80;\n        this.keyStyle = 'fill:black;stroke:black';\n        this.keyClass = 'blackkey';\n    }\n}\n\nkeyboard.BlackKey = BlackKey;\n\n/**\n * A Class representing a whole Keyboard full of keys.\n *\n * @class Keyboard\n * @memberof music21.keyboard\n * @property {number} whiteKeyWidth - default 23\n * @property {number} scaleFactor - default 1\n * @property {object} keyObjects - a mapping of id to {@link music21.keyboard.Key} objects\n * @property {DOMObject} svgObj - the SVG object of the keyboard\n * @property {Boolean} markC - default true\n * @property {Boolean} showNames - default false\n * @property {Boolean} showOctaves - default false\n * @property {string} startPitch - default \"C3\"\n * @property {string} endPitch - default \"C5\"\n * @property {Boolean} hideable - default false -- add a way to hide and show keyboard\n * @property {Boolean} scrollable - default false -- add scroll bars to change octave\n */\nexport class Keyboard {\n    constructor() {\n        this.whiteKeyWidth = 23;\n        this._defaultWhiteKeyWidth = 23;\n        this._defaultBlackKeyWidth = 13;\n        this.scaleFactor = 1;\n        this.height = 120; // does nothing right now...\n        this.keyObjects = {};\n        this.svgObj = undefined;\n\n        this.markC = true;\n        this.showNames = false;\n        this.showOctaves = false;\n\n        this.startPitch = 'C3';\n        this.endPitch = 'C5';\n        this._startDNN = undefined;\n        this._endDNN = undefined;\n\n        this.hideable = false;\n        this.scrollable = false;\n        /**\n         * An object of callbacks on events.\n         *\n         * default:\n         *\n         * - click: this.clickhandler\n         *\n         * @name callbacks\n         * @type {object}\n         * @memberof music21.keyboard.Keyboard#\n         */\n        this.callbacks = {\n            click: this.clickhandler,\n        };\n        //   more accurate offsets from http://www.mathpages.com/home/kmath043.htm\n        this.sharpOffsets = {\n            0: 14.3333,\n            1: 18.6666,\n            3: 13.25,\n            4: 16.25,\n            5: 19.75,\n        };\n    }\n    /**\n     * Redraws the SVG associated with this Keyboard\n     *\n     * @method music21.keyboard.Keyboard#redrawSVG\n     * @returns {DOMObject} new svgDOM\n     */\n    redrawSVG() {\n        if (this.svgObj === undefined) {\n            return undefined;\n        }\n        const oldSVG = this.svgObj;\n        const svgParent = oldSVG.parentNode;\n        this.keyObjects = {};\n        const svgDOM = this.createSVG();\n        svgParent.replaceChild(svgDOM, oldSVG);\n        return svgDOM;\n    }\n    /**\n     * Appends a keyboard to the `where` parameter\n     *\n     * @method music21.keyboard.Keyboard#appendKeyboard\n     * @param {JQueryDOMObject|DOMObject} [where]\n     * @returns {music21.keyboard.Keyboard} this\n     */\n    appendKeyboard(where) {\n        if (where === undefined) {\n            where = document.body;\n        } else if (where.jquery !== undefined) {\n            where = where[0];\n        }\n\n        let svgDOM = this.createSVG();\n\n        if (this.scrollable) {\n            svgDOM = this.wrapScrollable(svgDOM)[0];\n        }\n\n        if (this.hideable) {\n            // make it so the keyboard can be shown or hidden...\n            this.appendHideableKeyboard(where, svgDOM);\n        } else {\n            where.appendChild(svgDOM); // svg must use appendChild, not append.\n        }\n        return this;\n    }\n    /**\n     * Handle a click on a given SVG object\n     *\n     * @method music21.keyboard.Keyboard#clickhandler\n     * @param {DOMObject} keyRect - the dom object with the keyboard.\n     */\n    clickhandler(keyRect) {\n        // to-do : integrate with jazzHighlight...\n        const id = keyRect.id;\n        const thisKeyObject = this.keyObjects[id];\n        if (thisKeyObject === undefined) {\n            return; // not on keyboard;\n        }\n        const storedStyle = thisKeyObject.keyStyle;\n        let fillColor = '#c0c000';\n        if (thisKeyObject.keyClass === 'whitekey') {\n            fillColor = 'yellow';\n        }\n        keyRect.setAttribute('style', 'fill:' + fillColor + ';stroke:black');\n        miditools.loadSoundfont('acoustic_grand_piano', i => {\n            MIDI.noteOn(i.midiChannel, id, 100, 0);\n            MIDI.noteOff(i.midiChannel, id, 500);\n        });\n        setTimeout(() => {\n            keyRect.setAttribute('style', storedStyle);\n        }, 500);\n    }\n\n    /**\n     * Draws the SVG associated with this Keyboard\n     *\n     * @method music21.keyboard.Keyboard#createSVG\n     * @returns {DOMObject} new svgDOM\n     */\n    createSVG() {\n        // DNN = pitch.diatonicNoteNum;\n        // this._endDNN = final key note. I.e., the last note to be included, not the first note not included.\n        // 6, 57 gives a standard 88-key keyboard;\n        if (this._startDNN === undefined) {\n            if (typeof this.startPitch === 'string') {\n                const tempP = new pitch.Pitch(this.startPitch);\n                this._startDNN = tempP.diatonicNoteNum;\n            } else {\n                this._startDNN = this.startPitch;\n            }\n        }\n\n        if (this._endDNN === undefined) {\n            if (typeof this.endPitch === 'string') {\n                const tempP = new pitch.Pitch(this.endPitch);\n                this._endDNN = tempP.diatonicNoteNum;\n            } else {\n                this._endDNN = this.endPitch;\n            }\n        }\n\n        let currentIndex = (this._startDNN - 1) % 7; // C = 0\n        const keyboardDiatonicLength = 1 + this._endDNN - this._startDNN;\n        const totalWidth\n            = this.whiteKeyWidth * this.scaleFactor * keyboardDiatonicLength;\n        const height = 120 * this.scaleFactor;\n        const heightString = height.toString() + 'px';\n\n        const svgDOM = common.makeSVGright('svg', {\n            'xml:space': 'preserve',\n            height: heightString,\n            width: totalWidth.toString() + 'px',\n            class: 'keyboardSVG',\n        });\n        const movingPitch = new pitch.Pitch('C4');\n        const blackKeys = [];\n        const thisKeyboardObject = this;\n\n        for (let wki = 0; wki < keyboardDiatonicLength; wki++) {\n            movingPitch.diatonicNoteNum = this._startDNN + wki;\n            const wk = new keyboard.WhiteKey();\n            wk.id = movingPitch.midi;\n            wk.parent = this;\n            this.keyObjects[movingPitch.midi] = wk;\n            wk.scaleFactor = this.scaleFactor;\n            wk.width = this.whiteKeyWidth;\n            wk.callbacks.click = function whitekeyCallbacksClick() {\n                thisKeyboardObject.clickhandler(this);\n            };\n\n            const wkSVG = wk.makeKey(\n                this.whiteKeyWidth * this.scaleFactor * wki\n            );\n            svgDOM.appendChild(wkSVG);\n\n            if (\n                (currentIndex === 0\n                    || currentIndex === 1\n                    || currentIndex === 3\n                    || currentIndex === 4\n                    || currentIndex === 5)\n                && wki !== keyboardDiatonicLength - 1\n            ) {\n                // create but do not append blackkey to the right of whitekey\n                const bk = new keyboard.BlackKey();\n                bk.id = movingPitch.midi + 1;\n                this.keyObjects[movingPitch.midi + 1] = bk;\n                bk.parent = this;\n\n                bk.scaleFactor = this.scaleFactor;\n                bk.width\n                    = this._defaultBlackKeyWidth\n                    * this.whiteKeyWidth\n                    / this._defaultWhiteKeyWidth;\n                bk.callbacks.click = function blackKeyClicksCallback() {\n                    thisKeyboardObject.clickhandler(this);\n                };\n\n                let offsetFromWhiteKey = this.sharpOffsets[currentIndex];\n                offsetFromWhiteKey\n                    *= this.whiteKeyWidth\n                    / this._defaultWhiteKeyWidth\n                    * this.scaleFactor;\n                const bkSVG = bk.makeKey(\n                    this.whiteKeyWidth * this.scaleFactor * wki\n                        + offsetFromWhiteKey\n                );\n                blackKeys.push(bkSVG);\n            }\n            currentIndex += 1;\n            currentIndex %= 7;\n        }\n        // append blackkeys later since they overlap white keys;\n        for (let bki = 0; bki < blackKeys.length; bki++) {\n            svgDOM.appendChild(blackKeys[bki]);\n        }\n\n        this.svgObj = svgDOM;\n        if (this.markC) {\n            this.markMiddleC();\n        }\n        if (this.showNames) {\n            this.markNoteNames(this.showOctaves);\n        }\n\n        return svgDOM;\n    }\n\n    /**\n     * Puts a circle on middle c.\n     *\n     * @method music21.keyboard.Keyboard#markMiddleC\n     * @param {string} [strokeColor='red']\n     */\n    markMiddleC(strokeColor) {\n        const midC = this.keyObjects[60];\n        if (midC !== undefined) {\n            midC.addCircle('red');\n        }\n    }\n    /**\n     * Puts note names on every white key.\n     *\n     * @method music21.keyboard.Keyboard#markNoteNames\n     * @param {Boolean} [labelOctaves=false]\n     */\n    markNoteNames(labelOctaves) {\n        this.removeNoteNames(); // in case...\n        for (const midi in this.keyObjects) {\n            if ({}.hasOwnProperty.call(this.keyObjects, midi)) {\n                const keyObj = this.keyObjects[midi];\n                keyObj.addNoteName(labelOctaves);\n            }\n        }\n    }\n\n    /**\n     * Remove note names on the keys, if they exist\n     *\n     * @method music21.keyboard.Keyboard#removeNoteNames\n     */\n    removeNoteNames() {\n        for (const midi in this.keyObjects) {\n            if ({}.hasOwnProperty.call(this.keyObjects, midi)) {\n                const keyObj = this.keyObjects[midi];\n                keyObj.removeNoteName();\n            }\n        }\n    }\n\n    /**\n     * Wraps the SVG object inside a scrollable set of buttons\n     *\n     * Do not call this directly, just use createSVG after changing the\n     * scrollable property on the keyboard to True.\n     *\n     * @method music21.keyboard.Keyboard#wrapScrollable\n     * @param {DOMObject} svgDOM\n     * @returns {JQueryDOMObject}\n     */\n    wrapScrollable(svgDOM) {\n        const $wrapper = $(\n            \"<div class='keyboardScrollableWrapper'></div>\"\n        ).css({\n            display: 'inline-block',\n        });\n        const $bDown = $(\"<button class='keyboardOctaveDown'>&lt;&lt;</button>\")\n            .css({\n                'font-size': Math.floor(this.scaleFactor * 15).toString() + 'px',\n            })\n            .bind('click', () => {\n                miditools.transposeOctave -= 1;\n                this._startDNN -= 7;\n                this._endDNN -= 7;\n                this.redrawSVG();\n            });\n        const $bUp = $(\"<button class='keyboardOctaveUp'>&gt;&gt;</button>\")\n            .css({\n                'font-size': Math.floor(this.scaleFactor * 15).toString() + 'px',\n            })\n            .bind('click', () => {\n                miditools.transposeOctave += 1;\n                this._startDNN += 7;\n                this._endDNN += 7;\n                this.redrawSVG();\n            });\n        const $kWrapper = $(\n            \"<div style='display:inline-block; vertical-align: middle' class='keyboardScrollableInnerDiv'></div>\"\n        );\n        $kWrapper[0].appendChild(svgDOM);\n        $wrapper.append($bDown);\n        $wrapper.append($kWrapper);\n        $wrapper.append($bUp);\n        return $wrapper;\n    }\n    /**\n     * Puts a hideable keyboard inside a Div with the proper controls.\n     *\n     * Do not call this directly, just use createSVG after changing the\n     * hideable property on the keyboard to True.\n     *\n     * @method music21.keyboard.Keyboard#appendHideableKeyboard\n     * @param {DOMObject} where\n     * @param {DOMObject} keyboardSVG\n     */\n    appendHideableKeyboard(where, keyboardSVG) {\n        const $container = $(\"<div class='keyboardHideableContainer'/>\");\n        const $bInside = $(\"<div class='keyboardToggleInside'>‚Ü•</div>\").css({\n            display: 'inline-block',\n            'padding-top': '40px',\n            'font-size': '40px',\n        });\n        const $b = $(\"<div class='keyboardToggleOutside'/>\").css({\n            display: 'inline-block',\n            'vertical-align': 'top',\n            background: 'white',\n        });\n        $b.append($bInside);\n        $b.data(\n            'defaultDisplay',\n            $container.find('.keyboardSVG').css('display')\n        );\n        $b.data('state', 'down');\n        $b.click(keyboard.triggerToggleShow);\n        const $explain = $(\n            \"<div class='keyboardExplain'>Show keyboard</div>\"\n        ).css({\n            display: 'none',\n            'background-color': 'white',\n            padding: '10px 10px 10px 10px',\n            'font-size': '12pt',\n        });\n        $b.append($explain);\n        $container.append($b);\n        $container[0].appendChild(keyboardSVG); // svg must use appendChild, not append.\n        $(where).append($container);\n        return $container;\n    }\n}\n\n/**\n * triggerToggleShow -- event for keyboard is shown or hidden.\n *\n * @function music21.keyboard.triggerToggleShow\n * @param {Event} e\n */\nkeyboard.triggerToggleShow = function triggerToggleShow(e) {\n    // \"this\" refers to the object clicked\n    // e -- event is not used.\n    const $t = $(this);\n    const state = $t.data('state');\n    const $parent = $t.parent();\n    let $k = $parent.find('.keyboardScrollableWrapper');\n    if ($k.length === 0) {\n        // not scrollable\n        $k = $parent.find('.keyboardSVG');\n    }\n    const $bInside = $t.find('.keyboardToggleInside');\n    const $explain = $parent.find('.keyboardExplain');\n    if (state === 'up') {\n        $bInside.text('‚Ü•');\n        $bInside.css('padding-top', '40px');\n        $explain.css('display', 'none');\n        let dd = $t.data('defaultDisplay');\n        if (dd === undefined) {\n            dd = 'inline';\n        }\n        $k.css('display', dd);\n        $t.data('state', 'down');\n    } else {\n        $k.css('display', 'none');\n        $explain.css('display', 'inline-block');\n        $bInside.text('‚Üß');\n        $bInside.css('padding-top', '10px');\n        $t.data('state', 'up');\n    }\n};\n\n/**\n * highlight the keyboard stored in \"this\" appropriately\n *\n * @function music21.keyboard.jazzHighlight\n * @param {Event} e\n * @example\n * var midiCallbacksPlay = [music21.miditools.makeChords,\n *                          music21.miditools.sendToMIDIjs,\n *                          music21.keyboard.jazzHighlight.bind(k)];\n */\nkeyboard.jazzHighlight = function jazzHighlight(e) {\n    // e is a miditools.event object -- call with this = keyboard.Keyboard object via bind...\n    if (e === undefined) {\n        return;\n    }\n    if (e.noteOn) {\n        const midiNote = e.midiNote;\n        if (this.keyObjects[midiNote] !== undefined) {\n            const keyObj = this.keyObjects[midiNote];\n            const svgObj = keyObj.svgObj;\n            let intensityRGB = '';\n            let normalizedVelocity = (e.velocity + 25) / 127;\n            if (normalizedVelocity > 1) {\n                normalizedVelocity = 1.0;\n            }\n\n            if (keyObj.keyClass === 'whitekey') {\n                const intensity = normalizedVelocity.toString();\n                intensityRGB = 'rgba(255, 255, 0, ' + intensity + ')';\n            } else {\n                const intensity = Math.floor(\n                    normalizedVelocity * 255\n                ).toString();\n                intensityRGB = 'rgb(' + intensity + ',' + intensity + ',0)';\n                // console.log(intensityRGB);\n            }\n            svgObj.setAttribute(\n                'style',\n                'fill:' + intensityRGB + ';stroke:black'\n            );\n        }\n    } else if (e.noteOff) {\n        const midiNote = e.midiNote;\n        if (this.keyObjects[midiNote] !== undefined) {\n            const keyObj = this.keyObjects[midiNote];\n            const svgObj = keyObj.svgObj;\n            svgObj.setAttribute('style', keyObj.keyStyle);\n        }\n    }\n}; // call this with a bind(keyboard.Keyboard object)...\n\nkeyboard.Keyboard = Keyboard;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/meter -- TimeSignature objects\n *\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as Vex from 'vexflow';\n\nimport { base } from './base.js';\nimport { beam } from './beam.js';\nimport { common } from './common.js';\nimport { duration } from './duration.js';\n\n/**\n * meter module. See {@link music21.meter} namespace for details.\n *\n * @exports music21/meter\n */\n\n/**\n * Meter and TimeSignature Classes (esp. {@link music21.meter.TimeSignature} ) and methods.\n *\n * @namespace music21.meter\n * @memberof music21\n * @requires music21/base\n * @requires music21/duration\n */\nexport const meter = {};\n\n/**\n * A MUCH simpler version of the music21p TimeSignature object.\n *\n * @class TimeSignature\n * @memberof music21.meter\n * @param {string} meterString - a string (\"4/4\", \"3/8\" etc.) to initialize the TimeSignature.\n * @property {Int} [numerator=4]\n * @property {Int} [denominator=4]\n * @property {Array<Array<Int>>} beatGroups - groupings of beats; inner arrays are numerator, denominator\n * @property {string} ratioString - a string like \"4/4\"\n * @property {music21.duration.Duration} barDuration - a Duration object representing the expressed total length of the TimeSignature.\n */\nexport class TimeSignature extends base.Music21Object {\n    constructor(meterString) {\n        super();\n        this._numerator = 4;\n        this._denominator = 4;\n        this._beatGroups = [];\n        this._overwrittenBeatCount = undefined;\n        this._overwrittenBeatDuration = undefined;\n        if (typeof meterString === 'string') {\n            this.ratioString = meterString;\n        }\n    }\n    get numerator() {\n        return this._numerator;\n    }\n    set numerator(s) {\n        this._numerator = s;\n    }\n    get denominator() {\n        return this._denominator;\n    }\n    set denominator(s) {\n        this._denominator = s;\n    }\n    get ratioString() {\n        return this.numerator.toString() + '/' + this.denominator.toString();\n    }\n    set ratioString(meterString) {\n        const meterList = meterString.split('/');\n        this.numerator = parseInt(meterList[0]);\n        this.denominator = parseInt(meterList[1]);\n        this._beatGroups = [];\n    }\n    get barDuration() {\n        const ql = 4.0 * this._numerator / this._denominator;\n        return new duration.Duration(ql);\n    }\n    get beatGroups() {\n        if (this._beatGroups.length === 0) {\n            this._beatGroups = this.computeBeatGroups();\n        }\n        return this._beatGroups;\n    }\n    set beatGroups(newGroups) {\n        this._beatGroups = newGroups;\n    }\n\n    /**\n     *  Get the beatCount from the numerator, assuming fast 6/8, etc.\n     *  unless .beatCount has been set manually.\n     */\n    get beatCount() {\n        if (this._overwrittenBeatCount !== undefined) {\n            return this._overwrittenBeatCount;\n        }\n        if (this.numerator > 3 && this.numerator % 3 === 0) {\n            return this.numerator / 3;\n        } else {\n            return this.numerator;\n        }\n    }\n    /**\n     *  Manually set the beatCount to an int.\n     */\n    set beatCount(overwrite) {\n        this._overwrittenBeatCount = overwrite;\n        return overwrite;\n    }\n\n    /**\n     * Gets a single duration.Duration object representing\n     * the length of a beat in this time signature (using beatCount)\n     * or, if set manually, it can return a list of Durations For\n     * asymmetrical meters.\n     */\n    get beatDuration() {\n        const dur = this.barDuration;\n        dur.quarterLength /= this.beatCount;\n        return dur;\n    }\n    /**\n     * Set beatDuration to a duration.Duration object or\n     * if the client can handle it, a list of Duration objects...\n     */\n    set beatDuration(overwrite) {\n        this._overwrittenBeatDuration = overwrite;\n    }\n\n    /**\n     * Compute the Beat Group according to this time signature.\n     *\n     * @memberof music21.meter.TimeSignature\n     * @returns {Array<Array<Int>>} a list of numerator and denominators, find a list of beat groups.\n     */\n    computeBeatGroups() {\n        const tempBeatGroups = [];\n        let numBeats = this.numerator;\n        let beatValue = this.denominator;\n        if (beatValue < 8 && numBeats >= 5) {\n            const beatsToEighthNoteRatio = 8 / beatValue; // hopefully Int -- right Brian Ferneyhough?\n            beatValue = 8;\n            numBeats *= beatsToEighthNoteRatio;\n        }\n\n        if (beatValue >= 8) {\n            while (numBeats >= 5) {\n                tempBeatGroups.push([3, beatValue]);\n                numBeats -= 3;\n            }\n            if (numBeats === 4) {\n                tempBeatGroups.push([2, beatValue]);\n                tempBeatGroups.push([2, beatValue]);\n            } else if (numBeats > 0) {\n                tempBeatGroups.push([numBeats, beatValue]);\n            }\n        } else if (beatValue === 2) {\n            tempBeatGroups.push([1, 2]);\n        } else if (beatValue <= 1) {\n            tempBeatGroups.push([1, 1]);\n        } else {\n            // 4/4, 2/4, 3/4, standard stuff\n            tempBeatGroups.push([2, 8]);\n        }\n        return tempBeatGroups;\n    }\n    \n    /**\n     * Return a span of [start, end] for the current beat/beam grouping\n     */\n    offsetToSpan(offset) {\n        const beatDuration = this.beatDuration.quarterLength;\n        const beatsFromStart = Math.floor(offset / beatDuration);\n        const start = beatsFromStart * beatDuration;\n        const end = start + beatDuration;\n        return [start, end];\n    }\n    \n    /**\n     * @param {Iterable} srcStream - a stream of elements.\n     * @param {object} options - an object with measureStartOffset\n     */\n    getBeams(srcStream, options) {\n        const params = { measureStartOffset: 0.0 };\n        common.merge(params, options);\n        const measureStartOffset = params.measureStartOffset;\n        let beamsList = beam.Beams.naiveBeams(srcStream);\n        beamsList = beam.Beams.removeSandwichedUnbeamables(beamsList);\n        const fixBeamsOneElementDepth = (i, el, depth) => {\n            const beams = beamsList[i];\n            if (!beams || beams === undefined) {\n                return;\n            }\n            const beamNumber = depth + 1;\n            if (!(beams.getNumbers().includes(beamNumber))) {\n                return;\n            }\n            const dur = el.duration;\n            const pos = el.offset + measureStartOffset;\n            \n            const start = pos; // opFrac\n            const end = pos + dur.quarterLength; // opFrac;\n            const startNext = end;\n            const isLast = (i === srcStream.length - 1);\n            const isFirst = (i === 0);\n            let beamNext;\n            let beamPrevious;\n            if (!isFirst) {\n                beamPrevious = beamsList[i - 1];\n            }\n            if (!isLast) {\n                beamNext = beamsList[i + 1];\n            }\n            const [archetypeSpanStart, archetypeSpanEnd] = this.offsetToSpan(start);\n            let archetypeSpanNextStart = 0.0;\n            if (beamNext !== undefined) {\n                archetypeSpanNextStart = this.offsetToSpan(startNext)[0];\n            }\n            if (start === archetypeSpanStart && end === archetypeSpanEnd) {\n                beamsList[i] = undefined;\n                return;\n            }\n            \n            let beamType;\n            if (isFirst) {\n                beamType = 'start';\n                if (beamNext === undefined || !(beamNext.getNumbers().includes(beamNumber))) {\n                    beamType = 'partial-right';\n                }\n            } else if (isLast) {\n                beamType = 'start';\n                if (beamPrevious === undefined || !beamPrevious.getNumbers().includes(beamNumber)) {\n                    beamType = 'partial-left';\n                }\n            } else if (beamPrevious === undefined || !beamPrevious.getNumbers().includes(beamNumber)) {\n                if (beamNumber === 1 && beamNext === undefined) {\n                    beamsList[i] = undefined;\n                    return;\n                } else if (beamNext === undefined && beamNumber > 1) {\n                    beamType = 'partial-left';\n                } else if (startNext >= archetypeSpanEnd) {\n                    beamType = 'partial-left';\n                } else if (beamNext === undefined || !(beamNext.getNumbers().includes(beamNumber))) {\n                    beamType = 'partial-right';\n                } else {\n                    beamType = 'start';\n                }\n            } else if (beamPrevious !== undefined \n                        && beamPrevious.getNumbers().includes(beamNumber)\n                        && ['stop', 'partial-left'].includes(beamPrevious.getTypeByNumber(beamNumber))\n                       ) {\n                if (beamNext !== undefined) {\n                    beamType = 'start';                    \n                } else {\n                    beamType = 'partial-left'; \n                }\n            } else if (beamNext === undefined || !beamNext.getNumbers().includes(beamNumber)) {\n                beamType = 'stop';\n            } else if (startNext < archetypeSpanEnd) {\n                beamType = 'continue';\n            } else if (startNext >= archetypeSpanNextStart) {\n                beamType = 'stop';\n            } else {\n                console.warn('Cannot match beamType');\n                return;\n            }\n            beams.setByNumber(beamNumber, beamType);\n        };\n        \n        for (let depth = 0; depth < beam.beamableDurationTypes.length; depth++) {\n            let i = 0;\n            for (const el of srcStream) {\n                fixBeamsOneElementDepth(i, el, depth);\n                i += 1;\n            }\n        }\n        \n        beamsList = beam.Beams.sanitizePartialBeams(beamsList);\n        beamsList = beam.Beams.mergeConnectingPartialBeams(beamsList);\n        return beamsList;\n    }\n    \n    /**\n     * Compute the Beat Group according to this time signature for VexFlow. For beaming.\n     *\n     * @memberof music21.meter.TimeSignature\n     * @param {Vex} Vex - a reference to the Vex object\n     * @returns {Array<Vex.Flow.Fraction>} a list of numerator and denominator groups, for VexFlow\n     */\n    vexflowBeatGroups() {\n        const tempBeatGroups = this.beatGroups;\n        // console.log(tempBeatGroups);\n        const vfBeatGroups = [];\n        for (let i = 0; i < tempBeatGroups.length; i++) {\n            const bg = tempBeatGroups[i];\n            vfBeatGroups.push(new Vex.Flow.Fraction(bg[0], bg[1]));\n        }\n        return vfBeatGroups;\n\n        //  if (numBeats % 3 == 0 && beatValue < 4) {\n        //  // 6/8, 3/8, 9/8, etc.\n        //  numBeats = numBeats / 3;\n        //  beatValue = beatValue / 3;\n        //  }\n    }\n}\n\nmeter.TimeSignature = TimeSignature;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/renderOptions -- an object that defines the render options for a Stream\n *\n * note: no parallel in music21p\n *\n * Copyright (c) 2013-14, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì14, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { common } from './common.js';\n/**\n * renderOptions module, see {@link music21.renderOptions}\n *\n * @exports music21/renderOptions\n */\n/**\n * Options for rendering a stream\n *\n * @namespace music21.renderOptions\n * @memberof music21\n */\nexport const renderOptions = {};\n\n/**\n * An object that contains information on rendering the current stream\n *\n * Found on every Stream as `.renderOptions`\n *\n * @class RenderOptions\n * @memberof music21.renderOptions\n */\nexport class RenderOptions {\n    constructor() {\n        const defaultOptions = {\n            displayClef: true,\n            displayTimeSignature: true,\n            displayKeySignature: true,\n\n            scaleFactor: { x: 0.7, y: 0.7 },\n\n            top: 0,\n            left: undefined,\n            width: undefined,\n            overriddenWidth: undefined,\n            height: undefined,\n            naiveHeight: 120,\n\n            systemIndex: 0,\n            partIndex: 0,\n            measureIndex: 0,\n\n            systemMeasureIndex: 0,\n            systemPadding: undefined,\n            naiveSystemPadding: 40,\n\n            stemDirection: undefined,\n\n            maxSystemWidth: undefined,\n            rightBarline: undefined,\n            staffLines: 5,\n            staffConnectors: ['single', 'brace'],\n            staffPadding: 60, // width...\n            events: {\n                click: 'play',\n                dblclick: undefined,\n                // resize\n            },\n            startNewSystem: false,\n            startNewPage: false,\n            showMeasureNumber: undefined,\n        };\n        common.merge(this, defaultOptions);\n    }\n}\nrenderOptions.RenderOptions = RenderOptions;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/vfShow -- Vexflow integration\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\n\nimport * as $ from 'jquery';\nimport * as Vex from 'vexflow';\n\nimport { debug } from './debug.js';\nimport { duration } from './duration.js';\n/**\n * for rendering vexflow. Will eventually go to music21/converter/vexflow\n *\n * See {@link music21.vfShow} namespace for details\n *\n * @exports music21/vfShow\n */\n/**\n * Vexflow display related objects and methods.\n *\n * @namespace music21.vfShow\n * @memberof music21\n * @requires music21/common\n * @requires vexflow\n */\nexport const vfShow = {};\n\n/**\n * Represents a stack of objects that need to be rendered together.\n *\n * An intermediary state for showing created by {@link music21.vfShow.Renderer}.\n *\n * @class RenderStack\n * @memberof music21.vfShow\n * @property {Array<Vex.Flow.Voice>} voices - Vex.Flow.Voice objects\n * @property {Array<music21.stream.Stream>} streams - {@link music21.stream.Stream} objects\n * associated with the voices\n * @property {Array} textVoices - Vex.Flow.Voice objects for the text.\n */\nexport class RenderStack {\n    constructor() {\n        this.voices = [];\n        this.streams = [];\n        this.textVoices = [];\n        this.voiceToStreamMapping = new Map();\n    }\n    /**\n     * @memberof music21.vfShow.RenderStack\n     * @returns {Array} this.voices and this.textVoices as one array\n     */\n    allTickables() {\n        const t = [];\n        t.push(...this.voices);\n        t.push(...this.textVoices);\n        return t;\n    }\n    /**\n     * @memberof music21.vfShow.RenderStack\n     * @returns {Array<Array>} each array represents one staff....\n     * where this.voices and this.textVoices are all in that staff...\n     */\n    tickablesByStave() {\n        const tickablesByStave = []; // a list of lists of tickables being placed on the same Stave.\n        const knownStaves = []; // a list of Vex.Flow.Stave objects...\n\n        for (const t of this.allTickables()) {\n            const thisStaveIndex = knownStaves.indexOf(t.stave);\n            let currentStaveHolder;\n            if (thisStaveIndex === -1) {\n                knownStaves.push(t.stave);\n                currentStaveHolder = [];\n                tickablesByStave.push(currentStaveHolder);\n            } else {\n                currentStaveHolder = tickablesByStave[thisStaveIndex];\n            }\n            currentStaveHolder.push(t);\n        }\n        return tickablesByStave;\n    }\n}\nvfShow.RenderStack = RenderStack;\n\n/**\n * Renderer is a function that takes a stream, an\n * optional existing canvas or SVG element and a DOM\n * element where the canvas or SVG element should be placed\n * and renders the stream as Vexflow on the\n * canvas or svg element, placing it then in the where\n * DOM.\n *\n * \"s\" can be any type of Stream.\n *\n * \"div\" and \"where\" can be either a DOM\n * element or a jQuery object.\n *\n * @class Renderer\n * @memberof music21.vfShow\n * @param {music21.stream.Stream} s - main stream to render\n * @param {div} [div] - existing canvas or div-surroundingSVG element\n * @param {DOMObject|jQueryDOMObject} [where=document.body] - where to render the stream\n * @property {Vex.Flow.Renderer} vfRenderer - a Vex.Flow.Renderer to use\n * (will create if not existing)\n * @property {string} rendererType - canvas or svg\n * @property {Vex.Flow.Context} ctx - a Vex.Flow.Context (Canvas or SVG) to use.\n * @property {div} div - div-with-svg-or-canvas element\n * @property {jQueryDOMObject} $div - jQuery div or canvas element\n * @property {jQueryDOMObject} $where - jQuery element to render onto\n * @property {Vex.Flow.Formatter} activeFormatter - formatter\n * @property {Array<Vex.Flow.Beam>} beamGroups - beamGroups\n * @property {Array<Vex.Flow.StaveTie>} vfTies - ties as instances of Vex.Flow.StaveTie\n * @property {Array<number>} systemBreakOffsets - where to break the systems\n * @property {Array<Vex.Flow.Tuplet>} vfTuplets - tuplets represented in Vexflow\n * @property {Array<music21.vfShow.RenderStack>} stacks - array of RenderStack objects\n */\nexport class Renderer {\n    constructor(s, div, where) {\n        this.stream = s;\n        // this.streamType = s.classes[-1];\n        this.rendererType = 'svg';\n\n        this.div = undefined;\n        this.$div = undefined;\n        this.$where = undefined;\n        this.activeFormatter = undefined;\n        this._vfRenderer = undefined;\n        this._ctx = undefined;\n        this.beamGroups = [];\n        this.stacks = []; // an Array of RenderStacks: {voices: [Array of Vex.Flow.Voice objects],\n        //                                           streams: [Array of Streams, usually Measures]}\n        this.vfTies = [];\n        this.systemBreakOffsets = [];\n        this.vfTuplets = [];\n        // this.measureFormatters = [];\n        if (where !== undefined) {\n            if (where.jquery !== undefined) {\n                this.$where = where;\n            } else {\n                this.$where = $(where);\n            }\n        }\n        if (div !== undefined) {\n            if (div.jquery !== undefined) {\n                this.$div = div;\n                this.div = div[0];\n            } else {\n                this.div = div;\n                this.$div = $(div);\n            }\n        }\n    }\n\n    get vfRenderer() {\n        let backend;\n        if (this.rendererType === 'canvas') {\n            backend = Vex.Flow.Renderer.Backends.CANVAS;\n        } else {\n            backend = Vex.Flow.Renderer.Backends.SVG;\n        }\n\n        if (this._vfRenderer !== undefined) {\n            return this._vfRenderer;\n        } else {\n            this._vfRenderer = new Vex.Flow.Renderer(this.div, backend);\n            if (this.rendererType === 'svg') {\n                this._vfRenderer.resize(\n                    this.$div.attr('width'),\n                    this.$div.attr('height')\n                );\n            }\n            return this._vfRenderer;\n        }\n    }\n    set vfRenderer(vfr) {\n        this._vfRenderer = vfr;\n    }\n    get ctx() {\n        if (this._ctx !== undefined) {\n            return this._ctx;\n        } else {\n            this._ctx = this.vfRenderer.getContext();\n            if (\n                this.stream\n                && this.stream.renderOptions\n                && this.stream.renderOptions.scaleFactor.x\n                && this.stream.renderOptions.scaleFactor.y\n            ) {\n                this._ctx.scale(\n                    this.stream.renderOptions.scaleFactor.x,\n                    this.stream.renderOptions.scaleFactor.y\n                );\n            }\n            return this._ctx;\n        }\n    }\n    set ctx(ctx) {\n        this._ctx = ctx;\n    }\n    /**\n     *\n     * main function to render a Stream.\n     *\n     * if s is undefined, uses the stored Stream from\n     * the constructor object.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream]\n     */\n    render(s) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n\n        let isScorelike = false;\n        let isPartlike = false;\n        const hasSubStreams = s.hasSubStreams();\n\n        if (s.isClassOrSubclass('Score')) {\n            isScorelike = true;\n        } else if (hasSubStreams && s.get(0).hasSubStreams()) {\n            isScorelike = true;\n        } else if (hasSubStreams) {\n            isPartlike = true;\n        }\n        // requires organization Score -> Part -> Measure -> elements...\n        if (isScorelike) {\n            this.prepareScorelike(s);\n        } else if (isPartlike) {\n            this.preparePartlike(s);\n        } else {\n            this.prepareArrivedFlat(s);\n        }\n        this.formatMeasureStacks();\n        this.drawTies();\n        this.drawMeasureStacks();\n        this.drawBeamGroups();\n        this.drawTuplets();\n    }\n    /**\n     * Prepares a scorelike stream (i.e., one with parts or\n     * Streams that should be rendered vertically like parts)\n     * for rendering and adds Staff Connectors\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Score} s - prepare a stream of parts (i.e., Score)\n     */\n    prepareScorelike(s) {\n        // console.log('prepareScorelike called');\n        //\n        const parts = s.parts;\n        for (const subStream of parts) {\n            this.preparePartlike(subStream);\n        }\n        this.addStaffConnectors(s);\n    }\n    /**\n     *\n     * Prepares a Partlike stream (that is one with Measures\n     * or substreams that should be considered like Measures)\n     * for rendering.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Part} p\n     */\n    preparePartlike(p) {\n        // console.log('preparePartlike called');\n        this.systemBreakOffsets = [];\n        const measureList = p.measures;\n        for (let i = 0; i < measureList.length; i++) {\n            const subStream = measureList.get(i);\n            if (subStream.renderOptions.startNewSystem) {\n                this.systemBreakOffsets.push(subStream.offset);\n            }\n            if (i === p.length - 1) {\n                subStream.renderOptions.rightBarline = 'end';\n            }\n            if (this.stacks[i] === undefined) {\n                this.stacks[i] = new vfShow.RenderStack();\n            }\n            this.prepareMeasure(subStream, this.stacks[i]);\n        }\n        this.prepareTies(p);\n    }\n    /**\n     *\n     * Prepares a score that arrived flat... sets up\n     * stacks and vfTies after calling prepareFlat\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} m - a flat stream (maybe a measure or voice)\n     */\n    prepareArrivedFlat(m) {\n        const stack = new vfShow.RenderStack();\n        this.prepareMeasure(m, stack);\n        this.stacks[0] = stack;\n        this.prepareTies(m);\n    }\n    /**\n     *\n     * Prepares a measure (w/ or w/o voices) or generic Stream -- makes accidentals,\n     * associates a Vex.Flow.Stave with the stream and\n     * returns a vexflow Voice object\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Measure} m - a measure object (w or w/o voices)\n     * @param {music21.vfShow.RenderStack} stack - a RenderStack object to prepare into.\n     */\n    prepareMeasure(m, stack) {\n        if (m.hasVoices === undefined || m.hasVoices() === false) {\n            this.prepareFlat(m, stack);\n        } else {\n            // TODO: don't assume that all elements are Voices;\n            let stave;\n            const rendOp = m.renderOptions; // get render options from Measure;\n            for (let voiceIndex = 0; voiceIndex < m.length; voiceIndex++) {\n                const voiceStream = m.get(voiceIndex);\n                stave = this.prepareFlat(voiceStream, stack, stave, rendOp);\n            }\n        }\n        return stack;\n    }\n    /**\n     * Main internal routine to prepare a flat stream\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - a flat stream object\n     * @param {music21.vfShow.RenderStack} stack - a RenderStack object to prepare into.\n     * @param {Vex.Flow.Stave} [optionalStave] - an optional existing stave.\n     * @param {object} [optional_renderOp] - render options.\n     * Passed to {@link music21.vfShow.Renderer#renderStave}\n     * @returns {Vex.Flow.Stave} staff to return too\n     * (also changes the `stack` parameter and runs `makeAccidentals` on s)\n     */\n    prepareFlat(s, stack, optionalStave, optional_renderOp) {\n        s.makeAccidentals();\n        let stave;\n        if (optionalStave !== undefined) {\n            stave = optionalStave;\n        } else {\n            stave = this.renderStave(s, optional_renderOp);\n        }\n        s.activeVFStave = stave;\n        const voice = this.getVoice(s, stave);\n        stack.voices.push(voice);\n        stack.streams.push(s);\n        stack.voiceToStreamMapping.set(voice, s);\n\n        if (s.hasLyrics()) {\n            stack.textVoices.push(this.getLyricVoice(s, stave));\n        }\n\n        return stave;\n    }\n    /**\n     * Render the Vex.Flow.Stave from a flat stream and draws it.\n     *\n     * Just draws the stave, not the notes, etc.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [m=this.stream] - a flat stream\n     * @param {object} [optional_rendOp] - render options, passed\n     * to {@link music21.vfShow.Renderer#newStave} and {@link music21.vfShow.Renderer#setClefEtc}\n     * @returns {Vex.Flow.Stave} stave\n     */\n    renderStave(m, optional_rendOp) {\n        if (m === undefined) {\n            m = this.stream;\n        }\n        const ctx = this.ctx;\n        // stave will be passed in from Measure when we have Voices\n        const stave = this.newStave(m, optional_rendOp);\n\n        this.setClefEtc(m, stave, optional_rendOp);\n        stave.setContext(ctx);\n        stave.draw();\n        return stave;\n    }\n    /**\n     * Draws the Voices (music and text) from `this.stacks`\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawMeasureStacks() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.stacks.length; i++) {\n            const voices = this.stacks[i].allTickables();\n            for (let j = 0; j < voices.length; j++) {\n                const v = voices[j];\n                v.draw(ctx);\n            }\n        }\n    }\n    /**\n     * draws the tuplets.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawTuplets() {\n        const ctx = this.ctx;\n        this.vfTuplets.forEach(vft => {\n            vft.setContext(ctx).draw();\n        });\n    }\n    /**\n     * draws the vfTies\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawTies() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.vfTies.length; i++) {\n            this.vfTies[i].setContext(ctx).draw();\n        }\n    }\n    /**\n     * Finds all tied notes and creates the proper Vex.Flow.StaveTie objects in\n     * `this.vfTies`.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Part} p - a Part or similar object\n     */\n    prepareTies(p) {\n        const pf = p.flat.notesAndRests;\n        // console.log('newSystemsAt', this.systemBreakOffsets);\n        for (let i = 0; i < pf.length - 1; i++) {\n            const thisNote = pf.get(i);\n            if (thisNote.tie === undefined || thisNote.tie.type === 'stop') {\n                continue;\n            }\n            const nextNote = pf.get(i + 1);\n            let onSameSystem = true;\n            // this.systemBreakOffsets.length will be 0 for a flat score\n            for (let sbI = 0; sbI < this.systemBreakOffsets.length; sbI++) {\n                const thisSystemBreak = this.systemBreakOffsets[sbI];\n                if (\n                    thisNote.offset < thisSystemBreak\n                    && nextNote.offset >= thisSystemBreak\n                ) {\n                    onSameSystem = false;\n                    break;\n                }\n            }\n            if (onSameSystem) {\n                const vfTie = new Vex.Flow.StaveTie({\n                    first_note: thisNote.activeVexflowNote,\n                    last_note: nextNote.activeVexflowNote,\n                    first_indices: [0],\n                    last_indices: [0],\n                });\n                this.vfTies.push(vfTie);\n            } else {\n                // console.log('got me a tie across systemBreaks!');\n                const vfTie1 = new Vex.Flow.StaveTie({\n                    first_note: thisNote.activeVexflowNote,\n                    first_indices: [0],\n                });\n                this.vfTies.push(vfTie1);\n                const vfTie2 = new Vex.Flow.StaveTie({\n                    last_note: nextNote.activeVexflowNote,\n                    first_indices: [0],\n                });\n                this.vfTies.push(vfTie2);\n            }\n        }\n    }\n    /**\n     * Returns a Vex.Flow.Voice object with all the tickables (i.e., Notes, Voices, etc.)\n     *\n     * Does not draw it...\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream] -- usually a Measure or Voice\n     * @param {Vex.Flow.Stave} stave - not optional (would never fly in Python...)\n     * @returns {Vex.Flow.Voice}\n     */\n    getVoice(s, stave) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n\n        // gets a group of notes as a voice, but completely unformatted and not drawn.\n        const notes = this.vexflowNotes(s, stave);\n        const voice = this.vexflowVoice(s);\n        voice.setStave(stave);\n\n        voice.addTickables(notes);\n        return voice;\n    }\n    /**\n     * Returns a Vex.Flow.Voice with the lyrics set to render in the proper place.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s -- usually a Measure or Voice\n     * @param {Vex.Flow.Stave} stave\n     * @returns {Vex.Flow.Voice}\n     */\n    getLyricVoice(s, stave) {\n        const textVoice = this.vexflowVoice(s);\n        const lyrics = this.vexflowLyrics(s, stave);\n        textVoice.setStave(stave);\n        textVoice.addTickables(lyrics);\n        return textVoice;\n    }\n    /**\n     * Aligns all of `this.stacks` (after they've been prepared) so they align properly.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    formatMeasureStacks() {\n        // adds formats the voices, then adds the formatter information to every note in a voice...\n        for (let i = 0; i < this.stacks.length; i++) {\n            const stack = this.stacks[i];\n            const voices = stack.voices;\n            const measures = stack.streams;\n            const formatter = this.formatVoiceGroup(stack);\n            for (let j = 0; j < measures.length; j++) {\n                const m = measures[j];\n                const v = voices[j];\n                this.applyFormatterInformationToNotes(v.stave, m, formatter);\n            }\n        }\n    }\n    /**\n     * Formats a single voice group from a stack.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.vfShow.RenderStack} stack\n     * @param {Boolean} [autoBeam=measures[0].autoBeam]\n     * @returns {Vex.Flow.Formatter}\n     */\n    formatVoiceGroup(stack, autoBeam) {\n        // formats a group of voices to use the same formatter; returns the formatter\n        // if autoBeam is true then it will apply beams for each voice and put them in\n        // this.beamGroups;\n        const allTickables = stack.allTickables();\n        const voices = stack.voices;\n        const measures = stack.streams;\n        if (autoBeam === undefined) {\n            autoBeam = measures[0].autoBeam;\n        }\n\n        const formatter = new Vex.Flow.Formatter();\n        // var minLength = formatter.preCalculateMinTotalWidth([voices]);\n        // console.log(minLength);\n        if (voices.length === 0) {\n            return formatter;\n        }\n        let maxGlyphStart = 0; // find the stave with the farthest start point -- diff key sig, etc.\n        for (let i = 0; i < allTickables.length; i++) {\n            // console.log(voices[i], voices[i].stave, i);\n            if (allTickables[i].stave.getNoteStartX() > maxGlyphStart) {\n                maxGlyphStart = allTickables[i].stave.getNoteStartX();\n            }\n        }\n        for (let i = 0; i < allTickables.length; i++) {\n            allTickables[i].stave.setNoteStartX(maxGlyphStart); // corrected!\n        }\n        // TODO: should do the same for end_x -- for key sig changes, etc...\n\n        const stave = voices[0].stave; // all staves should be same length, so does not matter;\n        const tickablesByStave = stack.tickablesByStave();\n        for (const staveTickables of tickablesByStave) {\n            formatter.joinVoices(staveTickables);\n        }\n        formatter.formatToStave(allTickables, stave);\n\n//        const vf_auto_stem = false;\n//        for (const voice of voices) {            \n//            let activeBeamGroupNotes = [];\n//            for (let j = 0; j < voice.notes.length; j++) {\n//                const n = voice.notes[j];\n//                if (n.beams === undefined || !n.beams.getNumbers().includes(1)) {\n//                    continue;\n//                }\n//                const eighthNoteBeam = n.beams.getByNumber(1);\n//                if (eighthNoteBeam.type === 'start') {\n//                    activeBeamGroupNotes = [n];\n//                } else {\n//                    activeBeamGroupNotes.push(n);\n//                }\n//                if (eighthNoteBeam.type === 'stop') {\n//                    const vfBeam = new Vex.Flow.Beam(activeBeamGroupNotes, vf_auto_stem);\n//                    this.beamGroups.push(vfBeam);\n//                    activeBeamGroupNotes = []; // housekeeping, not really necessary...\n//                }\n//            }\n//        }\n        \n        if (autoBeam) {\n            for (let i = 0; i < voices.length; i++) {\n                // find beam groups -- n.b. this wipes out stemDirection. worth it usually...\n                const voice = voices[i];\n                const associatedStream = stack.voiceToStreamMapping.get(voice);\n                let beatGroups;\n                if (\n                    associatedStream !== undefined\n                    && associatedStream.timeSignature !== undefined\n                ) {\n                    beatGroups = associatedStream.timeSignature.vexflowBeatGroups(\n                        Vex\n                    );\n                    // TODO: getContextByClass...\n                    // console.log(beatGroups);\n                } else {\n                    beatGroups = [new Vex.Flow.Fraction(2, 8)]; // default beam groups\n                }\n                const beamGroups = Vex.Flow.Beam.applyAndGetBeams(\n                    voice,\n                    undefined,\n                    beatGroups\n                );\n                this.beamGroups.push(...beamGroups);\n            }\n        }\n        return formatter;\n    }\n    /**\n     * Draws the beam groups.\n     *\n     * @memberof music21.vfShow.Renderer\n     */\n    drawBeamGroups() {\n        const ctx = this.ctx;\n        for (let i = 0; i < this.beamGroups.length; i++) {\n            this.beamGroups[i].setContext(ctx).draw();\n        }\n    }\n    /**\n     * Return a new Vex.Flow.Stave object, which represents\n     * a single MEASURE of notation in m21j\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @returns {Vex.Flow.Stave}\n     */\n    newStave(s, rendOp) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        if (rendOp === undefined) {\n            rendOp = s.renderOptions;\n        }\n        // measure level...\n        let width = rendOp.width;\n        if (width === undefined) {\n            width = s.estimateStaffLength() + rendOp.staffPadding;\n        }\n        let top = rendOp.top; // * rendOp.scaleFactor.y;\n        if (top === undefined) {\n            top = 0;\n        }\n        let left = rendOp.left;\n        if (left === undefined) {\n            left = 10;\n        }\n        // console.log('streamLength: ' + streamLength);\n        if (debug) {\n            console.log(\n                'creating new stave: left:'\n                    + left\n                    + ' top: '\n                    + top\n                    + ' width: '\n                    + width\n            );\n        }\n        const stave = new Vex.Flow.Stave(left, top, width);\n        return stave;\n    }\n    /**\n     * Sets the number of stafflines, puts the clef on the Stave,\n     * adds keySignature, timeSignature, and rightBarline\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @param {Vex.Flow.Stave} stave\n     * @param {object} [rendOp=s.renderOptions] - a {@link music21.renderOptions.RenderOptions}\n     * object that might have\n     * `{showMeasureNumber: boolean, rightBarLine: string<{'single', 'double', 'end'}>}`\n     */\n    setClefEtc(s, stave, rendOp) {\n        if (rendOp === undefined) {\n            rendOp = s.renderOptions;\n        }\n        this.setStafflines(s, stave);\n        if (rendOp.showMeasureNumber) {\n            stave.setMeasure(rendOp.measureIndex + 1);\n        }\n        if (rendOp.displayClef) {\n            let ottava;\n            const size = 'default';\n            if (s.clef.octaveChange === 1) {\n                ottava = '8va';\n            } else if (s.clef.octaveChange === -1) {\n                ottava = '8vb';\n            }\n            stave.addClef(s.clef.name, size, ottava);\n        }\n        if (s.keySignature !== undefined && rendOp.displayKeySignature) {\n            const ksVFName = s.keySignature.majorName().replace(/-/g, 'b');\n            stave.addKeySignature(ksVFName);\n        }\n\n        if (s.timeSignature !== undefined && rendOp.displayTimeSignature) {\n            stave.addTimeSignature(\n                s.timeSignature.numerator.toString()\n                    + '/'\n                    + s.timeSignature.denominator.toString()\n            );\n        }\n        if (rendOp.rightBarline !== undefined) {\n            const bl = rendOp.rightBarline;\n            const barlineMap = {\n                single: 'SINGLE',\n                double: 'DOUBLE',\n                end: 'END',\n            };\n            const vxBL = barlineMap[bl];\n            if (vxBL !== undefined) {\n                stave.setEndBarType(Vex.Flow.Barline.type[vxBL]);\n            }\n        }\n    }\n    /**\n     * Sets the number of stafflines properly for the Stave object.\n     *\n     * This method does not just set Vex.Flow.Stave#setNumLines() except\n     * if the number of lines is 0 or >=4, because the default in VexFlow is\n     * to show the bottom(top?), not middle, lines and that looks bad.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - stream to get the `.staffLines`\n     * from `s.renderOptions` from -- should allow for overriding.\n     * @param {Vex.Flow.Stave} vexflowStave - stave to set the staff lines for.\n     */\n    setStafflines(s, vexflowStave) {\n        const rendOp = s.renderOptions;\n        if (rendOp.staffLines !== 5) {\n            if (rendOp.staffLines === 0) {\n                vexflowStave.setNumLines(0);\n            } else if (rendOp.staffLines === 1) {\n                // Vex.Flow.Stave.setNumLines hides all but the top line.\n                // this is better\n                vexflowStave.options.line_config = [\n                    { visible: false },\n                    { visible: false },\n                    { visible: true }, // show middle\n                    { visible: false },\n                    { visible: false },\n                ];\n            } else if (rendOp.staffLines === 2) {\n                vexflowStave.options.line_config = [\n                    { visible: false },\n                    { visible: false },\n                    { visible: true }, // show middle\n                    { visible: true },\n                    { visible: false },\n                ];\n            } else if (rendOp.staffLines === 3) {\n                vexflowStave.options.line_config = [\n                    { visible: false },\n                    { visible: true },\n                    { visible: true }, // show middle\n                    { visible: true },\n                    { visible: false },\n                ];\n            } else {\n                vexflowStave.setNumLines(rendOp.staffLines);\n            }\n        }\n    }\n    /**\n     * Gets the Vex.Flow.StaveNote objects from a Stream.\n     *\n     * Also changes `this.vfTuplets`.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} [s=this.stream] - flat stream to find notes in\n     * @param {Vex.Flow.Stave} stave - Vex.Flow.Stave to render notes on to.\n     * @returns {Array<Vex.Flow.StaveNote>} notes to return\n     */\n    vexflowNotes(s, stave) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        // runs on a flat stream, returns a list of voices...\n        const notes = [];\n        const vfTuplets = [];\n        let activeTuplet;\n        let activeTupletLength = 0.0;\n        let activeTupletVexflowNotes = [];\n\n        const options = { clef: s.clef, stave };\n        for (const thisEl of s) {\n            if (\n                thisEl.isClassOrSubclass('GeneralNote')\n                && thisEl.duration !== undefined\n            ) {\n                // sets thisEl.activeVexflowNote -- may be overwritten but not so fast...\n                const vfn = thisEl.vexflowNote(options);\n                if (vfn === undefined) {\n                    console.error('Cannot create a vexflowNote from: ', thisEl);\n                }\n                if (stave !== undefined) {\n                    vfn.setStave(stave);\n                }\n                notes.push(vfn);\n\n                // account for tuplets...\n                if (thisEl.duration.tuplets.length > 0) {\n                    // only support one tuplet per note -- like vexflow\n                    if (activeTuplet === undefined) {\n                        activeTuplet = thisEl.duration.tuplets[0];\n                    }\n                    activeTupletVexflowNotes.push(vfn);\n                    activeTupletLength += thisEl.duration.quarterLength;\n                    // console.log(activeTupletLength, activeTuplet.totalTupletLength());\n                    //\n                    // Add tuplet when complete.\n                    if (\n                        activeTupletLength\n                            >= activeTuplet.totalTupletLength()\n                        || Math.abs(\n                            activeTupletLength\n                                - activeTuplet.totalTupletLength()\n                        ) < 0.001\n                    ) {\n                        // console.log(activeTupletVexflowNotes);\n                        const tupletOptions = {\n                            num_notes: activeTuplet.numberNotesActual,\n                            notes_occupied: activeTuplet.numberNotesNormal,\n                        };\n                        // console.log('tupletOptions', tupletOptions);\n                        const vfTuplet = new Vex.Flow.Tuplet(\n                            activeTupletVexflowNotes,\n                            tupletOptions\n                        );\n                        if (activeTuplet.tupletNormalShow === 'ratio') {\n                            vfTuplet.setRatioed(true);\n                        }\n\n                        vfTuplets.push(vfTuplet);\n                        activeTupletLength = 0.0;\n                        activeTuplet = undefined;\n                        activeTupletVexflowNotes = [];\n                    }\n                }\n            }\n        }\n        if (activeTuplet !== undefined) {\n            console.warn('incomplete tuplet found in stream: ', s);\n        }\n        if (vfTuplets.length > 0) {\n            this.vfTuplets.push(...vfTuplets);\n        }\n        return notes;\n    }\n\n    /**\n     * Gets an Array of `Vex.Flow.TextNote` objects from any lyrics found in s\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - flat stream to search.\n     * @param {Vex.Flow.Stave} stave\n     * @returns {Array<Vex.Flow.TextNote>}\n     */\n    vexflowLyrics(s, stave) {\n        const getTextNote = (text, font, d, lyricObj) => {\n            // console.log(text, font, d);\n            const t1 = new Vex.Flow.TextNote({\n                text,\n                font,\n                duration: d.vexflowDuration,\n            })\n                .setLine(11)\n                .setStave(stave)\n                .setJustification(Vex.Flow.TextNote.Justification.LEFT);\n            if (lyricObj) {\n                t1.setStyle(lyricObj.style);\n            }\n            if (d.tuplets.length > 0) {\n                t1.applyTickMultiplier(d.tuplets[0].numberNotesNormal, d.tuplets[0].numberNotesActual);\n            }\n            return t1;\n        };\n\n        if (s === undefined) {\n            s = this.stream;\n        }\n        // runs on a flat, gapless, no-overlap stream, returns a list of TextNote objects...\n        const lyricsObjects = [];\n        for (const el of s) {\n            const lyricsArray = el.lyrics;\n            let text;\n            let d = el.duration;\n            let addConnector = false;\n            let firstLyric;\n            const font = {\n                family: 'Serif',\n                size: 12,\n                weight: '',\n            };\n\n            if (lyricsArray.length === 0) {\n                text = '';\n            } else {\n                firstLyric = lyricsArray[0];\n                text = firstLyric.text;\n                if (text === undefined) {\n                    text = '';\n                }\n                if (\n                    firstLyric.syllabic === 'middle'\n                    || firstLyric.syllabic === 'begin'\n                ) {\n                    addConnector = ' ' + firstLyric.lyricConnector;\n                    const tempQl = el.duration.quarterLength / 2.0;\n                    d = new duration.Duration(tempQl);\n                }\n                if (firstLyric.style.fontFamily) {\n                    font.family = firstLyric.style.fontFamily;                    \n                }\n                if (firstLyric.style.fontSize) {\n                    font.size = firstLyric.style.fontSize;                    \n                }\n                if (firstLyric.style.fontWeight) {\n                    font.weight = firstLyric.style.fontWeight;                    \n                }\n            }\n            const t1 = getTextNote(text, font, d, firstLyric);\n            lyricsObjects.push(t1);\n            if (addConnector !== false) {\n                const connector = getTextNote(addConnector, font, d);\n                lyricsObjects.push(connector);\n            }\n        }\n        return lyricsObjects;\n    }\n    /**\n     * Creates a Vex.Flow.Voice of the appropriate length given a Stream.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s\n     * @returns {Vex.Flow.Voice}\n     */\n    vexflowVoice(s) {\n        const totalLength = s.duration.quarterLength;\n\n        let num1024 = Math.round(totalLength / (1 / 256));\n        let beatValue = 1024;\n\n        if (num1024 % 512 === 0) {\n            beatValue = 2;\n            num1024 /= 512;\n        } else if (num1024 % 256 === 0) {\n            beatValue = 4;\n            num1024 /= 256;\n        } else if (num1024 % 128 === 0) {\n            beatValue = 8;\n            num1024 /= 128;\n        } else if (num1024 % 64 === 0) {\n            beatValue = 16;\n            num1024 /= 64;\n        } else if (num1024 % 32 === 0) {\n            beatValue = 32;\n            num1024 /= 32;\n        } else if (num1024 % 16 === 0) {\n            beatValue = 64;\n            num1024 /= 16;\n        } else if (num1024 % 8 === 0) {\n            beatValue = 128;\n            num1024 /= 8;\n        } else if (num1024 % 4 === 0) {\n            beatValue = 256;\n            num1024 /= 4;\n        } else if (num1024 % 2 === 0) {\n            beatValue = 512;\n            num1024 /= 2;\n        }\n        // console.log('creating voice');\n        if (debug) {\n            console.log(\n                'New voice, num_beats: '\n                    + num1024.toString()\n                    + ' beat_value: '\n                    + beatValue.toString()\n            );\n        }\n        const vfv = new Vex.Flow.Voice({\n            num_beats: num1024,\n            beat_value: beatValue,\n            resolution: Vex.Flow.RESOLUTION,\n        });\n\n        // from vexflow/src/voice.js\n        //\n        // Modes allow the addition of ticks in three different ways:\n        //\n        // STRICT: This is the default. Ticks must fill the voice.\n        // SOFT:   Ticks can be added without restrictions.\n        // FULL:   Ticks do not need to fill the voice, but can't exceed the maximum\n        //         tick length.\n        vfv.setMode(Vex.Flow.Voice.Mode.SOFT);\n        return vfv;\n    }\n    staffConnectorsMap(connectorType) {\n        const connectorMap = {\n            brace: Vex.Flow.StaveConnector.type.BRACE,\n            single: Vex.Flow.StaveConnector.type.SINGLE,\n            double: Vex.Flow.StaveConnector.type.DOUBLE,\n            bracket: Vex.Flow.StaveConnector.type.BRACKET,\n        };\n        return connectorMap[connectorType];\n    }\n\n    /**\n     * If a stream has parts (NOT CHECKED HERE) create and\n     * draw an appropriate Vex.Flow.StaveConnector\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Score} s\n     */\n    addStaffConnectors(s) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        const parts = s.parts;\n        const numParts = parts.length;\n        if (numParts < 2) {\n            return;\n        }\n\n        const firstPart = parts.get(0);\n        const lastPart = parts.get(-1);\n\n        const firstPartMeasures = firstPart.measures;\n        const lastPartMeasures = lastPart.measures;\n        const numMeasures = firstPartMeasures.length;\n\n        for (let mIndex = 0; mIndex < numMeasures; mIndex++) {\n            const thisPartMeasure = firstPartMeasures.get(mIndex);\n            const lastPartMeasure = lastPartMeasures.get(mIndex); // only needed once per system but\n            // good for symmetry.\n            if (thisPartMeasure.renderOptions.startNewSystem) {\n                let topVFStaff = thisPartMeasure.activeVFStave;\n                let bottomVFStaff = lastPartMeasure.activeVFStave;\n                if (topVFStaff === undefined) {\n                    if (thisPartMeasure.hasSubStreams()) {\n                        const thisPartVoice = thisPartMeasure\n                            .getElementsByClass('Stream')\n                            .get(0);\n                        topVFStaff = thisPartVoice.activeVFStave;\n                        if (topVFStaff === undefined) {\n                            console.warn(\n                                'No active VexFlow Staves defined for at least one measure'\n                            );\n                            continue;\n                        }\n                    }\n                }\n                if (bottomVFStaff === undefined) {\n                    if (lastPartMeasure.hasSubStreams()) {\n                        const lastPartVoice = lastPartMeasure\n                            .getElementsByClass('Stream')\n                            .get(0);\n                        bottomVFStaff = lastPartVoice.activeVFStave;\n                        if (bottomVFStaff === undefined) {\n                            console.warn(\n                                'No active VexFlow Staves defined for at least one measure'\n                            );\n                            continue;\n                        }\n                    }\n                }\n                for (\n                    let i = 0;\n                    i < s.renderOptions.staffConnectors.length;\n                    i++\n                ) {\n                    const sc = new Vex.Flow.StaveConnector(\n                        topVFStaff,\n                        bottomVFStaff\n                    );\n                    const scTypeM21 = s.renderOptions.staffConnectors[i];\n                    const scTypeVF = this.staffConnectorsMap(scTypeM21);\n                    sc.setType(scTypeVF);\n                    sc.setContext(this.ctx);\n                    sc.draw();\n                }\n            }\n        }\n    }\n\n    /**\n     * The process of putting a Stream onto a div affects each of the\n     * elements in the Stream by adding pieces of information to\n     * each {@link music21.base.Music21Object} -- see `applyFormatterInformationToNotes`\n     *\n     * You might want to remove this information; this routine does that.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {music21.stream.Stream} s - can have parts, measures, etc.\n     * @param {boolean} [recursive=false]\n     */\n    removeFormatterInformation(s, recursive) {\n        s.storedVexflowStave = undefined;\n        for (const el of s) {\n            el.x = undefined;\n            el.y = undefined;\n            el.width = undefined;\n            el.systemIndex = undefined;\n            el.activeVexflowNote = undefined;\n            if (recursive && el.isClassOrSubclass('Stream')) {\n                this.removeFormatterInformation(el, recursive);\n            }\n        }\n    }\n\n    /**\n     * Adds the following pieces of information to each Note\n     *\n     * - el.x -- x location in pixels\n     * - el.y -- y location in pixels\n     * - el.width - width of element in pixels.\n     * - el.systemIndex -- which system is it on\n     * - el.activeVexflowNote - which Vex.Flow.StaveNote is it connected with.\n     *\n     * mad props to our friend Vladimir Viro for figuring this out! Visit http://peachnote.com/\n     *\n     * Also sets s.storedVexflowStave to stave.\n     *\n     * @memberof music21.vfShow.Renderer\n     * @param {Vex.Flow.Stave} stave\n     * @param {music21.stream.Stream} [s=this.stream]\n     * @param {Vex.Flow.Formatter} formatter\n     */\n    applyFormatterInformationToNotes(stave, s, formatter) {\n        if (s === undefined) {\n            s = this.stream;\n        }\n        let noteOffsetLeft = 0;\n        // var staveHeight = 80;\n        if (stave !== undefined) {\n            noteOffsetLeft = stave.start_x + stave.glyph_start_x;\n            if (debug) {\n                console.log(\n                    'noteOffsetLeft: '\n                        + noteOffsetLeft\n                        + ' ; stave.start_x: '\n                        + stave.start_x\n                );\n                console.log('Bottom y: ' + stave.getBottomY());\n            }\n            // staveHeight = stave.height;\n        }\n\n        let nextTicks = 0;\n        for (const el of s) {\n            if (el.isClassOrSubclass('GeneralNote')) {\n                const vfn = el.activeVexflowNote;\n                if (vfn === undefined) {\n                    continue;\n                }\n                const nTicks = parseInt(vfn.ticks);\n                const formatterNote\n                    = formatter.tickContexts.map[String(nextTicks)];\n                nextTicks += nTicks;\n                el.x = vfn.getAbsoluteX();\n                // these are a bit hacky...\n                el.systemIndex = s.renderOptions.systemIndex;\n\n                // console.log(el.x + \" \" + formatterNote.x + \" \" + noteOffsetLeft);\n                if (formatterNote === undefined) {\n                    continue;\n                }\n\n                el.width = formatterNote.width;\n                if (el.pitch !== undefined) {\n                    // note only...\n                    el.y\n                        = stave.getBottomY()\n                        - (s.clef.lowestLine - el.pitch.diatonicNoteNum)\n                            * stave.options.spacing_between_lines_px;\n                    // console.log('Note DNN: ' + el.pitch.diatonicNoteNum + \" ; y: \" + el.y);\n                }\n            }\n        }\n        if (debug) {\n            for (const n of s) {\n                if (n.pitch !== undefined) {\n                    console.log(\n                        n.pitch.diatonicNoteNum\n                            + ' '\n                            + n.x\n                            + ' '\n                            + (n.x + n.width)\n                    );\n                }\n            }\n        }\n        s.storedVexflowStave = stave;\n    }\n}\nvfShow.Renderer = Renderer;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/stream -- Streams -- objects that hold other Music21Objects\n *\n * Does not implement the full features of music21p Streams by a long shot...\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006-17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\nimport * as MIDI from 'MIDI';\n\nimport { Music21Exception } from './exceptions21.js';\n\nimport { base } from './base.js';\nimport { beam } from './beam.js';\nimport { clef } from './clef.js';\nimport { common } from './common.js';\nimport { debug } from './debug.js';\nimport { duration } from './duration.js';\nimport { instrument } from './instrument.js';\nimport { meter } from './meter.js';\nimport { pitch } from './pitch.js';\nimport { renderOptions } from './renderOptions.js';\nimport { vfShow } from './vfShow.js';\n\n/**\n * powerful stream module, See {@link music21.stream} namespace\n * @exports music21/stream\n */\n/**\n * Streams are powerful music21 objects that hold Music21Object collections,\n * such as {@link music21.note.Note} or {@link music21.chord.Chord} objects.\n *\n * Understanding the {@link music21.stream.Stream} object is of fundamental\n * importance for using music21.  Definitely read the music21(python) tutorial\n * on using Streams before proceeding\n *\n * @namespace music21.stream\n * @memberof music21\n * @requires music21/base\n * @requires music21/renderOptions\n * @requires music21/clef\n * @requires music21/vfShow\n * @requires music21/duration\n * @requires music21/common\n * @requires music21/meter\n * @requires music21/pitch\n * @requires jquery\n */\nexport const stream = {};\n\nclass StreamException extends Music21Exception {}\n\nstream.StreamException = StreamException;\n\n/**\n * A generic Stream class -- a holder for other music21 objects\n * Will be subclassed into {@link music21.stream.Score},\n * {@link music21.stream.Part},\n * {@link music21.stream.Measure},\n * {@link music21.stream.Voice}, but most functions will be found here.\n *\n * @class Stream\n * @memberof music21.stream\n * @extends music21.base.Music21Object\n *\n * @property {Array<music21.base.Music21Object>} elements - the elements in the stream. DO NOT MODIFY individual components (consider it like a Python tuple)\n * @property {Int} length - (readonly) the number of elements in the stream.\n * @property {music21.duration.Duration} duration - the total duration of the stream's elements\n * @property {number} highestTime -- the highest time point in the stream's elements\n * @property {music21.clef.Clef} clef - the clef for the Stream (if there is one; if there are multiple, then the first clef)\n * @property {music21.meter.TimeSignature} timeSignature - the first TimeSignature of the Stream\n * @property {music21.key.KeySignature} keySignature - the first KeySignature for the Stream\n * @property {music21.renderOptions.RenderOptions} renderOptions - an object specifying how to render the stream\n * @property {music21.stream.Stream} flat - (readonly) a flattened representation of the Stream\n * @property {music21.stream.Stream} notes - (readonly) the stream with only {@link music21.note.Note} and {@link music21.chord.Chord} objects included\n * @property {music21.stream.Stream} notesAndRests - (readonly) like notes but also with {@link music21.note.Rest} objects included\n * @property {music21.stream.Stream} parts - (readonly) a filter on the Stream to just get the parts (NON-recursive)\n * @property {music21.stream.Stream} measures - (readonly) a filter on the Stream to just get the measures (NON-recursive)\n * @property {number} tempo - tempo in beats per minute (will become more sophisticated later, but for now the whole stream has one tempo\n * @property {music21.instrument.Instrument|undefined} instrument - an instrument object associated with the stream (can be set with a string also, but will return an `Instrument` object)\n * @property {Boolean} autoBeam - whether the notes should be beamed automatically or not (will be moved to `renderOptions` soon)\n * @property {Int} [staffLines=5] - number of staff lines\n * @property {function|undefined} changedCallbackFunction - function to call when the Stream changes through a standard interface\n * @property {number} maxSystemWidth - confusing... should be in renderOptions\n */\nexport class Stream extends base.Music21Object {\n    constructor() {\n        super();\n        // class variables;\n        this.isStream = true;\n        this.isMeasure = false;\n        this.classSortOrder = -20;\n        this.recursionType = 'elementsFirst';\n\n        this._duration = undefined;\n\n        this._elements = [];\n        this._elementOffsets = [];\n        this._clef = undefined;\n        this.displayClef = undefined;\n\n        this._keySignature = undefined; // a music21.key.KeySignature object\n        this._timeSignature = undefined; // a music21.meter.TimeSignature object\n        this._instrument = undefined;\n\n        this._autoBeam = undefined;\n        this.activeVFStave = undefined;\n        this.activeVFRenderer = undefined;\n        this.renderOptions = new renderOptions.RenderOptions();\n        this._tempo = undefined;\n\n        this.staffLines = 5;\n\n        this._stopPlaying = false;\n        this._allowMultipleSimultaneousPlays = true; // not implemented yet.\n        this.changedCallbackFunction = undefined; // for editable svges\n        /**\n         * A function bound to the current stream that\n         * will changes the stream. Used in editableAccidentalDOM, among other places.\n         *\n         *      var can = s.appendNewDOM();\n         *      $(can).on('click', s.DOMChangerFunction);\n         *\n         * @memberof music21.stream.Stream\n         * @param {Event} e\n         * @returns {music21.base.Music21Object|undefined} - returns whatever changedCallbackFunction does.\n         */\n        this.DOMChangerFunction = e => {\n            const canvasOrSVGElement = e.currentTarget;\n            const [clickedDiatonicNoteNum, foundNote] = this.findNoteForClick(\n                canvasOrSVGElement,\n                e\n            );\n            if (foundNote === undefined) {\n                if (debug) {\n                    console.log('No note found');\n                }\n                return undefined;\n            }\n            return this.noteChanged(\n                clickedDiatonicNoteNum,\n                foundNote,\n                canvasOrSVGElement\n            );\n        };\n    }\n    * [Symbol.iterator]() {\n        for (let i = 0; i < this.length; i++) {\n            yield this.get(i);\n        }\n    }\n\n    get duration() {\n        if (this._duration !== undefined) {\n            return this._duration;\n        }\n        return new duration.Duration(this.highestTime);\n    }\n    set duration(newDuration) {\n        this._duration = newDuration;\n    }\n    get highestTime() {\n        let highestTime = 0.0;\n        for (const el of this) {\n            let endTime = el.offset;\n            if (el.duration !== undefined) {\n                endTime += el.duration.quarterLength;\n            }\n            if (endTime > highestTime) {\n                highestTime = endTime;\n            }\n        }\n        return highestTime;\n    }\n\n    get semiFlat() {\n        return this._getFlatOrSemiFlat(true);\n    }\n\n    get flat() {\n        return this._getFlatOrSemiFlat(false);\n    }\n\n    _getFlatOrSemiFlat(retainContainers) {\n        if (!this.hasSubStreams()) {\n            return this;\n        }\n        const tempEls = [];\n        for (const el of this) {\n            if (el.isStream) {\n                if (retainContainers) {\n                    tempEls.push(el);\n                }\n                const offsetShift = el.offset;\n                // console.log('offsetShift', offsetShift, el.classes[el.classes.length -1]);\n                const elFlat = el._getFlatOrSemiFlat(retainContainers);\n                for (let j = 0; j < elFlat.length; j++) {\n                    // offset should NOT be null because already in Stream\n                    elFlat.get(j).offset += offsetShift;\n                }\n                tempEls.push(...elFlat._elements);\n            } else {\n                tempEls.push(el);\n            }\n        }\n        const newSt = this.clone(false);\n        newSt.elements = tempEls;\n        return newSt;\n    }\n\n    get notes() {\n        return this.getElementsByClass(['Note', 'Chord']);\n    }\n    get notesAndRests() {\n        return this.getElementsByClass('GeneralNote');\n    }\n    get tempo() {\n        if (this._tempo === undefined && this.activeSite !== undefined) {\n            return this.activeSite.tempo;\n        } else if (this._tempo === undefined) {\n            return 150;\n        } else {\n            return this._tempo;\n        }\n    }\n    set tempo(newTempo) {\n        this._tempo = newTempo;\n    }\n    get instrument() {\n        if (this._instrument === undefined && this.activeSite !== undefined) {\n            return this.activeSite.instrument;\n        } else {\n            return this._instrument;\n        }\n    }\n    set instrument(newInstrument) {\n        if (typeof newInstrument === 'string') {\n            newInstrument = new instrument.Instrument(newInstrument);\n        }\n        this._instrument = newInstrument;\n    }\n    get clef() {\n        if (this._clef === undefined && this.activeSite === undefined) {\n            return new clef.Clef('treble');\n        } else if (this._clef === undefined) {\n            return this.activeSite.clef;\n        } else {\n            return this._clef;\n        }\n    }\n    set clef(newClef) {\n        this._clef = newClef;\n    }\n    get keySignature() {\n        if (this._keySignature === undefined && this.activeSite !== undefined) {\n            return this.activeSite.keySignature;\n        } else {\n            return this._keySignature;\n        }\n    }\n    set keySignature(newKeySignature) {\n        this._keySignature = newKeySignature;\n    }\n    get timeSignature() {\n        if (\n            this._timeSignature === undefined\n            && this.activeSite !== undefined\n        ) {\n            return this.activeSite.timeSignature;\n        } else {\n            return this._timeSignature;\n        }\n    }\n    set timeSignature(newTimeSignature) {\n        if (typeof newTimeSignature === 'string') {\n            newTimeSignature = new meter.TimeSignature(newTimeSignature);\n        }\n        this._timeSignature = newTimeSignature;\n    }\n    get autoBeam() {\n        if (this._autoBeam === undefined && this.activeSite !== undefined) {\n            return this.activeSite.autoBeam;\n        } else if (this._autoBeam !== undefined) {\n            return this._autoBeam;\n        } else {\n            return true; // default...\n        }\n    }\n    set autoBeam(ab) {\n        this._autoBeam = ab;\n    }\n    get maxSystemWidth() {\n        let baseMaxSystemWidth = 750;\n        if (\n            this.renderOptions.maxSystemWidth === undefined\n            && this.activeSite !== undefined\n        ) {\n            baseMaxSystemWidth = this.activeSite.maxSystemWidth;\n        } else if (this.renderOptions.maxSystemWidth !== undefined) {\n            baseMaxSystemWidth = this.renderOptions.maxSystemWidth;\n        }\n        return baseMaxSystemWidth / this.renderOptions.scaleFactor.x;\n    }\n    set maxSystemWidth(newSW) {\n        this.renderOptions.maxSystemWidth\n            = newSW * this.renderOptions.scaleFactor.x;\n    }\n    get parts() {\n        return this.getElementsByClass('Part');\n    }\n    get measures() {\n        return this.getElementsByClass('Measure');\n    }\n    get voices() {\n        return this.getElementsByClass('Voice');\n    }\n\n    get length() {\n        return this._elements.length;\n    }\n    get elements() {\n        return this._elements;\n    }\n    set elements(newElements) {\n        let highestOffsetSoFar = 0.0;\n        this._elements = [];\n        this._elementOffsets = [];\n        const tempInsert = [];\n        let i;\n        let thisEl;\n        for (i = 0; i < newElements.length; i++) {\n            thisEl = newElements[i];\n            const thisElOffset = thisEl.offset;\n            if (thisElOffset === null || thisElOffset === highestOffsetSoFar) {\n                // append\n                this._elements.push(thisEl);\n                thisEl.offset = highestOffsetSoFar;\n                this._elementOffsets.push(highestOffsetSoFar);\n                if (thisEl.duration === undefined) {\n                    console.error('No duration for ', thisEl, ' in ', this);\n                }\n                highestOffsetSoFar += thisEl.duration.quarterLength;\n            } else {\n                // append -- slow\n                tempInsert.push(thisEl);\n            }\n        }\n        // console.warn('end', highestOffsetSoFar, tempInsert);\n        for (i = 0; i < tempInsert.length; i++) {\n            thisEl = tempInsert[i];\n            this.insert(thisEl.offset, thisEl);\n        }\n    }\n\n    /* override protoM21Object.clone() */\n    clone(deep=true) {\n        const ret = Object.create(this.constructor.prototype);\n        for (const key in this) {\n            if ({}.hasOwnProperty.call(this, key) === false) {\n                continue;\n            }\n            if (key === 'activeSite') {\n                ret[key] = this[key];\n            } else if (key === 'renderOptions') {\n                ret[key] = common.merge({}, this[key]);\n            } else if (\n                deep !== true\n                && (key === '_elements' || key === '_elementOffsets')\n            ) {\n                ret[key] = this[key].slice(); // shallow copy...\n            } else if (\n                deep\n                && (key === '_elements' || key === '_elementOffsets')\n            ) {\n                if (key === '_elements') {\n                    // console.log('got elements for deepcopy');\n                    ret._elements = [];\n                    ret._elementOffsets = [];\n                    for (let j = 0; j < this._elements.length; j++) {\n                        ret._elementOffsets[j] = this._elementOffsets[j];\n                        const el = this._elements[j];\n                        // console.log('cloning el: ', el.name);\n                        const elCopy = el.clone(deep);\n                        elCopy.activeSite = ret;\n                        ret._elements[j] = elCopy;\n                    }\n                }\n            } else if (\n                key === 'activeVexflowNote'\n                || key === 'storedVexflowstave'\n            ) {\n                // do nothing -- do not copy vexflowNotes -- permanent recursion\n            } else if (key in this._cloneCallbacks) {\n                if (this._cloneCallbacks[key] === true) {\n                    ret[key] = this[key];\n                } else if (this._cloneCallbacks[key] === false) {\n                    ret[key] = undefined;\n                } else {\n                    // call the cloneCallbacks function\n                    this._cloneCallbacks[key](key, ret, this);\n                }\n            } else if (\n                Object.getOwnPropertyDescriptor(this, key).get !== undefined\n                || Object.getOwnPropertyDescriptor(this, key).set !== undefined\n            ) {\n                // do nothing\n            } else if (typeof this[key] === 'function') {\n                // do nothing -- events might not be copied.\n            } else if (\n                this[key] !== null\n                && this[key] !== undefined\n                && this[key].isMusic21Object === true\n            ) {\n                // console.log('cloning...', key);\n                ret[key] = this[key].clone(deep);\n            } else {\n                ret[key] = this[key];\n            }\n        }\n        return ret;\n    }\n\n    /**\n     * Add an element to the end of the stream, setting its `.offset` accordingly\n     *\n     * @memberof music21.stream.Stream\n     * @param {music21.base.Music21Object|Array} el - element or list of elements to append\n     * @returns {this}\n     */\n    append(elOrElList) {\n        if (Array.isArray(elOrElList)) {\n            for (const el of elOrElList) {\n                this.append(el);\n            }\n            return this;\n        }\n        \n        const el = elOrElList;\n        try {\n            if (\n                el.isClassOrSubclass !== undefined\n                && el.isClassOrSubclass('NotRest')\n            ) {\n                // set stem direction on output...;\n            }\n            let elOffset = 0.0;\n            if (this._elements.length > 0) {\n                const lastQL = this._elements[this._elements.length - 1]\n                    .duration.quarterLength;\n                elOffset\n                    = this._elementOffsets[this._elementOffsets.length - 1]\n                    + lastQL;\n            }\n            this._elementOffsets.push(elOffset);\n            this._elements.push(el);\n            el.offset = elOffset;\n            el.sites.add(this);\n            el.activeSite = this; // would prefer weakref, but does not exist in JS.\n        } catch (err) {\n            console.error(\n                'Cannot append element ',\n                el,\n                ' to stream ',\n                this,\n                ' : ',\n                err\n            );\n        }\n        return this;\n    }\n\n    /**\n     * Add an element to the specified place in the stream, setting its `.offset` accordingly\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} offset - offset to place.\n     * @param {music21.base.Music21Object} el - element to append\n     * @returns {this}\n     */\n    insert(offset, el) {\n        try {\n            if (\n                el.isClassOrSubclass !== undefined\n                && el.isClassOrSubclass('NotRest')\n            ) {\n                // set stem direction on output\n                // this.clef.setStemDirection(el);\n            }\n            for (let i = 0; i < this._elements.length; i++) {\n                const testOffset = this._elementOffsets[i];\n                if (testOffset <= offset) {\n                    continue;\n                } else {\n                    this._elementOffsets.splice(i, 0, offset);\n                    this._elements.splice(i, 0, el);\n                    el.offset = offset;\n                    el.activeSite = this;\n                    return this;\n                }\n            }\n            // no element found. insert at end;\n            this._elementOffsets.push(offset);\n            this._elements.push(el);\n            el.offset = offset;\n            el.sites.add(this);\n            el.activeSite = this; // would prefer weakref, but does not exist in JS.\n        } catch (err) {\n            console.error(\n                'Cannot insert element ',\n                el,\n                ' to stream ',\n                this,\n                ' : ',\n                err\n            );\n        }\n        return this;\n    }\n\n    /**\n     * Inserts a single element at offset, shifting elements at or after it begins\n     * later in the stream.\n     *\n     * In single argument form, assumes it is an element and takes the offset from the element.\n     *\n     * Unlike music21p, does not take a list of elements.  TODO(msc): add this.\n     */\n    insertAndShift(offset, elementOrNone) {\n        let element;\n        if (elementOrNone === undefined) {\n            element = offset;\n            offset = element.offset;\n        } else {\n            element = elementOrNone;\n        }\n        const amountToShift = element.duration.quarterLength;\n\n        let shiftingOffsets = false;\n        for (let i = 0; i < this.length; i++) {\n            if (!shiftingOffsets && this._elementOffsets[i] >= offset) {\n                shiftingOffsets = true;\n            }\n            if (shiftingOffsets) {\n                this._elementOffsets[i] += amountToShift;\n                this._elements[i].offset = this._elementOffsets[i];\n            }\n        }\n        this.insert(offset, element);\n    }\n\n    /**\n     * Remove and return the last element in the stream,\n     * or return undefined if the stream is empty\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.base.Music21Object|undefined} last element in the stream\n     */\n    pop() {\n        // remove last element;\n        if (this.length > 0) {\n            const el = this.get(-1);\n            this._elementOffsets.pop();\n            this._elements.pop();\n            el.sites.remove(this);\n            return el;\n        } else {\n            return undefined;\n        }\n    }\n\n    /**\n     * Get the `index`th element from the Stream.  Equivalent to the\n     * music21p format of s[index].  Can use negative indexing to get from the end.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} index - can be -1, -2, to index from the end, like python\n     * @returns {music21.base.Music21Object|undefined}\n     */\n    get(index) {\n        // substitute for Python stream __getitem__; supports -1 indexing, etc.\n        let el;\n        if (index === undefined) {\n            return undefined;\n        } else if (Math.abs(index) > this._elements.length) {\n            return undefined;\n        } else if (index === this._elements.length) {\n            return undefined;\n        } else if (index < 0) {\n            el = this._elements[this._elements.length + index];\n            el.offset = this._elementOffsets[this._elements.length + index];\n            return el;\n        } else {\n            el = this._elements[index];\n            el.offset = this._elementOffsets[index];\n            return el;\n        }\n    }\n\n    setElementOffset(el, value, addElement = false) {\n        for (let i = 0; i < this.length; i++) {\n            if (this._elements[i] === el) {\n                this._elementOffsets[i] = value;\n                return;\n            }\n        }\n        if (!addElement) {\n            throw new StreamException(\n                'Cannot set the offset for elemenet '\n                    + el.toString()\n                    + ', not in Stream'\n            );\n        } else {\n            this.insert(value, el);\n        }\n    }\n\n    elementOffset(element, stringReturns = false) {\n        for (let i = 0; i < this.length; i++) {\n            if (this._elements[i] === element) {\n                return this._elementOffsets[i];\n            }\n        }\n        throw new StreamException(\n            'An entry for this object is not stored in this Stream.'\n        );\n    }\n\n    /*  --- ############# END ELEMENT FUNCTIONS ########## --- */\n\n    /**\n     * Returns Boolean about whether this stream contains any other streams.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasSubStreams() {\n        let hasSubStreams = false;\n        for (const el of this) {\n            if (el.isClassOrSubclass('Stream')) {\n                hasSubStreams = true;\n                break;\n            }\n        }\n        return hasSubStreams;\n    }\n    /**\n     * Takes a stream and places all of its elements into\n     * measures (:class:`~music21.stream.Measure` objects)\n     * based on the :class:`~music21.meter.TimeSignature` objects\n     * placed within\n     * the stream. If no TimeSignatures are found in the\n     * stream, a default of 4/4 is used.\n\n     * If `options.inPlace` is true, the original Stream is modified and lost\n     * if `options.inPlace` is False, this returns a modified deep copy.\n\n     * @memberof music21.stream.Stream\n     * @param {object} options\n     * @returns {music21.stream.Stream}\n     */\n    makeMeasures(options) {\n        const params = {\n            meterStream: undefined,\n            refStreamOrTimeRange: undefined,\n            searchContext: false,\n            innerBarline: undefined,\n            finalBarline: 'final',\n            bestClef: false,\n            inPlace: false,\n        };\n        common.merge(params, options);\n        let voiceCount;\n        if (this.hasVoices()) {\n            voiceCount = this.getElementsByClass('Voice').length;\n        } else {\n            voiceCount = 0;\n        }\n        // meterStream\n        const meterStream = this.getElementsByClass('TimeSignature');\n        if (meterStream.length === 0) {\n            meterStream.append(this.timeSignature);\n        }\n        // getContextByClass('Clef')\n        const clefObj = this.clef;\n        const offsetMap = this.offsetMap();\n        let oMax = 0;\n        for (let i = 0; i < offsetMap.length; i++) {\n            if (offsetMap[i].endTime > oMax) {\n                oMax = offsetMap[i].endTime;\n            }\n        }\n        // console.log('oMax: ', oMax);\n        const post = new this.constructor();\n        // derivation\n        let o = 0.0;\n        let measureCount = 0;\n        let lastTimeSignature;\n        let m;\n        let mStart;\n        while (measureCount === 0 || o < oMax) {\n            m = new stream.Measure();\n            m.number = measureCount + 1;\n            // var thisTimeSignature = meterStream.getElementAtOrBefore(o);\n            const thisTimeSignature = this.timeSignature;\n            if (thisTimeSignature === undefined) {\n                break;\n            }\n            const oneMeasureLength\n                = thisTimeSignature.barDuration.quarterLength;\n            if (oneMeasureLength === 0) {\n                // if for some reason we are advancing not at all, then get out!\n                break;\n            }\n            if (measureCount === 0) {\n                // simplified...\n            }\n            m.clef = clefObj;\n            m.timeSignature = thisTimeSignature.clone();\n\n            for (let voiceIndex = 0; voiceIndex < voiceCount; voiceIndex++) {\n                const v = new stream.Voice();\n                v.id = voiceIndex;\n                m.insert(0, v);\n            }\n            post.insert(o, m);\n            o += oneMeasureLength;\n            measureCount += 1;\n        }\n        for (let i = 0; i < offsetMap.length; i++) {\n            const ob = offsetMap[i];\n            const e = ob.element;\n            const start = ob.offset;\n            const voiceIndex = ob.voiceIndex;\n\n            // if 'Spanner' in e.classes;\n            lastTimeSignature = undefined;\n            for (let j = 0; j < post.length; j++) {\n                m = post.get(j); // nothing but measures...\n                if (m.timeSignature !== undefined) {\n                    lastTimeSignature = m.timeSignature;\n                }\n                mStart = m.getOffsetBySite(post);\n                const mEnd\n                    = mStart + lastTimeSignature.barDuration.quarterLength;\n                if (start >= mStart && start < mEnd) {\n                    break;\n                }\n            }\n            // if not match, raise Exception;\n            const oNew = start - mStart;\n            if (m.clef === e) {\n                continue;\n            }\n            if (oNew === 0 && e.isClassOrSubclass('TimeSignature')) {\n                continue;\n            }\n            let insertStream = m;\n            if (voiceIndex !== undefined) {\n                insertStream = m.getElementsByClass('Voice').get(voiceIndex);\n            }\n            insertStream.insert(oNew, e);\n        }\n        // set barlines, etc.\n        if (params.inPlace !== true) {\n            return post;\n        } else {\n            this.elements = [];\n            // endElements\n            // elementsChanged;\n            for (const e of post) {\n                this.insert(e.offset, e);\n            }\n            return this; // javascript style;\n        }\n    }\n\n    /**\n     * Return a new Stream or modify this stream\n     * to have beams.\n     *\n     * NOT yet being called March 2018\n     */\n    makeBeams(options) {\n        const params = { inPlace: false };\n        common.merge(params, options);\n        let returnObj = this;\n        if (!params.inPlace) {\n            returnObj = this.clone(true);\n        }\n        let mColl;\n        if (this.classes.includes('Measure')) {\n            mColl = [returnObj];\n        } else {\n            mColl = [];\n            for (const m of returnObj.getElementsByClass('Measure').elements) {\n                mColl.push(m);\n            }\n        }\n        let lastTimeSignature;\n        for (const m of mColl) {\n            if (m.timeSignature !== undefined) {\n                lastTimeSignature = m.timeSignature;\n            }\n            if (lastTimeSignature === undefined) {\n                throw new StreamException('Need a Time Signature to process beams');\n            }\n            // todo voices!\n            if (m.length <= 1) {\n                continue; // nothing to beam.\n            }\n            const noteStream = m.notesAndRests;\n            const durList = [];\n            for (const n of noteStream) {\n                durList.push(n.duration);\n            }\n            const durSum = durList.map(a => a.quarterLength).reduce((total, val) => total + val);\n            const barQL = lastTimeSignature.barDuration.quarterLength;\n            if (durSum > barQL) {\n                continue;\n            }\n            let offset = 0.0;\n            if (m.paddingLeft !== 0.0 && m.paddingLeft !== undefined) {\n                offset = m.paddingLeft;\n            } else if (noteStream.highestTime < barQL) {\n                offset = barQL - noteStream.highestTime;\n            }\n            const beamsList = lastTimeSignature.getBeams(noteStream, { measureStartOffset: offset });\n            for (let i = 0; i < noteStream.length; i++) {\n                const n = noteStream.get(i);\n                const thisBeams = beamsList[i];\n                if (thisBeams !== undefined) {\n                    n.beams = thisBeams;\n                } else {\n                    n.beams = new beam.Beams();\n                }\n            }\n        }\n\n        // returnObj.streamStatus.beams = true;\n        return returnObj;\n    }\n\n    /**\n     * Returns true if any note in the stream has lyrics, otherwise false\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasLyrics() {\n        for (const el of this) {\n            if (el.lyric !== undefined) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Returns a list of OffsetMap objects\n     *\n     * @memberof music21.stream.Stream\n     * @returns [music21.stream.OffsetMap]\n     */\n    offsetMap() {\n        const offsetMap = [];\n        let groups = [];\n        if (this.hasVoices()) {\n            $.each(this.getElementsByClass('Voice').elements, (i, v) => {\n                groups.push([v.flat, i]);\n            });\n        } else {\n            groups = [[this, undefined]];\n        }\n        for (let i = 0; i < groups.length; i++) {\n            const group = groups[i][0];\n            const voiceIndex = groups[i][1];\n            for (let j = 0; j < group.length; j++) {\n                const e = group.get(j);\n                const dur = e.duration.quarterLength;\n                const offset = e.offset; // TODO: getOffsetBySite(group)\n                const endTime = offset + dur;\n                const thisOffsetMap = new stream.OffsetMap(\n                    e,\n                    offset,\n                    endTime,\n                    voiceIndex\n                );\n                offsetMap.push(thisOffsetMap);\n            }\n        }\n        return offsetMap;\n    }\n\n    /**\n     * Find all elements with a certain class; if an Array is given, then any\n     * matching class will work.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Array<string>|string} classList - a list of classes to find\n     * @returns {music21.stream.Stream}\n     */\n    getElementsByClass(classList) {\n        const tempEls = [];\n        for (const thisEl of this) {\n            // console.warn(thisEl);\n            if (thisEl.isClassOrSubclass === undefined) {\n                console.error(\n                    'what the hell is a ',\n                    thisEl,\n                    'doing in a Stream?'\n                );\n            } else if (thisEl.isClassOrSubclass(classList)) {\n                tempEls.push(thisEl);\n            }\n        }\n        const newSt = this.clone(false);\n        newSt.elements = tempEls;\n        return newSt;\n    }\n    /**\n     * Sets Pitch.accidental.displayStatus for every element with a\n     * pitch or pitches in the stream. If a natural needs to be displayed\n     * and the Pitch does not have an accidental object yet, adds one.\n     *\n     * Called automatically before appendDOM routines are called.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.stream.Stream} this\n     */\n    makeAccidentals() {\n        // cheap version of music21p method\n        const extendableStepList = {};\n        const stepNames = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];\n        for (const stepName of stepNames) {\n            let stepAlter = 0;\n            if (this.keySignature !== undefined) {\n                const tempAccidental = this.keySignature.accidentalByStep(\n                    stepName\n                );\n                if (tempAccidental !== undefined) {\n                    stepAlter = tempAccidental.alter;\n                    // console.log(stepAlter + \" \" + stepName);\n                }\n            }\n            extendableStepList[stepName] = stepAlter;\n        }\n        const lastOctaveStepList = [];\n        for (let i = 0; i < 10; i++) {\n            const tempOctaveStepDict = $.extend({}, extendableStepList);\n            lastOctaveStepList.push(tempOctaveStepDict);\n        }\n        const lastOctavelessStepDict = $.extend({}, extendableStepList); // probably unnecessary, but safe...\n\n        for (const el of this) {\n            if (el.pitch !== undefined) {\n                // note\n                const p = el.pitch;\n                const lastStepDict = lastOctaveStepList[p.octave];\n                this._makeAccidentalForOnePitch(\n                    p,\n                    lastStepDict,\n                    lastOctavelessStepDict\n                );\n            } else if (el._notes !== undefined) {\n                // chord\n                for (const chordNote of el._notes) {\n                    const p = chordNote.pitch;\n                    const lastStepDict = lastOctaveStepList[p.octave];\n                    this._makeAccidentalForOnePitch(\n                        p,\n                        lastStepDict,\n                        lastOctavelessStepDict\n                    );\n                }\n            }\n        }\n        return this;\n    }\n\n    //  returns pitch\n    _makeAccidentalForOnePitch(p, lastStepDict, lastOctavelessStepDict) {\n        if (lastStepDict === undefined) {\n            // octave < 0 or > 10? -- error that appeared sometimes.\n            lastStepDict = {};\n        }\n        let newAlter;\n        if (p.accidental === undefined) {\n            newAlter = 0;\n        } else {\n            newAlter = p.accidental.alter;\n        }\n        // console.log(p.name + \" \" + lastStepDict[p.step].toString());\n        if (\n            lastStepDict[p.step] !== newAlter\n            || lastOctavelessStepDict[p.step] !== newAlter\n        ) {\n            if (p.accidental === undefined) {\n                p.accidental = new pitch.Accidental('natural');\n            }\n            p.accidental.displayStatus = true;\n            // console.log(\"setting displayStatus to true\");\n        } else if (\n            lastStepDict[p.step] === newAlter\n            && lastOctavelessStepDict[p.step] === newAlter\n        ) {\n            if (p.accidental !== undefined) {\n                p.accidental.displayStatus = false;\n            }\n            // console.log(\"setting displayStatus to false\");\n        }\n        lastStepDict[p.step] = newAlter;\n        lastOctavelessStepDict[p.step] = newAlter;\n        return p;\n    }\n\n    /**\n     * Sets the render options for any substreams (such as placing them\n     * in systems, etc.) DOES NOTHING for music21.stream.Stream, but is\n     * overridden in subclasses.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {music21.stream.Stream} this\n     */\n    setSubstreamRenderOptions() {\n        /* does nothing for standard streams ... */\n        return this;\n    }\n    /**\n     * Resets all the RenderOptions back to defaults. Can run recursively\n     * and can also preserve the `RenderOptions.events` object.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Boolean} [recursive=false]\n     * @param {Boolean} [preserveEvents=false]\n     * @returns {music21.stream.Stream} this\n     */\n    resetRenderOptions(recursive, preserveEvents) {\n        const oldEvents = this.renderOptions.events;\n        this.renderOptions = new renderOptions.RenderOptions();\n        if (preserveEvents) {\n            this.renderOptions.events = oldEvents;\n        }\n\n        if (recursive) {\n            for (const el of this) {\n                if (el.isClassOrSubclass('Stream')) {\n                    el.resetRenderOptions(recursive, preserveEvents);\n                }\n            }\n        }\n        return this;\n    }\n\n    //  * *********  VexFlow functionality\n\n    renderVexflowOnCanvas(canvasOrSVG) {\n        console.warn(\n            'renderVexflowOnCanvas is deprecated; call renderVexflow instead'\n        );\n        return this.renderVexflow(canvasOrSVG);\n    }\n\n    /**\n     * Uses {@link music21.vfShow.Renderer} to render Vexflow onto an\n     * existing canvas or SVG object.\n     *\n     * Runs `this.setRenderInteraction` on the canvas.\n     *\n     * Will be moved to vfShow eventually when converter objects are enabled...maybe.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject|JQueryDOMObject} canvasOrSVG - a canvas or the div surrounding an SVG object\n     * @returns {vfShow.Renderer}\n     */\n    renderVexflow(canvasOrSVG) {\n        if (canvasOrSVG.jquery) {\n            canvasOrSVG = canvasOrSVG[0];\n        }\n        const DOMContains = document.body.contains(canvasOrSVG);\n        if (!DOMContains) {\n            // temporarily add to DOM so Firefox can measure it...\n            document.body.appendChild(canvasOrSVG);\n        }\n\n        const tagName = canvasOrSVG.tagName.toLowerCase();\n\n        if (this.autoBeam === true) {\n            try {\n                this.makeBeams({ inPlace: true });                \n            } catch (e) {\n                if (!e.toString().includes('Time Signature')) {\n                    throw e;\n                }\n            }\n        }\n        const vfr = new vfShow.Renderer(this, canvasOrSVG);\n        if (tagName === 'canvas') {\n            vfr.rendererType = 'canvas';\n        } else if (tagName === 'svg') {\n            vfr.rendererType = 'svg';\n        }\n        vfr.render();\n        this.setRenderInteraction(canvasOrSVG);\n        this.activeVFRenderer = vfr;\n        if (!DOMContains) {\n            // remove the adding to DOM so that Firefox could measure it...\n            document.body.removeChild(canvasOrSVG);\n        }\n\n        return vfr;\n    }\n\n    /**\n     * Estimate the stream height for the Stream.\n     *\n     * If there are systems they will be incorporated into the height unless `ignoreSystems` is `true`.\n     *\n     * @memberof music21.stream.Stream\n     * @param {Boolean} [ignoreSystems=false]\n     * @returns {number} height in pixels\n     */\n    estimateStreamHeight(ignoreSystems) {\n        const staffHeight = this.renderOptions.naiveHeight;\n        let systemPadding = this.systemPadding;\n        if (systemPadding === undefined) {\n            systemPadding = 0;\n        }\n        let numSystems;\n        if (this.isClassOrSubclass('Score')) {\n            const numParts = this.length;\n            numSystems = this.numSystems();\n            if (numSystems === undefined || ignoreSystems) {\n                numSystems = 1;\n            }\n            const scoreHeight\n                = numSystems * staffHeight * numParts\n                + (numSystems - 1) * systemPadding;\n            // console.log('scoreHeight of ' + scoreHeight);\n            return scoreHeight;\n        } else if (this.isClassOrSubclass('Part')) {\n            numSystems = 1;\n            if (!ignoreSystems) {\n                numSystems = this.numSystems();\n            }\n            if (debug) {\n                console.log(\n                    'estimateStreamHeight for Part: numSystems ['\n                        + numSystems\n                        + '] * staffHeight ['\n                        + staffHeight\n                        + '] + (numSystems ['\n                        + numSystems\n                        + '] - 1) * systemPadding ['\n                        + systemPadding\n                        + '].'\n                );\n            }\n            return numSystems * staffHeight + (numSystems - 1) * systemPadding;\n        } else {\n            return staffHeight;\n        }\n    }\n\n    /**\n     * Estimates the length of the Stream in pixels.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {number} length in pixels\n     */\n    estimateStaffLength() {\n        let i;\n        let totalLength;\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        if (this.hasVoices()) {\n            let maxLength = 0;\n            for (const v of this) {\n                if (v.isClassOrSubclass('Stream')) {\n                    const thisLength\n                        = v.estimateStaffLength() + v.renderOptions.staffPadding;\n                    if (thisLength > maxLength) {\n                        maxLength = thisLength;\n                    }\n                }\n            }\n            return maxLength;\n        } else if (this.hasSubStreams()) {\n            // part\n            totalLength = 0;\n            for (i = 0; i < this.length; i++) {\n                const m = this.get(i);\n                if (m.isClassOrSubclass('Stream')) {\n                    totalLength\n                        += m.estimateStaffLength() + m.renderOptions.staffPadding;\n                    if (i !== 0 && m.renderOptions.startNewSystem === true) {\n                        break;\n                    }\n                }\n            }\n            return totalLength;\n        } else {\n            const rendOp = this.renderOptions;\n            totalLength = 30 * this.length;\n            totalLength += rendOp.displayClef ? 30 : 0;\n            totalLength\n                += rendOp.displayKeySignature && this.keySignature\n                    ? this.keySignature.width\n                    : 0;\n            totalLength += rendOp.displayTimeSignature ? 30 : 0;\n            // totalLength += rendOp.staffPadding;\n            return totalLength;\n        }\n    }\n\n    //  * ***** MIDI related routines...\n\n    /**\n     * Plays the Stream through the MIDI/sound playback (for now, only MIDI.js is supported)\n     *\n     * `options` can be an object containing:\n     * - instrument: {@link music21.instrument.Instrument} object (default, `this.instrument`)\n     * - tempo: number (default, `this.tempo`)\n     *\n     * @memberof music21.stream.Stream\n     * @param {object} [options] - object of playback options\n     * @returns {music21.stream.Stream} this\n     */\n    playStream(options) {\n        const params = {\n            instrument: this.instrument,\n            tempo: this.tempo,\n            done: undefined,\n            startNote: undefined,\n        };\n        common.merge(params, options);\n        const startNoteIndex = params.startNote;\n        let currentNoteIndex = 0;\n        if (startNoteIndex !== undefined) {\n            currentNoteIndex = startNoteIndex;\n        }\n        const flatEls = this.flat.elements;\n        const lastNoteIndex = flatEls.length - 1;\n        this._stopPlaying = false;\n        const thisStream = this;\n\n        const playNext = function playNext(elements, params) {\n            if (currentNoteIndex <= lastNoteIndex && !thisStream._stopPlaying) {\n                const el = elements[currentNoteIndex];\n                let nextNote;\n                let playDuration;\n                if (currentNoteIndex < lastNoteIndex) {\n                    nextNote = elements[currentNoteIndex + 1];\n                    playDuration = nextNote.offset - el.offset;\n                } else {\n                    playDuration = el.duration.quarterLength;\n                }\n                const milliseconds = playDuration * 1000 * 60 / params.tempo;\n                if (debug) {\n                    console.log(\n                        'playing: ',\n                        el,\n                        playDuration,\n                        milliseconds,\n                        params.tempo\n                    );\n                }\n\n                if (el.playMidi !== undefined) {\n                    el.playMidi(params.tempo, nextNote, params);\n                }\n                currentNoteIndex += 1;\n                setTimeout(() => {\n                    playNext(elements, params);\n                }, milliseconds);\n            } else if (params && params.done) {\n                params.done.call();\n            }\n        };\n        playNext(flatEls, params);\n        return this;\n    }\n\n    /**\n     * Stops a stream from playing if it currently is.\n     *\n     * @memberof music21.stream.Stream\n     * @returns {musci21.stream.Stream} this\n     */\n    stopPlayStream() {\n        // turns off all currently playing MIDI notes (on any stream) and stops playback.\n        this._stopPlaying = true;\n        for (let i = 0; i < 127; i++) {\n            MIDI.noteOff(0, i, 0);\n        }\n        return this;\n    }\n    /* ----------------------------------------------------------------------\n     *\n     *  SVG/Canvas DOM routines -- to be factored out eventually.\n     *\n     */\n\n    createNewCanvas(width, height, elementType = 'svg') {\n        console.warn('createNewCanvas is deprecated, use createNewDOM instead');\n        return this.createNewDOM(width, height, elementType);\n    }\n\n    /**\n     * Creates and returns a new `&lt;canvas&gt;` or `&lt;svg&gt;` object.\n     *\n     * Calls setSubstreamRenderOptions() first.\n     *\n     * Does not render on the DOM element.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} width - will use `this.estimateStaffLength()` + `this.renderOptions.staffPadding` if not given\n     * @param {number|string|undefined} height - if undefined will use `this.renderOptions.height`. If still undefined, will use `this.estimateStreamHeight()`\n     * @param {string} elementType - what type of element, default = svg\n     * @returns {JQueryDOMObject} svg in jquery.\n     */\n    createNewDOM(width, height, elementType = 'svg') {\n        if (this.hasSubStreams()) {\n            this.setSubstreamRenderOptions();\n        }\n\n        // we render SVG on a Div for Vexflow\n        let renderElementType = 'div';\n        if (elementType === 'canvas') {\n            renderElementType = 'canvas';\n        }\n\n        const $newCanvasOrDIV = $('<' + renderElementType + '/>');\n        $newCanvasOrDIV.addClass('streamHolding'); // .css('border', '1px red solid');\n        $newCanvasOrDIV.css('display', 'inline-block');\n\n        if (width !== undefined) {\n            if (typeof width === 'string') {\n                width = common.stripPx(width);\n            }\n            $newCanvasOrDIV.attr('width', width);\n        } else {\n            const computedWidth\n                = this.estimateStaffLength()\n                + this.renderOptions.staffPadding\n                + 0;\n            $newCanvasOrDIV.attr('width', computedWidth);\n        }\n        if (height !== undefined) {\n            $newCanvasOrDIV.attr('height', height);\n        } else {\n            let computedHeight;\n            if (this.renderOptions.height === undefined) {\n                computedHeight = this.estimateStreamHeight();\n                // console.log('computed Height estim: ' + computedHeight);\n            } else {\n                computedHeight = this.renderOptions.height;\n                // console.log('computed Height: ' + computedHeight);\n            }\n            $newCanvasOrDIV.attr(\n                'height',\n                computedHeight * this.renderOptions.scaleFactor.y\n            );\n        }\n        return $newCanvasOrDIV;\n    }\n\n    createPlayableCanvas(width, height, elementType = 'svg') {\n        console.warn(\n            'createPlayableCanvas is deprecated, use createPlayableDOM instead'\n        );\n        return this.createPlayableDOM(width, height, elementType);\n    }\n\n    /**\n     * Creates a rendered, playable svg where clicking plays it.\n     *\n     * Called from appendNewDOM() etc.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} width\n     * @param {number|string|undefined} height\n     * @param {string} elementType - what type of element, default = svg\n     * @returns {JQueryDOMObject} canvas or svg\n     */\n    createPlayableDOM(width, height, elementType = 'svg') {\n        this.renderOptions.events.click = 'play';\n        return this.createDOM(width, height, elementType);\n    }\n\n    createCanvas(width, height, elementType = 'svg') {\n        console.warn('createCanvas is deprecated, use createDOM');\n        return this.createDOM(width, height, elementType);\n    }\n    /**\n     * Creates a new svg and renders vexflow on it\n     *\n     * @memberof music21.stream.Stream\n     * @param {number|string|undefined} [width]\n     * @param {number|string|undefined} [height]\n     * @param {string} elementType - what type of element svg or canvas, default = svg\n     * @returns {JQueryDOMObject} canvas or SVG\n     */\n    createDOM(width, height, elementType = 'svg') {\n        const $newSvg = this.createNewDOM(width, height, elementType);\n        // temporarily append the SVG to the document to fix a Firefox bug\n        // where nothing can be measured unless is it in the document.\n        this.renderVexflow($newSvg);\n        return $newSvg;\n    }\n\n    appendNewCanvas(appendElement, width, height, elementType = 'svg') {\n        console.warn('appendNewCanvas is deprecated, use appendNewDOM instead');\n        return this.appendNewDOM(appendElement, width, height, elementType);\n    }\n\n    /**\n     * Creates a new canvas, renders vexflow on it, and appends it to the DOM.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject|DOMObject} [appendElement=document.body] - where to place the svg\n     * @param {number|string} [width]\n     * @param {number|string} [height]\n     * @param {string} elementType - what type of element, default = svg\n     * @returns {DOMObject} svg (not the jQueryDOMObject -- this is a difference with other routines and should be fixed. TODO: FIX)\n     *\n     */\n    appendNewDOM(appendElement, width, height, elementType = 'svg') {\n        if (appendElement === undefined) {\n            appendElement = 'body';\n        }\n        let $appendElement = appendElement;\n        if (appendElement.jquery === undefined) {\n            $appendElement = $(appendElement);\n        }\n\n        //      if (width === undefined && this.renderOptions.maxSystemWidth === undefined) {\n        //      var $bodyElement = bodyElement;\n        //      if (bodyElement.jquery === undefined) {\n        //      $bodyElement = $(bodyElement);\n        //      }\n        //      width = $bodyElement.width();\n        //      };\n\n        const svgOrCanvasBlock = this.createDOM(width, height, elementType);\n        $appendElement.append(svgOrCanvasBlock);\n        return svgOrCanvasBlock[0];\n    }\n\n    replaceCanvas(where, preserveSvgSize, elementType = 'svg') {\n        console.warn('replaceCanvas is deprecated, use replaceDOM instead');\n        return this.replaceDOM(where, preserveSvgSize, elementType);\n    }\n\n    /**\n     * Replaces a particular Svg with a new rendering of one.\n     *\n     * Note that if 'where' is empty, will replace all svges on the page.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject|DOMObject} [where] - the canvas or SVG to replace or a container holding the canvas(es) to replace.\n     * @param {Boolean} [preserveSvgSize=false]\n     * @param {string} elementType - what type of element, default = svg\n     * @returns {JQueryDOMObject} the svg\n     */\n    replaceDOM(where, preserveSvgSize, elementType = 'svg') {\n        // if called with no where, replaces all the svges on the page...\n        if (where === undefined) {\n            where = 'body';\n        }\n        let $where;\n        if (where.jquery === undefined) {\n            $where = $(where);\n        } else {\n            $where = where;\n            where = $where[0];\n        }\n        let $oldSVGOrCanvas;\n\n        if ($where.hasClass('streamHolding')) {\n            $oldSVGOrCanvas = $where;\n        } else {\n            $oldSVGOrCanvas = $where.find('.streamHolding');\n        }\n        // TODO: Max Width!\n        if ($oldSVGOrCanvas.length === 0) {\n            throw new Music21Exception('No svg defined for replaceDOM!');\n        } else if ($oldSVGOrCanvas.length > 1) {\n            // change last svg...\n            // replacing each with svgBlock doesn't work\n            // anyhow, it just resizes the svg but doesn't\n            // draw.\n            $oldSVGOrCanvas = $($oldSVGOrCanvas[$oldSVGOrCanvas.length - 1]);\n        }\n\n        let svgBlock;\n        if (preserveSvgSize) {\n            const width = $oldSVGOrCanvas.width() || parseInt($oldSVGOrCanvas.attr('width'));\n            const height = $oldSVGOrCanvas.attr('height'); // height manipulates\n            svgBlock = this.createDOM(width, height, elementType);\n        } else {\n            svgBlock = this.createDOM(undefined, undefined, elementType);\n        }\n\n        $oldSVGOrCanvas.replaceWith(svgBlock);\n        return svgBlock;\n    }\n\n\n    /**\n     * Set the type of interaction on the svg based on\n     *    - Stream.renderOptions.events.click\n     *    - Stream.renderOptions.events.dblclick\n     *    - Stream.renderOptions.events.resize\n     *\n     * Currently the only options available for each are:\n     *    - 'play' (string)\n     *    - 'reflow' (string; only on event.resize)\n     *    - customFunction (will receive event as a first variable; should set up a way to\n     *                    find the original stream; var s = this; var f = function () { s...}\n     *                   )\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} canvasOrDiv - canvas or the Div surrounding it.\n     * @returns {music21.stream.Stream} this\n     */\n    setRenderInteraction(canvasOrDiv) {\n        let $svg = canvasOrDiv;\n        if (canvasOrDiv === undefined) {\n            return this;\n        } else if (canvasOrDiv.jquery === undefined) {\n            $svg = $(canvasOrDiv);\n        }\n        const playFunc = () => {\n            this.playStream();\n        };\n\n        $.each(\n            this.renderOptions.events,\n            $.proxy(function setRenderInteractionProxy(\n                eventType,\n                eventFunction\n            ) {\n                $svg.off(eventType);\n                if (\n                    typeof eventFunction === 'string'\n                    && eventFunction === 'play'\n                ) {\n                    $svg.on(eventType, playFunc);\n                } else if (\n                    typeof eventFunction === 'string'\n                    && eventType === 'resize'\n                    && eventFunction === 'reflow'\n                ) {\n                    this.windowReflowStart($svg);\n                } else if (eventFunction !== undefined) {\n                    $svg.on(eventType, eventFunction);\n                }\n            },\n            this)\n        );\n        return this;\n    }\n\n    /**\n     *\n     * Recursively search downward for the closest storedVexflowStave...\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Vex.Flow.Stave|undefined}\n     */\n    recursiveGetStoredVexflowStave() {\n        let storedVFStave = this.storedVexflowStave;\n        if (storedVFStave === undefined) {\n            if (!this.hasSubStreams()) {\n                return undefined;\n            } else {\n                const subStreams = this.getElementsByClass('Stream');\n                storedVFStave = subStreams.get(0).storedVexflowStave;\n                if (storedVFStave === undefined) {\n                    // TODO: bad programming ... should support continuous recurse\n                    // but good enough for now...\n                    if (subStreams.get(0).hasSubStreams()) {\n                        storedVFStave = subStreams.get(0).get(0)\n                            .storedVexflowStave;\n                    }\n                }\n            }\n        }\n        return storedVFStave;\n    }\n\n    getUnscaledXYforCanvas(svg, e) {\n        console.warn(\n            'getUnscaledXYforCanvas is deprecated, use getUnscaledXYforDOM instead'\n        );\n        return this.getUnscaledXYforDOM(svg, e);\n    }\n\n    /**\n     * Given a mouse click, or other event with .pageX and .pageY,\n     * find the x and y for the svg.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} svg - a canvas or SVG object\n     * @param {Event} e\n     * @returns {Array<number>} two-elements, [x, y] in pixels.\n     */\n    getUnscaledXYforDOM(svg, e) {\n        let offset = null;\n        if (svg === undefined) {\n            offset = { left: 0, top: 0 };\n        } else {\n            offset = $(svg).offset();\n        }\n        /*\n         * mouse event handler code from: http://diveintohtml5.org/canvas.html\n         */\n        let xClick;\n        let yClick;\n        if (e.pageX !== undefined && e.pageY !== undefined) {\n            xClick = e.pageX;\n            yClick = e.pageY;\n        } else {\n            xClick\n                = e.clientX\n                + document.body.scrollLeft\n                + document.documentElement.scrollLeft;\n            yClick\n                = e.clientY\n                + document.body.scrollTop\n                + document.documentElement.scrollTop;\n        }\n        const xPx = xClick - offset.left;\n        const yPx = yClick - offset.top;\n        return [xPx, yPx];\n    }\n\n    getScaledXYforCanvas(svg, e) {\n        console.warn(\n            'getScaledXYforCanvas is deprecated, use getScaledXYforDOM instead'\n        );\n        return this.getScaledXYforDOM(svg, e);\n    }\n\n    /**\n     * return a list of [scaledX, scaledY] for\n     * a svg element.\n     *\n     * xScaled refers to 1/scaleFactor.x -- for instance, scaleFactor.x = 0.7 (default)\n     * x of 1 gives 1.42857...\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} svg -- a canvas or SVG object\n     * @param {Event} e\n     * @returns {Array<number>} [scaledX, scaledY]\n     */\n    getScaledXYforDOM(svg, e) {\n        const [xPx, yPx] = this.getUnscaledXYforDOM(svg, e);\n        const pixelScaling = this.renderOptions.scaleFactor;\n\n        const yPxScaled = yPx / pixelScaling.y;\n        const xPxScaled = xPx / pixelScaling.x;\n        return [xPxScaled, yPxScaled];\n    }\n    /**\n     *\n     * Given a Y position find the diatonicNoteNum that a note at that position would have.\n     *\n     * searches this.storedVexflowStave\n     *\n     * Y position must be offset from the start of the stave...\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} yPxScaled\n     * @returns {Int}\n     */\n    diatonicNoteNumFromScaledY(yPxScaled) {\n        const storedVFStave = this.recursiveGetStoredVexflowStave();\n        // for (var i = -10; i < 10; i++) {\n        //    console.log(\"line: \" + i + \" y: \" + storedVFStave.getYForLine(i));\n        // }\n        const lineSpacing = storedVFStave.options.spacing_between_lines_px;\n        const linesAboveStaff = storedVFStave.options.space_above_staff_ln;\n\n        const notesFromTop = yPxScaled * 2 / lineSpacing;\n        const notesAboveLowestLine\n            = (storedVFStave.options.num_lines - 1 + linesAboveStaff) * 2\n            - notesFromTop;\n        const clickedDiatonicNoteNum\n            = this.clef.lowestLine + Math.round(notesAboveLowestLine);\n        return clickedDiatonicNoteNum;\n    }\n\n    /**\n     * Returns the stream that is at X location xPxScaled and system systemIndex.\n     *\n     * Override in subclasses, always returns this; here.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} [xPxScaled]\n     * @param {number} [allowablePixels=10]\n     * @param {number} [systemIndex]\n     * @returns {music21.stream.Stream}\n     *\n     */\n    getStreamFromScaledXandSystemIndex(xPxScaled, systemIndex) {\n        return this;\n    }\n\n    /**\n     *\n     * Return the note at pixel X (or within allowablePixels [default 10])\n     * of the note.\n     *\n     * systemIndex element is not used on bare Stream\n     *\n     * options can be a dictionary of: 'allowBackup' which gets the closest\n     * note within the window even if it's beyond allowablePixels (default: true)\n     * and 'backupMaximum' which specifies a maximum distance even for backup\n     * (default: 70);\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} xPxScaled\n     * @param {number} [allowablePixels=10]\n     * @param {number} [systemIndex]\n     * @param {object} [options]\n     * @returns {music21.base.Music21Object|undefined}\n     */\n    noteElementFromScaledX(xPxScaled, allowablePixels, systemIndex, options) {\n        const params = {\n            allowBackup: true,\n            backupMaximum: 70,\n        };\n        common.merge(params, options);\n        let foundNote;\n        if (allowablePixels === undefined) {\n            allowablePixels = 10;\n        }\n        const subStream = this.getStreamFromScaledXandSystemIndex(\n            xPxScaled,\n            systemIndex\n        );\n        if (subStream === undefined) {\n            return undefined;\n        }\n        const backup = {\n            minDistanceSoFar: params.backupMaximum,\n            note: undefined,\n        }; // a backup in case we did not find within allowablePixels\n\n        for (const n of subStream.flat.notesAndRests.elements) {\n            /* should also\n             * compensate for accidentals...\n             */\n            const leftDistance = Math.abs(n.x - xPxScaled);\n            const rightDistance = Math.abs(n.x + n.width - xPxScaled);\n            const minDistance = Math.min(leftDistance, rightDistance);\n\n            if (\n                leftDistance < allowablePixels\n                && rightDistance < allowablePixels\n            ) {\n                foundNote = n;\n                break; /* O(n); can be made O(log n) */\n            } else if (\n                leftDistance < params.backupMaximum\n                && rightDistance < params.backupMaximum\n                && minDistance < backup.minDistanceSoFar\n            ) {\n                backup.note = n;\n                backup.minDistanceSoFar = minDistance;\n            }\n        }\n        // console.log('note here is: ', foundNote);\n        if (params.allowBackup && foundNote === undefined) {\n            foundNote = backup.note;\n            // console.log('used backup: closest was: ', backup.minDistanceSoFar);\n        }\n        // console.log(foundNote);\n        return foundNote;\n    }\n\n    /**\n     * Given an event object, and an x and y location, returns a two-element array\n     * of the pitch.Pitch.diatonicNoteNum that was clicked (i.e., if C4 was clicked this\n     * will return 29; if D4 was clicked this will return 30) and the closest note in the\n     * stream that was clicked.\n     *\n     * Return a list of [diatonicNoteNum, closestXNote]\n     * for an event (e) called on the svg (svg)\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} svg\n     * @param {Event} e\n     * @param {number} x\n     * @param {number} y\n     * @returns {Array} [diatonicNoteNum, closestXNote]\n     */\n    findNoteForClick(svg, e, x, y) {\n        if (x === undefined || y === undefined) {\n            [x, y] = this.getScaledXYforDOM(svg, e);\n        }\n        const clickedDiatonicNoteNum = this.diatonicNoteNumFromScaledY(y);\n        const foundNote = this.noteElementFromScaledX(x);\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * Change the pitch of a note given that it has been clicked and then\n     * call changedCallbackFunction\n     *\n     * To be removed...\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} clickedDiatonicNoteNum\n     * @param {music21.base.Music21Object} foundNote\n     * @param {DOMObject} svg\n     * @returns {any} output of changedCallbackFunction\n     */\n    noteChanged(clickedDiatonicNoteNum, foundNote, svg) {\n        const n = foundNote;\n        const p = new pitch.Pitch('C');\n        p.diatonicNoteNum = clickedDiatonicNoteNum;\n        p.accidental = n.pitch.accidental;\n        n.pitch = p;\n        n.stemDirection = undefined;\n        this.activeNote = n;\n        const $newSvg = this.redrawDOM(svg);\n        const params = { foundNote: n, svg: $newSvg };\n        if (this.changedCallbackFunction !== undefined) {\n            return this.changedCallbackFunction(params);\n        } else {\n            return params;\n        }\n    }\n\n    redrawCanvas(svg) {\n        console.warn('redrawCanvas is deprecated, use redrawDOM instead');\n        return this.redrawDOM(svg);\n    }\n\n    /**\n     * Redraws an svgDiv, keeping the events of the previous svg.\n     *\n     * @memberof music21.stream.Stream\n     * @param {DOMObject} svg\n     * @returns {music21.stream.Stream} this\n     */\n    redrawDOM(svg) {\n        // this.resetRenderOptions(true, true); // recursive, preserveEvents\n        // this.setSubstreamRenderOptions();\n        const $svg = $(svg); // works even if svg is already $jquery\n        const $newSvg = this.createNewDOM(svg.width, svg.height);\n        this.renderVexflow($newSvg);\n        $svg.replaceWith($newSvg);\n        // this is no longer necessary.\n        // common.jQueryEventCopy($.event, $svg, $newCanv); /* copy events -- using custom extension... */\n        return $newSvg;\n    }\n\n    editableAccidentalCanvas(width, height) {\n        console.warn(\n            'editableAccidentalCanvas is deprecated, use editableAccidentalDOM instead'\n        );\n        return this.editableAccidentalDOM(width, height);\n    }\n\n    /**\n     * Renders a stream on svg with the ability to edit it and\n     * a toolbar that allows the accidentals to be edited.\n     *\n     * @memberof music21.stream.Stream\n     * @param {number} [width]\n     * @param {number} [height]\n     * @returns {DOMObject} &lt;div&gt; tag around the svg.\n     */\n    editableAccidentalDOM(width, height) {\n        /*\n         * Create an editable svg with an accidental selection bar.\n         */\n        const d = $('<div/>')\n            .css('text-align', 'left')\n            .css('position', 'relative');\n\n        this.renderOptions.events.click = this.DOMChangerFunction;\n        const $svgDiv = this.createDOM(width, height);\n        const buttonDiv = this.getAccidentalToolbar(\n            undefined,\n            undefined,\n            $svgDiv\n        );\n        d.append(buttonDiv);\n        d.append($(\"<br clear='all'/>\"));\n        d.append($svgDiv);\n        return d;\n    }\n\n    /*\n     * SVG toolbars...\n     */\n\n    /**\n     *\n     * @memberof music21.stream.Stream\n     * @param {Int} minAccidental - alter of the min accidental (default -1)\n     * @param {Int} maxAccidental - alter of the max accidental (default 1)\n     * @param {jQueryObject} $siblingSvg - svg to use for redrawing;\n     * @returns {jQueryObject} the accidental toolbar.\n     */\n    getAccidentalToolbar(minAccidental, maxAccidental, $siblingSvg) {\n        if (minAccidental === undefined) {\n            minAccidental = -1;\n        }\n        if (maxAccidental === undefined) {\n            maxAccidental = 1;\n        }\n        minAccidental = Math.round(minAccidental);\n        maxAccidental = Math.round(maxAccidental);\n\n        const addAccidental = (newAlter, clickEvent) => {\n            /*\n             * To be called on a button...\n             */\n            let $useSvg = $siblingSvg;\n            if ($useSvg === undefined) {\n                let $searchParent = $(clickEvent.target).parent();\n                let maxSearch = 99;\n                while (\n                    maxSearch > 0\n                    && $searchParent !== undefined\n                    && ($useSvg === undefined || $useSvg[0] === undefined)\n                ) {\n                    maxSearch -= 1;\n                    $useSvg = $searchParent.find('.streamHolding');\n                    $searchParent = $searchParent.parent();\n                }\n                if ($useSvg[0] === undefined) {\n                    console.log('Could not find a svg...');\n                    return;\n                }\n            }\n            if (this.activeNote !== undefined) {\n                const n = this.activeNote;\n                n.pitch.accidental = new pitch.Accidental(newAlter);\n                /* console.log(n.pitch.name); */\n                const $newSvg = this.redrawDOM($useSvg[0]);\n                if (this.changedCallbackFunction !== undefined) {\n                    this.changedCallbackFunction({\n                        foundNote: n,\n                        svg: $newSvg,\n                    });\n                }\n            }\n        };\n\n        const $buttonDiv = $('<div/>').attr(\n            'class',\n            'accidentalToolbar scoreToolbar'\n        );\n        for (let i = minAccidental; i <= maxAccidental; i++) {\n            const acc = new pitch.Accidental(i);\n            const $button = $(\n                '<button>' + acc.unicodeModifier + '</button>'\n            ).click(e => addAccidental(i, e));\n            if (Math.abs(i) > 1) {\n                $button.css('font-family', 'Bravura Text');\n                $button.css('font-size', '20px');\n            }\n            $buttonDiv.append($button);\n        }\n        return $buttonDiv;\n    }\n    /**\n     *\n     * @memberof music21.stream.Stream\n     * @returns {jQueryObject} a Div containing two buttons -- play and stop\n     */\n    getPlayToolbar() {\n        const $buttonDiv = $('<div/>').attr(\n            'class',\n            'playToolbar scoreToolbar'\n        );\n        const $bPlay = $('<button>&#9658</button>');\n        $bPlay.click(() => {\n            this.playStream();\n        });\n        $buttonDiv.append($bPlay);\n        const $bStop = $('<button>&#9724</button>');\n        $bStop.click(() => {\n            this.stopPlayStream();\n        });\n        $buttonDiv.append($bStop);\n        return $buttonDiv;\n    }\n    //  reflow\n\n    /**\n     * Begins a series of bound events to the window that makes it\n     * so that on resizing the stream is redrawn and reflowed to the\n     * new size.\n     *\n     * @memberof music21.stream.Stream\n     * @param {JQueryDOMObject} jSvg\n     * @returns {music21.stream.Stream} this\n     */\n    windowReflowStart(jSvg) {\n        // set up a bunch of windowReflow bindings that affect the svg.\n        const callingStream = this;\n        let jSvgNow = jSvg;\n        $(window).bind('resizeEnd', () => {\n            // do something, window hasn't changed size in 500ms\n            const jSvgParent = jSvgNow.parent();\n            const newWidth = jSvgParent.width();\n            const svgWidth = newWidth;\n            // console.log(svgWidth);\n            console.log('resizeEnd triggered', newWidth);\n            // console.log(callingStream.renderOptions.events.click);\n            callingStream.resetRenderOptions(true, true); // recursive, preserveEvents\n            // console.log(callingStream.renderOptions.events.click);\n            callingStream.maxSystemWidth = svgWidth - 40;\n            jSvgNow.remove();\n            const svgObj = callingStream.appendNewDOM(jSvgParent);\n            jSvgNow = $(svgObj);\n        });\n        $(window).resize(function resizeSvgTo() {\n            if (this.resizeTO) {\n                clearTimeout(this.resizeTO);\n            }\n            this.resizeTO = setTimeout(function resizeToTimeout() {\n                $(this).trigger('resizeEnd');\n            }, 200);\n        });\n        setTimeout(function triggerResizeOnCreateSvg() {\n            const $window = $(window);\n            const doResize = $window.data('triggerResizeOnCreateSvg');\n            if (doResize === undefined || doResize === true) {\n                $(this).trigger('resizeEnd');\n                $window.data('triggerResizeOnCreateSvg', false);\n            }\n        }, 1000);\n        return this;\n    }\n    /**\n     * Does this stream have a {@link music21.stream.Voice} inside it?\n     *\n     * @memberof music21.stream.Stream\n     * @returns {Boolean}\n     */\n    hasVoices() {\n        for (const el of this) {\n            if (el.isClassOrSubclass('Voice')) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nstream.Stream = Stream;\n\n/**\n *\n * @class Voice\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Voice extends Stream {\n    constructor() {\n        super();\n        this.recursionType = 'elementsFirst';\n    }\n}\nstream.Voice = Voice;\n\n/**\n * @class Measure\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Measure extends Stream {\n    constructor() {\n        super();\n        this.recursionType = 'elementsFirst';\n        this.isMeasure = true;\n        this.number = 0; // measure number\n    }\n}\nstream.Measure = Measure;\n\n/**\n * Part -- specialized to handle Measures inside it\n *\n * @class Part\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Part extends Stream {\n    constructor() {\n        super();\n        this.recursionType = 'flatten';\n        this.systemHeight = this.renderOptions.naiveHeight;\n    }\n\n    /**\n     * How many systems does this Part have?\n     *\n     * Does not change any reflow information, so by default it's always 1.\n     *\n     * @memberof music21.stream.Part\n     * @returns {Number}\n     */\n    numSystems() {\n        let numSystems = 1;\n        const subStreams = this.getElementsByClass('Stream');\n        for (let i = 1; i < subStreams.length; i++) {\n            if (subStreams.get(i).renderOptions.startNewSystem) {\n                numSystems += 1;\n            }\n        }\n        return numSystems;\n    }\n\n    /**\n     * Find the width of every measure in the Part.\n     *\n     * @memberof music21.stream.Part\n     * @returns {Array<number>}\n     */\n    getMeasureWidths() {\n        /* call after setSubstreamRenderOptions */\n        const measureWidths = [];\n        for (const el of this) {\n            if (el.isClassOrSubclass('Measure')) {\n                const elRendOp = el.renderOptions;\n                measureWidths[elRendOp.measureIndex] = elRendOp.width;\n            }\n        }\n        /* console.log(measureWidths);\n         *\n         */\n        return measureWidths;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#estimateStaffLength\n     *\n     * @memberof music21.stream.Part\n     * @returns {number}\n     */\n    estimateStaffLength() {\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        if (this.hasSubStreams()) {\n            // part with Measures underneath\n            let totalLength = 0;\n            let isFirst = true;\n            for (const m of this.getElementsByClass('Measure')) {\n                // this looks wrong, but actually seems to be right. moving it to\n                // after the break breaks things.\n                totalLength\n                    += m.estimateStaffLength() + m.renderOptions.staffPadding;\n                if (!isFirst && m.renderOptions.startNewSystem === true) {\n                    break;\n                }\n                isFirst = false;\n            }\n            return totalLength;\n        }\n        // no measures found in part... treat as measure\n        const tempM = new stream.Measure();\n        tempM.elements = this.elements;\n        return tempM.estimateStaffLength();\n    }\n    /**\n     * Divide a part up into systems and fix the measure\n     * widths so that they are all even.\n     *\n     * Note that this is done on the part level even though\n     * the measure widths need to be consistent across parts.\n     *\n     * This is possible because the system is deterministic and\n     * will come to the same result for each part.  Opportunity\n     * for making more efficient through this...\n     *\n     * @memberof music21.stream.Part\n     * @param systemHeight\n     * @returns {Array}\n     */\n    fixSystemInformation(systemHeight) {\n        /*\n         * console.log('system height: ' + systemHeight);\n         */\n        if (systemHeight === undefined) {\n            systemHeight = this.systemHeight; /* part.show() called... */\n        } else if (debug) {\n            console.log('overridden systemHeight: ' + systemHeight);\n        }\n        const systemPadding\n            = this.renderOptions.systemPadding\n            || this.renderOptions.naiveSystemPadding;\n        const measureWidths = this.getMeasureWidths();\n        const maxSystemWidth = this.maxSystemWidth; /* of course fix! */\n        const systemCurrentWidths = [];\n        const systemBreakIndexes = [];\n        let lastSystemBreak = 0; /* needed to ensure each line has at least one measure */\n        const startLeft = 20; /* TODO: make it obtained elsewhere */\n        let currentLeft = startLeft;\n        let i;\n        for (i = 0; i < measureWidths.length; i++) {\n            const currentRight = currentLeft + measureWidths[i];\n            /* console.log(\"left: \" + currentLeft + \" ; right: \" + currentRight + \" ; m: \" + i); */\n            if (currentRight > maxSystemWidth && lastSystemBreak !== i) {\n                systemBreakIndexes.push(i - 1);\n                systemCurrentWidths.push(currentLeft);\n\n                // console.log('setting new width at ' + currentLeft);\n                currentLeft = startLeft + measureWidths[i]; // 20 + this width;\n                lastSystemBreak = i;\n            } else {\n                currentLeft = currentRight;\n            }\n        }\n        // console.log(systemCurrentWidths);\n        // console.log(systemBreakIndexes);\n\n        let currentSystemIndex = 0;\n        let leftSubtract = 0;\n        let newLeftSubtract;\n        for (i = 0; i < this.length; i++) {\n            const m = this.get(i);\n            if (m.renderOptions === undefined) {\n                continue;\n            }\n            if (i === 0) {\n                m.renderOptions.startNewSystem = true;\n            }\n            currentLeft = m.renderOptions.left;\n\n            if (systemBreakIndexes.indexOf(i - 1) !== -1) {\n                /* first measure of new System */\n                const oldWidth = m.renderOptions.width;\n                m.renderOptions.displayClef = true;\n                m.renderOptions.displayKeySignature = true;\n                m.renderOptions.startNewSystem = true;\n\n                const newWidth\n                    = m.estimateStaffLength() + m.renderOptions.staffPadding;\n                m.renderOptions.width = newWidth;\n                leftSubtract = currentLeft - 20;\n                // after this one, we'll have a new left subtract...\n                newLeftSubtract = leftSubtract - (newWidth - oldWidth);\n\n                currentSystemIndex += 1;\n            } else if (i !== 0) {\n                m.renderOptions.startNewSystem = false;\n                m.renderOptions.displayClef = false; // check for changed clef first?\n                m.renderOptions.displayKeySignature = false; // check for changed KS first?\n            }\n            m.renderOptions.systemIndex = currentSystemIndex;\n            let currentSystemMultiplier;\n            if (currentSystemIndex >= systemCurrentWidths.length) {\n                /* last system... non-justified */\n                currentSystemMultiplier = 1;\n            } else {\n                const currentSystemWidth\n                    = systemCurrentWidths[currentSystemIndex];\n                currentSystemMultiplier = maxSystemWidth / currentSystemWidth;\n                // console.log('systemMultiplier: ' + currentSystemMultiplier + ' max: ' + maxSystemWidth + ' current: ' + currentSystemWidth);\n            }\n            /* might make a small gap? fix? */\n            const newLeft = currentLeft - leftSubtract;\n            if (newLeftSubtract !== undefined) {\n                leftSubtract = newLeftSubtract;\n                newLeftSubtract = undefined;\n            }\n            // console.log('M: ' + i + ' ; old left: ' + currentLeft + ' ; new Left: ' + newLeft);\n            m.renderOptions.left = Math.floor(\n                newLeft * currentSystemMultiplier\n            );\n            m.renderOptions.width = Math.floor(\n                m.renderOptions.width * currentSystemMultiplier\n            );\n            const newTop\n                = m.renderOptions.top\n                + currentSystemIndex * (systemHeight + systemPadding);\n            // console.log('M: ' + i + '; New top: ' + newTop + \" ; old Top: \" + m.renderOptions.top);\n            m.renderOptions.top = newTop;\n        }\n\n        return systemCurrentWidths;\n    }\n    /**\n     * overrides music21.stream.Stream#setSubstreamRenderOptions\n     *\n     * figures out the `.left` and `.top` attributes for all contained measures\n     *\n     * @memberof music21.stream.Part\n     */\n    setSubstreamRenderOptions() {\n        let currentMeasureIndex = 0; /* 0 indexed for now */\n        let currentMeasureLeft = 20;\n        const rendOp = this.renderOptions;\n        let lastTimeSignature;\n        let lastKeySignature;\n        let lastClef;\n\n        for (const el of this) {\n            if (el.isClassOrSubclass('Measure')) {\n                const elRendOp = el.renderOptions;\n                elRendOp.measureIndex = currentMeasureIndex;\n                elRendOp.top = rendOp.top;\n                elRendOp.partIndex = rendOp.partIndex;\n                elRendOp.left = currentMeasureLeft;\n\n                if (currentMeasureIndex === 0) {\n                    lastClef = el._clef;\n                    lastTimeSignature = el._timeSignature;\n                    lastKeySignature = el._keySignature;\n\n                    elRendOp.displayClef = true;\n                    elRendOp.displayKeySignature = true;\n                    elRendOp.displayTimeSignature = true;\n                } else {\n                    if (\n                        el._clef !== undefined\n                        && lastClef !== undefined\n                        && el._clef.name !== lastClef.name\n                    ) {\n                        console.log(\n                            'changing clefs for ',\n                            elRendOp.measureIndex,\n                            ' from ',\n                            lastClef.name,\n                            ' to ',\n                            el._clef.name\n                        );\n                        lastClef = el._clef;\n                        elRendOp.displayClef = true;\n                    } else {\n                        elRendOp.displayClef = false;\n                    }\n\n                    if (\n                        el._keySignature !== undefined\n                        && lastKeySignature !== undefined\n                        && el._keySignature.sharps !== lastKeySignature.sharps\n                    ) {\n                        lastKeySignature = el._keySignature;\n                        elRendOp.displayKeySignature = true;\n                    } else {\n                        elRendOp.displayKeySignature = false;\n                    }\n\n                    if (\n                        el._timeSignature !== undefined\n                        && lastTimeSignature !== undefined\n                        && el._timeSignature.ratioString\n                            !== lastTimeSignature.ratioString\n                    ) {\n                        lastTimeSignature = el._timeSignature;\n                        elRendOp.displayTimeSignature = true;\n                    } else {\n                        elRendOp.displayTimeSignature = false;\n                    }\n                }\n                elRendOp.width\n                    = el.estimateStaffLength() + elRendOp.staffPadding;\n                elRendOp.height = el.estimateStreamHeight();\n                currentMeasureLeft += elRendOp.width;\n                currentMeasureIndex += 1;\n            }\n        }\n        return this;\n    }\n\n    /**\n     * systemIndexAndScaledY - given a scaled Y, return the systemIndex\n     * and the scaledYRelativeToSystem\n     *\n     * @memberof music21.stream.Part\n     * @param  {number} y the scaled Y\n     * @return Array<int, number>   systemIndex, scaledYRelativeToSystem\n     */\n    systemIndexAndScaledY(y) {\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            systemPadding = this.renderOptions.naiveSystemPadding;\n        }\n        const systemIndex = Math.floor(y / (this.systemHeight + systemPadding));\n        const scaledYRelativeToSystem\n            = y - systemIndex * (this.systemHeight + systemPadding);\n        return [systemIndex, scaledYRelativeToSystem];\n    }\n\n    /**\n     * Overrides the default music21.stream.Stream#findNoteForClick\n     * by taking into account systems\n     *\n     * @memberof music21.stream.Part\n     * @param {DOMObject} svg\n     * @param {Event} e\n     * @returns {Array} [clickedDiatonicNoteNum, foundNote]\n     */\n    findNoteForClick(svg, e) {\n        const [x, y] = this.getScaledXYforDOM(svg, e);\n\n        // debug = true;\n        if (debug) {\n            console.log(\n                'this.estimateStreamHeight(): '\n                    + this.estimateStreamHeight()\n                    + ' / $(svg).height(): '\n                    + $(svg).height()\n            );\n        }\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            systemPadding = this.renderOptions.naiveSystemPadding;\n        }\n        const [systemIndex, scaledYRelativeToSystem] = this.systemIndexAndScaledY(y);\n        const clickedDiatonicNoteNum = this.diatonicNoteNumFromScaledY(\n            scaledYRelativeToSystem\n        );\n\n        const foundNote = this.noteElementFromScaledX(\n            x,\n            undefined,\n            systemIndex\n        );\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * Returns the measure that is at X location xPxScaled and system systemIndex.\n     *\n     * @memberof music21.stream.Part\n     * @param {number} [xPxScaled]\n     * @param {number} [systemIndex]\n     * @returns {music21.stream.Stream}\n     *\n     */\n    getStreamFromScaledXandSystemIndex(xPxScaled, systemIndex) {\n        let gotMeasure;\n        const measures = this.measures;\n        for (const m of measures) {\n            const rendOp = m.renderOptions;\n            const left = rendOp.left;\n            const right = left + rendOp.width;\n            const top = rendOp.top;\n            const bottom = top + rendOp.height;\n            if (debug) {\n                console.log(\n                    'Searching for X:'\n                        + Math.round(xPxScaled)\n                        + ' in Measure '\n                        + ' with boundaries L:'\n                        + left\n                        + ' R:'\n                        + right\n                        + ' T: '\n                        + top\n                        + ' B: '\n                        + bottom\n                );\n            }\n            if (xPxScaled >= left && xPxScaled <= right) {\n                if (systemIndex === undefined) {\n                    gotMeasure = m;\n                    break;\n                } else if (rendOp.systemIndex === systemIndex) {\n                    gotMeasure = m;\n                    break;\n                }\n            }\n        }\n        return gotMeasure;\n    }\n}\nstream.Part = Part;\n\n/**\n * Scores with multiple parts\n *\n * @class Score\n * @memberof music21.stream\n * @extends music21.stream.Stream\n */\nexport class Score extends Stream {\n    constructor() {\n        super();\n        this.recursionType = 'elementsOnly';\n        this.measureWidths = [];\n        this.partSpacing = this.renderOptions.naiveHeight;\n    }\n    get systemPadding() {\n        const numParts = this.parts.length;\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            if (numParts === 1) {\n                systemPadding = this.renderOptions.naiveSystemPadding; // fix to 0\n            } else {\n                systemPadding = this.renderOptions.naiveSystemPadding;\n            }\n        }\n        return systemPadding;\n    }\n\n    /**\n     * Returns the measure that is at X location xPxScaled and system systemIndex.\n     *\n     * Always returns the measure of the top part...\n     *\n     * @memberof music21.stream.Score\n     * @param {number} [xPxScaled]\n     * @param {number} [systemIndex]\n     * @returns {music21.stream.Stream} usually a Measure\n     *\n     */\n    getStreamFromScaledXandSystemIndex(xPxScaled, systemIndex) {\n        const parts = this.parts;\n        return parts\n            .get(0)\n            .getStreamFromScaledXandSystemIndex(xPxScaled, systemIndex);\n    }\n    /**\n     * overrides music21.stream.Stream#setSubstreamRenderOptions\n     *\n     * figures out the `.left` and `.top` attributes for all contained parts\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    setSubstreamRenderOptions() {\n        let currentPartNumber = 0;\n        let currentPartTop = 0;\n        const partSpacing = this.partSpacing;\n        for (const el of this) {\n            if (el.isClassOrSubclass('Part')) {\n                el.renderOptions.partIndex = currentPartNumber;\n                el.renderOptions.top = currentPartTop;\n                el.setSubstreamRenderOptions();\n                currentPartTop += partSpacing;\n                currentPartNumber += 1;\n            }\n        }\n        this.evenPartMeasureSpacing();\n        const ignoreNumSystems = true;\n        const currentScoreHeight = this.estimateStreamHeight(ignoreNumSystems);\n        for (const el of this) {\n            if (el.isClassOrSubclass('Part')) {\n                el.fixSystemInformation(currentScoreHeight);\n            }\n        }\n        this.renderOptions.height = this.estimateStreamHeight();\n        return this;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#estimateStaffLength\n     *\n     * @memberof music21.stream.Score\n     * @returns {number}\n     */\n    estimateStaffLength() {\n        // override\n        if (this.renderOptions.overriddenWidth !== undefined) {\n            // console.log(\"Overridden staff width: \" + this.renderOptions.overriddenWidth);\n            return this.renderOptions.overriddenWidth;\n        }\n        for (const p of this) {\n            if (p.isClassOrSubclass('Part')) {\n                return p.estimateStaffLength();\n            }\n        }\n        // no parts found in score... use part...\n        console.log('no parts found in score');\n        const tempPart = new stream.Part();\n        tempPart.elements = this.elements;\n        return tempPart.estimateStaffLength();\n    }\n\n    /* MIDI override */\n    /**\n     * Overrides the default music21.stream.Stream#playStream\n     *\n     * Works crappily -- just starts *n* midi players.\n     *\n     * Render scrollable score works better...\n     *\n     * @memberof music21.stream.Score\n     * @param {object} params -- passed to each part\n     * @returns {music21.stream.Score} this\n     */\n    playStream(params) {\n        // play multiple parts in parallel...\n        for (const el of this) {\n            if (el.isClassOrSubclass('Part')) {\n                el.playStream(params);\n            }\n        }\n        return this;\n    }\n    /**\n     * Overrides the default music21.stream.Stream#stopPlayScore()\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    stopPlayStream() {\n        for (const el of this) {\n            if (el.isClassOrSubclass('Part')) {\n                el.stopPlayStream();\n            }\n        }\n        return this;\n    }\n    /*\n     * Svg routines\n     */\n    /**\n     * call after setSubstreamRenderOptions\n     * gets the maximum measure width for each measure\n     * by getting the maximum for each measure of\n     * Part.getMeasureWidths();\n     *\n     * Does this work? I found a bug in this and fixed it that should have\n     * broken it!\n     *\n     * @memberof music21.stream.Score\n     * @returns Array<number>\n     */\n    getMaxMeasureWidths() {\n        const maxMeasureWidths = [];\n        const measureWidthsArrayOfArrays = [];\n        let i;\n        // TODO: Do not crash on not partlike...\n        for (const el of this) {\n            measureWidthsArrayOfArrays.push(el.getMeasureWidths());\n        }\n        for (i = 0; i < measureWidthsArrayOfArrays[0].length; i++) {\n            let maxFound = 0;\n            for (let j = 0; j < this.length; j++) {\n                if (measureWidthsArrayOfArrays[j][i] > maxFound) {\n                    maxFound = measureWidthsArrayOfArrays[j][i];\n                }\n            }\n            maxMeasureWidths.push(maxFound);\n        }\n        // console.log(measureWidths);\n        return maxMeasureWidths;\n    }\n\n    /**\n     * systemIndexAndScaledY - given a scaled Y, return the systemIndex\n     * and the scaledYRelativeToSystem\n     *\n     * @memberof music21.stream.Score\n     * @param  {number} y the scaled Y\n     * @return Array<int, number>   systemIndex, scaledYRelativeToSystem\n     */\n    systemIndexAndScaledY(y) {\n        let systemPadding = this.renderOptions.systemPadding;\n        if (systemPadding === undefined) {\n            systemPadding = this.renderOptions.naiveSystemPadding;\n        }\n\n        const numParts = this.parts.length;\n        const systemHeight = numParts * this.partSpacing + this.systemPadding;\n        const systemIndex = Math.floor(y / systemHeight);\n        const scaledYRelativeToSystem = y - systemIndex * systemHeight;\n        return [systemIndex, scaledYRelativeToSystem];\n    }\n\n    /**\n     * Returns a list of [clickedDiatonicNoteNum, foundNote] for a\n     * click event, taking into account that the note will be in different\n     * Part objects (and different Systems) given the height and possibly different Systems.\n     *\n     * @memberof music21.stream.Score\n     * @param {DOMObject} svg\n     * @param {Event} e\n     * @returns {Array} [diatonicNoteNum, m21Element]\n     */\n    findNoteForClick(svg, e) {\n        const [x, y] = this.getScaledXYforDOM(svg, e);\n        const [systemIndex, scaledYFromSystemTop] = this.systemIndexAndScaledY(\n            y\n        );\n        const partIndex = Math.floor(scaledYFromSystemTop / this.partSpacing);\n        const scaledYinPart\n            = scaledYFromSystemTop - partIndex * this.partSpacing;\n        // console.log('systemIndex: ' + systemIndex + \" partIndex: \" + partIndex);\n        const rightPart = this.get(partIndex);\n        if (rightPart === undefined) {\n            return [undefined, undefined]; // may be too low?\n        }\n\n        const clickedDiatonicNoteNum = rightPart.diatonicNoteNumFromScaledY(\n            scaledYinPart\n        );\n\n        const foundNote = rightPart.noteElementFromScaledX(\n            x,\n            undefined,\n            systemIndex\n        );\n        return [clickedDiatonicNoteNum, foundNote];\n    }\n\n    /**\n     * How many systems are there? Calls numSystems() on the first part.\n     *\n     * @memberof music21.stream.Score\n     * @returns {Int}\n     */\n    numSystems() {\n        return this.getElementsByClass('Part')\n            .get(0)\n            .numSystems();\n    }\n\n    /**\n     * Fixes the part measure spacing for all parts.\n     *\n     * @memberof music21.stream.Score\n     * @returns {music21.stream.Score} this\n     */\n    evenPartMeasureSpacing() {\n        const measureStacks = [];\n        let currentPartNumber = 0;\n        const maxMeasureWidth = [];\n        let j;\n        for (const el of this) {\n            if (el.isClassOrSubclass('Part')) {\n                const measureWidths = el.getMeasureWidths();\n                for (j = 0; j < measureWidths.length; j++) {\n                    const thisMeasureWidth = measureWidths[j];\n                    if (measureStacks[j] === undefined) {\n                        measureStacks[j] = [];\n                        maxMeasureWidth[j] = thisMeasureWidth;\n                    } else if (thisMeasureWidth > maxMeasureWidth[j]) {\n                        maxMeasureWidth[j] = thisMeasureWidth;\n                    }\n                    measureStacks[j][currentPartNumber] = thisMeasureWidth;\n                }\n                currentPartNumber += 1;\n            }\n        }\n        let currentLeft = 20;\n        for (let i = 0; i < maxMeasureWidth.length; i++) {\n            // TODO: do not assume, only elements in Score are Parts and in Parts are Measures...\n            const measureNewWidth = maxMeasureWidth[i];\n            for (j = 0; j < this.length; j++) {\n                const part = this.get(j);\n                const measure = part.get(i);\n                const rendOp = measure.renderOptions;\n                rendOp.width = measureNewWidth;\n                rendOp.left = currentLeft;\n            }\n            currentLeft += measureNewWidth;\n        }\n        return this;\n    }\n}\nstream.Score = Score;\n\n// small Class; a namedtuple in music21p\nexport class OffsetMap {\n    constructor(element, offset, endTime, voiceIndex) {\n        this.element = element;\n        this.offset = offset;\n        this.endTime = endTime;\n        this.voiceIndex = voiceIndex;\n    }\n}\nstream.OffsetMap = OffsetMap;\n","// future -- rewrite of Score and Part to Page, System, SystemPart\n// not currently used\n// import * as $ from 'jquery';\n//\n// import { base } from './base.js';\n// import { renderOptions } from './renderOptions.js';\nimport { stream } from './stream.js';\n// import { common } from './common.js';\n/**\n * Does not work yet, so not documented\n *\n */\nexport const layout = {};\nlayout.makeLayoutFromScore = function makeLayoutFromScore(\n    score,\n    containerWidth\n) {\n    /*\n     * Divide a part up into systems and fix the measure\n     * widths so that they are all even.\n     *\n     * Note that this is done on the part level even though\n     * the measure widths need to be consistent across parts.\n     *\n     * This is possible because the system is deterministic and\n     * will come to the same result for each part.  Opportunity\n     * for making more efficient through this...\n     */\n    // var systemHeight = score.systemHeight; /* part.show() called... */\n    // var systemPadding = score.systemPadding;\n    const parts = score.parts;\n    // console.log(parts);\n    const numParts = parts.length;\n    const partZero = parts[0];\n    const numMeasures = partZero.length;\n\n    const measureWidths = partZero.getMeasureWidths();\n    const maxSystemWidth\n        = containerWidth || score.maxSystemWidth; /* of course fix! */\n\n    const layoutScore = new layout.LayoutScore();\n    const currentPage = new layout.Page(); // to-do multiple pages...\n    currentPage.measureStart = 1;\n    currentPage.measureEnd = numMeasures;\n\n    layoutScore.insert(0, currentPage);\n\n    let currentSystem = new layout.System();\n    let currentSystemNumber = 1;\n    currentSystem.measureStart = 1;\n    let currentStaves = [];\n\n    const staffMaker = (staffHolder, numParts, measureStart) => {\n        for (let pNum = 0; pNum < numParts; pNum++) {\n            const staff = new layout.Staff();\n            staff.measureStart = measureStart;\n            staff.staffNumber = pNum + 1;\n            staffHolder.push(staff);\n        }\n    };\n    staffMaker(currentStaves, numParts, 1);\n\n    const systemCurrentWidths = [];\n    const systemBreakIndexes = [];\n    let lastSystemBreak = 0; /* needed to ensure each line has at least one measure */\n    const startLeft = 20; /* TODO: make it obtained elsewhere */\n    let currentLeft = startLeft;\n    // let currentSystemTop = 0;\n    // var partTopOffsets = [];\n    // const ignoreSystemsInCalculatingScoreHeight = true;\n    // const systemHeight = score.estimateStreamHeight(ignoreSystemsInCalculatingScoreHeight);\n\n    for (let i = 0; i < measureWidths.length; i++) {\n        const currentRight = currentLeft + measureWidths[i];\n        /* console.log(\"left: \" + currentLeft + \" ; right: \" + currentRight + \" ; m: \" + i); */\n        if (currentRight > maxSystemWidth && lastSystemBreak !== i) {\n            // new system...\n            for (let j = 0; j < currentStaves.length; j++) {\n                currentStaves.measureEnd = i;\n                currentSystem.insert(0, currentStaves[j]);\n            }\n            currentStaves = [];\n            staffMaker(currentStaves, numParts, i + 1);\n            // currentSystemTop += systemHeight;\n            currentSystem.measureEnd = i;\n            currentPage.insert(0, currentSystem);\n            currentSystemNumber += 1;\n            currentSystem = new layout.System();\n            currentSystem.measureStart = i + 1;\n            currentSystem.systemNumber = currentSystemNumber;\n\n            systemBreakIndexes.push(i - 1);\n            systemCurrentWidths.push(currentLeft);\n            console.log(\n                'setting new width at ' + currentLeft + ' measure ' + i\n            );\n            currentLeft = startLeft + measureWidths[i];\n            lastSystemBreak = i;\n        } else {\n            currentLeft = currentRight;\n        }\n        for (let pNum = 0; pNum < currentStaves.length; pNum++) {\n            currentStaves[pNum].append(parts[pNum].get(i));\n        }\n    }\n    for (let j = 0; j < currentStaves.length; j++) {\n        currentStaves.measureEnd = measureWidths.length - 1;\n        currentSystem.insert(0, currentStaves[j]);\n    }\n    currentPage.insert(0, currentSystem);\n    return layoutScore;\n};\n\nexport class LayoutScore extends stream.Score {\n    constructor() {\n        super();\n        this.scoreLayout = undefined;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.top = 0;\n        this.left = 0;\n    }\n    get pages() {\n        return this.getElementsByClass('Page');\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n    /**\n     * return a tuple of (top, bottom) for a staff, specified by a given pageId,\n     * systemId, and staffId in PIXELS.\n\n     * @param pageId\n     * @param systemId\n     * @param staffId\n     * @param units -- \"pixels\" or \"tenths\" (not supported)\n     */\n\n    getPositionForStaff(pageId, systemId, staffId, units) {\n        units = units || 'pixels';\n    }\n}\nlayout.LayoutScore = LayoutScore;\n\n/**\n * All music must currently be on page 1.\n */\nexport class Page extends stream.Score {\n    constructor() {\n        super();\n        this.pageNumber = 1;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this.systemStart = undefined;\n        this.systemEnd = undefined;\n        this.pageLayout = undefined;\n    }\n    get systems() {\n        return this.getElementsByClass('System');\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\nlayout.Page = Page;\n\nexport class System extends stream.Score {\n    constructor() {\n        super();\n        this.systemNumber = 1;\n        this.systemLayout = undefined;\n        this.measureStart = undefined;\n        this.measureEnd = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.top = undefined;\n        this.left = undefined;\n    }\n    get staves() {\n        return this.getElementsByClass('Staff');\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\nlayout.System = System;\n\nexport class Staff extends stream.Part {\n    constructor() {\n        super();\n        this.staffNumber = 1;\n        this.optimized = 0;\n        this.top = undefined;\n        this.left = undefined;\n        this._width = undefined;\n        this.height = undefined;\n        this.inheritedHeight = undefined;\n        this.staffLayout = undefined;\n    }\n    get width() {\n        if (this._width) {\n            return this._width;\n        } else if (this.activeSite) {\n            return this.activeSite.width;\n        } else {\n            return undefined;\n        }\n    }\n}\n\nlayout.Staff = Staff;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/tie -- ties!\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\n\nimport { prebase } from './prebase.js';\nimport { Music21Exception } from './exceptions21.js';\n\n/**\n * Simple tie module {@link music21.tie} namespace\n *\n * @exports music21/tie\n */\n\n/**\n * Tie namespace, just has the {@link music21.tie.Tie} object\n *\n * @namespace music21.tie\n * @memberof music21\n * @requires music21/prebase\n */\nexport const tie = {};\nconst VALID_TIE_TYPES = ['start', 'stop', 'continue', 'let-ring', undefined];\n\n/**\n * Tie class. Found in {@link music21.note.GeneralNote} `.tie`.\n *\n * Does not support advanced music21p values `.to` and `.from`\n *\n * @class Tie\n * @memberof music21.tie\n * @extends music21.prebase.ProtoM21Object\n * @param {string} type - 'start', 'stop', 'continue', or 'let-ring'\n * @property {string} type - the tie type\n * @property {string} style - only supports 'normal' for now.\n * @property {string|undefined} placement - undefined = unknown or above/below. (NB curently does nothing)\n */\nexport class Tie extends prebase.ProtoM21Object {\n    constructor(type) {\n        super();\n        this._type = undefined;\n        this.style = 'normal';\n        this.type = type;\n        this.placement = undefined;\n    }\n    get type() {\n        return this._type;\n    }\n    set type(newType) {\n        if (!VALID_TIE_TYPES.includes(newType)) {\n            throw new Music21Exception(\n                'Tie type must be one of \"start\", \"stop\", \"continue\", \"let-ring\"'\n            );\n        }\n        this._type = newType;\n    }\n}\ntie.Tie = Tie;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/roman -- roman.RomanNumberal -- Chord subclass\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport { Music21Exception } from './exceptions21.js';\n\nimport { chord } from './chord.js';\nimport { common } from './common.js';\n// import { debug } from './debug.js';\nimport { figuredBass } from './figuredBass.js';\nimport { harmony } from './harmony.js';\nimport { interval } from './interval.js';\nimport { key } from './key.js';\nimport { pitch } from './pitch.js';\nimport { scale } from './scale.js';\n/**\n * Roman numeral module. See {@link music21.roman} namespace\n *\n * @exports music21/roman\n */\n/**\n * music21.roman -- namespace for dealing with RomanNumeral analysis.\n *\n * @namespace music21.roman\n * @memberof music21\n * @requires music21/chord\n * @requires music21/common\n * @requires music21/figuredBass\n * @requires music21/harmony\n * @requires music21/key\n * @requires music21/pitch\n * @requires music21/interval\n */\nexport const roman = {};\n\nroman.figureShorthands = {\n    '53': '',\n    '3': '',\n    '63': '6',\n    '753': '7',\n    '75': '7', // controversial perhaps\n    '73': '7', // controversial perhaps\n    '9753': '9',\n    '975': '9', // controversial perhaps\n    '953': '9', // controversial perhaps\n    '97': '9', // controversial perhaps\n    '95': '9', // controversial perhaps\n    '93': '9', // controversial perhaps\n    '653': '65',\n    '6b53': '6b5',\n    '643': '43',\n    '642': '42',\n    bb7b5b3: 'o7',\n    bb7b53: 'o7',\n    // '6b5bb3': 'o65',\n    b7b5b3: '/o7',\n};\n\nroman.functionalityScores = {\n    I: 100,\n    i: 90,\n    V7: 80,\n    V: 70,\n    V65: 68,\n    I6: 65,\n    V6: 63,\n    V43: 61,\n    I64: 60,\n    IV: 59,\n    i6: 58,\n    viio7: 57,\n    V42: 55,\n    viio65: 53,\n    viio6: 52,\n    '#viio65': 51,\n    ii: 50,\n    '#viio6': 49,\n    ii65: 48,\n    ii43: 47,\n    ii42: 46,\n    IV6: 45,\n    ii6: 43,\n    VI: 42,\n    '#VI': 41,\n    vi: 40,\n    viio: 39,\n    '#viio': 39,\n    iio: 37, // common in Minor\n    iio42: 36,\n    bII6: 35, // Neapolitan\n    iio43: 32,\n    iio65: 31,\n    '#vio': 28,\n    '#vio6': 28,\n    III: 22,\n    v: 20,\n    VII: 19,\n    VII7: 18,\n    IV65: 17,\n    IV7: 16,\n    iii: 15,\n    iii6: 12,\n    vi6: 10,\n};\n\n/**\n * expandShortHand - expand a string of numbers into an array\n *\n * N.B. this is NOT where abbreviations get expanded\n *\n * @memberof music21.roman\n * @param  {string} shorthand string of a figure w/o roman to parse\n * @return {Array<string>}           array of shorthands\n */\n\nroman.expandShortHand = function expandShortHand(shorthand) {\n    shorthand = shorthand.replace('/', '');\n    if (shorthand.match(/[b-]$/)) {\n        shorthand += '3';\n    }\n    shorthand = shorthand.replace('11', 'x');\n    shorthand = shorthand.replace('13', 'y');\n    shorthand = shorthand.replace('15', 'z');\n    const rx = new RegExp('#*-*b*o*[1-9xyz]', 'g');\n    let shorthandGroups = [];\n    let match = rx.exec(shorthand);\n    while (match !== null) {\n        shorthandGroups.push(match[0]);\n        match = rx.exec(shorthand);\n    }\n    if (shorthandGroups.length === 1 && shorthandGroups[0].endsWith('3')) {\n        shorthandGroups = ['5', shorthandGroups[0]];\n    }\n    const shGroupOut = [];\n    for (let sh of shorthandGroups) {\n        sh = sh.replace('x', '11');\n        sh = sh.replace('y', '13');\n        sh = sh.replace('z', '15');\n        shGroupOut.push(sh);\n    }\n    return shGroupOut;\n};\n\n/**\n * correctSuffixForChordQuality - Correct a given inversionString suffix given a\n *     chord of various qualities.\n *\n * @memberof music21.roman\n * @param  {music21.chord.Chord} chordObj\n * @param  {string} inversionString a string like '6' to fix.\n * @return {string}           corrected inversionString\n  */\n\nroman.correctSuffixForChordQuality = function correctSuffixForChordQuality(\n    chordObj,\n    inversionString\n) {\n    const fifthType = chordObj.semitonesFromChordStep(5);\n    let qualityName = '';\n    if (fifthType === 6) {\n        qualityName = 'o';\n    } else if (fifthType === 8) {\n        qualityName = '+';\n    }\n\n    if (\n        inversionString !== undefined\n        && (inversionString.startsWith('o') || inversionString.startsWith('/o'))\n    ) {\n        if (qualityName === 'o') {\n            // don't call viio7, viioo7.\n            qualityName = '';\n        }\n    }\n\n    const seventhType = chordObj.semitonesFromChordStep(7);\n    if (seventhType !== undefined && fifthType === 6) {\n        // there is a seventh and this is a diminished 5\n        if (seventhType === 10 && qualityName === 'o') {\n            qualityName = '/o';\n        } else if (seventhType !== 9) {\n            // do something for very odd chords built on diminished triad.\n        }\n    }\n    return qualityName + inversionString;\n};\n\n/**\n * maps an index number to a roman numeral in lowercase\n *\n * @memberof music21.roman\n * @example\n * music21.roman.romanToNumber[4]\n * // 'iv'\n */\nroman.romanToNumber = [undefined, 'i', 'ii', 'iii', 'iv', 'v', 'vi', 'vii'];\n\n/**\n * Represents a RomanNumeral.  By default, capital Roman Numerals are\n * major chords; lowercase are minor.\n *\n * @class RomanNumeral\n * @memberof music21.roman\n * @extends music21.chord.Chord\n * @param {string} figure - the roman numeral as a string, e.g., 'IV', 'viio', 'V7'\n * @param {string|music21.key.Key} [keyStr='C']\n * @property {Array<music21.pitch.Pitch>} scale - (readonly) returns the scale associated with the roman numeral\n * @property {music21.key.Key} key - the key associated with the RomanNumeral (not allowed to be undefined yet)\n * @property {string} figure - the figure as passed in\n * @property {string} degreeName - the name associated with the scale degree, such as \"mediant\" etc., scale 7 will be \"leading tone\" or \"subtonic\" appropriately\n * @property {Int} scaleDegree\n * @property {string} impliedQuality - \"major\", \"minor\", \"diminished\", \"augmented\"\n * @property {Array<music21.pitch.Pitch>} pitches - RomanNumerals are Chord objects, so .pitches will work for them also.\n */\nexport class RomanNumeral extends harmony.Harmony {\n    constructor(figure = '', keyStr, keywords) {\n        const params = { updatePitches: false, parseFigure: false };\n        common.merge(params, keywords);\n        super(figure, params);\n        this._parsingComplete = false;\n\n        // not yet used...\n        this.primaryFigure = undefined;\n        this.secondaryRomanNumeral = undefined;\n        this.secondaryRomanNumeralKey = undefined;\n\n        this.pivotChord = undefined;\n        this.scaleCardinality = 7;\n        this._figure = undefined;\n\n        this.caseMatters = true;\n        if (typeof figure === 'number') {\n            this.caseMatters = false;\n        }\n\n        this.scaleDegree = undefined;\n        this.frontAlterationString = undefined;\n        this.frontAlterationTransposeInterval = undefined;\n        this.frontAlterationAccidental = undefined;\n        this.romanNumeralAlone = undefined;\n\n        this.impliedQuality = undefined;\n        this.impliedScale = undefined;\n        this.scaleOffset = undefined;\n        this.useImpliedScale = false;\n        this.bracketedAlterations = [];\n        this.omittedSteps = [];\n        this.followsKeyChange = false;\n        this._functionalityScore = undefined;\n\n        this._scale = undefined; // the key\n\n        this.figure = figure;\n        this.key = keyStr;\n\n        // to remove...\n        this.numbers = '';\n\n        if (figure !== '') {\n            this._parseFigure();\n            this._parsingComplete = true;\n            this._updatePitches();\n        }\n    }\n\n    _parseFigure() {\n        let workingFigure = this.figure;\n\n        let useScale = this.impliedScale;\n        if (!this.useImpliedScale) {\n            useScale = this.key;\n        }\n        [workingFigure, useScale] = this._correctForSecondaryRomanNumeral(\n            useScale\n        );\n        this.primaryFigure = workingFigure;\n\n        workingFigure = this._parseOmittedSteps(workingFigure);\n        workingFigure = this._parseBracketedAlterations(workingFigure);\n        workingFigure = workingFigure.replace(/^N6/, 'bII6');\n        workingFigure = workingFigure.replace(/^N/, 'bII6');\n        workingFigure = this._parseFrontAlterations(workingFigure);\n        [workingFigure, useScale] = this._parseRNAloneAmidstAug6(\n            workingFigure,\n            useScale\n        );\n        workingFigure = this._setImpliedQualityFromString(workingFigure);\n\n        this._tempRoot = useScale.pitchFromDegree(this.scaleDegree);\n        this._fixMinorVIandVII(useScale);\n        const expandedFigure = roman.expandShortHand(workingFigure);\n        this.figuresNotationObj = new figuredBass.Notation(\n            expandedFigure.toString()\n        );\n\n        const numbersArr = workingFigure.match(/\\d+/);\n        if (numbersArr != null) {\n            workingFigure = workingFigure.replace(/\\d+/, '');\n            this.numbers = parseInt(numbersArr[0]);\n        }\n    }\n\n    _parseFrontAlterations(workingFigure) {\n        let frontAlterationString = '';\n        let frontAlterationTransposeInterval;\n        let frontAlterationAccidental;\n        const _alterationRegex = new RegExp('^(b+|-+|#+)');\n        const match = _alterationRegex.exec(workingFigure);\n        if (match != null) {\n            const group = match[1];\n            let alteration = group.length;\n            if (group[0] === 'b' || group[0] === '-') {\n                alteration *= -1;\n            }\n            frontAlterationTransposeInterval = interval.intervalFromGenericAndChromatic(\n                1,\n                alteration\n            );\n            frontAlterationAccidental = new pitch.Accidental(alteration);\n            frontAlterationString = group;\n            workingFigure = workingFigure.replace(_alterationRegex, '');\n        }\n        this.frontAlterationString = frontAlterationString;\n        this.frontAlterationTransposeInterval = frontAlterationTransposeInterval;\n        this.frontAlterationAccidental = frontAlterationAccidental;\n        return workingFigure;\n    }\n\n    _correctBracketedPitches() {\n        for (const innerAlteration of this.bracketedAlterations) {\n            const [alterNotation, chordStep] = innerAlteration;\n            const alterPitch = this.getChordStep(chordStep);\n            if (alterPitch === undefined) {\n                continue;\n            }\n            const newAccidental = new pitch.Accidental(alterNotation);\n            if (alterPitch.accidental === undefined) {\n                alterPitch.accidental = newAccidental;\n            } else {\n                alterPitch.accidental.set(\n                    alterPitch.accidental.alter + newAccidental.alter\n                );\n            }\n        }\n    }\n\n    _setImpliedQualityFromString(workingFigure) {\n        let impliedQuality = '';\n        if (workingFigure.startsWith('o')) {\n            impliedQuality = 'diminished';\n            workingFigure = workingFigure.replace(/^o/, '');\n        } else if (workingFigure.startsWith('/o')) {\n            impliedQuality = 'half-diminished';\n            workingFigure = workingFigure.replace(/^\\/o/, '');\n        } else if (workingFigure.startsWith('+')) {\n            impliedQuality = 'augmented';\n            workingFigure = workingFigure.replace(/^\\+/, '');\n        } else if (workingFigure.endsWith('d7')) {\n            impliedQuality = 'dominant-seventh';\n            workingFigure = workingFigure.replace(/d7$/, '7');\n        } else if (\n            this.caseMatters\n            && this.romanNumeralAlone.toUpperCase() === this.romanNumeralAlone\n        ) {\n            impliedQuality = 'major';\n        } else if (\n            this.caseMatters\n            && this.romanNumeralAlone.toLowerCase() === this.romanNumeralAlone\n        ) {\n            impliedQuality = 'minor';\n        }\n        this.impliedQuality = impliedQuality;\n        return workingFigure;\n    }\n\n    _fixMinorVIandVII(useScale) {\n        if (useScale.mode !== 'minor') {\n            return;\n        }\n        if (!this.caseMatters) {\n            return;\n        }\n        if (this.scaleDegree !== 6 && this.scaleDegree !== 7) {\n            return;\n        }\n        if (\n            !['minor', 'diminished', 'half-diminished'].includes(\n                this.impliedQuality\n            )\n        ) {\n            return;\n        }\n\n        const fati = this.frontAlterationTransposeInterval;\n        if (fati !== undefined) {\n            const newFati = interval.add([fati, new interval.Interval('A1')]);\n            this.frontAlterationTransposeInterval = newFati;\n            this.frontAlterationAccidental.alter\n                = this.frontAlterationAccidental.alter + 1;\n        } else {\n            this.frontAlterationTransposeInterval = new interval.Interval('A1');\n            this.frontAlterationAccidental = new pitch.Accidental(1);\n        }\n\n        this._tempRoot = this.frontAlterationTransposeInterval.transposePitch(\n            this._tempRoot\n        );\n\n        return;\n    }\n\n    _parseRNAloneAmidstAug6(workingFigure, useScale) {\n        let romanNumeralAlone = '';\n        const _romanNumeralAloneRegex = new RegExp(\n            '(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2}|N)'\n        );\n        const _augmentedSixthRegex = new RegExp('(It|Ger|Fr|Sw)');\n        const rm = _romanNumeralAloneRegex.exec(workingFigure);\n        const a6match = _augmentedSixthRegex.exec(workingFigure);\n        if (rm === null && a6match === null) {\n            throw new Music21Exception(\n                `No roman numeral found in ${workingFigure}`\n            );\n        }\n        if (a6match !== null) {\n            if (useScale.mode === 'major') {\n                useScale = new key.Key(useScale.tonic.name, 'minor');\n                this.impliedScale = useScale;\n                this.useImpliedScale = true;\n            }\n            romanNumeralAlone = a6match[1];\n            if (['It', 'Ger'].includes(romanNumeralAlone)) {\n                this.scaleDegree = 4;\n            } else {\n                this.scaleDegree = 2;\n            }\n            workingFigure = workingFigure.replace(_augmentedSixthRegex, '');\n            this.romanNumeralAlone = romanNumeralAlone;\n            if (romanNumeralAlone !== 'Fr') {\n                this.bracketedAlterations.push(['#', 1]);\n            }\n            if (romanNumeralAlone === 'Fr' || romanNumeralAlone === 'Sw') {\n                this.bracketedAlterations.push(['#', 3]);\n            }\n        } else {\n            romanNumeralAlone = rm[1];\n            this.scaleDegree = common.fromRoman(romanNumeralAlone);\n            workingFigure = workingFigure.replace(_romanNumeralAloneRegex, '');\n            this.romanNumeralAlone = romanNumeralAlone;\n        }\n        return [workingFigure, useScale];\n    }\n\n    /**\n     * get romanNumeral - return either romanNumeralAlone (II) or with frontAlterationAccidental (#II)\n     *\n     * @return {string}  new romanNumeral;\n     */\n\n    get romanNumeral() {\n        if (this.frontAlterationAccidental === undefined) {\n            return this.romanNumeralAlone;\n        } else {\n            return (\n                this.frontAlterationAccidental.modifier + this.romanNumeralAlone\n            );\n        }\n    }\n\n    get scale() {\n        if (this._scale !== undefined) {\n            return this._scale;\n        } else {\n            this._scale = this.key.getScale();\n            return this._scale;\n        }\n    }\n    get key() {\n        return this._scale;\n    }\n    set key(keyOrScale) {\n        if (typeof keyOrScale === 'string') {\n            this._scale = new key.Key(keyOrScale);\n        } else if (typeof keyOrScale === 'undefined') {\n            this._scale = new key.Key('C');\n        } else {\n            this._scale = keyOrScale;\n        }\n        if (keyOrScale === undefined) {\n            this.useImpliedScale = true;\n            this.impliedScale = new scale.MajorScale('C');\n        } else {\n            this.useImpliedScale = false;\n            this.impliedScale = false;\n        }\n        if (this._parsingComplete) {\n            this._updatePitches();\n        }\n    }\n\n    get figure() {\n        return this._figure;\n    }\n    set figure(newFigure) {\n        this._figure = newFigure;\n        if (this._parsingComplete) {\n            this._parseFigure();\n            this._updatePitches();\n        }\n    }\n\n    get figureAndKey() {\n        let tonicName = this.key.tonic.name;\n        let mode = '';\n        if (this.key.mode !== undefined) {\n            mode = ' ' + this.key.mode;\n        }\n\n        if (mode === ' minor') {\n            tonicName = tonicName.toLowerCase();\n        } else if (mode === ' major') {\n            tonicName = tonicName.toUpperCase();\n        }\n        return this.figure + ' in ' + tonicName + mode;\n    }\n\n    get degreeName() {\n        if (this.scaleDegree < 7) {\n            return [\n                undefined,\n                'Tonic',\n                'Supertonic',\n                'Mediant',\n                'Subdominant',\n                'Dominant',\n                'Submediant',\n            ][this.scaleDegree];\n        } else {\n            const tonicPitch = this.key.tonic;\n            let diffRootToTonic = (tonicPitch.ps - this.root().ps) % 12;\n            if (diffRootToTonic < 0) {\n                diffRootToTonic += 12;\n            }\n            if (diffRootToTonic === 1) {\n                return 'Leading-tone';\n            } else {\n                return 'Subtonic';\n            }\n        }\n    }\n\n    /**\n     * Update the .pitches array.  Called at instantiation, but not automatically afterwards.\n     *\n     * @memberof music21.roman.RomanNumeral\n     */\n    _updatePitches() {\n        let useScale;\n        if (this.secondaryRomanNumeralKey !== undefined) {\n            useScale = this.secondaryRomanNumeralKey;\n        } else if (!this.useImpliedScale) {\n            useScale = this.key;\n        } else {\n            useScale = this.impliedScale;\n        }\n\n        this.scaleCardinality = 7; // simple speedup;\n        const bassScaleDegree = this.bassScaleDegreeFromNotation(\n            this.figuresNotationObj\n        );\n        const bassPitch = useScale.pitchFromDegree(\n            bassScaleDegree,\n            'ascending'\n        );\n        const pitches = [bassPitch];\n        let lastPitch = bassPitch;\n        const numberNotes = this.figuresNotationObj.numbers.length;\n\n        for (let j = 0; j < numberNotes; j++) {\n            const i = numberNotes - j - 1;\n            const thisScaleDegree\n                = bassScaleDegree + this.figuresNotationObj.numbers[i] - 1;\n            const newPitch = useScale.pitchFromDegree(\n                thisScaleDegree,\n                'ascending'\n            );\n            const pitchName = this.figuresNotationObj.modifiers[\n                i\n            ].modifyPitchName(newPitch.name);\n            const newNewPitch = new pitch.Pitch(pitchName);\n            newNewPitch.octave = newPitch.octave;\n            if (newNewPitch.ps < lastPitch.ps) {\n                newNewPitch.octave += 1;\n            }\n            pitches.push(newNewPitch);\n            lastPitch = newNewPitch;\n        }\n        if (this.frontAlterationTransposeInterval !== undefined) {\n            const newPitches = [];\n            for (const thisPitch of pitches) {\n                const newPitch = this.frontAlterationTransposeInterval.transposePitch(\n                    thisPitch\n                );\n                newPitches.push(newPitch);\n            }\n            this.pitches = newPitches;\n        } else {\n            this.pitches = pitches;\n        }\n\n        this._matchAccidentalsToQuality(this.impliedQuality);\n\n        this.scaleOffset = this.frontAlterationTransposeInterval;\n\n        if (this.omittedSteps.length) {\n            const omittedPitches = [];\n            for (const thisCS of this.omittedSteps) {\n                const p = this.getChordStep(thisCS);\n                if (p !== undefined) {\n                    omittedPitches.push(p.name);\n                }\n            }\n            const newPitches = [];\n            for (const thisPitch of pitches) {\n                if (!omittedPitches.includes(thisPitch.name)) {\n                    newPitches.push(thisPitch);\n                }\n            }\n            this.pitches = newPitches;\n            // do something...\n        }\n        this._correctBracketedPitches();\n    }\n\n    bassScaleDegreeFromNotation(notationObject) {\n        const c = new pitch.Pitch('C3');\n        const cDNN = c.diatonicNoteNum; // always 22\n        const pitches = [c];\n        for (const i of notationObject.numbers) {\n            const distanceToMove = i - 1;\n            const newDiatonicNumber = cDNN + distanceToMove;\n            const [newStep, newOctave] = interval.convertDiatonicNumberToStep(\n                newDiatonicNumber\n            );\n            const newPitch = new pitch.Pitch('C3');\n            newPitch.step = newStep;\n            newPitch.octave = newOctave;\n            pitches.push(newPitch);\n        }\n        const tempChord = new chord.Chord(pitches);\n        const rootDNN = tempChord.root().diatonicNoteNum;\n        const staffDistanceFromBassToRoot = rootDNN - cDNN;\n        let bassSD = common.posMod(\n            this.scaleDegree - staffDistanceFromBassToRoot,\n            7\n        );\n        if (bassSD === 0) {\n            bassSD = 7;\n        }\n        return bassSD;\n    }\n\n    _matchAccidentalsToQuality(impliedQuality) {\n        const correctSemitones = this._findSemitoneSizeForQuality(\n            impliedQuality\n        );\n        const chordStepsToExamine = [3, 5, 7];\n        for (let i = 0; i < chordStepsToExamine.length; i++) {\n            const thisChordStep = chordStepsToExamine[i];\n            const thisCorrect = correctSemitones[i];\n            const thisSemis = this.semitonesFromChordStep(thisChordStep);\n            if (thisCorrect === undefined) {\n                continue;\n            }\n            if (thisSemis === undefined) {\n                continue;\n            }\n            if (thisSemis === thisCorrect) {\n                continue;\n            }\n\n            let correctedSemis = thisCorrect - thisSemis;\n            if (correctedSemis >= 6) {\n                correctedSemis = -1 * (12 - correctedSemis);\n            } else if (correctedSemis <= -6) {\n                correctedSemis += 12;\n            }\n\n            const faultyPitch = this.getChordStep(thisChordStep);\n            // TODO: check for faultyPitch is undefined\n\n            if (faultyPitch.accidental === undefined) {\n                faultyPitch.accidental = new pitch.Accidental(correctedSemis);\n            } else {\n                const acc = faultyPitch.accidental;\n                correctedSemis += acc.alter;\n                if (correctedSemis >= 6) {\n                    correctedSemis = -1 * (12 - correctedSemis);\n                } else if (correctedSemis <= -6) {\n                    correctedSemis += 12;\n                }\n                acc.set(correctedSemis);\n            }\n        }\n    }\n\n    _correctForSecondaryRomanNumeral(useScale, figure) {\n        if (figure === undefined) {\n            figure = this._figure;\n        }\n        let workingFigure = figure;\n        const rx = new RegExp('(.*?)/([#a-np-zA-NP-Z].*)');\n        const match = rx.exec(figure);\n        if (match !== null) {\n            const primaryFigure = match[1];\n            const secondaryFigure = match[2];\n            const secondaryRomanNumeral = new RomanNumeral(\n                secondaryFigure,\n                useScale,\n                this.caseMatters\n            );\n            this.secondaryRomanNumeral = secondaryRomanNumeral;\n            let secondaryMode;\n            if (secondaryRomanNumeral.quality === 'minor') {\n                secondaryMode = 'minor';\n            } else if (secondaryRomanNumeral.quality === 'major') {\n                secondaryMode = 'minor';\n            } else if (secondaryRomanNumeral.semitonesFromChordStep(3) === 3) {\n                secondaryMode = 'minor';\n            } else {\n                secondaryMode = 'major';\n            }\n            this.secondaryRomanNumeralKey = new key.Key(\n                secondaryRomanNumeral.root().name,\n                secondaryMode\n            );\n            useScale = this.secondaryRomanNumeralKey;\n            workingFigure = primaryFigure;\n        }\n        return [workingFigure, useScale];\n    }\n\n    _parseOmittedSteps(workingFigure) {\n        const omittedSteps = [];\n        const rx = new RegExp(/\\[no(\\d+)\\]s*/);\n        let match = rx.exec(workingFigure);\n        while (match !== null) {\n            let thisStep = match[1];\n            thisStep = parseInt(thisStep);\n            thisStep = thisStep % 7 || 7;\n            omittedSteps.push(thisStep);\n            workingFigure = workingFigure.replace(rx, '');\n            match = rx.exec(workingFigure);\n        }\n        this.omittedSteps = omittedSteps;\n        return workingFigure;\n    }\n\n    _parseBracketedAlterations(workingFigure) {\n        const bracketedAlterations = this.bracketedAlterations;\n        const rx = new RegExp(/\\[(b+|-+|#+)(\\d+)\\]/);\n        let match = rx.exec(workingFigure);\n        while (match !== null) {\n            const matchAlteration = match[1];\n            const matchDegree = parseInt(match[2]);\n            bracketedAlterations.push([matchAlteration, matchDegree]);\n            workingFigure = workingFigure.replace(rx, '');\n            match = rx.exec(workingFigure);\n        }\n        return workingFigure;\n    }\n\n    _findSemitoneSizeForQuality(impliedQuality) {\n        let correctSemitones;\n        if (impliedQuality === 'major') {\n            correctSemitones = [4, 7];\n        } else if (impliedQuality === 'minor') {\n            correctSemitones = [3, 7];\n        } else if (impliedQuality === 'diminished') {\n            correctSemitones = [3, 6, 9];\n        } else if (impliedQuality === 'half-diminished') {\n            correctSemitones = [3, 6, 10];\n        } else if (impliedQuality === 'augmented') {\n            correctSemitones = [4, 8];\n        } else if (impliedQuality === 'dominant-seventh') {\n            correctSemitones = [4, 7, 10];\n        } else {\n            correctSemitones = [];\n        }\n\n        return correctSemitones;\n    }\n\n    /**\n     * Gives a string display.  Note that since inversion is not yet supported\n     * it needs to be given separately.\n     *\n     * Inverting 7th chords does not work.\n     *\n     * @memberof music21.roman.RomanNumeral\n     * @param {string} displayType - ['roman', 'bassName', 'nameOnly', other]\n     * @param {Int} [inversion=0]\n     * @returns {String}\n     */\n    asString(displayType, inversion) {\n        const keyObj = this.key;\n        const tonicName = keyObj.tonic.name;\n        const mode = keyObj.mode;\n\n        // specifying inversion is for backwards compatibility only.\n        if (inversion === undefined) {\n            inversion = 0;\n        }\n        let inversionName = '';\n        if (inversion === 1) {\n            if (displayType === 'roman') {\n                inversionName = '6';\n            } else {\n                inversionName = ' (first inversion)';\n            }\n        } else if (inversion === 2) {\n            if (displayType === 'roman') {\n                inversionName = '64';\n            } else {\n                inversionName = ' (second inversion)';\n            }\n        }\n        let fullChordName;\n        let connector = ' in ';\n        let suffix = '';\n        if (displayType === 'roman') {\n            fullChordName = this.figure;\n            fullChordName = fullChordName.replace('/o', '√∏');\n        } else if (displayType === 'nameOnly') {\n            // use only with only choice being tonicName\n            fullChordName = '';\n            connector = '';\n            suffix = ' triad';\n        } else if (displayType === 'bassName') {\n            fullChordName = this.bass().name.replace(/-/, 'b');\n        } else {\n            // \"default\" submediant, etc...\n            fullChordName = this.degreeName;\n            if (this.numbers !== undefined) {\n                fullChordName += ' ' + this.numbers.toString();\n            }\n        }\n        let tonicDisplay = tonicName.replace(/-/, 'b');\n        if (mode === 'minor') {\n            tonicDisplay = tonicDisplay.toLowerCase();\n        }\n        const chordStr\n            = fullChordName\n            + inversionName\n            + connector\n            + tonicDisplay\n            + ' '\n            + mode\n            + suffix;\n        return chordStr;\n    }\n}\nroman.RomanNumeral = RomanNumeral;\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/tempo -- tempo and (not in music21p) metronome objects\n *\n * Copyright (c) 2013-18, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as MIDI from 'MIDI';\nimport * as $ from 'jquery';\n\nimport { prebase } from './prebase.js';\n\n/* a Music21Object in m21p; the overhead is too high here to follow ... */\n/**\n * tempo module, see {@link music21.tempo}\n *\n * @exports music21/tempo\n */\n/**\n * tempo namespace\n *\n * @namespace music21.tempo\n * @memberof music21\n * @requires music21/prebase\n * @requires music21/base\n * @requires MIDI\n * @property {number} [baseTempo=60] - basic tempo\n */\nexport const tempo = {};\n\n/**\n * Object mapping names to tempo values\n *\n * @name music21.tempo.defaultTempoValues\n * @memberof music21.tempo\n * @example\n * music21.tempo.defaultTempoValues.grave\n * // 40\n */\ntempo.defaultTempoValues = {\n    larghissimo: 16,\n    largamente: 32,\n    grave: 40,\n    'molto adagio': 40,\n    largo: 46,\n    lento: 52,\n    adagio: 56,\n    slow: 56,\n    langsam: 56,\n    larghetto: 60,\n    adagietto: 66,\n    andante: 72,\n    andantino: 80,\n    'andante moderato': 83,\n    maestoso: 88,\n    moderato: 92,\n    moderate: 92,\n    allegretto: 108,\n    animato: 120,\n    'allegro moderato': 128,\n    allegro: 132,\n    fast: 132,\n    schnell: 132,\n    allegrissimo: 140,\n    'molto allegro': 144,\n    'tr√®s vite': 144,\n    vivace: 160,\n    vivacissimo: 168,\n    presto: 184,\n    prestissimo: 208,\n};\n\ntempo.baseTempo = 60;\n\n/* --------- metronome ---------- */\n/**\n *\n * @class Metronome\n * @memberof music21.tempo\n * @extends music21.prebase.ProtoM21Object\n * @param {number} [tempo=music21.tempo.baseTempo] - the tempo of the metronome to start\n * @property {number} tempo\n * @property {Int} [numBeatsPerMeasure=4]\n * @property {number} [minTempo=10]\n * @property {number} [maxTempo=600]\n * @property {bool} [flash=false] - flash the tempo\n * @property {bool} [silent=false] - play silently\n * @property {Int} beat - current beat number\n * @property {Int} chirpTimeout - an index of a timeout object for chirping\n */\nexport class Metronome extends prebase.ProtoM21Object {\n    constructor(tempoInt) {\n        super();\n        this._tempo = 60; // overridden by music21.tempo.baseTempo;\n        if (tempoInt === undefined) {\n            this.tempo = tempo.baseTempo;\n        } else {\n            this.tempo = tempoInt;\n        }\n        this.numBeatsPerMeasure = 4;\n        this.minTempo = 10;\n        this.maxTempo = 600;\n        this.beat = this.numBeatsPerMeasure;\n        this.chirpTimeout = undefined;\n        this.silent = false;\n        this.flash = false;\n        this.tempoRanges = [0, 40, 60, 72, 120, 144, 240, 999];\n        this.tempoIncreases = [0, 1, 2, 3, 4, 6, 8, 15, 100];\n    }\n    get tempo() {\n        return this._tempo;\n    }\n    set tempo(t) {\n        this._tempo = t;\n        if (this._tempo > this.maxTempo) {\n            this._tempo = this.maxTempo;\n        } else if (this._tempo < this.minTempo) {\n            this._tempo = this.minTempo;\n        }\n    }\n    get beatLength() {\n        return 60.0 / this.tempo;\n    }\n    _silentFlash(flashColor) {\n        this.$metronomeDiv\n            .find('.metroFlash')\n            .css('background-color', flashColor)\n            .fadeOut(this.beatLength * 1000 * 1 / 4, function silentFadeOut() {\n                $(this)\n                    .css('background-color', '#ffffff')\n                    .fadeIn(1);\n            });\n    }\n\n    /**\n     * Play a note (a higher one on the downbeat) and start the metronome chirping.\n     *\n     * @memberof music21.tempo.Metronome\n     */\n    chirp() {\n        this.beat += 1;\n        if (this.beat > this.numBeatsPerMeasure) {\n            this.beat = 1;\n            if (this.silent !== true) {\n                MIDI.noteOn(0, 96, 100, 0);\n                MIDI.noteOff(0, 96, 0.1);\n            }\n            if (this.flash === true) {\n                this._silentFlash('#0000f0');\n            }\n        } else {\n            if (this.silent !== true) {\n                MIDI.noteOn(0, 84, 70, 0);\n                MIDI.noteOff(0, 84, 0.1);\n            }\n            if (this.flash === true) {\n                this._silentFlash('#ff0000');\n            }\n        }\n        const that = this;\n        this.chirpTimeout = setTimeout(() => {\n            that.chirp();\n        }, 1000 * 60 / this.tempo);\n    }\n\n    /**\n     * Stop the metronome from chirping.\n     *\n     * @memberof music21.tempo.Metronome\n     */\n    stopChirp() {\n        if (this.chirpTimeout !== undefined) {\n            clearTimeout(this.chirpTimeout);\n            this.chirpTimeout = undefined;\n        }\n    }\n\n    /**\n     * Increase the metronome tempo one \"click\".\n     *\n     * Value changes depending on the current tempo.  Uses standard metronome guidelines.\n     *\n     * To change the tempo, just set this.tempo = n\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {Int} n - number of clicks to the right\n     * @returns {number} new tempo\n     */\n    increaseSpeed(n) {\n        // increase by one metronome 'click' for every n\n        if (n === undefined) {\n            n = 1;\n        }\n        for (let i = 0; i < n; i++) {\n            let t = this.tempo;\n            for (let tr = 0; tr < this.tempoRanges.length; tr++) {\n                const tempoExtreme = this.tempoRanges[tr];\n                const tempoIncrease = this.tempoIncreases[tr];\n                if (t < tempoExtreme) {\n                    t += tempoIncrease;\n                    t = tempoIncrease * Math.round(t / tempoIncrease);\n                    break;\n                }\n            }\n            // console.log(t);\n            this.tempo = t;\n        }\n        return this.tempo;\n    }\n\n    /**\n     * Decrease the metronome tempo one \"click\"\n     *\n     * To change the tempo, just set this.tempo = n\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {Int} n - number of clicks to the left\n     * @returns {number} new tempo\n     */\n    decreaseSpeed(n) {\n        if (n === undefined) {\n            n = 1;\n        }\n        for (let i = 0; i < n; i++) {\n            let t = this.tempo;\n            const trL = this.tempoRanges.length;\n            for (let tr = 1; tr <= trL; tr++) {\n                const tempoExtreme = this.tempoRanges[trL - tr];\n                const tempoIncrease = this.tempoIncreases[trL - tr + 1];\n                if (t > tempoExtreme) {\n                    t -= tempoIncrease;\n                    t = tempoIncrease * Math.floor(t / tempoIncrease);\n                    break;\n                }\n            }\n            // console.log(t);\n            this.tempo = t;\n        }\n    }\n\n    /**\n     * add a Metronome interface onto the DOM at where\n     *\n     * @memberof music21.tempo.Metronome\n     * @param {JQueryDOMObject|DOMObject} [where='body']\n     * @returns {JQueryDOMObject} - a div holding the metronome.\n     */\n    addDiv(where) {\n        let jWhere;\n        if (where !== undefined && where.jquery !== undefined) {\n            jWhere = where;\n        } else if (where !== undefined) {\n            jWhere = $(where);\n        } else {\n            jWhere = $('body');\n        }\n        const metroThis = this;\n        const tempoHolder = $(\n            '<span class=\"tempoHolder\">' + this.tempo.toString() + '</span>'\n        );\n        tempoHolder.css({\n            'font-size': '24px',\n            'padding-left': '10px',\n            'padding-right': '10px',\n        });\n        const newDiv = $('<div class=\"metronomeRendered\"></div>');\n        newDiv.append(tempoHolder);\n\n        const b1 = $('<button>start</button>');\n        b1.on('click', () => {\n            metroThis.chirp();\n        });\n        const b2 = $('<button>stop</button>');\n        b2.on('click', () => {\n            metroThis.stopChirp();\n        });\n        newDiv.prepend(b2);\n        newDiv.prepend(b1);\n        const b3 = $('<button>up</button>');\n        b3.on('click', function increaseSpeedButton() {\n            metroThis.increaseSpeed();\n            $(this)\n                .prevAll('.tempoHolder')\n                .html(metroThis.tempo.toString());\n        });\n        const b4 = $('<button>down</button>');\n        b4.on('click', function decreaseSpeedButton() {\n            metroThis.decreaseSpeed();\n            $(this)\n                .prevAll('.tempoHolder')\n                .html(metroThis.tempo.toString());\n        });\n        newDiv.append(b3);\n        newDiv.append(b4);\n        const $flash = $(\n            '<span class=\"metroFlash\">'\n                + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>'\n        );\n        $flash.css('margin-left', '40px');\n        $flash.css('height', '40px');\n\n        newDiv.append($flash);\n\n        jWhere.append(newDiv);\n\n        this.$metronomeDiv = newDiv;\n        return newDiv;\n    }\n}\ntempo.Metronome = Metronome;\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/tinyNotation -- TinyNotation implementation\n *\n * Copyright (c) 2013-17, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì17, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\n\nimport { clef } from './clef.js';\nimport { duration } from './duration.js';\nimport { pitch } from './pitch.js';\nimport { note } from './note.js';\nimport { meter } from './meter.js';\nimport { stream } from './stream.js';\nimport { tie } from './tie.js';\n\n/**\n * TinyNotation module, see {@link music21.tinyNotation} namespace\n *\n * @exports music21/tinyNotation\n */\n/**\n * @namespace music21.tinyNotation\n * @memberof music21\n * @requires music21/base\n * @requires music21/clef\n * @requires music21/duration\n * @requires music21/pitch\n * @requires music21/note\n * @requires music21/meter\n * @requires music21/stream\n * @requires music21/tie\n */\nexport const tinyNotation = {};\n\n/**\n * Regular expressions object\n *\n * @memberof music21.tinyNotation\n */\ntinyNotation.regularExpressions = {\n    REST: /r/,\n    OCTAVE2: /([A-G])[A-G]+/,\n    OCTAVE3: /([A-G])/,\n    OCTAVE5: /([a-g])('+)/,\n    OCTAVE4: /([a-g])/,\n    EDSHARP: /\\((#+)\\)/,\n    EDFLAT: /\\((-+)\\)/,\n    EDNAT: /\\(n\\)/,\n    SHARP: /^[A-Ga-g]+'*(#+)/, // simple notation finds\n    FLAT: /^[A-Ga-g]+'*(-+)/, // double sharps too\n    NAT: /^[A-Ga-g]+'*n/, // explicit naturals\n    TYPE: /(\\d+)/,\n    TIE: /.~/, // not preceding ties\n    PRECTIE: /~/, // front ties\n    ID_EL: /=([A-Za-z0-9]*)/,\n    LYRIC: /_(.*)/,\n    DOT: /\\.+/,\n    TIMESIG: /(\\d+)\\/(\\d+)/,\n\n    PARTBREAK: /partBreak/, // nonstandard...fix later...\n\n    TRIP: /trip\\{/,\n    QUAD: /quad\\{/,\n    ENDBRAC: /\\}$/,\n};\n/**\n * Function, not class.\n *\n * Converts a TinyNotation String into a music21 Stream\n *\n * See music21p for examples of what can go into tinynotation. It's an\n * adaptation of Lilypond format, by design Extremely simple!\n *\n * @memberof music21.tinyNotation\n * @param {string} textIn - a valid tinyNotation string\n * @returns {music21.stream.Part|music21.stream.Measure} - a Stream or Part object (if multiple measures)\n * @example\n * var t = \"3/4 c4 B8 c d4 e2.\";\n * var p = music21.tinyNotation.TinyNotation(t);\n * p.duration.quarterLength;\n * // 6.0\n */\ntinyNotation.TinyNotation = function TinyNotation(textIn) {\n    textIn = textIn.trim();\n    const tokens = textIn.split(' ');\n\n    let optionalScore;\n\n    let p = new stream.Part();\n    let m = new stream.Measure();\n    let currentTSBarDuration = 4.0;\n    let lastDurationQL = 1.0;\n    const storedDict = {\n        lastNoteTied: false,\n        inTrip: false,\n        inQuad: false,\n        endTupletAfterNote: false,\n    };\n    const tnre = tinyNotation.regularExpressions; // faster typing\n    for (let i = 0; i < tokens.length; i++) {\n        // check at first so that a full measure but not over full\n        // gets returned as a stream.Measure object.\n        if ((m.duration.quarterLength >= currentTSBarDuration)\n            || (Math.abs(m.duration.quarterLength - currentTSBarDuration) < 0.0001)) {\n            p.append(m);\n            m = new stream.Measure();\n        }\n\n        let token = tokens[i];\n        let noteObj;\n        let lyric;\n        if (tnre.PARTBREAK.exec(token)) {\n            if (m.length > 0) {\n                p.append(m);\n                m = new stream.Measure();\n            }\n            if (optionalScore === undefined) {\n                optionalScore = new stream.Score();\n            }\n            optionalScore.insert(0, p);\n            p = new stream.Part();\n\n            storedDict.lastNoteTied = false;\n            storedDict.inTrip = false;\n            storedDict.inQuad = false;\n            storedDict.endTupletAfterNote = false;\n\n            continue;\n        }\n\n        if (tnre.TRIP.exec(token)) {\n            token = token.slice(5); // cut...\n            storedDict.inTrip = true;\n        }\n        if (tnre.QUAD.exec(token)) {\n            token = token.slice(5); // cut...\n            storedDict.inQuad = true;\n        }\n        if (tnre.ENDBRAC.exec(token)) {\n            token = token.slice(0, -1); // cut...\n            storedDict.endTupletAfterNote = true;\n        }\n\n        // Modifiers\n        if (tnre.LYRIC.exec(token)) {\n            [token, lyric] = token.split('_');\n        }\n\n        if (tnre.TIMESIG.exec(token)) {\n            const MATCH = tnre.TIMESIG.exec(token);\n            const ts = new meter.TimeSignature();\n            ts.numerator = parseInt(MATCH[1]);\n            ts.denominator = parseInt(MATCH[2]);\n            m.timeSignature = ts;\n            currentTSBarDuration = ts.barDuration.quarterLength;\n            // console.log(currentTSBarDuration);\n            continue;\n        } else if (tnre.REST.exec(token)) {\n            noteObj = new note.Rest(lastDurationQL);\n        } else if (tnre.OCTAVE2.exec(token)) {\n            const MATCH = tnre.OCTAVE2.exec(token);\n            noteObj = new note.Note(MATCH[1], lastDurationQL);\n            noteObj.pitch.octave = 4 - MATCH[0].length;\n        } else if (tnre.OCTAVE3.exec(token)) {\n            const MATCH = tnre.OCTAVE3.exec(token);\n            noteObj = new note.Note(MATCH[1], lastDurationQL);\n            noteObj.pitch.octave = 3;\n        } else if (tnre.OCTAVE5.exec(token)) {\n            // must match octave 5 before 4\n            const MATCH = tnre.OCTAVE5.exec(token);\n            noteObj = new note.Note(MATCH[1].toUpperCase(), lastDurationQL);\n            noteObj.pitch.octave = 3 + MATCH[0].length;\n        } else if (tnre.OCTAVE4.exec(token)) {\n            const MATCH = tnre.OCTAVE4.exec(token);\n            noteObj = new note.Note(MATCH[1].toUpperCase(), lastDurationQL);\n            noteObj.pitch.octave = 4;\n        }\n\n        if (noteObj === undefined) {\n            continue;\n        }\n\n        if (lyric !== undefined) {\n            noteObj.lyric = lyric;\n        }\n\n        if (tnre.TIE.exec(token)) {\n            noteObj.tie = new tie.Tie('start');\n            if (storedDict.lastNoteTied) {\n                noteObj.tie.type = 'continue';\n            }\n            storedDict.lastNoteTied = true;\n        } else if (storedDict.lastNoteTied) {\n            noteObj.tie = new tie.Tie('stop');\n            storedDict.lastNoteTied = false;\n        }\n        if (tnre.SHARP.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('sharp');\n        } else if (tnre.FLAT.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('flat');\n        } else if (tnre.NAT.exec(token)) {\n            noteObj.pitch.accidental = new pitch.Accidental('natural');\n            noteObj.pitch.accidental.displayType = 'always';\n        }\n        let MATCH = tnre.TYPE.exec(token);\n        if (MATCH) {\n            const durationType = parseInt(MATCH[0]);\n            noteObj.duration.quarterLength = 4.0 / durationType;\n        }\n        MATCH = tnre.DOT.exec(token);\n        if (MATCH) {\n            const numDots = MATCH[0].length;\n            const multiplier = 1 + (1 - Math.pow(0.5, numDots));\n            noteObj.duration.quarterLength *= multiplier;\n        }\n        lastDurationQL = noteObj.duration.quarterLength;\n        // do before appending tuplets\n\n        if (storedDict.inTrip) {\n            // console.log(noteObj.duration.quarterLength);\n            noteObj.duration.appendTuplet(\n                new duration.Tuplet(3, 2, noteObj.duration.quarterLength)\n            );\n        }\n        if (storedDict.inQuad) {\n            noteObj.duration.appendTuplet(\n                new duration.Tuplet(4, 3, noteObj.duration.quarterLength)\n            );\n        }\n        if (storedDict.endTupletAfterNote) {\n            storedDict.inTrip = false;\n            storedDict.inQuad = false;\n            storedDict.endTupletAfterNote = false;\n        }\n        m.append(noteObj);\n    }\n\n    let returnObject;\n\n    if (optionalScore !== undefined) {\n        if (m.length > 0) {\n            p.append(m);\n        }\n        if (p.length > 0) {\n            optionalScore.append(p);\n        }\n        for (let i = 0; i < optionalScore.length; i++) {\n            const innerPart = optionalScore.get(i);\n            innerPart.clef = clef.bestClef(innerPart);\n        }\n        returnObject = optionalScore;\n    } else if (p.length > 0) {\n        p.append(m);\n        p.clef = clef.bestClef(p);\n        returnObject = p;\n    } else {\n        m.clef = clef.bestClef(m);\n        returnObject = m;\n    }\n    return returnObject;\n};\n\n// render notation divs in HTML\n/**\n * Render all the TinyNotation classes in the DOM as notation\n *\n * Called automatically when music21 is loaded.\n *\n * @memberof music21.tinyNotation\n * @param {string} classTypes - a JQuery selector to find elements to replace.\n */\ntinyNotation.renderNotationDivs = function renderNotationDivs(\n    classTypes,\n    selector\n) {\n    if (classTypes === undefined) {\n        classTypes = '.music21.tinyNotation';\n    }\n    let allRender = [];\n    if (selector === undefined) {\n        allRender = $(classTypes);\n    } else {\n        if (selector.jquery === undefined) {\n            selector = $(selector);\n        }\n        allRender = selector.find(classTypes);\n    }\n    for (let i = 0; i < allRender.length; i++) {\n        const thisTN = allRender[i];\n        const $thisTN = $(thisTN);\n        let thisTNContents;\n        if ($thisTN.attr('tinynotationcontents') !== undefined) {\n            thisTNContents = $thisTN.attr('tinynotationcontents');\n        } else if (thisTN.textContent !== undefined) {\n            thisTNContents = thisTN.textContent;\n            thisTNContents = thisTNContents.replace(/s+/g, ' '); // no line-breaks, etc.\n        }\n\n        if (\n            String.prototype.trim !== undefined\n            && thisTNContents !== undefined\n        ) {\n            thisTNContents = thisTNContents.trim(); // remove leading, trailing whitespace\n        }\n        if (thisTNContents) {\n            const st = tinyNotation.TinyNotation(thisTNContents);\n            if ($thisTN.hasClass('noPlayback')) {\n                st.renderOptions.events.click = undefined;\n            }\n            const newSVG = st.createDOM();\n\n            $thisTN.attr('tinynotationcontents', thisTNContents);\n            $thisTN.empty();\n            $thisTN.data('stream', st);\n            $thisTN.append(newSVG);\n            // console.log(thisTNContents);\n        }\n    }\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21 features.\n * music21/voiceLeading -- voiceLeading objects\n *\n * Copyright (c) 2013-18, Michael Scott Cuthbert and cuthbertLab\n * Based on music21, Copyright (c) 2006‚Äì18, Michael Scott Cuthbert and cuthbertLab\n *\n */\n\nimport { interval } from './interval.js';\nimport { key } from './key.js';\nimport { note } from './note.js';\n\nimport { Music21Object } from './base.js';\n\nconst intervalCache = [];\n\nconst MotionType = {\n    antiParallel: 'Anti-Parallel',\n    contrary: 'Contrary',\n    noMotion: 'No Motion',\n    oblique: 'Oblique',\n    parallel: 'Parallel',\n    similar: 'Similar',\n};\n\nclass VoiceLeadingQuartet extends Music21Object {\n    constructor(v1n1, v1n2, v2n1, v2n2, analyticKey) {\n        super();\n        if (!intervalCache.length) {\n            intervalCache.push(new interval.Interval('P1'));\n            intervalCache.push(new interval.Interval('P5'));\n            intervalCache.push(new interval.Interval('P8'));\n        }\n        this.unison = intervalCache[0];\n        this.fifth = intervalCache[1];\n        this.octave = intervalCache[2];\n\n        this._v1n1 = undefined;\n        this._v1n2 = undefined;\n        this._v2n1 = undefined;\n        this._v2n2 = undefined;\n\n        this.v1n1 = v1n1;\n        this.v1n2 = v1n2;\n        this.v2n1 = v2n1;\n        this.v2n2 = v2n2;\n\n        this.vIntervals = [];\n        this.hIntervals = [];\n\n        this._key = undefined;\n        if (analyticKey !== undefined) {\n            this.key = analyticKey;\n        }\n        if (\n            v1n1 !== undefined\n            && v1n2 !== undefined\n            && v2n1 !== undefined\n            && v2n2 !== undefined\n        ) {\n            this._findIntervals();\n        }\n    }\n\n    _setVoiceNote(value, which) {\n        if (value === undefined) {\n            this[which] = value;\n        } else if (typeof value === 'string') {\n            this[which] = new note.Note(value);\n        } else if (value.classes.includes('Note')) {\n            this[which] = value;\n        } else {\n            const n = new note.Note(value.nameWithOctave);\n            n.duration.quarterLength = 0.0;\n            this[which] = n;\n        }\n    }\n\n    get v1n1() {\n        return this._v1n1;\n    }\n    set v1n1(value) {\n        this._setVoiceNote(value, '_v1n1');\n    }\n    get v1n2() {\n        return this._v1n2;\n    }\n    set v1n2(value) {\n        this._setVoiceNote(value, '_v1n2');\n    }\n    get v2n1() {\n        return this._v2n1;\n    }\n    set v2n1(value) {\n        this._setVoiceNote(value, '_v2n1');\n    }\n    get v2n2() {\n        return this._v2n2;\n    }\n    set v2n2(value) {\n        this._setVoiceNote(value, '_v2n2');\n    }\n\n    get key() {\n        return this._key;\n    }\n    set key(keyValue) {\n        if (typeof keyValue === 'string') {\n            keyValue = new key.Key(\n                key.convertKeyStringToMusic21KeyString(keyValue)\n            );\n        }\n        this._key = keyValue;\n    }\n\n    _findIntervals() {\n        this.vIntervals.push(new interval.Interval(this.v1n1, this.v2n1));\n        this.vIntervals.push(new interval.Interval(this.v1n2, this.v2n2));\n        this.hIntervals.push(new interval.Interval(this.v1n1, this.v1n2));\n        this.hIntervals.push(new interval.Interval(this.v2n1, this.v2n2));\n    }\n\n    motionType() {\n        if (this.obliqueMotion()) {\n            return MotionType.oblique;\n        } else if (this.parallelMotion()) {\n            return MotionType.parallel;\n        } else if (this.similarMotion()) {\n            return MotionType.similar;\n        } else if (this.contraryMotion()) {\n            return MotionType.contrary;\n        } else if (this.antiParallelMotion()) {\n            return MotionType.antiParallel;\n        } else if (this.noMotion()) {\n            return MotionType.noMotion;\n        }\n        return undefined;\n    }\n\n    noMotion() {\n        for (const iV of this.hIntervals) {\n            if (iV.name !== 'P1') {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    obliqueMotion() {\n        if (this.noMotion()) {\n            return false;\n        }\n\n        for (const iH of this.hIntervals) {\n            if (iH.name === 'P1') {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    similarMotion() {\n        if (this.noMotion()) {\n            return false;\n        }\n\n        if (this.hIntervals[0].direction === this.hIntervals[1].direction) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    parallelMotion(requiredInterval) {\n        if (!this.similarMotion()) {\n            return false;\n        }\n        if (\n            this.vIntervals[0].directedSimpleName\n            !== this.vIntervals[1].directedSimpleName\n        ) {\n            return false;\n        }\n        if (requiredInterval === undefined) {\n            return true;\n        }\n        if (typeof requiredInterval === 'string') {\n            requiredInterval = new interval.Interval(requiredInterval);\n        }\n        if (this.vIntervals[0].simpleName === requiredInterval.simpleName) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    contraryMotion() {\n        if (this.noMotion()) {\n            return false;\n        }\n        if (this.obliqueMotion()) {\n            return false;\n        }\n        if (this.hIntervals[0].direction === this.hIntervals[1].direction) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n\n    outwardContraryMotion() {\n        return (\n            this.contraryMotion()\n            && this.hIntervals[0].direction === interval.Direction.ASCENDING\n        );\n    }\n\n    inwardContraryMotion() {\n        return (\n            this.contraryMotion()\n            && this.hIntervals[0].direction === interval.Direction.DESCENDING\n        );\n    }\n\n    antiParallelMotion(simpleName) {\n        if (!this.contraryMotion()) {\n            return false;\n        }\n        if (this.vIntervals[0].simpleName !== this.vIntervals[1].simpleName) {\n            return false;\n        }\n        if (simpleName === undefined) {\n            return true;\n        }\n        if (typeof simpleName === 'string') {\n            if (this.vIntervals[0].simpleName === simpleName) {\n                return true;\n            } else {\n                return false;\n            }\n        } else if (this.vIntervals[0].simpleName === simpleName.simpleName) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    parallelInterval(thisInterval) {\n        if (!(this.parallelMotion() || this.antiParallelMotion())) {\n            return false;\n        }\n        if (typeof thisInterval === 'string') {\n            thisInterval = new interval.Interval(thisInterval);\n        }\n\n        if (this.vIntervals[0].semiSimpleName === thisInterval.semiSimpleName) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    parallelFifth() {\n        return this.parallelInterval(this.fifth);\n    }\n\n    parallelOctave() {\n        return this.parallelInterval(this.octave);\n    }\n\n    parallelUnison() {\n        return this.parallelInterval(this.unison);\n    }\n\n    parallelUnisonOrOctave() {\n        return this.parallelUnison() || this.parallelOctave();\n    }\n\n    hiddenInterval(thisInterval) {\n        if (this.parallelMotion()) {\n            return false;\n        }\n        if (!this.similarMotion()) {\n            return false;\n        }\n\n        if (typeof thisInterval === 'string') {\n            thisInterval = new interval.Interval(thisInterval);\n        }\n        if (this.vIntervals[1].simpleName === thisInterval.simpleName) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    hiddenFifth() {\n        return this.hiddenInterval(this.fifth);\n    }\n\n    hiddenOctave() {\n        return this.hiddenInterval(this.octave);\n    }\n\n    // True if either note in voice 1 is lower than the corresponding voice 2 note\n    voiceCrossing() {\n        return (\n            this.v1n1.pitch.ps < this.v2n1.pitch.ps\n            || this.v1n2.pitch.ps < this.v2n2.pitch.ps\n        );\n    }\n\n    voiceOverlap() {\n        return (\n            this.v1n2.pitch.ps <= this.v2n1.pitch.ps\n            || this.v2n2.pitch.ps >= this.v1n1.pitch.ps\n        );\n    }\n\n    /**\n     * isProperResolution - Checks whether the voice-leading quartet resolves correctly according to standard\n     *         counterpoint rules. If the first harmony is dissonant (d5, A4, or m7) it checks\n     *         that these are correctly resolved. If the first harmony is consonant, True is returned.\n     *\n     *         The key parameter should be specified to check for motion in the bass from specific\n     *         note degrees. If it is not set, then no checking for scale degrees takes place.\n     *\n     *         Diminished Fifth: in by contrary motion to a third, with 7 resolving up to 1 in the bass\n     *         Augmented Fourth: out by contrary motion to a sixth, with chordal seventh resolving\n     *         down to a third in the bass.\n     *         Minor Seventh: Resolves to a third with a leap form 5 to 1 in the bass\n     *\n     * @return {boolean}  true if proper or rules do not apply; false if improper\n     */\n\n    isProperResolution() {\n        if (this.noMotion()) {\n            return true;\n        }\n        let scale;\n        let n1degree;\n        let n2degree;\n        if (this.key !== undefined) {\n            scale = this.key.getScale();\n            n1degree = scale.getScaleDegreeFromPitch(this.v2n1);\n            n2degree = scale.getScaleDegreeFromPitch(this.v2n2);\n        }\n\n        // catches case of #7 in minor\n        if (\n            this.key !== undefined\n            && this.key.mode === 'minor'\n            && (n1degree === undefined || n2degree === undefined)\n        ) {\n            const scale2 = this.key.getScale('melodic-minor'); // gets ascending form\n            if (n1degree === undefined) {\n                n1degree = scale2.getScaleDegreeFromPitch(this.v2n1);\n            }\n            if (n2degree === undefined) {\n                n2degree = scale2.getScaleDegreeFromPitch(this.v2n2);\n            }\n        }\n\n        const firstHarmony = this.vIntervals[0].simpleName;\n        const secondHarmony = this.vIntervals[1].generic.simpleUndirected;\n\n        if (firstHarmony === 'P4') {\n            if (this.v1n1.pitch.ps >= this.v1n2.pitch.ps) {\n                return true;\n            } else {\n                return false;\n            }\n        } else if (firstHarmony === 'd5') {\n            if (scale !== undefined && n1degree !== 7) {\n                return true;\n            }\n            if (scale !== undefined && n2degree !== 1) {\n                return false;\n            }\n            return this.inwardContraryMotion() && secondHarmony === 3;\n        } else if (firstHarmony === 'A4') {\n            if (scale !== undefined && n1degree !== 4) {\n                return true;\n            }\n            if (scale !== undefined && n2degree !== 3) {\n                return false;\n            }\n            return this.outwardContraryMotion() && secondHarmony === 6;\n        } else if (firstHarmony === 'm7') {\n            if (scale !== undefined && n1degree !== 5) {\n                return true;\n            }\n            if (scale !== undefined && n2degree !== 1) {\n                return false;\n            }\n            return secondHarmony === 3;\n        } else {\n            return true;\n        }\n    }\n}\n\nexport const voiceLeading = {\n    VoiceLeadingQuartet,\n};\n","/**\n * music21j -- Javascript reimplementation of Core music21p features.\n * music21/webmidi -- webmidi or wrapper around the Jazz Plugin\n *\n * For non webmidi --  Uses the cross-platform, cross-browser plugin from\n * http://jazz-soft.net/doc/Jazz-Plugin/Plugin.html\n * P.S. by the standards of divinity of most major religions, Sema Kachalo is a god.\n *\n * Copyright (c) 2014-18, Michael Scott Cuthbert and cuthbertLab\n * Based on music21 (=music21p), Copyright (c) 2006‚Äì18, Michael Scott Cuthbert and cuthbertLab\n *\n */\nimport * as $ from 'jquery';\nimport { debug } from './debug.js';\nimport { common } from './common.js';\nimport { miditools } from './miditools.js';\n\n/**\n * webmidi -- for connecting with external midi devices\n *\n * Uses either the webmidi API or the Jazz plugin\n *\n * See {@link music21.webmidi}\n *\n * @exports music21/webmidi\n */\n/**\n * webmidi -- for connecting with external midi devices\n *\n * Uses either the webmidi API or the Jazz plugin\n *\n * @namespace music21.webmidi\n * @memberof music21\n * @requires music21/miditools\n * @requires jquery\n * @property {JazzObject|undefined} storedPlugin - reference to the Jazz object from the plugin; cached from `createPlugin`.\n * @property {string} selectedJazzInterface - the currently connected interface (note that we can only use one right now)\n */\nexport const webmidi = {};\n\nwebmidi.selectedOutputPort = undefined;\nwebmidi.selectedInputPort = undefined;\n\nwebmidi.access = undefined;\nwebmidi.$selectDiv = undefined;\n\nwebmidi.jazzDownloadUrl = 'http://jazz-soft.net/download/Jazz-Plugin/';\nwebmidi.storedPlugin = undefined;\nwebmidi.selectedJazzInterface = undefined; // not the same as \"\" etc. uses last selected interface by default.\n\n/**\n * Called by Jazz MIDI plugin when an event arrives.\n *\n * Shim to convert the data into WebMIDI API format and then call the WebMIDI API midiInArrived\n *\n * See the MIDI spec for information on parameters\n *\n * @memberof music21.webmidi\n * @param {byte} t - timing information\n * @param {byte} a - data 1\n * @param {byte} b - data 2\n * @param {byte} c - data 3\n */\nwebmidi.jazzMidiInArrived = function jazzMidiInArrived(t, a, b, c) {\n    const webmidiEvent = {\n        timestamp: t,\n        data: [a, b, c],\n    };\n    return webmidi.midiInArrived(webmidiEvent);\n};\n\n/**\n * Called directly when a MIDI event arrives from the WebMIDI API, or via a Shim (jazzMidiInArrived)\n * when MIDI information comes from JazzMIDI\n *\n * Calls the 'raw' and 'general callbacks when a raw midi event (four bytes)\n * arrives.\n *\n * See the MIDI spec for information on the contents of the three parameters.\n *\n * midiMessageEvent should be an object with two keys: timeStamp (int) and data (array of three int values)\n *\n * @memberof music21.webmidi\n * @param {MidiMessageEvent} midiMessageEvent - midi Information\n */\nwebmidi.midiInArrived = function midiInArrived(midiMessageEvent) {\n    const t = midiMessageEvent.timeStamp;\n    const a = midiMessageEvent.data[0];\n    const b = midiMessageEvent.data[1];\n    const c = midiMessageEvent.data[2];\n    const eventObject = miditools.callBacks.raw(t, a, b, c);\n    if (miditools.callBacks.general instanceof Array) {\n        return miditools.callBacks.general.forEach((el, index, array) => {\n            el(eventObject);\n        });\n    } else if (miditools.callBacks.general !== undefined) {\n        return miditools.callBacks.general(eventObject);\n    } else {\n        return undefined;\n    }\n};\n\n/**\n * Create a hidden tiny, &lt;object&gt; tag in the DOM with the\n * proper classid (`CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90`) to\n * load the Jazz plugin.\n *\n * It will return the plugin if it can or undefined if it cannot. Caches it in webmidi.storedPlugin.\n *\n * @function music21.webmidi.createPlugin\n * @param {DOMObject} [appendElement=document.body] - where to place this hidden object (does not really matter)\n * @param {Boolean} [override=false] - if this method has been called successfully before return the storedPlugin unless override is true.\n * @returns {Jazz|undefined} Jazz MIDI plugin object\n */\nwebmidi.createPlugin = function createPlugin(appendElement, override) {\n    if (webmidi.storedPlugin && override !== true) {\n        return webmidi.storedPlugin;\n    }\n    if (typeof appendElement === 'undefined') {\n        appendElement = $('body')[0];\n    }\n    const obj = document.createElement('object');\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n    if (!obj.isJazz) {\n        obj.type = 'audio/x-jazz';\n    }\n    obj.style.visibility = 'hidden';\n    obj.style.width = '0px';\n    obj.style.height = '0px';\n    appendElement.appendChild(obj);\n\n    if (obj.isJazz) {\n        webmidi.storedPlugin = obj;\n        return obj;\n    } else {\n        appendElement.removeChild(obj);\n        console.error(\n            'Cannot use jazz plugin; install at ' + webmidi.jazzDownloadUrl\n        );\n        return undefined;\n    }\n};\n\n/**\n * Creates a &lt;select&gt; object for selecting among the MIDI choices in Jazz\n *\n * @function music21.webmidi.createJazzSelector\n * @param {JQueryDOMObject|DOMObject} [midiSelectDiv=document.body] - object to append the select to\n * @param {object} [options] - see createSelector for details\n * @returns {DOMObject|undefined} DOM object containing the select tag, or undefined if Jazz cannot be loaded.\n */\nwebmidi.createJazzSelector = function createJazzSelector($newSelect, options) {\n    const params = {};\n    common.merge(params, options);\n\n    const Jazz = webmidi.createPlugin();\n    if (Jazz === undefined) {\n        return undefined;\n    }\n\n    $newSelect.change(() => {\n        const selectedInput = $('#midiInSelect option:selected').text();\n        if (selectedInput !== 'None selected') {\n            webmidi.selectedJazzInterface = Jazz.MidiInOpen(\n                selectedInput,\n                webmidi.jazzMidiInArrived\n            );\n        } else {\n            Jazz.MidiInClose();\n        }\n        if (debug) {\n            console.log(\n                'current input changed to: ' + webmidi.selectedInterface\n            );\n        }\n    });\n    const midiOptions = Jazz.MidiInList();\n    const noneAppendOption = $(\"<option value='None'>None selected</option>\");\n    $newSelect.append(noneAppendOption);\n\n    let anySelected = false;\n    const allAppendOptions = [];\n    for (let i = 0; i < midiOptions.length; i++) {\n        const $appendOption = $(\n            \"<option value='\"\n                + midiOptions[i]\n                + \"'>\"\n                + midiOptions[i]\n                + '</option>'\n        );\n        if (midiOptions[i] === webmidi.selectedJazzInterface) {\n            $appendOption.attr('selected', true);\n            anySelected = true;\n        }\n        allAppendOptions.push($appendOption);\n        // console.log(appendOption);\n        $newSelect.append($appendOption);\n    }\n    if (anySelected === false && midiOptions.length > 0) {\n        $newSelect.val(midiOptions[0]);\n        allAppendOptions[0].attr('selected', true);\n        webmidi.selectedJazzInterface = Jazz.MidiInOpen(\n            midiOptions[0],\n            webmidi.jazzMidiInArrived\n        );\n        anySelected = true;\n    } else {\n        noneAppendOption.attr('selected', true);\n    }\n    if (params.onsuccess !== undefined) {\n        params.onsuccess();\n    }\n    if (anySelected === true && params.oninputsuccess !== undefined) {\n        params.oninputsuccess();\n    } else if (anySelected === false && params.oninputempty !== undefined) {\n        params.oninputempty();\n    }\n    return $newSelect;\n};\n\n/**\n * Function to be called if the webmidi-api selection changes. (not jazz)\n *\n */\nwebmidi.selectionChanged = function selectionChanged() {\n    const selectedInput = webmidi.$select.val();\n    if (selectedInput === webmidi.selectedInputPort) {\n        return false;\n    }\n    const storedStateChange = webmidi.access.onstatechange; // port.close() fires onstatechange, so turn off for a moment.\n    webmidi.access.onstatechange = () => {};\n    if (debug) {\n        console.log('current input changed to: ' + selectedInput);\n    }\n    webmidi.selectedInputPort = selectedInput;\n\n    webmidi.access.inputs.forEach(port => {\n        if (port.name === selectedInput) {\n            port.onmidimessage = webmidi.midiInArrived;\n        } else {\n            port.close();\n        }\n    });\n    webmidi.access.onstatechange = storedStateChange;\n    return false;\n};\n\n/**\n * Creates a &lt;select&gt; object for selecting among the MIDI choices in Jazz\n *\n * The options object has several parameters:\n *\n * {bool} autoupdate -- should this auto update?\n * {function} onsuccess -- function to call on all successful port queries\n * {function} oninputsuccess -- function to call if successful and at least one input device is found\n * {function} oninputempty -- function to call if successful but no input devices are found.\n * {bool} existingMidiSelect -- is there already a select tag for MIDI?\n *\n * @function music21.webmidi.createSelector\n * @param {JQueryDOMObject|DOMObject} [$midiSelectDiv=$('body')] - object to append the select to\n * @param {object} [options] - see above.\n * @returns {DOMObject|undefined} DOM object containing the select tag, or undefined if Jazz cannot be loaded.\n */\nwebmidi.createSelector = function createSelector($midiSelectDiv, options) {\n    const params = {\n        autoUpdate: true,\n        existingMidiSelect: false,\n    };\n    common.merge(params, options);\n\n    if (typeof $midiSelectDiv === 'undefined') {\n        $midiSelectDiv = $('body');\n    }\n    if ($midiSelectDiv.jquery === undefined) {\n        $midiSelectDiv = $($midiSelectDiv);\n    }\n    let $newSelect;\n    const foundMidiSelects = $midiSelectDiv.find('select#midiInSelect');\n    if (foundMidiSelects.length > 0) {\n        $newSelect = foundMidiSelects[0];\n        params.existingMidiSelect = true;\n    } else {\n        $newSelect = $('<select>').attr('id', 'midiInSelect');\n        $midiSelectDiv.append($newSelect);\n    }\n    webmidi.$select = $newSelect;\n\n    if (navigator.requestMIDIAccess === undefined) {\n        webmidi.createJazzSelector($newSelect, params);\n    } else {\n        if (params.existingMidiSelect !== true) {\n            $newSelect.change(webmidi.selectionChanged);\n        }\n        navigator.requestMIDIAccess().then(\n            access => {\n                webmidi.access = access;\n                webmidi.populateSelect();\n                if (params.autoUpdate) {\n                    access.onstatechange = webmidi.populateSelect;\n                }\n                webmidi.$select.change();\n                if (params.onsuccess !== undefined) {\n                    params.onsuccess();\n                }\n                if (\n                    webmidi.selectedInputPort !== 'None'\n                    && params.oninputsuccess !== undefined\n                ) {\n                    params.oninputsuccess();\n                } else if (\n                    webmidi.selectedInputPort === 'None'\n                    && params.oninputempty !== undefined\n                ) {\n                    params.oninputempty();\n                }\n            },\n            e => {\n                $midiSelectDiv.html(e.message);\n            }\n        );\n    }\n    miditools.clearOldChords(); // starts the chord checking process.\n    return $newSelect;\n};\n\nwebmidi.populateSelect = function populateSelect() {\n    const inputs = webmidi.access.inputs;\n    webmidi.$select.empty();\n\n    const $noneAppendOption = $(\"<option value='None'>None selected</option>\");\n    webmidi.$select.append($noneAppendOption);\n\n    const allAppendOptions = [];\n    const midiOptions = [];\n    let i = 0;\n    inputs.forEach(port => {\n        const $appendOption = $(\n            \"<option value='\" + port.name + \"'>\" + port.name + '</option>'\n        );\n        allAppendOptions.push($appendOption);\n        midiOptions.push(port.name);\n        // console.log(appendOption);\n        webmidi.$select.append($appendOption);\n        i += 1;\n    });\n\n    if (allAppendOptions.length > 0) {\n        webmidi.$select.val(midiOptions[0]);\n        allAppendOptions[0].attr('selected', true);\n    } else {\n        $noneAppendOption.attr('selected', true);\n    }\n    webmidi.$select.change();\n};\n\n// this allows for the deprecated webmidi.callBacks to still work for now.\nwebmidi.callBacks = miditools.callBacks;\n\n/**\n * Example smallest usage of the webmidi toolkit.  see testHTML/midiInRequire.html\n\n<html>\n<head>\n    <title>MIDI In/Jazz Test for Music21j</title>\n    <!-- for MSIE 10 on Windows 8 -->\n    <meta http-equiv=\"X-UA-Compatible\" content=\"requiresActiveX=true\"/>\n    <script data-main=\"../src/music21.js\" src=\"../ext/require/require.js\"></script>\n    <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" />\n\n    <script>\n    var s = \"\";\n    function displayStream(me) {\n        me.sendToMIDIjs();\n        if (me.noteOn) {\n            var m21n = me.music21Note();\n            if (s.length > 7) {\n                s.elements = s.elements.slice(1)\n            }\n            s.append(m21n);\n            var $svgDiv = $(\"#svgDiv\");\n            $svgDiv.empty();\n            var svgDiv = s.appendNewDOM($svgDiv);\n        }\n    }\n\n    require(['music21'], function () {\n        s = new music21.stream.Stream();\n        music21.webmidi.createSelector($(\"#putMidiSelectHere\"));\n        music21.miditools.callBacks.general = displayStream;\n    });\n\n\n    </script>\n</head>\n<body>\n<div>\nMIDI Input: <div id=\"putMidiSelectHere\" />\n</div>\n<div id=\"svgDiv\">\n</div>\n</body>\n</html>\n **/\n","// order below doesn't matter, but good to give a sense\n// of what will be needed by almost everyone, and then\n// alphabetical.\nimport * as exceptions21 from './music21/exceptions21.js';\nimport { debug } from './music21/debug.js';\nimport { common } from './music21/common.js';\nimport { prebase } from './music21/prebase.js';\nimport { base } from './music21/base.js';\n\nimport { articulations } from './music21/articulations.js';\nimport { audioRecording } from './music21/audioRecording.js';\nimport { audioSearch } from './music21/audioSearch.js';\nimport { beam } from './music21/beam.js';\nimport { chord } from './music21/chord.js';\nimport { clef } from './music21/clef.js';\nimport { duration } from './music21/duration.js';\nimport { dynamics } from './music21/dynamics.js';\nimport { expressions } from './music21/expressions.js';\nimport { figuredBass } from './music21/figuredBass.js';\nimport { fromPython } from './music21/fromPython.js';\nimport { harmony } from './music21/harmony.js';\nimport { instrument } from './music21/instrument.js';\nimport { interval } from './music21/interval.js';\nimport { key } from './music21/key.js';\nimport { keyboard } from './music21/keyboard.js';\nimport { layout } from './music21/layout.js';\nimport { meter } from './music21/meter.js';\nimport { miditools } from './music21/miditools.js';\nimport { musicxml } from './music21/musicxml.js';\nimport { note } from './music21/note.js';\nimport { pitch } from './music21/pitch.js';\nimport { renderOptions } from './music21/renderOptions.js';\nimport { roman } from './music21/roman.js';\nimport { scale } from './music21/scale.js';\nimport { sites } from './music21/sites.js';\nimport { stream } from './music21/stream.js';\nimport { tempo } from './music21/tempo.js';\nimport { tie } from './music21/tie.js';\nimport { tinyNotation } from './music21/tinyNotation.js';\nimport { voiceLeading } from './music21/voiceLeading.js';\nimport { vfShow } from './music21/vfShow.js';\nimport { webmidi } from './music21/webmidi.js';\n\nconst music21 = {\n    common,\n    debug,\n    prebase,\n    base,\n\n    articulations,\n    audioRecording,\n    audioSearch,\n    beam,\n    chord,\n    clef,\n    dynamics,\n    duration,\n    exceptions21,\n    expressions,\n    figuredBass,\n    fromPython,\n    harmony,\n    instrument,\n    interval,\n    key,\n    keyboard,\n    layout,\n    meter,\n    miditools,\n    musicxml,\n    note,\n    pitch,\n    renderOptions,\n    roman,\n    scale,\n    sites,\n    stream,\n    tempo,\n    tie,\n    tinyNotation,\n    voiceLeading,\n    vfShow,\n    webmidi,\n};\n\nmusic21.Music21Object = base.Music21Object;\n\nexport default music21;\n"]}